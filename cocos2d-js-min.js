(()=>{var se=(Yt=>typeof require!="undefined"?require:typeof Proxy!="undefined"?new Proxy(Yt,{get:(Ut,Bt)=>(typeof require!="undefined"?require:Ut)[Bt]}):Yt)(function(Yt){if(typeof require!="undefined")return require.apply(this,arguments);throw Error('Dynamic require of "'+Yt+'" is not supported')});(()=>{var Yt=(Ut=>typeof se!="undefined"?se:typeof Proxy!="undefined"?new Proxy(Ut,{get:(Bt,kt)=>(typeof se!="undefined"?se:Bt)[kt]}):Ut)(function(Ut){if(typeof se!="undefined")return se.apply(this,arguments);throw Error('Dynamic require of "'+Ut+'" is not supported')});(function(){var Ut=function(Bt){return typeof Yt!="undefined"?Yt:typeof Proxy!="undefined"?new Proxy(Bt,{get:function(kt,T){return(typeof Yt!="undefined"?Yt:kt)[T]}}):Bt}(function(Bt){if(typeof Yt!="undefined")return Yt.apply(this,arguments);throw new Error('Dynamic require of "'+Bt+'" is not supported')});(function(){var Bt=function(kt){return typeof Ut!="undefined"?Ut:typeof Proxy!="undefined"?new Proxy(kt,{get:function(T,N){return(typeof Ut!="undefined"?Ut:T)[N]}}):kt}(function(kt){if(typeof Ut!="undefined")return Ut.apply(this,arguments);throw new Error('Dynamic require of "'+kt+'" is not supported')});(function(){var kt=function(T){return typeof Bt!="undefined"?Bt:typeof Proxy!="undefined"?new Proxy(T,{get:function(N,z){return(typeof Bt!="undefined"?Bt:N)[z]}}):T}(function(T){if(typeof Bt!="undefined")return Bt.apply(this,arguments);throw new Error('Dynamic require of "'+T+'" is not supported')});(function(T,N,z){function o(t,e){var r=N[t];if(!r){var a=T[t];if(!a){var c=typeof kt=="function"&&kt;if(!e&&c)return c(t,!0);if(s)return s(t,!0);var h=new Error("Cannot find module '"+t+"'");throw h.code="MODULE_NOT_FOUND",h}var u={};r=N[t]={exports:u},a[0](function(d){return o(a[1][d]||d)},r,u)}return r.exports}for(var s=typeof kt=="function"&&kt,n=0;n<z.length;n++)o(z[n])})({1:[function(T,N,z){function o(){cc._engineLoaded=!0,console.log(cc.ENGINE_VERSION),e&&e()}function s(){window.removeEventListener("load",s,!1),o()}cc._LogInfos=cc._LogInfos||{},window.CocosEngine=cc.ENGINE_VERSION="1.9.3";var n=function(r,a){var c=window.location.search;if(c&&c.indexOf("?")!==-1&&(c=c.substr(1)||window.location.hash.split("?")[1])){var h=new RegExp("(^|&)"+r+"=([^&]*)(&|$)"),u=c.match(h);if(u!=null)return decodeURIComponent(u[2])}return a};n("screen_mode")==="horizontal"&&(window.CMPlayScreen={containerWidth:0,containerHeight:0,canvasWidth:0,canvasHeight:0,resize:function(r,a){if(window.CMPlayScreen.containerWidth!=r||window.CMPlayScreen.containerHeight!=a){var c=n("screen_ratio"),h=.625;c!=null&&(h=Number(c)),window.CMPlayScreen.containerWidth=r,window.CMPlayScreen.containerHeight=window.CMPlayScreen.canvasHeight=a,window.CMPlayScreen.canvasWidth=h*a}}},window.CMPlayScreen.resize(window.innerWidth,window.innerHeight)),cc._renderContext=null,cc._supportRender=!1,cc._canvas=null,cc.container=null,cc._gameDiv=null,T("./cocos2d/core/utils"),T("./cocos2d/core/platform/CCSys");var t=!1,e=null;cc._engineLoaded=!1,cc.initEngine=function(r,a){if(t){var c=e;e=function(){c&&c(),a&&a()}}else e=a,!cc.game.config&&r?cc.game.config=r:cc.game.config||cc.game._loadConfig(),r=cc.game.config,window.CMPlayScreen&&(cc.game.config.height=window.CMPlayScreen.canvasHeight,cc.game.config.width=window.CMPlayScreen.canvasWidth),function(h){var u=cc.game.CONFIG_KEY,d=parseInt(h[u.renderMode])||0;(Number.isNaN(d)||d>2||d<0)&&(h[u.renderMode]=0),cc._renderType=cc.game.RENDER_TYPE_CANVAS,cc._supportRender=!1,d===0?cc.sys.capabilities.opengl?(cc._renderType=cc.game.RENDER_TYPE_WEBGL,cc._supportRender=!0):cc.sys.capabilities.canvas&&(cc._renderType=cc.game.RENDER_TYPE_CANVAS,cc._supportRender=!0):d===1&&cc.sys.capabilities.canvas?(cc._renderType=cc.game.RENDER_TYPE_CANVAS,cc._supportRender=!0):d===2&&cc.sys.capabilities.opengl&&(cc._renderType=cc.game.RENDER_TYPE_WEBGL,cc._supportRender=!0),cc._supportRender||(cc._renderType=cc.game.RENDER_TYPE_CANVAS,cc._supportRender=!0)}(r),document.body?o():window.addEventListener("load",s,!1),t=!0}},{"./cocos2d/core/platform/CCSys":144,"./cocos2d/core/utils":184}],2:[function(T,N,z){function o(e,r){return function(a){"use strict";if(arguments.length!==1){var c="";arguments.length===2?c="Arguments: "+arguments[1]:arguments.length>2&&(c="Arguments: "+cc.js.shiftArguments.apply(null,arguments).join(", ")),e(r+" "+a+", please go to "+t+"#"+a+" to see details. "+c)}else e(r+" "+a+", please go to "+t+"#"+a+" to see details.")}}var s,n=T("./cocos2d/core/platform/CCEnum");cc.DebugMode=n({NONE:0,INFO:1,WARN:2,ERROR:3,INFO_FOR_WEB_PAGE:4,WARN_FOR_WEB_PAGE:5,ERROR_FOR_WEB_PAGE:6}),cc._initDebugSetting=function(e){if(cc.log=cc.logID=cc.warn=cc.warnID=cc.error=cc.errorID=cc.assert=cc.assertID=function(){},e!==cc.DebugMode.NONE){e>cc.DebugMode.ERROR?function(){function a(c){if(cc._canvas){if(!s){var h=document.createElement("Div");h.setAttribute("id","logInfoDiv"),h.setAttribute("width","200"),h.setAttribute("height",cc._canvas.height);var u=h.style;u.zIndex="99999",u.position="absolute",u.top=u.left="0",(s=document.createElement("textarea")).setAttribute("rows","20"),s.setAttribute("cols","30"),s.setAttribute("disabled","true");var d=s.style;d.backgroundColor="transparent",d.borderBottom="1px solid #cccccc",d.borderTopWidth=d.borderLeftWidth=d.borderRightWidth="0px",d.borderTopStyle=d.borderLeftStyle=d.borderRightStyle="none",d.padding="0px",d.margin=0,h.appendChild(s),cc._canvas.parentNode.appendChild(h)}s.value=s.value+c+`\r
`,s.scrollTop=s.scrollHeight}}cc.error=function(){a("ERROR :  "+cc.js.formatStr.apply(null,arguments))},cc.assert=function(c,h){"use strict";!c&&h&&a("ASSERT: "+(h=cc.js.formatStr.apply(null,cc.js.shiftArguments.apply(null,arguments))))},e!==cc.DebugMode.ERROR_FOR_WEB_PAGE&&(cc.warn=function(){a("WARN :  "+cc.js.formatStr.apply(null,arguments))}),e===cc.DebugMode.INFO_FOR_WEB_PAGE&&(cc.log=cc.info=function(){a(cc.js.formatStr.apply(null,arguments))})}():console&&console.log.apply&&(console.error||(console.error=console.log),console.warn||(console.warn=console.log),console.error.bind?cc.error=console.error.bind(console):cc.error=function(){return console.error.apply(console,arguments)},cc.assert=function(a,c){if(!a)throw c&&(c=cc.js.formatStr.apply(null,cc.js.shiftArguments.apply(null,arguments))),new Error(c)}),e!==cc.DebugMode.ERROR&&(console.warn.bind?cc.warn=console.warn.bind(console):cc.warn=function(){return console.warn.apply(console,arguments)}),e===cc.DebugMode.INFO&&(console.log.bind?cc.log=console.log.bind(console):cc.log=function(){return console.log.apply(console,arguments)},cc.info=function(){(console.info||console.log).apply(console,arguments)}),cc.warnID=o(cc.warn,"Warning"),cc.errorID=o(cc.error,"Error"),cc.logID=o(cc.log,"Log");var r=o(function(){for(var a=[!1],c=0;c<arguments.length;++c)a.push(arguments[c]);cc.assert.apply(null,a)},"Assert");cc.assertID=function(a){"use strict";a||r.apply(null,cc.js.shiftArguments.apply(null,arguments))}}},cc._throw=function(e){var r=e.stack;r?cc.error(r):cc.error(e)};var t="https://github.com/cocos-creator/engine/blob/master/EngineErrorMap.md"},{"./cocos2d/core/platform/CCEnum":137}],3:[function(T,N,z){},{}],4:[function(T,N,z){cc.Action=cc._Class.extend({ctor:function(){this.originalTarget=null,this.target=null,this.tag=cc.Action.TAG_INVALID},clone:function(){var o=new cc.Action;return o.originalTarget=null,o.target=null,o.tag=this.tag,o},isDone:function(){return!0},startWithTarget:function(o){this.originalTarget=o,this.target=o},stop:function(){this.target=null},step:function(o){cc.logID(1006)},update:function(o){cc.logID(1007)},getTarget:function(){return this.target},setTarget:function(o){this.target=o},getOriginalTarget:function(){return this.originalTarget},setOriginalTarget:function(o){this.originalTarget=o},getTag:function(){return this.tag},setTag:function(o){this.tag=o},retain:function(){},release:function(){}}),cc.Action.TAG_INVALID=-1,cc.FiniteTimeAction=cc.Action.extend({_duration:0,ctor:function(){cc.Action.prototype.ctor.call(this),this._duration=0},getDuration:function(){return this._duration*(this._timesForRepeat||1)},setDuration:function(o){this._duration=o},reverse:function(){return cc.logID(1008),null},clone:function(){return new cc.FiniteTimeAction}}),cc.Speed=cc.Action.extend({_speed:0,_innerAction:null,ctor:function(o,s){cc.Action.prototype.ctor.call(this),this._speed=0,this._innerAction=null,o&&this.initWithAction(o,s)},getSpeed:function(){return this._speed},setSpeed:function(o){this._speed=o},initWithAction:function(o,s){if(!o)throw new Error("cc.Speed.initWithAction(): action must be non nil");return this._innerAction=o,this._speed=s,!0},clone:function(){var o=new cc.Speed;return o.initWithAction(this._innerAction.clone(),this._speed),o},startWithTarget:function(o){cc.Action.prototype.startWithTarget.call(this,o),this._innerAction.startWithTarget(o)},stop:function(){this._innerAction.stop(),cc.Action.prototype.stop.call(this)},step:function(o){this._innerAction.step(o*this._speed)},isDone:function(){return this._innerAction.isDone()},reverse:function(){return new cc.Speed(this._innerAction.reverse(),this._speed)},setInnerAction:function(o){this._innerAction!==o&&(this._innerAction=o)},getInnerAction:function(){return this._innerAction}}),cc.speed=function(o,s){return new cc.Speed(o,s)},cc.Follow=cc.Action.extend({_followedNode:null,_boundarySet:!1,_boundaryFullyCovered:!1,_halfScreenSize:null,_fullScreenSize:null,_worldRect:null,leftBoundary:0,rightBoundary:0,topBoundary:0,bottomBoundary:0,ctor:function(o,s){cc.Action.prototype.ctor.call(this),this._followedNode=null,this._boundarySet=!1,this._boundaryFullyCovered=!1,this._halfScreenSize=null,this._fullScreenSize=null,this.leftBoundary=0,this.rightBoundary=0,this.topBoundary=0,this.bottomBoundary=0,this._worldRect=cc.rect(0,0,0,0),o&&(s?this.initWithTarget(o,s):this.initWithTarget(o))},clone:function(){var o=new cc.Follow,s=this._worldRect,n=new cc.Rect(s.x,s.y,s.width,s.height);return o.initWithTarget(this._followedNode,n),o},isBoundarySet:function(){return this._boundarySet},setBoudarySet:function(o){this._boundarySet=o},initWithTarget:function(o,s){if(!o)throw new Error("cc.Follow.initWithAction(): followedNode must be non nil");s=s||cc.rect(0,0,0,0),this._followedNode=o,this._worldRect=s,this._boundarySet=!cc._rectEqualToZero(s),this._boundaryFullyCovered=!1;var n=cc.director.getWinSize();return this._fullScreenSize=cc.p(n.width,n.height),this._halfScreenSize=cc.pMult(this._fullScreenSize,.5),this._boundarySet&&(this.leftBoundary=-(s.x+s.width-this._fullScreenSize.x),this.rightBoundary=-s.x,this.topBoundary=-s.y,this.bottomBoundary=-(s.y+s.height-this._fullScreenSize.y),this.rightBoundary<this.leftBoundary&&(this.rightBoundary=this.leftBoundary=(this.leftBoundary+this.rightBoundary)/2),this.topBoundary<this.bottomBoundary&&(this.topBoundary=this.bottomBoundary=(this.topBoundary+this.bottomBoundary)/2),this.topBoundary===this.bottomBoundary&&this.leftBoundary===this.rightBoundary&&(this._boundaryFullyCovered=!0)),!0},step:function(o){var s=this.target.convertToWorldSpaceAR(cc.Vec2.ZERO),n=this._followedNode.convertToWorldSpaceAR(cc.Vec2.ZERO),t=cc.pSub(s,n),e=this.target.parent.convertToNodeSpaceAR(cc.pAdd(t,this._halfScreenSize));if(this._boundarySet){if(this._boundaryFullyCovered)return;this.target.setPosition(cc.clampf(e.x,this.leftBoundary,this.rightBoundary),cc.clampf(e.y,this.bottomBoundary,this.topBoundary))}else this.target.setPosition(e.x,e.y)},isDone:function(){return!this._followedNode.isRunning()},stop:function(){this.target=null,cc.Action.prototype.stop.call(this)}}),cc.follow=function(o,s){return new cc.Follow(o,s)}},{}],5:[function(T,N,z){function o(n){for(var t=[],e=n.length-1;e>=0;e--)t.push(cc.p(n[e].x,n[e].y));return t}function s(n){for(var t=[],e=0;e<n.length;e++)t.push(cc.p(n[e].x,n[e].y));return t}cc.cardinalSplineAt=function(n,t,e,r,a,c){var h=c*c,u=h*c,d=(1-a)/2,f=d*(2*h-u-c),m=d*(-u+h)+(2*u-3*h+1),v=d*(u-2*h+c)+(-2*u+3*h),_=d*(u-h),p=n.x*f+t.x*m+e.x*v+r.x*_,g=n.y*f+t.y*m+e.y*v+r.y*_;return cc.p(p,g)},cc.getControlPointAt=function(n,t){return n[Math.min(n.length-1,Math.max(t,0))]},cc.CardinalSplineTo=cc.ActionInterval.extend({_points:null,_deltaT:0,_tension:0,_previousPosition:null,_accumulatedDiff:null,ctor:function(n,t,e){cc.ActionInterval.prototype.ctor.call(this),this._points=[],e!==void 0&&this.initWithDuration(n,t,e)},initWithDuration:function(n,t,e){if(!t||t.length===0)throw new Error("Invalid configuration. It must at least have one control point");return!!cc.ActionInterval.prototype.initWithDuration.call(this,n)&&(this.setPoints(t),this._tension=e,!0)},clone:function(){var n=new cc.CardinalSplineTo;return n.initWithDuration(this._duration,s(this._points),this._tension),n},startWithTarget:function(n){cc.ActionInterval.prototype.startWithTarget.call(this,n),this._deltaT=1/(this._points.length-1),this._previousPosition=cc.p(this.target.getPositionX(),this.target.getPositionY()),this._accumulatedDiff=cc.p(0,0)},update:function(n){n=this._computeEaseTime(n);var t,e,r=this._points;if(n===1)t=r.length-1,e=1;else{var a=this._deltaT;e=(n-a*(t=0|n/a))/a}var c=cc.cardinalSplineAt(cc.getControlPointAt(r,t-1),cc.getControlPointAt(r,t-0),cc.getControlPointAt(r,t+1),cc.getControlPointAt(r,t+2),this._tension,e);if(cc.macro.ENABLE_STACKABLE_ACTIONS){var h,u;if(h=this.target.getPositionX()-this._previousPosition.x,u=this.target.getPositionY()-this._previousPosition.y,h!==0||u!==0){var d=this._accumulatedDiff;h=d.x+h,u=d.y+u,d.x=h,d.y=u,c.x+=h,c.y+=u}}this.updatePosition(c)},reverse:function(){var n=o(this._points);return cc.cardinalSplineTo(this._duration,n,this._tension)},updatePosition:function(n){this.target.setPosition(n),this._previousPosition=n},getPoints:function(){return this._points},setPoints:function(n){this._points=n}}),cc.cardinalSplineTo=function(n,t,e){return new cc.CardinalSplineTo(n,t,e)},cc.CardinalSplineBy=cc.CardinalSplineTo.extend({_startPosition:null,ctor:function(n,t,e){cc.CardinalSplineTo.prototype.ctor.call(this),this._startPosition=cc.p(0,0),e!==void 0&&this.initWithDuration(n,t,e)},startWithTarget:function(n){cc.CardinalSplineTo.prototype.startWithTarget.call(this,n),this._startPosition.x=n.getPositionX(),this._startPosition.y=n.getPositionY()},reverse:function(){for(var n,t=this._points.slice(),e=t[0],r=1;r<t.length;++r)n=t[r],t[r]=cc.pSub(n,e),e=n;var a=o(t);for(e=a[a.length-1],a.pop(),e.x=-e.x,e.y=-e.y,a.unshift(e),r=1;r<a.length;++r)(n=a[r]).x=-n.x,n.y=-n.y,n.x+=e.x,n.y+=e.y,a[r]=n,e=n;return cc.cardinalSplineBy(this._duration,a,this._tension)},updatePosition:function(n){var t=this._startPosition,e=n.x+t.x,r=n.y+t.y;this._previousPosition.x=e,this._previousPosition.y=r,this.target.setPosition(e,r)},clone:function(){var n=new cc.CardinalSplineBy;return n.initWithDuration(this._duration,s(this._points),this._tension),n}}),cc.cardinalSplineBy=function(n,t,e){return new cc.CardinalSplineBy(n,t,e)},cc.CatmullRomTo=cc.CardinalSplineTo.extend({ctor:function(n,t){t&&this.initWithDuration(n,t)},initWithDuration:function(n,t){return cc.CardinalSplineTo.prototype.initWithDuration.call(this,n,t,.5)},clone:function(){var n=new cc.CatmullRomTo;return n.initWithDuration(this._duration,s(this._points)),n}}),cc.catmullRomTo=function(n,t){return new cc.CatmullRomTo(n,t)},cc.CatmullRomBy=cc.CardinalSplineBy.extend({ctor:function(n,t){cc.CardinalSplineBy.prototype.ctor.call(this),t&&this.initWithDuration(n,t)},initWithDuration:function(n,t){return cc.CardinalSplineTo.prototype.initWithDuration.call(this,n,t,.5)},clone:function(){var n=new cc.CatmullRomBy;return n.initWithDuration(this._duration,s(this._points)),n}}),cc.catmullRomBy=function(n,t){return new cc.CatmullRomBy(n,t)}},{}],6:[function(T,N,z){cc.ActionEase=cc.ActionInterval.extend({_inner:null,ctor:function(o){cc.ActionInterval.prototype.ctor.call(this),o&&this.initWithAction(o)},initWithAction:function(o){if(!o)throw new Error("cc.ActionEase.initWithAction(): action must be non nil");return!!this.initWithDuration(o.getDuration())&&(this._inner=o,!0)},clone:function(){var o=new cc.ActionEase;return o.initWithAction(this._inner.clone()),o},startWithTarget:function(o){cc.ActionInterval.prototype.startWithTarget.call(this,o),this._inner.startWithTarget(this.target)},stop:function(){this._inner.stop(),cc.ActionInterval.prototype.stop.call(this)},update:function(o){this._inner.update(o)},reverse:function(){return new cc.ActionEase(this._inner.reverse())},getInnerAction:function(){return this._inner}}),cc.actionEase=function(o){return new cc.ActionEase(o)},cc.EaseRateAction=cc.ActionEase.extend({_rate:0,ctor:function(o,s){cc.ActionEase.prototype.ctor.call(this),s!==void 0&&this.initWithAction(o,s)},setRate:function(o){this._rate=o},getRate:function(){return this._rate},initWithAction:function(o,s){return!!cc.ActionEase.prototype.initWithAction.call(this,o)&&(this._rate=s,!0)},clone:function(){var o=new cc.EaseRateAction;return o.initWithAction(this._inner.clone(),this._rate),o},reverse:function(){return new cc.EaseRateAction(this._inner.reverse(),1/this._rate)}}),cc.easeRateAction=function(o,s){return new cc.EaseRateAction(o,s)},cc.EaseIn=cc.EaseRateAction.extend({update:function(o){this._inner.update(Math.pow(o,this._rate))},reverse:function(){return new cc.EaseIn(this._inner.reverse(),1/this._rate)},clone:function(){var o=new cc.EaseIn;return o.initWithAction(this._inner.clone(),this._rate),o}}),cc.easeIn=function(o){return{_rate:o,easing:function(s){return Math.pow(s,this._rate)},reverse:function(){return cc.easeIn(1/this._rate)}}},cc.EaseOut=cc.EaseRateAction.extend({update:function(o){this._inner.update(Math.pow(o,1/this._rate))},reverse:function(){return new cc.EaseOut(this._inner.reverse(),1/this._rate)},clone:function(){var o=new cc.EaseOut;return o.initWithAction(this._inner.clone(),this._rate),o}}),cc.easeOut=function(o){return{_rate:o,easing:function(s){return Math.pow(s,1/this._rate)},reverse:function(){return cc.easeOut(1/this._rate)}}},cc.EaseInOut=cc.EaseRateAction.extend({update:function(o){(o*=2)<1?this._inner.update(.5*Math.pow(o,this._rate)):this._inner.update(1-.5*Math.pow(2-o,this._rate))},clone:function(){var o=new cc.EaseInOut;return o.initWithAction(this._inner.clone(),this._rate),o},reverse:function(){return new cc.EaseInOut(this._inner.reverse(),this._rate)}}),cc.easeInOut=function(o){return{_rate:o,easing:function(s){return(s*=2)<1?.5*Math.pow(s,this._rate):1-.5*Math.pow(2-s,this._rate)},reverse:function(){return cc.easeInOut(this._rate)}}},cc.EaseExponentialIn=cc.ActionEase.extend({update:function(o){this._inner.update(o===0?0:Math.pow(2,10*(o-1)))},reverse:function(){return new cc.EaseExponentialOut(this._inner.reverse())},clone:function(){var o=new cc.EaseExponentialIn;return o.initWithAction(this._inner.clone()),o}}),cc._easeExponentialInObj={easing:function(o){return o===0?0:Math.pow(2,10*(o-1))},reverse:function(){return cc._easeExponentialOutObj}},cc.easeExponentialIn=function(){return cc._easeExponentialInObj},cc.EaseExponentialOut=cc.ActionEase.extend({update:function(o){this._inner.update(o===1?1:1-Math.pow(2,-10*o))},reverse:function(){return new cc.EaseExponentialIn(this._inner.reverse())},clone:function(){var o=new cc.EaseExponentialOut;return o.initWithAction(this._inner.clone()),o}}),cc._easeExponentialOutObj={easing:function(o){return o===1?1:1-Math.pow(2,-10*o)},reverse:function(){return cc._easeExponentialInObj}},cc.easeExponentialOut=function(){return cc._easeExponentialOutObj},cc.EaseExponentialInOut=cc.ActionEase.extend({update:function(o){o!==1&&o!==0&&(o=(o*=2)<1?.5*Math.pow(2,10*(o-1)):.5*(2-Math.pow(2,-10*(o-1)))),this._inner.update(o)},reverse:function(){return new cc.EaseExponentialInOut(this._inner.reverse())},clone:function(){var o=new cc.EaseExponentialInOut;return o.initWithAction(this._inner.clone()),o}}),cc._easeExponentialInOutObj={easing:function(o){return o!==1&&o!==0?(o*=2)<1?.5*Math.pow(2,10*(o-1)):.5*(2-Math.pow(2,-10*(o-1))):o},reverse:function(){return cc._easeExponentialInOutObj}},cc.easeExponentialInOut=function(){return cc._easeExponentialInOutObj},cc.EaseSineIn=cc.ActionEase.extend({update:function(o){o=o===0||o===1?o:-1*Math.cos(o*Math.PI/2)+1,this._inner.update(o)},reverse:function(){return new cc.EaseSineOut(this._inner.reverse())},clone:function(){var o=new cc.EaseSineIn;return o.initWithAction(this._inner.clone()),o}}),cc._easeSineInObj={easing:function(o){return o===0||o===1?o:-1*Math.cos(o*Math.PI/2)+1},reverse:function(){return cc._easeSineOutObj}},cc.easeSineIn=function(){return cc._easeSineInObj},cc.EaseSineOut=cc.ActionEase.extend({update:function(o){o=o===0||o===1?o:Math.sin(o*Math.PI/2),this._inner.update(o)},reverse:function(){return new cc.EaseSineIn(this._inner.reverse())},clone:function(){var o=new cc.EaseSineOut;return o.initWithAction(this._inner.clone()),o}}),cc._easeSineOutObj={easing:function(o){return o===0||o===1?o:Math.sin(o*Math.PI/2)},reverse:function(){return cc._easeSineInObj}},cc.easeSineOut=function(){return cc._easeSineOutObj},cc.EaseSineInOut=cc.ActionEase.extend({update:function(o){o=o===0||o===1?o:-.5*(Math.cos(Math.PI*o)-1),this._inner.update(o)},clone:function(){var o=new cc.EaseSineInOut;return o.initWithAction(this._inner.clone()),o},reverse:function(){return new cc.EaseSineInOut(this._inner.reverse())}}),cc._easeSineInOutObj={easing:function(o){return o===0||o===1?o:-.5*(Math.cos(Math.PI*o)-1)},reverse:function(){return cc._easeSineInOutObj}},cc.easeSineInOut=function(){return cc._easeSineInOutObj},cc.EaseElastic=cc.ActionEase.extend({_period:.3,ctor:function(o,s){cc.ActionEase.prototype.ctor.call(this),o&&this.initWithAction(o,s)},getPeriod:function(){return this._period},setPeriod:function(o){this._period=o},initWithAction:function(o,s){return cc.ActionEase.prototype.initWithAction.call(this,o),this._period=s==null?.3:s,!0},reverse:function(){return cc.logID(1009),null},clone:function(){var o=new cc.EaseElastic;return o.initWithAction(this._inner.clone(),this._period),o}}),cc.EaseElasticIn=cc.EaseElastic.extend({update:function(o){var s=0;if(o===0||o===1)s=o;else{var n=this._period/4;o-=1,s=-Math.pow(2,10*o)*Math.sin((o-n)*Math.PI*2/this._period)}this._inner.update(s)},reverse:function(){return new cc.EaseElasticOut(this._inner.reverse(),this._period)},clone:function(){var o=new cc.EaseElasticIn;return o.initWithAction(this._inner.clone(),this._period),o}}),cc._easeElasticInObj={easing:function(o){return o===0||o===1?o:(o-=1,-Math.pow(2,10*o)*Math.sin((o-.075)*Math.PI*2/.3))},reverse:function(){return cc._easeElasticOutObj}},cc.easeElasticIn=function(o){return o&&o!==.3?{_period:o,easing:function(s){return s===0||s===1?s:(s-=1,-Math.pow(2,10*s)*Math.sin((s-this._period/4)*Math.PI*2/this._period))},reverse:function(){return cc.easeElasticOut(this._period)}}:cc._easeElasticInObj},cc.EaseElasticOut=cc.EaseElastic.extend({update:function(o){var s=0;if(o===0||o===1)s=o;else{var n=this._period/4;s=Math.pow(2,-10*o)*Math.sin((o-n)*Math.PI*2/this._period)+1}this._inner.update(s)},reverse:function(){return new cc.EaseElasticIn(this._inner.reverse(),this._period)},clone:function(){var o=new cc.EaseElasticOut;return o.initWithAction(this._inner.clone(),this._period),o}}),cc._easeElasticOutObj={easing:function(o){return o===0||o===1?o:Math.pow(2,-10*o)*Math.sin((o-.075)*Math.PI*2/.3)+1},reverse:function(){return cc._easeElasticInObj}},cc.easeElasticOut=function(o){return o&&o!==.3?{_period:o,easing:function(s){return s===0||s===1?s:Math.pow(2,-10*s)*Math.sin((s-this._period/4)*Math.PI*2/this._period)+1},reverse:function(){return cc.easeElasticIn(this._period)}}:cc._easeElasticOutObj},cc.EaseElasticInOut=cc.EaseElastic.extend({update:function(o){var s=0,n=this._period;if(o===0||o===1)s=o;else{o*=2,n||(n=this._period=.3*1.5);var t=n/4;s=(o-=1)<0?-.5*Math.pow(2,10*o)*Math.sin((o-t)*Math.PI*2/n):Math.pow(2,-10*o)*Math.sin((o-t)*Math.PI*2/n)*.5+1}this._inner.update(s)},reverse:function(){return new cc.EaseElasticInOut(this._inner.reverse(),this._period)},clone:function(){var o=new cc.EaseElasticInOut;return o.initWithAction(this._inner.clone(),this._period),o}}),cc.easeElasticInOut=function(o){return o=o||.3,{_period:o,easing:function(s){var n=0,t=this._period;if(s===0||s===1)n=s;else{s*=2,t||(t=this._period=.3*1.5);var e=t/4;n=(s-=1)<0?-.5*Math.pow(2,10*s)*Math.sin((s-e)*Math.PI*2/t):Math.pow(2,-10*s)*Math.sin((s-e)*Math.PI*2/t)*.5+1}return n},reverse:function(){return cc.easeElasticInOut(this._period)}}},cc.EaseBounce=cc.ActionEase.extend({bounceTime:function(o){return o<1/2.75?7.5625*o*o:o<2/2.75?7.5625*(o-=1.5/2.75)*o+.75:o<2.5/2.75?7.5625*(o-=2.25/2.75)*o+.9375:7.5625*(o-=2.625/2.75)*o+.984375},clone:function(){var o=new cc.EaseBounce;return o.initWithAction(this._inner.clone()),o},reverse:function(){return new cc.EaseBounce(this._inner.reverse())}}),cc.EaseBounceIn=cc.EaseBounce.extend({update:function(o){var s=1-this.bounceTime(1-o);this._inner.update(s)},reverse:function(){return new cc.EaseBounceOut(this._inner.reverse())},clone:function(){var o=new cc.EaseBounceIn;return o.initWithAction(this._inner.clone()),o}}),cc._bounceTime=function(o){return o<1/2.75?7.5625*o*o:o<2/2.75?7.5625*(o-=1.5/2.75)*o+.75:o<2.5/2.75?7.5625*(o-=2.25/2.75)*o+.9375:7.5625*(o-=2.625/2.75)*o+.984375},cc._easeBounceInObj={easing:function(o){return 1-cc._bounceTime(1-o)},reverse:function(){return cc._easeBounceOutObj}},cc.easeBounceIn=function(){return cc._easeBounceInObj},cc.EaseBounceOut=cc.EaseBounce.extend({update:function(o){var s=this.bounceTime(o);this._inner.update(s)},reverse:function(){return new cc.EaseBounceIn(this._inner.reverse())},clone:function(){var o=new cc.EaseBounceOut;return o.initWithAction(this._inner.clone()),o}}),cc._easeBounceOutObj={easing:function(o){return cc._bounceTime(o)},reverse:function(){return cc._easeBounceInObj}},cc.easeBounceOut=function(){return cc._easeBounceOutObj},cc.EaseBounceInOut=cc.EaseBounce.extend({update:function(o){var s=0;o<.5?(o*=2,s=.5*(1-this.bounceTime(1-o))):s=.5*this.bounceTime(2*o-1)+.5,this._inner.update(s)},clone:function(){var o=new cc.EaseBounceInOut;return o.initWithAction(this._inner.clone()),o},reverse:function(){return new cc.EaseBounceInOut(this._inner.reverse())}}),cc._easeBounceInOutObj={easing:function(o){var s;return o<.5?(o*=2,s=.5*(1-cc._bounceTime(1-o))):s=.5*cc._bounceTime(2*o-1)+.5,s},reverse:function(){return cc._easeBounceInOutObj}},cc.easeBounceInOut=function(){return cc._easeBounceInOutObj},cc.EaseBackIn=cc.ActionEase.extend({update:function(o){o=o===0||o===1?o:o*o*(2.70158*o-1.70158),this._inner.update(o)},reverse:function(){return new cc.EaseBackOut(this._inner.reverse())},clone:function(){var o=new cc.EaseBackIn;return o.initWithAction(this._inner.clone()),o}}),cc._easeBackInObj={easing:function(o){return o===0||o===1?o:o*o*(2.70158*o-1.70158)},reverse:function(){return cc._easeBackOutObj}},cc.easeBackIn=function(){return cc._easeBackInObj},cc.EaseBackOut=cc.ActionEase.extend({update:function(o){o-=1,this._inner.update(o*o*(2.70158*o+1.70158)+1)},reverse:function(){return new cc.EaseBackIn(this._inner.reverse())},clone:function(){var o=new cc.EaseBackOut;return o.initWithAction(this._inner.clone()),o}}),cc._easeBackOutObj={easing:function(o){return(o-=1)*o*(2.70158*o+1.70158)+1},reverse:function(){return cc._easeBackInObj}},cc.easeBackOut=function(){return cc._easeBackOutObj},cc.EaseBackInOut=cc.ActionEase.extend({update:function(o){(o*=2)<1?this._inner.update(o*o*(3.5949095*o-2.5949095)/2):(o-=2,this._inner.update(o*o*(3.5949095*o+2.5949095)/2+1))},clone:function(){var o=new cc.EaseBackInOut;return o.initWithAction(this._inner.clone()),o},reverse:function(){return new cc.EaseBackInOut(this._inner.reverse())}}),cc._easeBackInOutObj={easing:function(o){return(o*=2)<1?o*o*(3.5949095*o-2.5949095)/2:(o-=2)*o*(3.5949095*o+2.5949095)/2+1},reverse:function(){return cc._easeBackInOutObj}},cc.easeBackInOut=function(){return cc._easeBackInOutObj},cc.EaseBezierAction=cc.ActionEase.extend({_p0:null,_p1:null,_p2:null,_p3:null,ctor:function(o){cc.ActionEase.prototype.ctor.call(this,o)},_updateTime:function(o,s,n,t,e){return Math.pow(1-e,3)*o+3*e*Math.pow(1-e,2)*s+3*Math.pow(e,2)*(1-e)*n+Math.pow(e,3)*t},update:function(o){var s=this._updateTime(this._p0,this._p1,this._p2,this._p3,o);this._inner.update(s)},clone:function(){var o=new cc.EaseBezierAction;return o.initWithAction(this._inner.clone()),o.setBezierParamer(this._p0,this._p1,this._p2,this._p3),o},reverse:function(){var o=new cc.EaseBezierAction(this._inner.reverse());return o.setBezierParamer(this._p3,this._p2,this._p1,this._p0),o},setBezierParamer:function(o,s,n,t){this._p0=o||0,this._p1=s||0,this._p2=n||0,this._p3=t||0}}),cc.easeBezierAction=function(o,s,n,t){return{easing:function(e){return cc.EaseBezierAction.prototype._updateTime(o,s,n,t,e)},reverse:function(){return cc.easeBezierAction(t,n,s,o)}}},cc.EaseQuadraticActionIn=cc.ActionEase.extend({_updateTime:function(o){return Math.pow(o,2)},update:function(o){this._inner.update(this._updateTime(o))},clone:function(){var o=new cc.EaseQuadraticActionIn;return o.initWithAction(this._inner.clone()),o},reverse:function(){return new cc.EaseQuadraticActionIn(this._inner.reverse())}}),cc._easeQuadraticActionIn={easing:cc.EaseQuadraticActionIn.prototype._updateTime,reverse:function(){return cc._easeQuadraticActionIn}},cc.easeQuadraticActionIn=function(){return cc._easeQuadraticActionIn},cc.EaseQuadraticActionOut=cc.ActionEase.extend({_updateTime:function(o){return-o*(o-2)},update:function(o){this._inner.update(this._updateTime(o))},clone:function(){var o=new cc.EaseQuadraticActionOut;return o.initWithAction(),o},reverse:function(){return new cc.EaseQuadraticActionOut(this._inner.reverse())}}),cc._easeQuadraticActionOut={easing:cc.EaseQuadraticActionOut.prototype._updateTime,reverse:function(){return cc._easeQuadraticActionOut}},cc.easeQuadraticActionOut=function(){return cc._easeQuadraticActionOut},cc.EaseQuadraticActionInOut=cc.ActionEase.extend({_updateTime:function(o){return o*=2,o<1?o*o*.5:-.5*(--o*(o-2)-1)},update:function(o){this._inner.update(this._updateTime(o))},clone:function(){var o=new cc.EaseQuadraticActionInOut;return o.initWithAction(this._inner.clone()),o},reverse:function(){return new cc.EaseQuadraticActionInOut(this._inner.reverse())}}),cc._easeQuadraticActionInOut={easing:cc.EaseQuadraticActionInOut.prototype._updateTime,reverse:function(){return cc._easeQuadraticActionInOut}},cc.easeQuadraticActionInOut=function(){return cc._easeQuadraticActionInOut},cc.EaseQuarticActionIn=cc.ActionEase.extend({_updateTime:function(o){return o*o*o*o},update:function(o){this._inner.update(this._updateTime(o))},clone:function(){var o=new cc.EaseQuarticActionIn;return o.initWithAction(this._inner.clone()),o},reverse:function(){return new cc.EaseQuarticActionIn(this._inner.reverse())}}),cc._easeQuarticActionIn={easing:cc.EaseQuarticActionIn.prototype._updateTime,reverse:function(){return cc._easeQuarticActionIn}},cc.easeQuarticActionIn=function(){return cc._easeQuarticActionIn},cc.EaseQuarticActionOut=cc.ActionEase.extend({_updateTime:function(o){return-((o-=1)*o*o*o-1)},update:function(o){this._inner.update(this._updateTime(o))},clone:function(){var o=new cc.EaseQuarticActionOut;return o.initWithAction(this._inner.clone()),o},reverse:function(){return new cc.EaseQuarticActionOut(this._inner.reverse())}}),cc._easeQuarticActionOut={easing:cc.EaseQuarticActionOut.prototype._updateTime,reverse:function(){return cc._easeQuarticActionOut}},cc.easeQuarticActionOut=function(){return cc._easeQuarticActionOut},cc.EaseQuarticActionInOut=cc.ActionEase.extend({_updateTime:function(o){return(o*=2)<1?.5*o*o*o*o:-.5*((o-=2)*o*o*o-2)},update:function(o){this._inner.update(this._updateTime(o))},clone:function(){var o=new cc.EaseQuarticActionInOut;return o.initWithAction(this._inner.clone()),o},reverse:function(){return new cc.EaseQuarticActionInOut(this._inner.reverse())}}),cc._easeQuarticActionInOut={easing:cc.EaseQuarticActionInOut.prototype._updateTime,reverse:function(){return cc._easeQuarticActionInOut}},cc.easeQuarticActionInOut=function(){return cc._easeQuarticActionInOut},cc.EaseQuinticActionIn=cc.ActionEase.extend({_updateTime:function(o){return o*o*o*o*o},update:function(o){this._inner.update(this._updateTime(o))},clone:function(){var o=new cc.EaseQuinticActionIn;return o.initWithAction(this._inner.clone()),o},reverse:function(){return new cc.EaseQuinticActionIn(this._inner.reverse())}}),cc._easeQuinticActionIn={easing:cc.EaseQuinticActionIn.prototype._updateTime,reverse:function(){return cc._easeQuinticActionIn}},cc.easeQuinticActionIn=function(){return cc._easeQuinticActionIn},cc.EaseQuinticActionOut=cc.ActionEase.extend({_updateTime:function(o){return(o-=1)*o*o*o*o+1},update:function(o){this._inner.update(this._updateTime(o))},clone:function(){var o=new cc.EaseQuinticActionOut;return o.initWithAction(this._inner.clone()),o},reverse:function(){return new cc.EaseQuinticActionOut(this._inner.reverse())}}),cc._easeQuinticActionOut={easing:cc.EaseQuinticActionOut.prototype._updateTime,reverse:function(){return cc._easeQuinticActionOut}},cc.easeQuinticActionOut=function(){return cc._easeQuinticActionOut},cc.EaseQuinticActionInOut=cc.ActionEase.extend({_updateTime:function(o){return(o*=2)<1?.5*o*o*o*o*o:.5*((o-=2)*o*o*o*o+2)},update:function(o){this._inner.update(this._updateTime(o))},clone:function(){var o=new cc.EaseQuinticActionInOut;return o.initWithAction(this._inner.clone()),o},reverse:function(){return new cc.EaseQuinticActionInOut(this._inner.reverse())}}),cc._easeQuinticActionInOut={easing:cc.EaseQuinticActionInOut.prototype._updateTime,reverse:function(){return cc._easeQuinticActionInOut}},cc.easeQuinticActionInOut=function(){return cc._easeQuinticActionInOut},cc.EaseCircleActionIn=cc.ActionEase.extend({_updateTime:function(o){return-1*(Math.sqrt(1-o*o)-1)},update:function(o){this._inner.update(this._updateTime(o))},clone:function(){var o=new cc.EaseCircleActionIn;return o.initWithAction(this._inner.clone()),o},reverse:function(){return new cc.EaseCircleActionIn(this._inner.reverse())}}),cc._easeCircleActionIn={easing:cc.EaseCircleActionIn.prototype._updateTime,reverse:function(){return cc._easeCircleActionIn}},cc.easeCircleActionIn=function(){return cc._easeCircleActionIn},cc.EaseCircleActionOut=cc.ActionEase.extend({_updateTime:function(o){return o-=1,Math.sqrt(1-o*o)},update:function(o){this._inner.update(this._updateTime(o))},clone:function(){var o=new cc.EaseCircleActionOut;return o.initWithAction(this._inner.clone()),o},reverse:function(){return new cc.EaseCircleActionOut(this._inner.reverse())}}),cc._easeCircleActionOut={easing:cc.EaseCircleActionOut.prototype._updateTime,reverse:function(){return cc._easeCircleActionOut}},cc.easeCircleActionOut=function(){return cc._easeCircleActionOut},cc.EaseCircleActionInOut=cc.ActionEase.extend({_updateTime:function(o){return(o*=2)<1?-.5*(Math.sqrt(1-o*o)-1):(o-=2,.5*(Math.sqrt(1-o*o)+1))},update:function(o){this._inner.update(this._updateTime(o))},clone:function(){var o=new cc.EaseCircleActionInOut;return o.initWithAction(this._inner.clone()),o},reverse:function(){return new cc.EaseCircleActionInOut(this._inner.reverse())}}),cc._easeCircleActionInOut={easing:cc.EaseCircleActionInOut.prototype._updateTime,reverse:function(){return cc._easeCircleActionInOut}},cc.easeCircleActionInOut=function(){return cc._easeCircleActionInOut},cc.EaseCubicActionIn=cc.ActionEase.extend({_updateTime:function(o){return o*o*o},update:function(o){this._inner.update(this._updateTime(o))},clone:function(){var o=new cc.EaseCubicActionIn;return o.initWithAction(this._inner.clone()),o},reverse:function(){return new cc.EaseCubicActionIn(this._inner.reverse())}}),cc._easeCubicActionIn={easing:cc.EaseCubicActionIn.prototype._updateTime,reverse:function(){return cc._easeCubicActionIn}},cc.easeCubicActionIn=function(){return cc._easeCubicActionIn},cc.EaseCubicActionOut=cc.ActionEase.extend({_updateTime:function(o){return(o-=1)*o*o+1},update:function(o){this._inner.update(this._updateTime(o))},clone:function(){var o=new cc.EaseCubicActionOut;return o.initWithAction(this._inner.clone()),o},reverse:function(){return new cc.EaseCubicActionOut(this._inner.reverse())}}),cc._easeCubicActionOut={easing:cc.EaseCubicActionOut.prototype._updateTime,reverse:function(){return cc._easeCubicActionOut}},cc.easeCubicActionOut=function(){return cc._easeCubicActionOut},cc.EaseCubicActionInOut=cc.ActionEase.extend({_updateTime:function(o){return(o*=2)<1?.5*o*o*o:.5*((o-=2)*o*o+2)},update:function(o){this._inner.update(this._updateTime(o))},clone:function(){var o=new cc.EaseCubicActionInOut;return o.initWithAction(this._inner.clone()),o},reverse:function(){return new cc.EaseCubicActionInOut(this._inner.reverse())}}),cc._easeCubicActionInOut={easing:cc.EaseCubicActionInOut.prototype._updateTime,reverse:function(){return cc._easeCubicActionInOut}},cc.easeCubicActionInOut=function(){return cc._easeCubicActionInOut}},{}],7:[function(T,N,z){cc.ActionInstant=cc.FiniteTimeAction.extend({isDone:function(){return!0},step:function(o){this.update(1)},update:function(o){},reverse:function(){return this.clone()},clone:function(){return new cc.ActionInstant}}),cc.Show=cc.ActionInstant.extend({update:function(o){for(var s=this.target.getComponentsInChildren(cc._SGComponent),n=0;n<s.length;++n)s[n].enabled=!0},reverse:function(){return new cc.Hide},clone:function(){return new cc.Show}}),cc.show=function(){return new cc.Show},cc.Hide=cc.ActionInstant.extend({update:function(o){for(var s=this.target.getComponentsInChildren(cc._SGComponent),n=0;n<s.length;++n)s[n].enabled=!1},reverse:function(){return new cc.Show},clone:function(){return new cc.Hide}}),cc.hide=function(){return new cc.Hide},cc.ToggleVisibility=cc.ActionInstant.extend({update:function(o){for(var s=this.target.getComponentsInChildren(cc._SGComponent),n=0;n<s.length;++n){var t=s[n];t.enabled=!t.enabled}},reverse:function(){return new cc.ToggleVisibility},clone:function(){return new cc.ToggleVisibility}}),cc.toggleVisibility=function(){return new cc.ToggleVisibility},cc.RemoveSelf=cc.ActionInstant.extend({_isNeedCleanUp:!0,ctor:function(o){cc.FiniteTimeAction.prototype.ctor.call(this),o!==void 0&&this.init(o)},update:function(o){this.target.removeFromParent(this._isNeedCleanUp)},init:function(o){return this._isNeedCleanUp=o,!0},reverse:function(){return new cc.RemoveSelf(this._isNeedCleanUp)},clone:function(){return new cc.RemoveSelf(this._isNeedCleanUp)}}),cc.removeSelf=function(o){return new cc.RemoveSelf(o)},cc.FlipX=cc.ActionInstant.extend({_flippedX:!1,ctor:function(o){cc.FiniteTimeAction.prototype.ctor.call(this),this._flippedX=!1,o!==void 0&&this.initWithFlipX(o)},initWithFlipX:function(o){return this._flippedX=o,!0},update:function(o){this.target.scaleX=Math.abs(this.target.scaleX)*(this._flippedX?-1:1)},reverse:function(){return new cc.FlipX(!this._flippedX)},clone:function(){var o=new cc.FlipX;return o.initWithFlipX(this._flippedX),o}}),cc.flipX=function(o){return new cc.FlipX(o)},cc.FlipY=cc.ActionInstant.extend({_flippedY:!1,ctor:function(o){cc.FiniteTimeAction.prototype.ctor.call(this),this._flippedY=!1,o!==void 0&&this.initWithFlipY(o)},initWithFlipY:function(o){return this._flippedY=o,!0},update:function(o){this.target.scaleY=Math.abs(this.target.scaleY)*(this._flippedY?-1:1)},reverse:function(){return new cc.FlipY(!this._flippedY)},clone:function(){var o=new cc.FlipY;return o.initWithFlipY(this._flippedY),o}}),cc.flipY=function(o){return new cc.FlipY(o)},cc.Place=cc.ActionInstant.extend({_x:0,_y:0,ctor:function(o,s){cc.FiniteTimeAction.prototype.ctor.call(this),this._x=0,this._y=0,o!==void 0&&(o.x!==void 0&&(s=o.y,o=o.x),this.initWithPosition(o,s))},initWithPosition:function(o,s){return this._x=o,this._y=s,!0},update:function(o){this.target.setPosition(this._x,this._y)},clone:function(){var o=new cc.Place;return o.initWithPosition(this._x,this._y),o}}),cc.place=function(o,s){return new cc.Place(o,s)},cc.CallFunc=cc.ActionInstant.extend({_selectorTarget:null,_function:null,_data:null,ctor:function(o,s,n){cc.FiniteTimeAction.prototype.ctor.call(this),this.initWithFunction(o,s,n)},initWithFunction:function(o,s,n){return o&&(this._function=o),s&&(this._selectorTarget=s),n!==void 0&&(this._data=n),!0},execute:function(){this._function&&this._function.call(this._selectorTarget,this.target,this._data)},update:function(o){this.execute()},getTargetCallback:function(){return this._selectorTarget},setTargetCallback:function(o){o!==this._selectorTarget&&(this._selectorTarget&&(this._selectorTarget=null),this._selectorTarget=o)},clone:function(){var o=new cc.CallFunc;return o.initWithFunction(this._function,this._selectorTarget,this._data),o}}),cc.callFunc=function(o,s,n){return new cc.CallFunc(o,s,n)}},{}],8:[function(T,N,z){cc.ActionInterval=cc.FiniteTimeAction.extend({_elapsed:0,_firstTick:!1,_easeList:null,_timesForRepeat:1,_repeatForever:!1,_repeatMethod:!1,_speed:1,_speedMethod:!1,ctor:function(o){this._speed=1,this._timesForRepeat=1,this._repeatForever=!1,this.MAX_VALUE=2,this._repeatMethod=!1,this._speedMethod=!1,cc.FiniteTimeAction.prototype.ctor.call(this),o!==void 0&&this.initWithDuration(o)},getElapsed:function(){return this._elapsed},initWithDuration:function(o){return this._duration=o===0?cc.macro.FLT_EPSILON:o,this._elapsed=0,this._firstTick=!0,!0},isDone:function(){return this._elapsed>=this._duration},_cloneDecoration:function(o){o._repeatForever=this._repeatForever,o._speed=this._speed,o._timesForRepeat=this._timesForRepeat,o._easeList=this._easeList,o._speedMethod=this._speedMethod,o._repeatMethod=this._repeatMethod},_reverseEaseList:function(o){if(this._easeList){o._easeList=[];for(var s=0;s<this._easeList.length;s++)o._easeList.push(this._easeList[s].reverse())}},clone:function(){var o=new cc.ActionInterval(this._duration);return this._cloneDecoration(o),o},easing:function(o){this._easeList?this._easeList.length=0:this._easeList=[];for(var s=0;s<arguments.length;s++)this._easeList.push(arguments[s]);return this},_computeEaseTime:function(o){var s=this._easeList;if(!s||s.length===0)return o;for(var n=0,t=s.length;n<t;n++)o=s[n].easing(o);return o},step:function(o){this._firstTick?(this._firstTick=!1,this._elapsed=0):this._elapsed+=o;var s=this._elapsed/(this._duration>1192092896e-16?this._duration:1192092896e-16);s=1>s?s:1,this.update(s>0?s:0),this._repeatMethod&&this._timesForRepeat>1&&this.isDone()&&(this._repeatForever||this._timesForRepeat--,this.startWithTarget(this.target),this.step(this._elapsed-this._duration))},startWithTarget:function(o){cc.Action.prototype.startWithTarget.call(this,o),this._elapsed=0,this._firstTick=!0},reverse:function(){return cc.logID(1010),null},setAmplitudeRate:function(o){cc.logID(1011)},getAmplitudeRate:function(){return cc.logID(1012),0},speed:function(o){return o<=0?(cc.logID(1013),this):(this._speedMethod=!0,this._speed*=o,this)},getSpeed:function(){return this._speed},setSpeed:function(o){return this._speed=o,this},repeat:function(o){return o=Math.round(o),Number.isNaN(o)||o<1?(cc.logID(1014),this):(this._repeatMethod=!0,this._timesForRepeat*=o,this)},repeatForever:function(){return this._repeatMethod=!0,this._timesForRepeat=this.MAX_VALUE,this._repeatForever=!0,this}}),cc.actionInterval=function(o){return new cc.ActionInterval(o)},cc.Sequence=cc.ActionInterval.extend({_actions:null,_split:null,_last:0,_reversed:!1,ctor:function(o){cc.ActionInterval.prototype.ctor.call(this),this._actions=[];var s=o instanceof Array?o:arguments;if(s.length!==1){var n=s.length-1;if(n>=0&&s[n]==null&&cc.logID(1015),n>=0){for(var t,e=s[0],r=1;r<n;r++)s[r]&&(t=e,e=cc.Sequence._actionOneTwo(t,s[r]));this.initWithTwoActions(e,s[n])}}else cc.errorID(1019)},initWithTwoActions:function(o,s){if(!o||!s)throw new Error("cc.Sequence.initWithTwoActions(): arguments must all be non nil");var n=o._duration,t=s._duration,e=(n*=o._repeatMethod?o._timesForRepeat:1)+(t*=s._repeatMethod?s._timesForRepeat:1);return this.initWithDuration(e),this._actions[0]=o,this._actions[1]=s,!0},clone:function(){var o=new cc.Sequence;return this._cloneDecoration(o),o.initWithTwoActions(this._actions[0].clone(),this._actions[1].clone()),o},startWithTarget:function(o){cc.ActionInterval.prototype.startWithTarget.call(this,o),this._split=this._actions[0]._duration/this._duration,this._split*=this._actions[0]._repeatMethod?this._actions[0]._timesForRepeat:1,this._last=-1},stop:function(){this._last!==-1&&this._actions[this._last].stop(),cc.Action.prototype.stop.call(this)},update:function(o){var s,n,t=0,e=this._split,r=this._actions,a=this._last;(o=this._computeEaseTime(o))<e?(s=e!==0?o/e:1,t===0&&a===1&&this._reversed&&(r[1].update(0),r[1].stop())):(t=1,s=e===1?1:(o-e)/(1-e),a===-1&&(r[0].startWithTarget(this.target),r[0].update(1),r[0].stop()),a===0&&(r[0].update(1),r[0].stop())),n=r[t],a===t&&n.isDone()||(a!==t&&n.startWithTarget(this.target),s*=n._timesForRepeat,n.update(s>1?s%1:s),this._last=t)},reverse:function(){var o=cc.Sequence._actionOneTwo(this._actions[1].reverse(),this._actions[0].reverse());return this._cloneDecoration(o),this._reverseEaseList(o),o._reversed=!0,o}}),cc.sequence=function(o){var s=o instanceof Array?o:arguments;if(s.length===1)return cc.errorID(1019),null;var n=s.length-1;n>=0&&s[n]==null&&cc.logID(1015);var t=null;if(n>=0){t=s[0];for(var e=1;e<=n;e++)s[e]&&(t=cc.Sequence._actionOneTwo(t,s[e]))}return t},cc.Sequence._actionOneTwo=function(o,s){var n=new cc.Sequence;return n.initWithTwoActions(o,s),n},cc.Repeat=cc.ActionInterval.extend({_times:0,_total:0,_nextDt:0,_actionInstant:!1,_innerAction:null,ctor:function(o,s){cc.ActionInterval.prototype.ctor.call(this),s!==void 0&&this.initWithAction(o,s)},initWithAction:function(o,s){var n=o._duration*s;return!!this.initWithDuration(n)&&(this._times=s,this._innerAction=o,o instanceof cc.ActionInstant&&(this._actionInstant=!0,this._times-=1),this._total=0,!0)},clone:function(){var o=new cc.Repeat;return this._cloneDecoration(o),o.initWithAction(this._innerAction.clone(),this._times),o},startWithTarget:function(o){this._total=0,this._nextDt=this._innerAction._duration/this._duration,cc.ActionInterval.prototype.startWithTarget.call(this,o),this._innerAction.startWithTarget(o)},stop:function(){this._innerAction.stop(),cc.Action.prototype.stop.call(this)},update:function(o){o=this._computeEaseTime(o);var s=this._innerAction,n=this._duration,t=this._times,e=this._nextDt;if(o>=e){for(;o>e&&this._total<t;)s.update(1),this._total++,s.stop(),s.startWithTarget(this.target),e+=s._duration/n,this._nextDt=e;o>=1&&this._total<t&&(s.update(1),this._total++),this._actionInstant||(this._total===t?s.stop():s.update(o-(e-s._duration/n)))}else s.update(o*t%1)},isDone:function(){return this._total===this._times},reverse:function(){var o=new cc.Repeat(this._innerAction.reverse(),this._times);return this._cloneDecoration(o),this._reverseEaseList(o),o},setInnerAction:function(o){this._innerAction!==o&&(this._innerAction=o)},getInnerAction:function(){return this._innerAction}}),cc.repeat=function(o,s){return new cc.Repeat(o,s)},cc.RepeatForever=cc.ActionInterval.extend({_innerAction:null,ctor:function(o){cc.ActionInterval.prototype.ctor.call(this),this._innerAction=null,o&&this.initWithAction(o)},initWithAction:function(o){if(!o)throw new Error("cc.RepeatForever.initWithAction(): action must be non null");return this._innerAction=o,!0},clone:function(){var o=new cc.RepeatForever;return this._cloneDecoration(o),o.initWithAction(this._innerAction.clone()),o},startWithTarget:function(o){cc.ActionInterval.prototype.startWithTarget.call(this,o),this._innerAction.startWithTarget(o)},step:function(o){var s=this._innerAction;s.step(o),s.isDone()&&(s.startWithTarget(this.target),s.step(s.getElapsed()-s._duration))},isDone:function(){return!1},reverse:function(){var o=new cc.RepeatForever(this._innerAction.reverse());return this._cloneDecoration(o),this._reverseEaseList(o),o},setInnerAction:function(o){this._innerAction!==o&&(this._innerAction=o)},getInnerAction:function(){return this._innerAction}}),cc.repeatForever=function(o){return new cc.RepeatForever(o)},cc.Spawn=cc.ActionInterval.extend({_one:null,_two:null,ctor:function(o){cc.ActionInterval.prototype.ctor.call(this),this._one=null,this._two=null;var s=o instanceof Array?o:arguments;if(s.length!==1){var n=s.length-1;if(n>=0&&s[n]==null&&cc.logID(1015),n>=0){for(var t,e=s[0],r=1;r<n;r++)s[r]&&(t=e,e=cc.Spawn._actionOneTwo(t,s[r]));this.initWithTwoActions(e,s[n])}}else cc.errorID(1020)},initWithTwoActions:function(o,s){if(!o||!s)throw new Error("cc.Spawn.initWithTwoActions(): arguments must all be non null");var n=!1,t=o._duration,e=s._duration;return this.initWithDuration(Math.max(t,e))&&(this._one=o,this._two=s,t>e?this._two=cc.Sequence._actionOneTwo(s,cc.delayTime(t-e)):t<e&&(this._one=cc.Sequence._actionOneTwo(o,cc.delayTime(e-t))),n=!0),n},clone:function(){var o=new cc.Spawn;return this._cloneDecoration(o),o.initWithTwoActions(this._one.clone(),this._two.clone()),o},startWithTarget:function(o){cc.ActionInterval.prototype.startWithTarget.call(this,o),this._one.startWithTarget(o),this._two.startWithTarget(o)},stop:function(){this._one.stop(),this._two.stop(),cc.Action.prototype.stop.call(this)},update:function(o){o=this._computeEaseTime(o),this._one&&this._one.update(o),this._two&&this._two.update(o)},reverse:function(){var o=cc.Spawn._actionOneTwo(this._one.reverse(),this._two.reverse());return this._cloneDecoration(o),this._reverseEaseList(o),o}}),cc.spawn=function(o){var s=o instanceof Array?o:arguments;if(s.length===1)return cc.errorID(1020),null;s.length>0&&s[s.length-1]==null&&cc.logID(1015);for(var n=s[0],t=1;t<s.length;t++)s[t]!=null&&(n=cc.Spawn._actionOneTwo(n,s[t]));return n},cc.Spawn._actionOneTwo=function(o,s){var n=new cc.Spawn;return n.initWithTwoActions(o,s),n},cc.RotateTo=cc.ActionInterval.extend({_dstAngleX:0,_startAngleX:0,_diffAngleX:0,_dstAngleY:0,_startAngleY:0,_diffAngleY:0,ctor:function(o,s,n){cc.ActionInterval.prototype.ctor.call(this),s!==void 0&&this.initWithDuration(o,s,n)},initWithDuration:function(o,s,n){return!!cc.ActionInterval.prototype.initWithDuration.call(this,o)&&(this._dstAngleX=s||0,this._dstAngleY=n!==void 0?n:this._dstAngleX,!0)},clone:function(){var o=new cc.RotateTo;return this._cloneDecoration(o),o.initWithDuration(this._duration,this._dstAngleX,this._dstAngleY),o},startWithTarget:function(o){cc.ActionInterval.prototype.startWithTarget.call(this,o);var s=o.rotationX%360,n=this._dstAngleX-s;n>180&&(n-=360),n<-180&&(n+=360),this._startAngleX=s,this._diffAngleX=n,this._startAngleY=o.rotationY%360;var t=this._dstAngleY-this._startAngleY;t>180&&(t-=360),t<-180&&(t+=360),this._diffAngleY=t},reverse:function(){cc.logID(1016)},update:function(o){o=this._computeEaseTime(o),this.target&&(this.target.rotationX=this._startAngleX+this._diffAngleX*o,this.target.rotationY=this._startAngleY+this._diffAngleY*o)}}),cc.rotateTo=function(o,s,n){return new cc.RotateTo(o,s,n)},cc.RotateBy=cc.ActionInterval.extend({_angleX:0,_startAngleX:0,_angleY:0,_startAngleY:0,ctor:function(o,s,n){cc.ActionInterval.prototype.ctor.call(this),s!==void 0&&this.initWithDuration(o,s,n)},initWithDuration:function(o,s,n){return!!cc.ActionInterval.prototype.initWithDuration.call(this,o)&&(this._angleX=s||0,this._angleY=n!==void 0?n:this._angleX,!0)},clone:function(){var o=new cc.RotateBy;return this._cloneDecoration(o),o.initWithDuration(this._duration,this._angleX,this._angleY),o},startWithTarget:function(o){cc.ActionInterval.prototype.startWithTarget.call(this,o),this._startAngleX=o.rotationX,this._startAngleY=o.rotationY},update:function(o){o=this._computeEaseTime(o),this.target&&(this.target.rotationX=this._startAngleX+this._angleX*o,this.target.rotationY=this._startAngleY+this._angleY*o)},reverse:function(){var o=new cc.RotateBy(this._duration,-this._angleX,-this._angleY);return this._cloneDecoration(o),this._reverseEaseList(o),o}}),cc.rotateBy=function(o,s,n){return new cc.RotateBy(o,s,n)},cc.MoveBy=cc.ActionInterval.extend({_positionDelta:null,_startPosition:null,_previousPosition:null,ctor:function(o,s,n){cc.ActionInterval.prototype.ctor.call(this),this._positionDelta=cc.p(0,0),this._startPosition=cc.p(0,0),this._previousPosition=cc.p(0,0),s!==void 0&&this.initWithDuration(o,s,n)},initWithDuration:function(o,s,n){return!!cc.ActionInterval.prototype.initWithDuration.call(this,o)&&(s.x!==void 0&&(n=s.y,s=s.x),this._positionDelta.x=s,this._positionDelta.y=n,!0)},clone:function(){var o=new cc.MoveBy;return this._cloneDecoration(o),o.initWithDuration(this._duration,this._positionDelta),o},startWithTarget:function(o){cc.ActionInterval.prototype.startWithTarget.call(this,o);var s=o.getPositionX(),n=o.getPositionY();this._previousPosition.x=s,this._previousPosition.y=n,this._startPosition.x=s,this._startPosition.y=n},update:function(o){if(o=this._computeEaseTime(o),this.target){var s=this._positionDelta.x*o,n=this._positionDelta.y*o,t=this._startPosition;if(cc.macro.ENABLE_STACKABLE_ACTIONS){var e=this.target.getPositionX(),r=this.target.getPositionY(),a=this._previousPosition;t.x=t.x+e-a.x,t.y=t.y+r-a.y,s+=t.x,n+=t.y,a.x=s,a.y=n,this.target.setPosition(s,n)}else this.target.setPosition(t.x+s,t.y+n)}},reverse:function(){var o=new cc.MoveBy(this._duration,cc.p(-this._positionDelta.x,-this._positionDelta.y));return this._cloneDecoration(o),this._reverseEaseList(o),o}}),cc.moveBy=function(o,s,n){return new cc.MoveBy(o,s,n)},cc.MoveTo=cc.MoveBy.extend({_endPosition:null,ctor:function(o,s,n){cc.MoveBy.prototype.ctor.call(this),this._endPosition=cc.p(0,0),s!==void 0&&this.initWithDuration(o,s,n)},initWithDuration:function(o,s,n){return!!cc.MoveBy.prototype.initWithDuration.call(this,o,s,n)&&(s.x!==void 0&&(n=s.y,s=s.x),this._endPosition.x=s,this._endPosition.y=n,!0)},clone:function(){var o=new cc.MoveTo;return this._cloneDecoration(o),o.initWithDuration(this._duration,this._endPosition),o},startWithTarget:function(o){cc.MoveBy.prototype.startWithTarget.call(this,o),this._positionDelta.x=this._endPosition.x-o.getPositionX(),this._positionDelta.y=this._endPosition.y-o.getPositionY()}}),cc.moveTo=function(o,s,n){return new cc.MoveTo(o,s,n)},cc.SkewTo=cc.ActionInterval.extend({_skewX:0,_skewY:0,_startSkewX:0,_startSkewY:0,_endSkewX:0,_endSkewY:0,_deltaX:0,_deltaY:0,ctor:function(o,s,n){cc.ActionInterval.prototype.ctor.call(this),n!==void 0&&this.initWithDuration(o,s,n)},initWithDuration:function(o,s,n){var t=!1;return cc.ActionInterval.prototype.initWithDuration.call(this,o)&&(this._endSkewX=s,this._endSkewY=n,t=!0),t},clone:function(){var o=new cc.SkewTo;return this._cloneDecoration(o),o.initWithDuration(this._duration,this._endSkewX,this._endSkewY),o},startWithTarget:function(o){cc.ActionInterval.prototype.startWithTarget.call(this,o),this._startSkewX=o.skewX%180,this._deltaX=this._endSkewX-this._startSkewX,this._deltaX>180&&(this._deltaX-=360),this._deltaX<-180&&(this._deltaX+=360),this._startSkewY=o.skewY%360,this._deltaY=this._endSkewY-this._startSkewY,this._deltaY>180&&(this._deltaY-=360),this._deltaY<-180&&(this._deltaY+=360)},update:function(o){o=this._computeEaseTime(o),this.target.skewX=this._startSkewX+this._deltaX*o,this.target.skewY=this._startSkewY+this._deltaY*o}}),cc.skewTo=function(o,s,n){return new cc.SkewTo(o,s,n)},cc.SkewBy=cc.SkewTo.extend({ctor:function(o,s,n){cc.SkewTo.prototype.ctor.call(this),n!==void 0&&this.initWithDuration(o,s,n)},initWithDuration:function(o,s,n){var t=!1;return cc.SkewTo.prototype.initWithDuration.call(this,o,s,n)&&(this._skewX=s,this._skewY=n,t=!0),t},clone:function(){var o=new cc.SkewBy;return this._cloneDecoration(o),o.initWithDuration(this._duration,this._skewX,this._skewY),o},startWithTarget:function(o){cc.SkewTo.prototype.startWithTarget.call(this,o),this._deltaX=this._skewX,this._deltaY=this._skewY,this._endSkewX=this._startSkewX+this._deltaX,this._endSkewY=this._startSkewY+this._deltaY},reverse:function(){var o=new cc.SkewBy(this._duration,-this._skewX,-this._skewY);return this._cloneDecoration(o),this._reverseEaseList(o),o}}),cc.skewBy=function(o,s,n){return new cc.SkewBy(o,s,n)},cc.JumpBy=cc.ActionInterval.extend({_startPosition:null,_delta:null,_height:0,_jumps:0,_previousPosition:null,ctor:function(o,s,n,t,e){cc.ActionInterval.prototype.ctor.call(this),this._startPosition=cc.p(0,0),this._previousPosition=cc.p(0,0),this._delta=cc.p(0,0),t!==void 0&&this.initWithDuration(o,s,n,t,e)},initWithDuration:function(o,s,n,t,e){return!!cc.ActionInterval.prototype.initWithDuration.call(this,o)&&(e===void 0&&(e=t,t=n,n=s.y,s=s.x),this._delta.x=s,this._delta.y=n,this._height=t,this._jumps=e,!0)},clone:function(){var o=new cc.JumpBy;return this._cloneDecoration(o),o.initWithDuration(this._duration,this._delta,this._height,this._jumps),o},startWithTarget:function(o){cc.ActionInterval.prototype.startWithTarget.call(this,o);var s=o.getPositionX(),n=o.getPositionY();this._previousPosition.x=s,this._previousPosition.y=n,this._startPosition.x=s,this._startPosition.y=n},update:function(o){if(o=this._computeEaseTime(o),this.target){var s=o*this._jumps%1,n=4*this._height*s*(1-s);n+=this._delta.y*o;var t=this._delta.x*o,e=this._startPosition;if(cc.macro.ENABLE_STACKABLE_ACTIONS){var r=this.target.getPositionX(),a=this.target.getPositionY(),c=this._previousPosition;e.x=e.x+r-c.x,e.y=e.y+a-c.y,t+=e.x,n+=e.y,c.x=t,c.y=n,this.target.setPosition(t,n)}else this.target.setPosition(e.x+t,e.y+n)}},reverse:function(){var o=new cc.JumpBy(this._duration,cc.p(-this._delta.x,-this._delta.y),this._height,this._jumps);return this._cloneDecoration(o),this._reverseEaseList(o),o}}),cc.jumpBy=function(o,s,n,t,e){return new cc.JumpBy(o,s,n,t,e)},cc.JumpTo=cc.JumpBy.extend({_endPosition:null,ctor:function(o,s,n,t,e){cc.JumpBy.prototype.ctor.call(this),this._endPosition=cc.p(0,0),t!==void 0&&this.initWithDuration(o,s,n,t,e)},initWithDuration:function(o,s,n,t,e){return!!cc.JumpBy.prototype.initWithDuration.call(this,o,s,n,t,e)&&(e===void 0&&(n=s.y,s=s.x),this._endPosition.x=s,this._endPosition.y=n,!0)},startWithTarget:function(o){cc.JumpBy.prototype.startWithTarget.call(this,o),this._delta.x=this._endPosition.x-this._startPosition.x,this._delta.y=this._endPosition.y-this._startPosition.y},clone:function(){var o=new cc.JumpTo;return this._cloneDecoration(o),o.initWithDuration(this._duration,this._endPosition,this._height,this._jumps),o}}),cc.jumpTo=function(o,s,n,t,e){return new cc.JumpTo(o,s,n,t,e)},cc.bezierAt=function(o,s,n,t,e){return Math.pow(1-e,3)*o+3*e*Math.pow(1-e,2)*s+3*Math.pow(e,2)*(1-e)*n+Math.pow(e,3)*t},cc.BezierBy=cc.ActionInterval.extend({_config:null,_startPosition:null,_previousPosition:null,ctor:function(o,s){cc.ActionInterval.prototype.ctor.call(this),this._config=[],this._startPosition=cc.p(0,0),this._previousPosition=cc.p(0,0),s&&this.initWithDuration(o,s)},initWithDuration:function(o,s){return!!cc.ActionInterval.prototype.initWithDuration.call(this,o)&&(this._config=s,!0)},clone:function(){var o=new cc.BezierBy;this._cloneDecoration(o);for(var s=[],n=0;n<this._config.length;n++){var t=this._config[n];s.push(cc.p(t.x,t.y))}return o.initWithDuration(this._duration,s),o},startWithTarget:function(o){cc.ActionInterval.prototype.startWithTarget.call(this,o);var s=o.getPositionX(),n=o.getPositionY();this._previousPosition.x=s,this._previousPosition.y=n,this._startPosition.x=s,this._startPosition.y=n},update:function(o){if(o=this._computeEaseTime(o),this.target){var s=this._config,n=s[0].x,t=s[1].x,e=s[2].x,r=s[0].y,a=s[1].y,c=s[2].y,h=cc.bezierAt(0,n,t,e,o),u=cc.bezierAt(0,r,a,c,o),d=this._startPosition;if(cc.macro.ENABLE_STACKABLE_ACTIONS){var f=this.target.getPositionX(),m=this.target.getPositionY(),v=this._previousPosition;d.x=d.x+f-v.x,d.y=d.y+m-v.y,h+=d.x,u+=d.y,v.x=h,v.y=u,this.target.setPosition(h,u)}else this.target.setPosition(d.x+h,d.y+u)}},reverse:function(){var o=this._config,s=[cc.pAdd(o[1],cc.pNeg(o[2])),cc.pAdd(o[0],cc.pNeg(o[2])),cc.pNeg(o[2])],n=new cc.BezierBy(this._duration,s);return this._cloneDecoration(n),this._reverseEaseList(n),n}}),cc.bezierBy=function(o,s){return new cc.BezierBy(o,s)},cc.BezierTo=cc.BezierBy.extend({_toConfig:null,ctor:function(o,s){cc.BezierBy.prototype.ctor.call(this),this._toConfig=[],s&&this.initWithDuration(o,s)},initWithDuration:function(o,s){return!!cc.ActionInterval.prototype.initWithDuration.call(this,o)&&(this._toConfig=s,!0)},clone:function(){var o=new cc.BezierTo;return this._cloneDecoration(o),o.initWithDuration(this._duration,this._toConfig),o},startWithTarget:function(o){cc.BezierBy.prototype.startWithTarget.call(this,o);var s=this._startPosition,n=this._toConfig,t=this._config;t[0]=cc.pSub(n[0],s),t[1]=cc.pSub(n[1],s),t[2]=cc.pSub(n[2],s)}}),cc.bezierTo=function(o,s){return new cc.BezierTo(o,s)},cc.ScaleTo=cc.ActionInterval.extend({_scaleX:1,_scaleY:1,_startScaleX:1,_startScaleY:1,_endScaleX:0,_endScaleY:0,_deltaX:0,_deltaY:0,ctor:function(o,s,n){cc.ActionInterval.prototype.ctor.call(this),s!==void 0&&this.initWithDuration(o,s,n)},initWithDuration:function(o,s,n){return!!cc.ActionInterval.prototype.initWithDuration.call(this,o)&&(this._endScaleX=s,this._endScaleY=n!=null?n:s,!0)},clone:function(){var o=new cc.ScaleTo;return this._cloneDecoration(o),o.initWithDuration(this._duration,this._endScaleX,this._endScaleY),o},startWithTarget:function(o){cc.ActionInterval.prototype.startWithTarget.call(this,o),this._startScaleX=o.scaleX,this._startScaleY=o.scaleY,this._deltaX=this._endScaleX-this._startScaleX,this._deltaY=this._endScaleY-this._startScaleY},update:function(o){o=this._computeEaseTime(o),this.target&&(this.target.scaleX=this._startScaleX+this._deltaX*o,this.target.scaleY=this._startScaleY+this._deltaY*o)}}),cc.scaleTo=function(o,s,n){return new cc.ScaleTo(o,s,n)},cc.ScaleBy=cc.ScaleTo.extend({startWithTarget:function(o){cc.ScaleTo.prototype.startWithTarget.call(this,o),this._deltaX=this._startScaleX*this._endScaleX-this._startScaleX,this._deltaY=this._startScaleY*this._endScaleY-this._startScaleY},reverse:function(){var o=new cc.ScaleBy(this._duration,1/this._endScaleX,1/this._endScaleY);return this._cloneDecoration(o),this._reverseEaseList(o),o},clone:function(){var o=new cc.ScaleBy;return this._cloneDecoration(o),o.initWithDuration(this._duration,this._endScaleX,this._endScaleY),o}}),cc.scaleBy=function(o,s,n){return new cc.ScaleBy(o,s,n)},cc.Blink=cc.ActionInterval.extend({_times:0,_originalState:!1,ctor:function(o,s){cc.ActionInterval.prototype.ctor.call(this),s!==void 0&&this.initWithDuration(o,s)},initWithDuration:function(o,s){return!!cc.ActionInterval.prototype.initWithDuration.call(this,o)&&(this._times=s,!0)},clone:function(){var o=new cc.Blink;return this._cloneDecoration(o),o.initWithDuration(this._duration,this._times),o},update:function(o){if(o=this._computeEaseTime(o),this.target&&!this.isDone()){var s=1/this._times,n=o%s;this.target.opacity=n>s/2?255:0}},startWithTarget:function(o){cc.ActionInterval.prototype.startWithTarget.call(this,o),this._originalState=o.opacity},stop:function(){this.target.opacity=this._originalState,cc.ActionInterval.prototype.stop.call(this)},reverse:function(){var o=new cc.Blink(this._duration,this._times);return this._cloneDecoration(o),this._reverseEaseList(o),o}}),cc.blink=function(o,s){return new cc.Blink(o,s)},cc.FadeTo=cc.ActionInterval.extend({_toOpacity:0,_fromOpacity:0,ctor:function(o,s){cc.ActionInterval.prototype.ctor.call(this),s!==void 0&&this.initWithDuration(o,s)},initWithDuration:function(o,s){return!!cc.ActionInterval.prototype.initWithDuration.call(this,o)&&(this._toOpacity=s,!0)},clone:function(){var o=new cc.FadeTo;return this._cloneDecoration(o),o.initWithDuration(this._duration,this._toOpacity),o},update:function(o){o=this._computeEaseTime(o);var s=this._fromOpacity!==void 0?this._fromOpacity:255;this.target.opacity=s+(this._toOpacity-s)*o},startWithTarget:function(o){cc.ActionInterval.prototype.startWithTarget.call(this,o),this._fromOpacity=o.opacity}}),cc.fadeTo=function(o,s){return new cc.FadeTo(o,s)},cc.FadeIn=cc.FadeTo.extend({_reverseAction:null,ctor:function(o){cc.FadeTo.prototype.ctor.call(this),o==null&&(o=0),this.initWithDuration(o,255)},reverse:function(){var o=new cc.FadeOut;return o.initWithDuration(this._duration,0),this._cloneDecoration(o),this._reverseEaseList(o),o},clone:function(){var o=new cc.FadeIn;return this._cloneDecoration(o),o.initWithDuration(this._duration,this._toOpacity),o},startWithTarget:function(o){this._reverseAction&&(this._toOpacity=this._reverseAction._fromOpacity),cc.FadeTo.prototype.startWithTarget.call(this,o)}}),cc.fadeIn=function(o){return new cc.FadeIn(o)},cc.FadeOut=cc.FadeTo.extend({ctor:function(o){cc.FadeTo.prototype.ctor.call(this),o==null&&(o=0),this.initWithDuration(o,0)},reverse:function(){var o=new cc.FadeIn;return o._reverseAction=this,o.initWithDuration(this._duration,255),this._cloneDecoration(o),this._reverseEaseList(o),o},clone:function(){var o=new cc.FadeOut;return this._cloneDecoration(o),o.initWithDuration(this._duration,this._toOpacity),o}}),cc.fadeOut=function(o){return new cc.FadeOut(o)},cc.TintTo=cc.ActionInterval.extend({_to:null,_from:null,ctor:function(o,s,n,t){cc.ActionInterval.prototype.ctor.call(this),this._to=cc.color(0,0,0),this._from=cc.color(0,0,0),s instanceof cc.Color&&(t=s.b,n=s.g,s=s.r),t!==void 0&&this.initWithDuration(o,s,n,t)},initWithDuration:function(o,s,n,t){return!!cc.ActionInterval.prototype.initWithDuration.call(this,o)&&(this._to=cc.color(s,n,t),!0)},clone:function(){var o=new cc.TintTo;this._cloneDecoration(o);var s=this._to;return o.initWithDuration(this._duration,s.r,s.g,s.b),o},startWithTarget:function(o){cc.ActionInterval.prototype.startWithTarget.call(this,o),this._from=this.target.color},update:function(o){o=this._computeEaseTime(o);var s=this._from,n=this._to;s&&this.target.setColor(cc.color(s.r+(n.r-s.r)*o,s.g+(n.g-s.g)*o,s.b+(n.b-s.b)*o))}}),cc.tintTo=function(o,s,n,t){return new cc.TintTo(o,s,n,t)},cc.TintBy=cc.ActionInterval.extend({_deltaR:0,_deltaG:0,_deltaB:0,_fromR:0,_fromG:0,_fromB:0,ctor:function(o,s,n,t){cc.ActionInterval.prototype.ctor.call(this),t!==void 0&&this.initWithDuration(o,s,n,t)},initWithDuration:function(o,s,n,t){return!!cc.ActionInterval.prototype.initWithDuration.call(this,o)&&(this._deltaR=s,this._deltaG=n,this._deltaB=t,!0)},clone:function(){var o=new cc.TintBy;return this._cloneDecoration(o),o.initWithDuration(this._duration,this._deltaR,this._deltaG,this._deltaB),o},startWithTarget:function(o){cc.ActionInterval.prototype.startWithTarget.call(this,o);var s=o.color;this._fromR=s.r,this._fromG=s.g,this._fromB=s.b},update:function(o){o=this._computeEaseTime(o),this.target.color=cc.color(this._fromR+this._deltaR*o,this._fromG+this._deltaG*o,this._fromB+this._deltaB*o)},reverse:function(){var o=new cc.TintBy(this._duration,-this._deltaR,-this._deltaG,-this._deltaB);return this._cloneDecoration(o),this._reverseEaseList(o),o}}),cc.tintBy=function(o,s,n,t){return new cc.TintBy(o,s,n,t)},cc.DelayTime=cc.ActionInterval.extend({update:function(o){},reverse:function(){var o=new cc.DelayTime(this._duration);return this._cloneDecoration(o),this._reverseEaseList(o),o},clone:function(){var o=new cc.DelayTime;return this._cloneDecoration(o),o.initWithDuration(this._duration),o}}),cc.delayTime=function(o){return new cc.DelayTime(o)},cc.ReverseTime=cc.ActionInterval.extend({_other:null,ctor:function(o){cc.ActionInterval.prototype.ctor.call(this),this._other=null,o&&this.initWithAction(o)},initWithAction:function(o){if(!o)throw new Error("cc.ReverseTime.initWithAction(): action must be non null");if(o===this._other)throw new Error("cc.ReverseTime.initWithAction(): the action was already passed in.");return!!cc.ActionInterval.prototype.initWithDuration.call(this,o._duration)&&(this._other=o,!0)},clone:function(){var o=new cc.ReverseTime;return this._cloneDecoration(o),o.initWithAction(this._other.clone()),o},startWithTarget:function(o){cc.ActionInterval.prototype.startWithTarget.call(this,o),this._other.startWithTarget(o)},update:function(o){o=this._computeEaseTime(o),this._other&&this._other.update(1-o)},reverse:function(){return this._other.clone()},stop:function(){this._other.stop(),cc.Action.prototype.stop.call(this)}}),cc.reverseTime=function(o){return new cc.ReverseTime(o)},cc.Animate=cc.ActionInterval.extend({_animation:null,_nextFrame:0,_origFrame:null,_executedLoops:0,_splitTimes:null,_currFrameIndex:0,ctor:function(o){cc.ActionInterval.prototype.ctor.call(this),this._splitTimes=[],o&&this.initWithAnimation(o)},getAnimation:function(){return this._animation},setAnimation:function(o){this._animation=o},getCurrentFrameIndex:function(){return this._currFrameIndex},initWithAnimation:function(o){if(!o)throw new Error("cc.Animate.initWithAnimation(): animation must be non-NULL");var s=o.getDuration();if(this.initWithDuration(s*o.getLoops())){this._nextFrame=0,this.setAnimation(o),this._origFrame=null,this._executedLoops=0;var n=this._splitTimes;n.length=0;var t=0,e=s/o.getTotalDelayUnits(),r=o.getFrames();cc.js.array.verifyType(r,cc.AnimationFrame);for(var a=0;a<r.length;a++){var c=t*e/s;t+=r[a].getDelayUnits(),n.push(c)}return!0}return!1},clone:function(){var o=new cc.Animate;return this._cloneDecoration(o),o.initWithAnimation(this._animation.clone()),o},startWithTarget:function(o){cc.ActionInterval.prototype.startWithTarget.call(this,o),this._animation.getRestoreOriginalFrame()&&(this._origFrame=o.getSpriteFrame()),this._nextFrame=0,this._executedLoops=0},update:function(o){(o=this._computeEaseTime(o))<1&&((0|(o*=this._animation.getLoops()))>this._executedLoops&&(this._nextFrame=0,this._executedLoops++),o%=1);for(var s=this._animation.getFrames(),n=s.length,t=this._splitTimes,e=this._nextFrame;e<n&&t[e]<=o;e++)_currFrameIndex=e,this.target.setSpriteFrame(s[_currFrameIndex].getSpriteFrame()),this._nextFrame=e+1},reverse:function(){var o=this._animation,s=o.getFrames(),n=[];if(cc.js.array.verifyType(s,cc.AnimationFrame),s.length>0)for(var t=s.length-1;t>=0;t--){var e=s[t];if(!e)break;n.push(e.clone())}var r=new cc.SpriteFrameAnimation(n,o.getDelayPerUnit(),o.getLoops());r.setRestoreOriginalFrame(o.getRestoreOriginalFrame());var a=new cc.Animate(r);return this._cloneDecoration(a),this._reverseEaseList(a),a},stop:function(){this._animation.getRestoreOriginalFrame()&&this.target&&this.target.setSpriteFrame(this._origFrame),cc.Action.prototype.stop.call(this)}}),cc.animate=function(o){return new cc.Animate(o)},cc.TargetedAction=cc.ActionInterval.extend({_action:null,_forcedTarget:null,ctor:function(o,s){cc.ActionInterval.prototype.ctor.call(this),s&&this.initWithTarget(o,s)},initWithTarget:function(o,s){return!!this.initWithDuration(s._duration)&&(this._forcedTarget=o,this._action=s,!0)},clone:function(){var o=new cc.TargetedAction;return this._cloneDecoration(o),o.initWithTarget(this._forcedTarget,this._action.clone()),o},startWithTarget:function(o){cc.ActionInterval.prototype.startWithTarget.call(this,o),this._action.startWithTarget(this._forcedTarget)},stop:function(){this._action.stop()},update:function(o){o=this._computeEaseTime(o),this._action.update(o)},getForcedTarget:function(){return this._forcedTarget},setForcedTarget:function(o){this._forcedTarget!==o&&(this._forcedTarget=o)}}),cc.targetedAction=function(o,s){return new cc.TargetedAction(o,s)}},{}],9:[function(T,N,z){cc.ActionManager=cc._Class.extend({_elementPool:[],_searchElementByTarget:function(o,s){for(var n=0;n<o.length;n++)if(s===o[n].target)return o[n];return null},ctor:function(){this._hashTargets={},this._arrayTargets=[],this._currentTarget=null},_getElement:function(o,s){var n=this._elementPool.pop();return n||(n=new function(){this.actions=[],this.target=null,this.actionIndex=0,this.currentAction=null,this.paused=!1,this.lock=!1}),n.target=o,n.paused=!!s,n},_putElement:function(o){o.actions.length=0,o.actionIndex=0,o.currentAction=null,o.paused=!1,o.target=null,o.lock=!1,this._elementPool.push(o)},addAction:function(o,s,n){if(!o)throw new Error("cc.ActionManager.addAction(): action must be non-null");if(!s)throw new Error("cc.ActionManager.addAction(): action must be non-null");var t=this._hashTargets[s.__instanceId];t?t.actions||(t.actions=[]):(t=this._getElement(s,n),this._hashTargets[s.__instanceId]=t,this._arrayTargets.push(t)),t.actions.push(o),o.startWithTarget(s)},removeAllActions:function(){for(var o=this._arrayTargets,s=0;s<o.length;s++){var n=o[s];n&&this.removeAllActionsFromTarget(n.target,!0)}},removeAllActionsFromTarget:function(o,s){if(o!=null){var n=this._hashTargets[o.__instanceId];n&&(n.actions.length=0,this._deleteHashElement(n))}},removeAction:function(o){if(o!=null){var s=o.getOriginalTarget(),n=this._hashTargets[s.__instanceId];if(n){for(var t=0;t<n.actions.length;t++)if(n.actions[t]===o){n.actions.splice(t,1),n.actionIndex>=t&&n.actionIndex--;break}}else cc.logID(1001)}},removeActionByTag:function(o,s){o===cc.Action.TAG_INVALID&&cc.logID(1002),cc.assertID(s,1003);var n=this._hashTargets[s.__instanceId];if(n)for(var t=n.actions.length,e=0;e<t;++e){var r=n.actions[e];if(r&&r.getTag()===o&&r.getOriginalTarget()===s){this._removeActionAtIndex(e,n);break}}},getActionByTag:function(o,s){o===cc.Action.TAG_INVALID&&cc.logID(1004);var n=this._hashTargets[s.__instanceId];if(n){if(n.actions!=null)for(var t=0;t<n.actions.length;++t){var e=n.actions[t];if(e&&e.getTag()===o)return e}cc.logID(1005,o)}return null},getNumberOfRunningActionsInTarget:function(o){var s=this._hashTargets[o.__instanceId];return s&&s.actions?s.actions.length:0},pauseTarget:function(o){var s=this._hashTargets[o.__instanceId];s&&(s.paused=!0)},resumeTarget:function(o){var s=this._hashTargets[o.__instanceId];s&&(s.paused=!1)},pauseAllRunningActions:function(){for(var o=[],s=this._arrayTargets,n=0;n<s.length;n++){var t=s[n];t&&!t.paused&&(t.paused=!0,o.push(t.target))}return o},resumeTargets:function(o){if(o)for(var s=0;s<o.length;s++)o[s]&&this.resumeTarget(o[s])},pauseTargets:function(o){if(o)for(var s=0;s<o.length;s++)o[s]&&this.pauseTarget(o[s])},purgeSharedManager:function(){cc.director.getScheduler().unscheduleUpdate(this)},_removeActionAtIndex:function(o,s){s.actions[o],s.actions.splice(o,1),s.actionIndex>=o&&s.actionIndex--,s.actions.length===0&&this._deleteHashElement(s)},_deleteHashElement:function(o){var s=!1;if(o&&!o.lock&&this._hashTargets[o.target.__instanceId]){delete this._hashTargets[o.target.__instanceId];for(var n=this._arrayTargets,t=0,e=n.length;t<e;t++)if(n[t]===o){n.splice(t,1);break}this._putElement(o),s=!0}return s},update:function(o){for(var s,n=this._arrayTargets,t=0;t<n.length;t++){if(this._currentTarget=n[t],!(s=this._currentTarget).paused&&s.actions){for(s.lock=!0,s.actionIndex=0;s.actionIndex<s.actions.length;s.actionIndex++)if(s.currentAction=s.actions[s.actionIndex],s.currentAction){if(s.currentAction.step(o*(s.currentAction._speedMethod?s.currentAction._speed:1)),s.currentAction&&s.currentAction.isDone()){s.currentAction.stop();var e=s.currentAction;s.currentAction=null,this.removeAction(e)}s.currentAction=null}s.lock=!1}s.actions.length===0&&this._deleteHashElement(s)&&t--}}})},{}],10:[function(T,N,z){T("./CCActionManager"),T("./CCAction"),T("./CCActionInterval"),T("./CCActionInstant"),T("./CCActionEase"),T("./CCActionCatmullRom")},{"./CCAction":4,"./CCActionCatmullRom":5,"./CCActionEase":6,"./CCActionInstant":7,"./CCActionInterval":8,"./CCActionManager":9}],11:[function(T,N,z){function o(m,v){t.call(this),this.target=m,this.animation=v,this._anims=new n.array.MutableForwardIterator([])}function s(m,v){function _(F){if(!Array.isArray(F))return!1;for(var M=0,B=F.length;M<B;M++){var W=F[M];if(!Array.isArray(W)||W.length!==6)return!1}return!0}function p(F,M,B){var W=F instanceof cc.Node&&M==="position",V=[],U=new e;U.target=F;var k,X=M.indexOf(".");X!==-1?F[k=M.slice(0,X)]:k=M,U.prop=k,U.subProps=function(Rt){var zt=Rt.split(".");return zt.shift(),zt.length>0?zt:null}(M);for(var Y=0,Z=B.length;Y<Z;Y++){var et=B[Y],$=et.frame/v.duration;if(U.ratios.push($),W){var nt=et.motionPath;nt&&!_(nt)&&(cc.errorID(3904,F.name,M,Y),nt=null),V.push(nt)}var at=et.value;U.values.push(at);var rt=et.curve;if(rt){if(typeof rt=="string"){U.types.push(rt);continue}if(Array.isArray(rt)){rt[0]===rt[1]&&rt[2]===rt[3]?U.types.push(e.Linear):U.types.push(e.Bezier(rt));continue}}U.types.push(e.Linear)}W&&a(V,U,y.duration,y.sample);for(var it,ot,_t=U.ratios,ut=!0,vt=1,Tt=_t.length;vt<Tt;vt++)if(it=_t[vt]-_t[vt-1],vt===1)ot=it;else if(Math.abs(it-ot)>1e-6){ut=!1;break}return U._findFrameIndex=ut?r:d,U}function g(F,M){var B=M.props,W=M.comps;if(B)for(var V in B){var U=p(F,V,B[V]);C.push(U)}if(W)for(var k in W){var X=F.getComponent(k);if(X){var Y=W[k];for(var V in Y)U=p(X,V,Y[V]),C.push(U)}}}var y=v.clip,C=v.curves;C.length=0,v.duration=y.duration,v.speed=y.speed,v.wrapMode=y.wrapMode,v.frameRate=y.sample,(v.wrapMode&u.Loop)===u.Loop?v.repeatCount=1/0:v.repeatCount=1;var S=y.curveData,I=S.paths;g(m,S);for(var b in I){var A=cc.find(b,m);A&&g(A,I[b])}var E=y.events;if(E)for(var R,O=0,P=E.length;O<P;O++){R||((R=new c).target=m,C.push(R));var x,w=E[O],L=w.frame/v.duration,D=d(R.ratios,L);D>=0?x=R.events[D]:(x=new h,R.ratios.push(L),R.events.push(x)),x.add(w.func,w.params)}}var n=cc.js,t=T("./playable"),e=T("./animation-curves").DynamicAnimCurve,r=T("./animation-curves").quickFindIndex,a=T("./motion-path-helper").sampleMotionPaths,c=T("./animation-curves").EventAnimCurve,h=T("./animation-curves").EventInfo,u=T("./types").WrapModeMask,d=T("../core/utils/binary-search").binarySearchEpsilon;n.extend(o,t);var f=o.prototype;f.playState=function(m,v){m.clip&&(m.curveLoaded||s(this.target,m),m.animator=this,m.play(),typeof v=="number"&&m.setTime(v),this.play())},f.stopStatesExcept=function(m){var v=this._anims,_=v.array;for(v.i=0;v.i<_.length;++v.i){var p=_[v.i];p!==m&&this.stopState(p)}},f.addAnimation=function(m){this._anims.array.indexOf(m)===-1&&this._anims.push(m),m._setListeners(this.animation)},f.removeAnimation=function(m){var v=this._anims.array.indexOf(m);v>=0?(this._anims.fastRemoveAt(v),this._anims.array.length===0&&this.stop()):cc.errorID(3908),m.animator=null},f.sample=function(){var m=this._anims,v=m.array;for(m.i=0;m.i<v.length;++m.i)v[m.i].sample()},f.stopState=function(m){m&&m.stop()},f.pauseState=function(m){m&&m.pause()},f.resumeState=function(m){m&&m.resume(),this.isPaused&&this.resume()},f.setStateTime=function(m,v){if(v!==void 0)m&&(m.setTime(v),m.sample());else{v=m;for(var _=this._anims.array,p=0;p<_.length;++p){var g=_[p];g.setTime(v),g.sample()}}},f.onStop=function(){var m=this._anims,v=m.array;for(m.i=0;m.i<v.length;++m.i)v[m.i].stop()},f.onPause=function(){for(var m=this._anims.array,v=0;v<m.length;++v){var _=m[v];_.pause(),_.animator=null}},f.onResume=function(){for(var m=this._anims.array,v=0;v<m.length;++v){var _=m[v];_.animator=this,_.resume()}},f._reloadClip=function(m){s(this.target,m)},N.exports=o},{"../core/utils/binary-search":181,"./animation-curves":13,"./motion-path-helper":19,"./playable":20,"./types":21}],12:[function(T,N,z){var o=cc.Class({name:"cc.AnimationClip",extends:cc.Asset,properties:{_duration:{default:0,type:"Float"},duration:{get:function(){return this._duration}},sample:{default:60},speed:{default:1},wrapMode:{default:cc.WrapMode.Normal},curveData:{default:{},visible:!1},events:{default:[],visible:!1}},statics:{createWithSpriteFrames:function(s,n){if(!Array.isArray(s))return cc.errorID(3905),null;var t=new o;t.sample=n||t.sample,t._duration=s.length/t.sample;for(var e=[],r=1/t.sample,a=0,c=s.length;a<c;a++)e[a]={frame:a*r,value:s[a]};return t.curveData={comps:{"cc.Sprite":{spriteFrame:e}}},t}}});cc.AnimationClip=N.exports=o},{}],13:[function(T,N,z){function o(u,d){if(typeof d=="string"){var f=cc.Easing[d];f?u=f(u):cc.errorID(3906,d)}else Array.isArray(d)&&(u=s(d,u));return u}var s=T("./bezier").bezierByTime,n=T("../core/utils/binary-search").binarySearchEpsilon,t=T("./types").WrapModeMask,e=T("./types").WrappedInfo,r=cc.Class({name:"cc.AnimCurve",sample:function(u,d,f){},onTimeChangedManually:void 0}),a=cc.Class({name:"cc.DynamicAnimCurve",extends:r,properties:{target:null,prop:"",values:[],ratios:[],types:[],subProps:null},_findFrameIndex:n,sample:function(u,d,f){var m=this.values,v=this.ratios,_=v.length;if(_!==0){var p,g=this._findFrameIndex(v,d);if(g<0)if((g=~g)<=0)p=m[0];else if(g>=_)p=m[_-1];else{var y=m[g-1],C=typeof y=="number",S=y&&y.lerp;if(C||S){var I=v[g-1],b=v[g],A=this.types[g-1],E=(d-I)/(b-I);A&&(E=o(E,A));var R=m[g];C?p=y+(R-y)*E:S&&(p=y.lerp(R,E))}else p=y}else p=m[g];var O=this.subProps;if(O){for(var P=this.target[this.prop],x=P,w=0;w<O.length-1;w++){var L=O[w];if(!x)return;x=x[L]}var D=O[O.length-1];if(!x)return;x[D]=p,p=P}this.target[this.prop]=p}}});a.Linear=null,a.Bezier=function(u){return u};var c=function(){this.events=[]};c.prototype.add=function(u,d){this.events.push({func:u||"",params:d||[]})};var h=cc.Class({name:"cc.EventAnimCurve",extends:r,properties:{target:null,ratios:[],events:[],_wrappedInfo:{default:function(){return new e}},_lastWrappedInfo:null,_ignoreIndex:NaN},_wrapIterations:function(u){return u-(0|u)==0&&(u-=1),0|u},sample:function(u,d,f){var m=this.ratios.length,v=f.getWrappedInfo(f.time,this._wrappedInfo),_=v.direction,p=n(this.ratios,v.ratio);if(p<0&&(p=~p-1,_<0&&(p+=1)),this._ignoreIndex!==p&&(this._ignoreIndex=NaN),v.frameIndex=p,!this._lastWrappedInfo)return this._fireEvent(p),void(this._lastWrappedInfo=new e(v));var g=f.wrapMode,y=this._wrapIterations(v.iterations),C=this._lastWrappedInfo,S=this._wrapIterations(C.iterations),I=C.frameIndex,b=C.direction,A=S!==-1&&y!==S;if(I===p&&A&&m===1)this._fireEvent(0);else if(I!==p||A){_=b;do{if(I!==p&&(_===-1&&I===0&&p>0?((g&t.PingPong)===t.PingPong?_*=-1:I=m,S++):_===1&&I===m-1&&p<m-1&&((g&t.PingPong)===t.PingPong?_*=-1:I=-1,S++),I===p||S>y))break;I+=_,cc.director.getAnimationManager().pushDelayEvent(this,"_fireEvent",[I])}while(I!==p&&I>-1&&I<m)}this._lastWrappedInfo.set(v)},_fireEvent:function(u){if(!(u<0||u>=this.events.length||this._ignoreIndex===u)){var d=this.events[u].events;if(this.target.isValid)for(var f=this.target._components,m=0;m<d.length;m++)for(var v=d[m],_=v.func,p=0;p<f.length;p++){var g=f[p],y=g[_];y&&y.apply(g,v.params)}}},onTimeChangedManually:function(u,d){this._lastWrappedInfo=null,this._ignoreIndex=NaN;var f=d.getWrappedInfo(u,this._wrappedInfo),m=f.direction,v=n(this.ratios,f.ratio);v<0&&(v=~v-1,m<0&&(v+=1),this._ignoreIndex=v)}});N.exports={AnimCurve:r,DynamicAnimCurve:a,EventAnimCurve:h,EventInfo:c,computeRatioByType:o,quickFindIndex:function(u,d){var f=u.length-1;if(f===0)return 0;var m=u[0];if(d<m)return 0;var v=u[f];if(d>v)return f;var _=(d=(d-m)/(v-m))/(1/f),p=0|_;return _-p<1e-6?p:~(p+1)}}},{"../core/utils/binary-search":181,"./bezier":16,"./types":21}],14:[function(T,N,z){var o=cc.js,s=cc.Class({ctor:function(){this.__instanceId=cc.ClassManager.getNewInstanceId(),this._anims=new o.array.MutableForwardIterator([]),this._delayEvents=[]},update:function(n){var t=this._anims,e=t.array;for(t.i=0;t.i<e.length;++t.i){var r=e[t.i];r._isPlaying&&!r._isPaused&&r.update(n)}var a=this._delayEvents;for(i=0,l=a.length;i<l;i++){var c=a[i];c.target[c.func].apply(c.target,c.args)}a.length=0},destruct:function(){},addAnimation:function(n){this._anims.array.indexOf(n)===-1&&this._anims.push(n)},removeAnimation:function(n){var t=this._anims.array.indexOf(n);t>=0?this._anims.fastRemoveAt(t):cc.errorID(3907)},pushDelayEvent:function(n,t,e){this._delayEvents.push({target:n,func:t,args:e})}});cc.AnimationManager=N.exports=s},{}],15:[function(T,N,z){function o(d,f){e.call(this),cc.EventTarget.call(this),this._currentFramePlayed=!1,this._delay=0,this._delayTime=0,this._wrappedInfo=new a,this._lastWrappedInfo=null,this._process=s,this._clip=d,this._name=f||d&&d.name,this.animator=null,this.curves=[],this.delay=0,this.repeatCount=1,this.duration=1,this.speed=1,this.wrapMode=c.Normal,this.time=0,this._emit=this.emit,this.emit=function(){for(var m=new Array(arguments.length),v=0,_=m.length;v<_;v++)m[v]=arguments[v];cc.director.getAnimationManager().pushDelayEvent(this,"_emit",m)}}function s(){var d=this.sample(),f=this._hasListenerCache;if(f&&f.lastframe){var m;m=this._lastWrappedInfo?this._lastWrappedInfo:this._lastWrappedInfo=new a(d),this.repeatCount>1&&(0|d.iterations)>(0|m.iterations)&&this.emit("lastframe",this),m.set(d)}d.stopped&&(this.stop(),this.emit("finished",this))}function n(){var d=this.time,f=this.duration;d>f?(d%=f)===0&&(d=f):d<0&&(d%=f)!==0&&(d+=f);for(var m=d/f,v=this.curves,_=0,p=v.length;_<p;_++)v[_].sample(d,m,this);var g=this._hasListenerCache;g&&g.lastframe&&(this._lastIterations===void 0&&(this._lastIterations=m),(this.time>0&&this._lastIterations>m||this.time<0&&this._lastIterations<m)&&this.emit("lastframe",this),this._lastIterations=m)}var t=cc.js,e=T("./playable"),r=T("./types"),a=r.WrappedInfo,c=r.WrapMode,h=r.WrapModeMask;t.extend(o,e);var u=o.prototype;cc.js.mixin(u,cc.EventTarget.prototype),u._setListeners=function(d){this._capturingListeners=d?d._capturingListeners:null,this._bubblingListeners=d?d._bubblingListeners:null,this._hasListenerCache=d?d._hasListenerCache:null},u.onPlay=function(){this.setTime(0),this._delayTime=this._delay,cc.director.getAnimationManager().addAnimation(this),this.animator&&this.animator.addAnimation(this),this.emit("play",this)},u.onStop=function(){this.isPaused||cc.director.getAnimationManager().removeAnimation(this),this.animator&&this.animator.removeAnimation(this),this.emit("stop",this)},u.onResume=function(){cc.director.getAnimationManager().addAnimation(this),this.emit("resume",this)},u.onPause=function(){cc.director.getAnimationManager().removeAnimation(this),this.emit("pause",this)},u.setTime=function(d){this._currentFramePlayed=!1,this.time=d||0;for(var f=this.curves,m=0,v=f.length;m<v;m++){var _=f[m];_.onTimeChangedManually&&_.onTimeChangedManually(d,this)}},u.update=function(d){this._delayTime>0&&(this._delayTime-=d,this._delayTime>0)||(this._currentFramePlayed?this.time+=d*this.speed:this._currentFramePlayed=!0,this._process())},u._needRevers=function(d){var f=this.wrapMode,m=!1;return(f&h.PingPong)===h.PingPong&&(d-(0|d)==0&&d>0&&(d-=1),1&d&&(m=!m)),(f&h.Reverse)===h.Reverse&&(m=!m),m},u.getWrappedInfo=function(d,f){f=f||new a;var m=!1,v=this.duration,_=this.repeatCount,p=d>0?d/v:-d/v;if(p>=_){p=_,m=!0;var g=_-(0|_);g===0&&(g=1),d=g*v*(d>0?1:-1)}if(d>v){var y=d%v;d=y===0?v:y}else d<0&&(d%=v)!==0&&(d+=v);var C=!1,S=this._wrapMode&h.ShouldWrap;S&&(C=this._needRevers(p));var I=C?-1:1;return this.speed<0&&(I*=-1),S&&C&&(d=v-d),f.ratio=d/v,f.time=d,f.direction=I,f.stopped=m,f.iterations=p,f},u.sample=function(){for(var d=this.getWrappedInfo(this.time,this._wrappedInfo),f=this.curves,m=0,v=f.length;m<v;m++)f[m].sample(d.time,d.ratio,this);return d},t.get(u,"clip",function(){return this._clip}),t.get(u,"name",function(){return this._name}),t.obsolete(u,"AnimationState.length","duration"),t.getset(u,"curveLoaded",function(){return this.curves.length>0},function(){this.curves.length=0}),t.getset(u,"wrapMode",function(){return this._wrapMode},function(d){this._wrapMode=d,this.time=0,d&h.Loop?this.repeatCount=1/0:this.repeatCount=1}),t.getset(u,"repeatCount",function(){return this._repeatCount},function(d){this._repeatCount=d;var f=this._wrapMode&h.ShouldWrap,m=(this.wrapMode&h.Reverse)===h.Reverse;this._process=d!==1/0||f||m?s:n}),t.getset(u,"delay",function(){return this._delay},function(d){this._delayTime=this._delay=d}),cc.AnimationState=N.exports=o},{"./playable":20,"./types":21}],16:[function(T,N,z){function o(h,u,d,f,m){var v=1-m;return h*v*v*v+3*u*v*v*m+3*d*v*m*m+f*m*m*m}function s(h){return h<0?-Math.pow(-h,1/3):Math.pow(h,1/3)}function n(h,u){var d=function(m,v){var _,p,g,y,C,S=v-0,I=v-m[0],b=3*S,A=3*I,E=3*(v-m[2]),R=1/(-S+A-E+(v-1)),O=(b-6*I+E)*R,P=O*(1/3),x=(-b+A)*R,w=1/3*(3*x-O*O),L=w*(1/3),D=(2*O*O*O-9*O*x+S*R*27)/27,F=D/2,M=F*F+L*L*L;if(M<0){var B=.3333333333333333*-w,W=c(B*B*B),V=-D/(2*W),U=e(V<-1?-1:V>1?1:V),k=2*s(W);return g=k*t(U*.3333333333333333)-P,y=k*t((U+a)*.3333333333333333)-P,C=k*t((U+2*a)*.3333333333333333)-P,0<=g&&g<=1?0<=y&&y<=1?0<=C&&C<=1?r(g,y,C):r(g,y):0<=C&&C<=1?r(g,C):g:0<=y&&y<=1?0<=C&&C<=1?r(y,C):y:C}if(M===0)return _=F<0?s(-F):-s(F),g=2*_-P,y=-_-P,0<=g&&g<=1?0<=y&&y<=1?r(g,y):g:y;var X=c(M);return _=s(-F+X),p=s(F+X),g=_-p-P}(h,u),f=1-d;return 0*f*f*f+3*h[1]*d*f*f+3*h[3]*d*d*f+1*d*d*d}var t=Math.cos,e=Math.acos,r=Math.max,a=2*Math.PI,c=Math.sqrt;N.exports={bezier:o,bezierByTime:n}},{}],17:[function(T,N,z){function o(n,t){return function(e){return e<.5?t(2*e)/2:n(2*e-1)/2+.5}}var s={constant:function(){return 0},linear:function(n){return n},quadIn:function(n){return n*n},quadOut:function(n){return n*(2-n)},quadInOut:function(n){return(n*=2)<1?.5*n*n:-.5*(--n*(n-2)-1)},cubicIn:function(n){return n*n*n},cubicOut:function(n){return--n*n*n+1},cubicInOut:function(n){return(n*=2)<1?.5*n*n*n:.5*((n-=2)*n*n+2)},quartIn:function(n){return n*n*n*n},quartOut:function(n){return 1- --n*n*n*n},quartInOut:function(n){return(n*=2)<1?.5*n*n*n*n:-.5*((n-=2)*n*n*n-2)},quintIn:function(n){return n*n*n*n*n},quintOut:function(n){return--n*n*n*n*n+1},quintInOut:function(n){return(n*=2)<1?.5*n*n*n*n*n:.5*((n-=2)*n*n*n*n+2)},sineIn:function(n){return 1-Math.cos(n*Math.PI/2)},sineOut:function(n){return Math.sin(n*Math.PI/2)},sineInOut:function(n){return .5*(1-Math.cos(Math.PI*n))},expoIn:function(n){return n===0?0:Math.pow(1024,n-1)},expoOut:function(n){return n===1?1:1-Math.pow(2,-10*n)},expoInOut:function(n){return n===0?0:n===1?1:(n*=2)<1?.5*Math.pow(1024,n-1):.5*(2-Math.pow(2,-10*(n-1)))},circIn:function(n){return 1-Math.sqrt(1-n*n)},circOut:function(n){return Math.sqrt(1- --n*n)},circInOut:function(n){return(n*=2)<1?-.5*(Math.sqrt(1-n*n)-1):.5*(Math.sqrt(1-(n-=2)*n)+1)},elasticIn:function(n){var t,e=.1;return n===0?0:n===1?1:(!e||e<1?(e=1,t=.1):t=.4*Math.asin(1/e)/(2*Math.PI),-e*Math.pow(2,10*(n-=1))*Math.sin((n-t)*(2*Math.PI)/.4))},elasticOut:function(n){var t,e=.1;return n===0?0:n===1?1:(!e||e<1?(e=1,t=.1):t=.4*Math.asin(1/e)/(2*Math.PI),e*Math.pow(2,-10*n)*Math.sin((n-t)*(2*Math.PI)/.4)+1)},elasticInOut:function(n){var t,e=.1;return n===0?0:n===1?1:(!e||e<1?(e=1,t=.1):t=.4*Math.asin(1/e)/(2*Math.PI),(n*=2)<1?e*Math.pow(2,10*(n-=1))*Math.sin((n-t)*(2*Math.PI)/.4)*-.5:e*Math.pow(2,-10*(n-=1))*Math.sin((n-t)*(2*Math.PI)/.4)*.5+1)},backIn:function(n){return n*n*(2.70158*n-1.70158)},backOut:function(n){return--n*n*(2.70158*n+1.70158)+1},backInOut:function(n){return(n*=2)<1?n*n*(3.5949095*n-2.5949095)*.5:.5*((n-=2)*n*(3.5949095*n+2.5949095)+2)},bounceOut:function(n){return n<1/2.75?7.5625*n*n:n<2/2.75?7.5625*(n-=1.5/2.75)*n+.75:n<2.5/2.75?7.5625*(n-=2.25/2.75)*n+.9375:7.5625*(n-=2.625/2.75)*n+.984375},smooth:function(n){return n<=0?0:n>=1?1:n*n*(3-2*n)},fade:function(n){return n<=0?0:n>=1?1:n*n*n*(n*(6*n-15)+10)}};s.quadOutIn=o(s.quadIn,s.quadOut),s.cubicOutIn=o(s.cubicIn,s.cubicOut),s.quartOutIn=o(s.quartIn,s.quartOut),s.quintOutIn=o(s.quintIn,s.quintOut),s.sineOutIn=o(s.sineIn,s.sineOut),s.expoOutIn=o(s.expoIn,s.expoOut),s.circOutIn=o(s.circIn,s.circOut),s.backOutIn=o(s.backIn,s.backOut),s.backOutIn=o(s.backIn,s.backOut),s.bounceIn=function(n){return 1-s.bounceOut(1-n)},s.bounceInOut=function(n){return n<.5?.5*s.bounceIn(2*n):.5*s.bounceOut(2*n-1)+.5},s.bounceOutIn=o(s.bounceIn,s.bounceOut),cc.Easing=N.exports=s},{}],18:[function(T,N,z){T("./bezier"),T("./easing"),T("./types"),T("./motion-path-helper"),T("./animation-curves"),T("./animation-clip"),T("./animation-manager"),T("./animation-state"),T("./animation-animator")},{"./animation-animator":11,"./animation-clip":12,"./animation-curves":13,"./animation-manager":14,"./animation-state":15,"./bezier":16,"./easing":17,"./motion-path-helper":19,"./types":21}],19:[function(T,N,z){function o(h){this.points=h||[],this.beziers=[],this.ratios=[],this.progresses=[],this.length=0,this.computeBeziers()}function s(){this.start=c(),this.end=c(),this.startCtrlPoint=c(),this.endCtrlPoint=c()}function n(h,u,d,f){function m(it){return it instanceof cc.Vec2?{in:it,pos:it,out:it}:Array.isArray(it)&&it.length===6?{in:c(it[2],it[3]),pos:c(it[0],it[1]),out:c(it[4],it[5])}:{in:cc.Vec2.ZERO,pos:cc.Vec2.ZERO,out:cc.Vec2.ZERO}}function v(it,ot,_t){y.push(it),C.push(ot),S.push(_t)}var _=u.values;if(h.length!==0&&_.length!==0)if((_=_.map(function(it){return c(it[0],it[1])})).length!==1){for(var p=u.types,g=u.ratios,y=u.values=[],C=u.types=[],S=u.ratios=[],I=0,b=t.Linear,A=0,E=h.length;A<E-1;A++){var R,O=h[A],P=g[A],x=g[A+1]-P,w=_[A],L=_[A+1],D=p[A],F=[],M=I/x,B=1/(x*d*f);if(O&&O.length>0){var W=[];W.push(m(w));for(var V=0,U=O.length;V<U;V++){var k=m(O[V]);W.push(k)}W.push(m(L));var X=new o(W);X.computeBeziers();for(var Y=X.progresses;1-M>1e-6;){var Z,et,$,nt;if((R=e(R=M,D))<0)nt=(0-R)*(et=X.beziers[0]).getLength(),$=et.start.sub(et.endCtrlPoint).normalize(),Z=et.start.add($.mul(nt));else if(R>1)nt=(R-1)*(et=X.beziers[X.beziers.length-1]).getLength(),$=et.end.sub(et.startCtrlPoint).normalize(),Z=et.end.add($.mul(nt));else{var at=a(Y,R);at<0&&(at=~at),R-=at>0?Y[at-1]:0,R/=X.ratios[at],Z=X.beziers[at].getPointAt(R)}F.push(Z),M+=B}}else for(;1-M>1e-6;)R=e(R=M,D),F.push(w.lerp(L,R)),M+=B;for(b=D==="constant"?D:t.Linear,V=0,U=F.length;V<U;V++){var rt=P+I+B*V*x;v(F[V],b,rt)}I=Math.abs(M-1)>1e-6?(M-1)*x:0}g[g.length-1]!==S[S.length-1]&&v(_[_.length-1],b,g[g.length-1])}else u.values=_}var t=T("./animation-curves").DynamicAnimCurve,e=T("./animation-curves").computeRatioByType,r=T("./bezier").bezier,a=T("../core/utils/binary-search").binarySearchEpsilon,c=cc.v2;o.prototype.computeBeziers=function(){this.beziers.length=0,this.ratios.length=0,this.progresses.length=0,this.length=0;for(var h,u=1;u<this.points.length;u++){var d=this.points[u-1],f=this.points[u];(h=new s).start=d.pos,h.startCtrlPoint=d.out,h.end=f.pos,h.endCtrlPoint=f.in,this.beziers.push(h),this.length+=h.getLength()}var m=0;for(u=0;u<this.beziers.length;u++)h=this.beziers[u],this.ratios[u]=h.getLength()/this.length,this.progresses[u]=m+=this.ratios[u];return this.beziers},s.prototype.getPointAt=function(h){var u=this.getUtoTmapping(h);return this.getPoint(u)},s.prototype.getPoint=function(h){var u=r(this.start.x,this.startCtrlPoint.x,this.endCtrlPoint.x,this.end.x,h),d=r(this.start.y,this.startCtrlPoint.y,this.endCtrlPoint.y,this.end.y,h);return new c(u,d)},s.prototype.getLength=function(){var h=this.getLengths();return h[h.length-1]},s.prototype.getLengths=function(h){if(h||(h=this.__arcLengthDivisions?this.__arcLengthDivisions:200),this.cacheArcLengths&&this.cacheArcLengths.length===h+1)return this.cacheArcLengths;var u,d,f=[],m=this.getPoint(0),v=0;for(f.push(0),d=1;d<=h;d++)u=this.getPoint(d/h),v+=cc.pDistance(u,m),f.push(v),m=u;return this.cacheArcLengths=f,f},s.prototype.getUtoTmapping=function(h,u){var d,f=this.getLengths(),m=0,v=f.length;d=u||h*f[v-1];for(var _,p=0,g=v-1;p<=g;)if(m=Math.floor(p+(g-p)/2),(_=f[m]-d)<0)p=m+1;else{if(!(_>0)){g=m;break}g=m-1}if(m=g,f[m]===d)return m/(v-1);var y=f[m];return(m+(d-y)/(f[m+1]-y))/(v-1)},N.exports={sampleMotionPaths:n,Curve:o,Bezier:s}},{"../core/utils/binary-search":181,"./animation-curves":13,"./bezier":16}],20:[function(T,N,z){function o(){this._isPlaying=!1,this._isPaused=!1,this._stepOnce=!1}var s=cc.js,n=o.prototype;s.get(n,"isPlaying",function(){return this._isPlaying},!0),s.get(n,"isPaused",function(){return this._isPaused},!0);var t=function(){};n.onPlay=t,n.onPause=t,n.onResume=t,n.onStop=t,n.onError=t,n.play=function(){this._isPlaying?this._isPaused?(this._isPaused=!1,this.onResume()):this.onError("already-playing"):(this._isPlaying=!0,this.onPlay())},n.stop=function(){this._isPlaying&&(this._isPlaying=!1,this.onStop(),this._isPaused=!1)},n.pause=function(){this._isPlaying&&!this._isPaused&&(this._isPaused=!0,this.onPause())},n.resume=function(){this._isPlaying&&this._isPaused&&(this._isPaused=!1,this.onResume())},n.step=function(){this.pause(),this._stepOnce=!0,this._isPlaying||this.play()},N.exports=o},{}],21:[function(T,N,z){function o(t){t?this.set(t):(this.ratio=0,this.time=0,this.direction=1,this.stopped=!0,this.iterations=0,this.frameIndex=void 0)}cc.js;var s={Loop:2,ShouldWrap:4,PingPong:22,Reverse:36},n=cc.Enum({Default:0,Normal:1,Reverse:s.Reverse,Loop:s.Loop,LoopReverse:s.Loop|s.Reverse,PingPong:s.PingPong,PingPongReverse:s.PingPong|s.Reverse});cc.WrapMode=n,o.prototype.set=function(t){this.ratio=t.ratio,this.time=t.time,this.direction=t.direction,this.stopped=t.stopped,this.iterations=t.iterations,this.frameIndex=t.frameIndex},N.exports={WrapModeMask:s,WrapMode:n,WrappedInfo:o}},{}],22:[function(T,N,z){var o=T("../core/event/event-target"),s=T("../core/platform/CCSys"),n=!1,t=[],e=function(a){o.call(this),this._src=a,this._audioType=e.Type.UNKNOWN,this._element=null,this._eventList={},this._state=e.State.INITIALZING,this._loaded=!1,this._onended=function(){this.emit("ended")}.bind(this)};cc.js.extend(e,o),e.Type={DOM:"AUDIO",WEBAUDIO:"WEBAUDIO",NATIVE:"NATIVE",UNKNOWN:"UNKNOWN"},e.State={ERROR:-1,INITIALZING:0,PLAYING:1,PAUSED:2},function(a){a.preload=function(){var c=this._src,h=this;if(!c)return this._src="",this._audioType=e.Type.UNKNOWN,this._element=null,this._state=e.State.INITIALZING,void(this._loaded=!1);if(!this._element){var u=cc.loader.getItem(c);if(u||(u=cc.loader.getItem(c+"?useDom=1")),!u||!u.complete)return cc.loader.load(c,function(d){if(!d){var f=cc.loader.getItem(c);h.mount(f.element||f.buffer),h.emit("load")}});h.mount(u.element||u.buffer),h.emit("load")}},a._bindEnded=function(c){c=c||this._onended,this._audioType===e.Type.DOM?this._element.addEventListener("ended",c):this._element.onended=c},a._unbindEnded=function(){this._audioType===e.Type.DOM?this._element.removeEventListener("ended",this._onended):this._element.onended=null},a.mount=function(c){c instanceof HTMLElement?(this._element=document.createElement("audio"),this._element.src=c.src,this._audioType=e.Type.DOM):(this._element=new r(c,this),this._audioType=e.Type.WEBAUDIO),this._state=e.State.INITIALZING,this._loaded=!0},a.play=function(){this._element&&(this._bindEnded(),this._element.play(),this.emit("play"),this._state=e.State.PLAYING,this._audioType===e.Type.DOM&&this._element.paused&&t.push({instance:this,offset:0,audio:this._element}),n||(n=!0,cc.game.canvas.addEventListener("touchstart",function(){for(var c;c=t.pop();)c.audio.play(c.offset)})))},a.destroy=function(){},a.pause=function(){this._element&&(this._unbindEnded(),this._element.pause(),this.emit("pause"),this._state=e.State.PAUSED)},a.resume=function(){this._element&&this._state!==e.State.PLAYING&&(this._bindEnded(),this._element.play(),this.emit("resume"),this._state=e.State.PLAYING)},a.stop=function(){if(this._element){try{this._element.currentTime=0}catch(h){}this._element.pause();for(var c=0;c<t.length;c++)if(t[c].instance===this){t.splice(c,1);break}this._unbindEnded(),this.emit("stop"),this._state=e.State.PAUSED}},a.setLoop=function(c){this._element&&(this._element.loop=c)},a.getLoop=function(){return this._element&&this._element.loop},a.setVolume=function(c){this._element&&(this._element.volume=c)},a.getVolume=function(){return this._element?this._element.volume:1},a.setCurrentTime=function(c){if(this._element){this._unbindEnded(),this._bindEnded(function(){this._bindEnded()}.bind(this));try{this._element.currentTime=c}catch(d){var h=this._element;if(h.addEventListener){var u=function(){h.removeEventListener("loadedmetadata",u),h.currentTime=c};h.addEventListener("loadedmetadata",u)}}}},a.getCurrentTime=function(){return this._element?this._element.currentTime:0},a.getDuration=function(){return this._element?this._element.duration:0},a.getState=function(){var c=this._element;return e.State.PLAYING===this._state&&c.paused&&(this._state=e.State.PAUSED),this._state},a.__defineGetter__("src",function(){return this._src}),a.__defineSetter__("src",function(c){return this._src=c}),a.__defineGetter__("paused",function(){return!this._element||this._element.paused})}(e.prototype);var r=function(a,c){this._audio=c,this._context=s.__audioSupport.context,this._buffer=a,this._gainObj=this._context.createGain(),this._volume=1,this._gainObj.gain.setTargetAtTime?this._gainObj.gain.setTargetAtTime(this._volume,this._context.currentTime,.01):this._gainObj.gain.value=1,this._gainObj.connect(this._context.destination),this._loop=!1,this._startTime=-1,this._currentSource=null,this.playedLength=0,this._currextTimer=null,this._endCallback=function(){this.onended&&this.onended(this)}.bind(this)};(function(a){a.play=function(c){this._currentSource&&!this.paused&&(this._currentSource.onended=null,this._currentSource.stop(0),this.playedLength=0);var h=this._context.createBufferSource();h.buffer=this._buffer,h.connect(this._gainObj),h.loop=this._loop,this._startTime=this._context.currentTime,(c=c||this.playedLength)&&(this._startTime-=c);var u,d=this._buffer.duration,f=c;if(this._loop?h.start?h.start(0,f):h.notoGrainOn?h.noteGrainOn(0,f):h.noteOn(0,f):(u=d-c,h.start?h.start(0,f,u):h.notoGrainOn?h.noteGrainOn(0,f,u):h.noteOn(0,f,u)),this._currentSource=h,h.onended=this._endCallback,(!h.context.state||h.context.state==="suspended")&&this._context.currentTime===0){var m=this;clearTimeout(this._currextTimer),this._currextTimer=setTimeout(function(){m._context.currentTime===0&&t.push({instance:m._audio,offset:c,audio:m})},10)}},a.pause=function(){if(clearTimeout(this._currextTimer),!this.paused){this.playedLength=this._context.currentTime-this._startTime,this.playedLength%=this._buffer.duration;var c=this._currentSource;this._currentSource=null,this._startTime=-1,c&&c.stop(0)}},a.__defineGetter__("paused",function(){return(!this._currentSource||!this._currentSource.loop)&&(this._startTime===-1||this._context.currentTime-this._startTime>this._buffer.duration)}),a.__defineGetter__("loop",function(){return this._loop}),a.__defineSetter__("loop",function(c){return this._currentSource&&(this._currentSource.loop=c),this._loop=c}),a.__defineGetter__("volume",function(){return this._volume}),a.__defineSetter__("volume",function(c){return this._volume=c,this._gainObj.gain.setTargetAtTime?this._gainObj.gain.setTargetAtTime(this._volume,this._context.currentTime,.01):this._volume.gain.value=c,s.os===s.OS_IOS&&!this.paused&&this._currentSource&&(this._currentSource.onended=null,this.pause(),this.play()),c}),a.__defineGetter__("currentTime",function(){return this.paused?this.playedLength:(this.playedLength=this._context.currentTime-this._startTime,this.playedLength%=this._buffer.duration,this.playedLength)}),a.__defineSetter__("currentTime",function(c){return this.paused?this.playedLength=c:(this.pause(),this.playedLength=c,this.play()),c}),a.__defineGetter__("duration",function(){return this._buffer.duration})})(r.prototype),N.exports=cc.Audio=e},{"../core/event/event-target":97,"../core/platform/CCSys":144}],23:[function(T,N,z){var o=T("./CCAudio"),s=0,n={},t={},e=function(c){return n[c]},r={AudioState:o.State,_maxWebAudioSize:2097152,_maxAudioInstance:24,_id2audio:n,play:function(c,h,u){var d=function(m){var v=s++,_=t[m];_||(_=t[m]=[]);var p;if(r._maxAudioInstance<=_.length){var g=_.shift(),y=n[g];y.stop(),y.destroy()}var C=function(){var S=this.instanceId;delete n[S];var I=_.indexOf(S);cc.js.array.fastRemoveAt(_,I)};return(p=new o(m)).on("ended",C),p.on("stop",C),n[v]=p,p.instanceId=v,_.push(v),p}(c),f=function(){d.setLoop(h||!1),(typeof u!="number"||Number.isNaN(u))&&(u=1),d.setVolume(u),d.play()};return d.__callback=f,d.on("load",f),d.preload(),d.instanceId},setLoop:function(c,h){var u=e(c);u&&u.setLoop&&u.setLoop(h)},isLoop:function(c){var h=e(c);return!(!h||!h.isLoop)&&h.isLoop()},setVolume:function(c,h){var u=e(c);u&&(u._loaded||u.once("load",function(){u.setVolume&&u.setVolume(h)}),u.setVolume&&u.setVolume(h))},getVolume:function(c){var h=e(c);return h&&h.getVolume?h.getVolume():1},setCurrentTime:function(c,h){var u=e(c);return!!u&&(u._loaded?(u.setCurrentTime&&u.setCurrentTime(h),!0):(u.once("load",function(){u.setCurrentTime&&u.setCurrentTime(h)}),!0))},getCurrentTime:function(c){var h=e(c);return h&&h.getCurrentTime?h.getCurrentTime():0},getDuration:function(c){var h=e(c);return h&&h.getDuration?h.getDuration():0},getState:function(c){var h=e(c);return h&&h.getState?h.getState():this.AudioState.ERROR},setFinishCallback:function(c,h){var u=e(c);u&&(u.off("ended",u._finishCallback),u._finishCallback=h,u.on("ended",u._finishCallback))},pause:function(c){var h=e(c);return!(!h||!h.pause)&&(h.pause(),!0)},_pauseIDCache:[],pauseAll:function(){for(var c in n){var h=n[c];h.getState()===o.State.PLAYING&&(this._pauseIDCache.push(c),h.pause())}},resume:function(c){var h=e(c);if(!h||!h.resume)return!1;h.resume()},resumeAll:function(){for(;this._pauseIDCache.length>0;){var c=this._pauseIDCache.pop(),h=e(c);h&&h.resume&&h.resume()}},stop:function(c){var h=e(c);return!(!h||!h.stop)&&(h.off("load",h.__callback),h.stop(),h.destroy(),!0)},stopAll:function(){for(var c in n){var h=n[c];h&&h.stop&&(h.stop(),h.destroy(),h.off("load",h.__callback))}},setMaxAudioInstance:function(c){return this._maxAudioInstance=c},getMaxAudioInstance:function(){return this._maxAudioInstance},uncache:function(c){var h=t[c];if(h)for(;h.length>0;){var u=h.pop(),d=n[u];d&&(d.stop(),d.destroy(),delete n[u])}},uncacheAll:function(){this.stopAll();for(var c in n){var h=n[c];h&&h.destroy()}n={},t={}},getProfile:function(c){},preload:function(c,h){cc.loader.load(c,h&&function(u){u||h()})},setMaxWebAudioSize:function(c){this._maxWebAudioSize=1024*c},_breakCache:null,_break:function(){this._breakCache=[];for(var c in n){var h=n[c];h.getState()===o.State.PLAYING&&(this._breakCache.push(c),h.pause())}},_restore:function(){if(this._breakCache){for(;this._breakCache.length>0;){var c=this._breakCache.pop(),h=e(c);h&&h.resume&&h.resume()}this._breakCache=null}}};N.exports=cc.audioEngine=r;var a=T("./deprecated");a.removed(r),a.deprecated(r)},{"./CCAudio":22,"./deprecated":24}],24:[function(T,N,z){var o=cc.js;z.removed=function(s){function n(){cc.errorID(1403)}o.getset(s,"willPlayMusic",n,n)},z.deprecated=function(s){var n=-1,t=1,e=1,r=[];o.get(s,"playMusic",function(){return function(a,c){return s.stop(n),n=s.play(a,c,t),n}}),o.get(s,"stopMusic",function(){return function(){return s.stop(n),n}}),o.get(s,"pauseMusic",function(){return function(){return s.pause(n),n}}),o.get(s,"resumeMusic",function(){return function(){return s.resume(n),n}}),o.get(s,"rewindMusic",function(){return function(){return s.setCurrentTime(n,0),n}}),o.get(s,"getMusicVolume",function(){return function(){return t}}),o.get(s,"setMusicVolume",function(){return function(a){return t=a,s.setVolume(n,t),t}}),o.get(s,"isMusicPlaying",function(){return function(){return s.getState(n)===s.AudioState.PLAYING}}),o.get(s,"playEffect",function(){return function(a,c,h){return s.play(a,c||!1,h===void 0?e:h)}}),o.get(s,"setEffectsVolume",function(a){return function(c){e=c;var h=s._id2audio;for(var u in h)u!==n&&s.setVolume(u,c)}}),o.get(s,"getEffectsVolume",function(){return function(){return e}}),o.get(s,"pauseEffect",function(){return function(a){return s.pause(a)}}),o.get(s,"pauseAllEffects",function(){return function(){r.length=0;var a=s._id2audio;for(var c in a)if(c!==n){var h=a[c];h.getState()===s.AudioState.PLAYING&&(r.push(c),h.pause())}}}),o.get(s,"resumeEffect",function(){return function(a){s.resume(a)}}),o.get(s,"resumeAllEffects",function(){return function(){for(var a=s._id2audio;r.length>0;){var c=a[r.pop()];c&&c.resume&&c.resume()}}}),o.get(s,"stopEffect",function(){return function(a){return s.stop(a)}}),o.get(s,"stopAllEffects",function(){return function(){var a=s._id2audio;for(var c in a)if(c!==n){var h=a[c];h.getState()===s.AudioState.PLAYING&&h.stop()}}}),o.get(s,"unloadEffect",function(){return function(a){return s.stop(a)}}),o.get(s,"end",function(){return function(){return s.stopAll()}})}},{}],25:[function(T,N,z){cc.ClippingNode=_ccsg.Node.extend({inverted:!1,_alphaThreshold:0,_stencil:null,_className:"ClippingNode",_originStencilProgram:null,ctor:function(s){s=s||null,_ccsg.Node.prototype.ctor.call(this),this._stencil=s,s&&(this._originStencilProgram=s.getShaderProgram()),this.alphaThreshold=1,this.inverted=!1,this._renderCmd.initStencilBits()},onEnter:function(){_ccsg.Node.prototype.onEnter.call(this),this._stencil&&this._stencil.performRecursive(_ccsg.Node.performType.onEnter)},onEnterTransitionDidFinish:function(){_ccsg.Node.prototype.onEnterTransitionDidFinish.call(this),this._stencil&&this._stencil.performRecursive(_ccsg.Node.performType.onEnterTransitionDidFinish)},onExitTransitionDidStart:function(){this._stencil&&this._stencil.performRecursive(_ccsg.Node.performType.onExitTransitionDidStart),_ccsg.Node.prototype.onExitTransitionDidStart.call(this)},onExit:function(){this._stencil&&this._stencil.performRecursive(_ccsg.Node.performType.onExit),_ccsg.Node.prototype.onExit.call(this)},visit:function(s){this._renderCmd.clippingVisit(s&&s._renderCmd)},_visitChildren:function(){this._reorderChildDirty&&this.sortAllChildren();for(var s,n=this._children,t=0,e=n.length;t<e;t++)(s=n[t])&&s._visible&&s.visit(this);this._renderCmd._dirtyFlag=0},getAlphaThreshold:function(){return this._alphaThreshold},setAlphaThreshold:function(s){s===1&&s!==this._alphaThreshold&&this._renderCmd.resetProgramByStencil(),this._alphaThreshold=s},isInverted:function(){return this.inverted},setInverted:function(s){this.inverted=s},getStencil:function(){return this._stencil},setStencil:function(s){this._stencil!==s&&(s&&(this._originStencilProgram=s.getShaderProgram()),this._renderCmd.setStencil(s))},_createRenderCmd:function(){return cc._renderType===cc.game.RENDER_TYPE_CANVAS?new cc.ClippingNode.CanvasRenderCmd(this):new cc.ClippingNode.WebGLRenderCmd(this)}}),cc.ClippingNode.stencilBits=-1;var o=cc.ClippingNode.prototype;cc.defineGetterSetter(o,"stencil",o.getStencil,o.setStencil),cc.defineGetterSetter(o,"alphaThreshold",o.getAlphaThreshold,o.setAlphaThreshold)},{}],26:[function(T,N,z){T("../shape-nodes/CCDrawNode"),cc.ClippingNode.CanvasRenderCmd=function(s){this._rootCtor(s),this._needDraw=!1,this._rendererClipCmd=new cc.CustomRenderCmd(this,this._drawStencilCommand),this._rendererRestoreCmd=new cc.CustomRenderCmd(this,this._restoreCmdCallback)};var o=cc.ClippingNode.CanvasRenderCmd.prototype=Object.create(_ccsg.Node.CanvasRenderCmd.prototype);o.constructor=cc.ClippingNode.CanvasRenderCmd,o.resetProgramByStencil=function(){},o.initStencilBits=function(){},o.setStencil=function(s){s!=null&&(this._node._stencil=s,s instanceof cc.DrawNode||cc.errorID(6300))},o._restoreCmdCallback=function(s){(s||cc._renderContext).restore()},o._drawStencilCommand=function(s,n,t){var e=s||cc._renderContext,r=e.getContext();e.save(),r.beginPath(),e.setTransform(this._worldTransform,n,t);for(var a=this._node._stencil._buffer,c=0;c<a.length;++c){var h=a[c].verts;if(!(h.length<3)){r.moveTo(h[0].x,-h[0].y);for(var u=1;u<h.length;++u)r.lineTo(h[u].x,-h[u].y)}}r.clip()},o.clippingVisit=function(s){var n=this._node;if(s=s||this.getParentRenderCmd(),this._propagateFlagsDown(s),n._visible){s&&(this._curLevel=s._curLevel+1),this._syncStatus(s),n._stencil&&cc.renderer.pushRenderCommand(this._rendererClipCmd);var t,e=n._children,r=e.length;if(r>0)for(n.sortAllChildren(),t=0;t<r;t++)e[t].visit(n);n._stencil&&cc.renderer.pushRenderCommand(this._rendererRestoreCmd),this._dirtyFlag=0}}},{"../shape-nodes/CCDrawNode":229}],27:[function(T,N,z){function o(t,e){t.shaderProgram=e;var r=t.children;if(r)for(var a=0;a<r.length;a++)o(r[a],e)}T("../core/CCDrawingPrimitives");var s={stencilEnabled:!1,depthWriteMask:!0};cc.ClippingNode.WebGLRenderCmd=function(t){this._rootCtor(t),this._needDraw=!1,this._beforeVisitCmd=new cc.CustomRenderCmd(this,this._onBeforeVisit),this._afterDrawStencilCmd=new cc.CustomRenderCmd(this,this._onAfterDrawStencil),this._afterVisitCmd=new cc.CustomRenderCmd(this,this._onAfterVisit),this._previousState=null,this._state={stencilEnabled:!0,stencilWriteMask:0,depthWriteMask:!1,stencilFunc:0,stencilRef:0,stencilValueMask:0}};var n=cc.ClippingNode.WebGLRenderCmd.prototype=Object.create(_ccsg.Node.WebGLRenderCmd.prototype);n.constructor=cc.ClippingNode.WebGLRenderCmd,cc.ClippingNode.WebGLRenderCmd._init_once=null,cc.ClippingNode.WebGLRenderCmd._visit_once=null,cc.ClippingNode.WebGLRenderCmd._layer=-1,n.initStencilBits=function(){cc.ClippingNode.WebGLRenderCmd._init_once=!0,cc.ClippingNode.WebGLRenderCmd._init_once&&(cc.ClippingNode.stencilBits=cc._renderContext.getParameter(cc._renderContext.STENCIL_BITS),cc.ClippingNode.stencilBits<=0&&cc.logID(6301),cc.ClippingNode.WebGLRenderCmd._init_once=!1)},n.transform=function(t,e){var r=this._node;this.originTransform(t,e),r._stencil&&(r._stencil._renderCmd.transform(this,!0),r._stencil._dirtyFlag&=~_ccsg.Node._dirtyFlags.transformDirty)},n.clippingVisit=function(t){var e=this._node;if(t=t||this.getParentRenderCmd(),this.visit(t),cc.ClippingNode.stencilBits<1)e._visitChildren();else if(e._stencil&&e._stencil.visible){if(cc.ClippingNode.WebGLRenderCmd._layer+1===cc.ClippingNode.stencilBits)return cc.ClippingNode.WebGLRenderCmd._visit_once=!0,cc.ClippingNode.WebGLRenderCmd._visit_once&&(cc.logID(6302,cc.ClippingNode.stencilBits),cc.ClippingNode.WebGLRenderCmd._visit_once=!1),void e._visitChildren();cc.renderer.pushRenderCommand(this._beforeVisitCmd),e._stencil.visit(e),cc.renderer.pushRenderCommand(this._afterDrawStencilCmd);var r=e._children;if(r&&r.length>0){var a=r.length;e.sortAllChildren();for(var c=0;c<a;c++)r[c].visit(e)}cc.renderer.pushRenderCommand(this._afterVisitCmd),this._dirtyFlag=0}else e.inverted&&e._visitChildren()},n.setStencil=function(t){var e=this._node;e._stencil&&(e._stencil._parent=null),e._stencil=t,e._stencil&&(e._stencil._parent=e)},n._drawFullScreenQuadClearStencil=function(){var t=cc.math.projection_matrix_stack;t.push(),t.top.identity();var e=cc.math.modelview_matrix_stack;e.push(),e.top.identity(),cc._drawingUtil.drawSolidRect(cc.p(-1,-1),cc.p(1,1),cc.color(255,255,255,255)),t.pop(),e.pop()},n.resetProgramByStencil=function(){var t=this._node;if(t._stencil){var e=t._originStencilProgram;o(t._stencil,e)}},n._onBeforeVisit=function(t){var e=t||cc._renderContext,r=this._node;cc.ClippingNode.WebGLRenderCmd._layer++;var a=1<<cc.ClippingNode.WebGLRenderCmd._layer,c=a|a-1;if(this._previousState=s,e.enable(e.STENCIL_TEST),e.stencilMask(a),e.depthMask(!1),e.stencilFunc(e.NEVER,a,a),e.stencilOp(this._node.inverted?e.REPLACE:e.ZERO,e.KEEP,e.KEEP),this._drawFullScreenQuadClearStencil(),e.stencilFunc(e.NEVER,a,a),e.stencilOp(this._node.inverted?e.ZERO:e.REPLACE,e.KEEP,e.KEEP),r.alphaThreshold<1){var h=cc.shaderCache.programForKey(cc.macro.SHADER_POSITION_TEXTURECOLORALPHATEST);cc.gl.useProgram(h.getProgram()),h.setUniformLocationWith1f(cc.macro.UNIFORM_ALPHA_TEST_VALUE_S,r.alphaThreshold),h.setUniformLocationWithMatrix4fv(cc.macro.UNIFORM_MVMATRIX_S,cc.renderer.mat4Identity.mat),o(r._stencil,h)}this._state.stencilWriteMask=a,this._state.stencilRef=this._state.stencilValueMask=c,this._state.stencilFunc=e.NEVER,s=this._state},n._onAfterDrawStencil=function(t){var e=t||cc._renderContext;e.depthMask(this._previousState.depthWriteMask),e.stencilFunc(e.EQUAL,this._state.stencilRef,this._state.stencilValueMask),e.stencilOp(e.KEEP,e.KEEP,e.KEEP),this._state.stencilFunc=e.EQUAL},n._onAfterVisit=function(t){var e=t||cc._renderContext,r=this._previousState;r.stencilEnabled?(e.stencilFunc(r.stencilFunc,r.stencilRef,r.stencilValueMask),e.stencilOp(e.KEEP,e.KEEP,e.KEEP),e.stencilMask(r.stencilWriteMask)):e.disable(e.STENCIL_TEST),s=this._previousState,this._previousState=null,cc.ClippingNode.WebGLRenderCmd._layer--}},{"../core/CCDrawingPrimitives":36}],28:[function(T,N,z){cc.Codec={name:"Jacob__Codec"},cc.Codec.Base64=T("./base64"),cc.Codec.GZip=T("./gzip"),cc.Codec.unzip=function(){return cc.Codec.GZip.gunzip.apply(cc.Codec.GZip,arguments)},cc.Codec.unzipBase64=function(){var o=cc.Codec.Base64.decode.apply(cc.Codec.Base64,arguments);try{return cc.Codec.GZip.gunzip.call(cc.Codec.GZip,o)}catch(s){return o.slice(7)}},cc.Codec.unzipBase64AsArray=function(o,s){s=s||1;var n,t,e,r=this.unzipBase64(o),a=[];for(n=0,e=r.length/s;n<e;n++)for(a[n]=0,t=s-1;t>=0;--t)a[n]+=r.charCodeAt(n*s+t)<<8*t;return a},cc.Codec.unzipAsArray=function(o,s){s=s||1;var n,t,e,r=this.unzip(o),a=[];for(n=0,e=r.length/s;n<e;n++)for(a[n]=0,t=s-1;t>=0;--t)a[n]+=r.charCodeAt(n*s+t)<<8*t;return a}},{"./base64":29,"./gzip":30}],29:[function(T,N,z){var o=T("../core/utils/misc").BASE64_VALUES,s={name:"Jacob__Codec__Base64"};s.decode=function(n){var t,e,r,a,c,h,u=[],d=0;for(n=n.replace(/[^A-Za-z0-9\+\/\=]/g,"");d<n.length;)t=o[n.charCodeAt(d++)]<<2|(a=o[n.charCodeAt(d++)])>>4,e=(15&a)<<4|(c=o[n.charCodeAt(d++)])>>2,r=(3&c)<<6|(h=o[n.charCodeAt(d++)]),u.push(String.fromCharCode(t)),c!==64&&u.push(String.fromCharCode(e)),h!==64&&u.push(String.fromCharCode(r));return u=u.join("")},s.decodeAsArray=function(n,t){var e,r,a,c=this.decode(n),h=[];for(e=0,a=c.length/t;e<a;e++)for(h[e]=0,r=t-1;r>=0;--r)h[e]+=c.charCodeAt(e*t+r)<<8*r;return h},N.exports=s},{"../core/utils/misc":185}],30:[function(T,N,z){var o=function(s){this.data=s,this.debug=!1,this.gpflags=void 0,this.files=0,this.unzipped=[],this.buf32k=new Array(32768),this.bIdx=0,this.modeZIP=!1,this.bytepos=0,this.bb=1,this.bits=0,this.nameBuf=[],this.fileout=void 0,this.literalTree=new Array(o.LITERALS),this.distanceTree=new Array(32),this.treepos=0,this.Places=null,this.len=0,this.fpos=new Array(17),this.fpos[0]=0,this.flens=void 0,this.fmax=void 0};o.gunzip=function(s){return s.constructor===Array||s.constructor,new o(s).gunzip()[0][0]},o.HufNode=function(){this.b0=0,this.b1=0,this.jump=null,this.jumppos=-1},o.LITERALS=288,o.NAMEMAX=256,o.bitReverse=[0,128,64,192,32,160,96,224,16,144,80,208,48,176,112,240,8,136,72,200,40,168,104,232,24,152,88,216,56,184,120,248,4,132,68,196,36,164,100,228,20,148,84,212,52,180,116,244,12,140,76,204,44,172,108,236,28,156,92,220,60,188,124,252,2,130,66,194,34,162,98,226,18,146,82,210,50,178,114,242,10,138,74,202,42,170,106,234,26,154,90,218,58,186,122,250,6,134,70,198,38,166,102,230,22,150,86,214,54,182,118,246,14,142,78,206,46,174,110,238,30,158,94,222,62,190,126,254,1,129,65,193,33,161,97,225,17,145,81,209,49,177,113,241,9,137,73,201,41,169,105,233,25,153,89,217,57,185,121,249,5,133,69,197,37,165,101,229,21,149,85,213,53,181,117,245,13,141,77,205,45,173,109,237,29,157,93,221,61,189,125,253,3,131,67,195,35,163,99,227,19,147,83,211,51,179,115,243,11,139,75,203,43,171,107,235,27,155,91,219,59,187,123,251,7,135,71,199,39,167,103,231,23,151,87,215,55,183,119,247,15,143,79,207,47,175,111,239,31,159,95,223,63,191,127,255],o.cplens=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],o.cplext=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,99,99],o.cpdist=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],o.cpdext=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],o.border=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],o.prototype.gunzip=function(){return this.outputArr=[],this.nextFile(),this.unzipped},o.prototype.readByte=function(){return this.bits+=8,this.bytepos<this.data.length?this.data.charCodeAt(this.bytepos++):-1},o.prototype.byteAlign=function(){this.bb=1},o.prototype.readBit=function(){var s;return this.bits++,s=1&this.bb,this.bb>>=1,this.bb===0&&(this.bb=this.readByte(),s=1&this.bb,this.bb=this.bb>>1|128),s},o.prototype.readBits=function(s){for(var n=0,t=s;t--;)n=n<<1|this.readBit();return s&&(n=o.bitReverse[n]>>8-s),n},o.prototype.flushBuffer=function(){this.bIdx=0},o.prototype.addBuffer=function(s){this.buf32k[this.bIdx++]=s,this.outputArr.push(String.fromCharCode(s)),this.bIdx===32768&&(this.bIdx=0)},o.prototype.IsPat=function(){for(;;){if(this.fpos[this.len]>=this.fmax)return-1;if(this.flens[this.fpos[this.len]]===this.len)return this.fpos[this.len]++;this.fpos[this.len]++}},o.prototype.Rec=function(){var s,n=this.Places[this.treepos];if(this.len===17)return-1;if(this.treepos++,this.len++,(s=this.IsPat())>=0)n.b0=s;else if(n.b0=32768,this.Rec())return-1;if((s=this.IsPat())>=0)n.b1=s,n.jump=null;else if(n.b1=32768,n.jump=this.Places[this.treepos],n.jumppos=this.treepos,this.Rec())return-1;return this.len--,0},o.prototype.CreateTree=function(s,n,t,e){var r;for(this.Places=s,this.treepos=0,this.flens=t,this.fmax=n,r=0;r<17;r++)this.fpos[r]=0;return this.len=0,this.Rec()?-1:0},o.prototype.DecodeValue=function(s){for(var n,t,e=0,r=s[e];;)if(this.readBit()){if(!(32768&r.b1))return r.b1;for(r=r.jump,n=s.length,t=0;t<n;t++)if(s[t]===r){e=t;break}}else{if(!(32768&r.b0))return r.b0;r=s[++e]}return-1},o.prototype.DeflateLoop=function(){var s,n,t;do if(s=this.readBit(),(n=this.readBits(2))===0){var e,r;for(this.byteAlign(),e=this.readByte(),e|=this.readByte()<<8,r=this.readByte(),65535&(e^~(r|=this.readByte()<<8))&&document.write(`BlockLen checksum mismatch
`);e--;)a=this.readByte(),this.addBuffer(a)}else if(n===1)for(;;)if((c=o.bitReverse[this.readBits(7)]>>1)>23?(c=c<<1|this.readBit())>199?c=(c-=128)<<1|this.readBit():(c-=48)>143&&(c+=136):c+=256,c<256)this.addBuffer(c);else{if(c===256)break;for(c-=257,p=this.readBits(o.cplext[c])+o.cplens[c],c=o.bitReverse[this.readBits(5)]>>3,o.cpdext[c]>8?(g=this.readBits(8),g|=this.readBits(o.cpdext[c]-8)<<8):g=this.readBits(o.cpdext[c]),g+=o.cpdist[c],c=0;c<p;c++){var a=this.buf32k[this.bIdx-g&32767];this.addBuffer(a)}}else if(n===2){var c,h,u,d,f,m=new Array(320);for(u=257+this.readBits(5),d=1+this.readBits(5),f=4+this.readBits(4),c=0;c<19;c++)m[c]=0;for(c=0;c<f;c++)m[o.border[c]]=this.readBits(3);for(p=this.distanceTree.length,t=0;t<p;t++)this.distanceTree[t]=new o.HufNode;if(this.CreateTree(this.distanceTree,19,m,0))return this.flushBuffer(),1;for(h=u+d,t=0;t<h;)if((c=this.DecodeValue(this.distanceTree))<16)m[t++]=c;else if(c===16){var v;if(c=3+this.readBits(2),t+c>h)return this.flushBuffer(),1;for(v=t?m[t-1]:0;c--;)m[t++]=v}else{if(c=c===17?3+this.readBits(3):11+this.readBits(7),t+c>h)return this.flushBuffer(),1;for(;c--;)m[t++]=0}for(p=this.literalTree.length,t=0;t<p;t++)this.literalTree[t]=new o.HufNode;if(this.CreateTree(this.literalTree,u,m,0))return this.flushBuffer(),1;for(p=this.literalTree.length,t=0;t<p;t++)this.distanceTree[t]=new o.HufNode;var _=new Array;for(t=u;t<m.length;t++)_[t-u]=m[t];if(this.CreateTree(this.distanceTree,d,_,0))return this.flushBuffer(),1;for(;;)if((c=this.DecodeValue(this.literalTree))>=256){var p,g;if((c-=256)==0)break;for(c--,p=this.readBits(o.cplext[c])+o.cplens[c],c=this.DecodeValue(this.distanceTree),o.cpdext[c]>8?(g=this.readBits(8),g|=this.readBits(o.cpdext[c]-8)<<8):g=this.readBits(o.cpdext[c]),g+=o.cpdist[c];p--;)a=this.buf32k[this.bIdx-g&32767],this.addBuffer(a)}else this.addBuffer(c)}while(!s);return this.flushBuffer(),this.byteAlign(),0},o.prototype.unzipFile=function(s){var n;for(this.gunzip(),n=0;n<this.unzipped.length;n++)if(this.unzipped[n][1]===s)return this.unzipped[n][0]},o.prototype.nextFile=function(){this.outputArr=[],this.modeZIP=!1;var s=[];if(s[0]=this.readByte(),s[1]=this.readByte(),s[0]===120&&s[1]===218&&(this.DeflateLoop(),this.unzipped[this.files]=[this.outputArr.join(""),"geonext.gxt"],this.files++),s[0]===31&&s[1]===139&&(this.skipdir(),this.unzipped[this.files]=[this.outputArr.join(""),"file"],this.files++),s[0]===80&&s[1]===75&&(this.modeZIP=!0,s[2]=this.readByte(),s[3]=this.readByte(),s[2]===3&&s[3]===4)){s[0]=this.readByte(),s[1]=this.readByte(),this.gpflags=this.readByte(),this.gpflags|=this.readByte()<<8;var n=this.readByte();n|=this.readByte()<<8,this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte()<<8,this.readByte()<<16,this.readByte()<<24,this.readByte(),this.readByte()<<8,this.readByte()<<16,this.readByte()<<24;var t=this.readByte();t|=this.readByte()<<8;var e=this.readByte();for(e|=this.readByte()<<8,a=0,this.nameBuf=[];t--;){var r=this.readByte();r==="/"|r===":"?a=0:a<o.NAMEMAX-1&&(this.nameBuf[a++]=String.fromCharCode(r))}this.fileout||(this.fileout=this.nameBuf);for(var a=0;a<e;)r=this.readByte(),a++;n===8&&(this.DeflateLoop(),this.unzipped[this.files]=[this.outputArr.join(""),this.nameBuf.join("")],this.files++),this.skipdir()}},o.prototype.skipdir=function(){var s,n,t,e,r=[];if(8&this.gpflags&&(r[0]=this.readByte(),r[1]=this.readByte(),r[2]=this.readByte(),r[3]=this.readByte(),s=this.readByte(),s|=this.readByte()<<8,s|=this.readByte()<<16,s|=this.readByte()<<24,n=this.readByte(),n|=this.readByte()<<8,n|=this.readByte()<<16,n|=this.readByte()<<24),this.modeZIP&&this.nextFile(),r[0]=this.readByte(),r[0]!==8)return 0;if(this.gpflags=this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),4&this.gpflags)for(r[0]=this.readByte(),r[2]=this.readByte(),this.len=r[0]+256*r[1],t=0;t<this.len;t++)this.readByte();if(8&this.gpflags)for(t=0,this.nameBuf=[];e=this.readByte();)e!=="7"&&e!==":"||(t=0),t<o.NAMEMAX-1&&(this.nameBuf[t++]=e);if(16&this.gpflags)for(;e=this.readByte(););2&this.gpflags&&(this.readByte(),this.readByte()),this.DeflateLoop(),n=this.readByte(),n|=this.readByte()<<8,n|=this.readByte()<<16,n|=this.readByte()<<24,this.modeZIP&&this.nextFile()},N.exports=o},{}],31:[function(T,N,z){(function(){"use strict";function s(G){throw G}function n(G,H){var K=G.split("."),j=I;!(K[0]in j)&&j.execScript&&j.execScript("var "+K[0]);for(var Q;K.length&&(Q=K.shift());)K.length||H===C?j=j[Q]?j[Q]:j[Q]={}:j[Q]=H}function t(G){if(typeof G=="string"){var H,K,j=G.split("");for(H=0,K=j.length;H<K;H++)j[H]=(255&j[H].charCodeAt(0))>>>0;G=j}for(var Q,J=1,tt=0,st=G.length,lt=0;0<st;){st-=Q=1024<st?1024:st;do tt+=J+=G[lt++];while(--Q);J%=65521,tt%=65521}return(tt<<16|J)>>>0}function e(G,H){this.index=typeof H=="number"?H:0,this.i=0,this.buffer=G instanceof(b?Uint8Array:Array)?G:new(b?Uint8Array:Array)(32768),2*this.buffer.length<=this.index&&s(Error("invalid index")),this.buffer.length<=this.index&&this.f()}function r(G){this.buffer=new(b?Uint16Array:Array)(2*G),this.length=0}function a(G){var H,K,j,Q,J,tt,st,lt,pt,gt=G.length,ft=0,ht=Number.POSITIVE_INFINITY;for(lt=0;lt<gt;++lt)G[lt]>ft&&(ft=G[lt]),G[lt]<ht&&(ht=G[lt]);for(H=1<<ft,K=new(b?Uint32Array:Array)(H),j=1,Q=0,J=2;j<=ft;){for(lt=0;lt<gt;++lt)if(G[lt]===j){for(tt=0,st=Q,pt=0;pt<j;++pt)tt=tt<<1|1&st,st>>=1;for(pt=tt;pt<H;pt+=J)K[pt]=j<<16|lt;++Q}++j,Q<<=1,J<<=1}return[K,ft,ht]}function c(G,H){this.h=L,this.w=0,this.input=G,this.b=0,H&&(H.lazy&&(this.w=H.lazy),typeof H.compressionType=="number"&&(this.h=H.compressionType),H.outputBuffer&&(this.a=b&&H.outputBuffer instanceof Array?new Uint8Array(H.outputBuffer):H.outputBuffer),typeof H.outputIndex=="number"&&(this.b=H.outputIndex)),this.a||(this.a=new(b?Uint8Array:Array)(32768))}function h(G,H){this.length=G,this.G=H}function u(){var G=M;switch(S){case G===3:return[257,G-3,0];case G===4:return[258,G-4,0];case G===5:return[259,G-5,0];case G===6:return[260,G-6,0];case G===7:return[261,G-7,0];case G===8:return[262,G-8,0];case G===9:return[263,G-9,0];case G===10:return[264,G-10,0];case 12>=G:return[265,G-11,1];case 14>=G:return[266,G-13,1];case 16>=G:return[267,G-15,1];case 18>=G:return[268,G-17,1];case 22>=G:return[269,G-19,2];case 26>=G:return[270,G-23,2];case 30>=G:return[271,G-27,2];case 34>=G:return[272,G-31,2];case 42>=G:return[273,G-35,3];case 50>=G:return[274,G-43,3];case 58>=G:return[275,G-51,3];case 66>=G:return[276,G-59,3];case 82>=G:return[277,G-67,4];case 98>=G:return[278,G-83,4];case 114>=G:return[279,G-99,4];case 130>=G:return[280,G-115,4];case 162>=G:return[281,G-131,5];case 194>=G:return[282,G-163,5];case 226>=G:return[283,G-195,5];case 257>=G:return[284,G-227,5];case G===258:return[285,G-258,0];default:s("invalid length: "+G)}}function d(G,H){function K(ae,ce){var Xt,ct=ae.G,Wt=[],At=0;Xt=V[ae.length],Wt[At++]=65535&Xt,Wt[At++]=Xt>>16&255,Wt[At++]=Xt>>24;var mt;switch(S){case ct===1:mt=[0,ct-1,0];break;case ct===2:mt=[1,ct-2,0];break;case ct===3:mt=[2,ct-3,0];break;case ct===4:mt=[3,ct-4,0];break;case 6>=ct:mt=[4,ct-5,1];break;case 8>=ct:mt=[5,ct-7,1];break;case 12>=ct:mt=[6,ct-9,2];break;case 16>=ct:mt=[7,ct-13,2];break;case 24>=ct:mt=[8,ct-17,3];break;case 32>=ct:mt=[9,ct-25,3];break;case 48>=ct:mt=[10,ct-33,4];break;case 64>=ct:mt=[11,ct-49,4];break;case 96>=ct:mt=[12,ct-65,5];break;case 128>=ct:mt=[13,ct-97,5];break;case 192>=ct:mt=[14,ct-129,6];break;case 256>=ct:mt=[15,ct-193,6];break;case 384>=ct:mt=[16,ct-257,7];break;case 512>=ct:mt=[17,ct-385,7];break;case 768>=ct:mt=[18,ct-513,8];break;case 1024>=ct:mt=[19,ct-769,8];break;case 1536>=ct:mt=[20,ct-1025,9];break;case 2048>=ct:mt=[21,ct-1537,9];break;case 3072>=ct:mt=[22,ct-2049,10];break;case 4096>=ct:mt=[23,ct-3073,10];break;case 6144>=ct:mt=[24,ct-4097,11];break;case 8192>=ct:mt=[25,ct-6145,11];break;case 12288>=ct:mt=[26,ct-8193,12];break;case 16384>=ct:mt=[27,ct-12289,12];break;case 24576>=ct:mt=[28,ct-16385,13];break;case 32768>=ct:mt=[29,ct-24577,13];break;default:s("invalid distance")}Xt=mt,Wt[At++]=Xt[0],Wt[At++]=Xt[1],Wt[At++]=Xt[2];var Ft,_e;for(Ft=0,_e=Wt.length;Ft<_e;++Ft)dt[wt++]=Wt[Ft];St[Wt[0]]++,Ct[Wt[3]]++,Et=ae.length+ce-1,gt=null}var j,Q,J,tt,st,lt,pt,gt,ft,ht={},dt=b?new Uint16Array(2*H.length):[],wt=0,Et=0,St=new(b?Uint32Array:Array)(286),Ct=new(b?Uint32Array:Array)(30),Ot=G.w;if(!b){for(J=0;285>=J;)St[J++]=0;for(J=0;29>=J;)Ct[J++]=0}for(St[256]=1,j=0,Q=H.length;j<Q;++j){for(J=st=0,tt=3;J<tt&&j+J!==Q;++J)st=st<<8|H[j+J];if(ht[st]===C&&(ht[st]=[]),lt=ht[st],!(0<Et--)){for(;0<lt.length&&32768<j-lt[0];)lt.shift();if(j+3>=Q){for(gt&&K(gt,-1),J=0,tt=Q-j;J<tt;++J)ft=H[j+J],dt[wt++]=ft,++St[ft];break}if(0<lt.length){var Vt=C,It=C,bt=0,yt=C,Pt=C,Nt=C,Lt=C,Mt=H.length;Pt=0,Lt=lt.length;t:for(;Pt<Lt;Pt++){if(Vt=lt[Lt-Pt-1],yt=3,3<bt){for(Nt=bt;3<Nt;Nt--)if(H[Vt+Nt-1]!==H[j+Nt-1])continue t;yt=bt}for(;258>yt&&j+yt<Mt&&H[Vt+yt]===H[j+yt];)++yt;if(yt>bt&&(It=Vt,bt=yt),yt===258)break}pt=new h(bt,j-It),gt?gt.length<pt.length?(ft=H[j-1],dt[wt++]=ft,++St[ft],K(pt,0)):K(gt,-1):pt.length<Ot?gt=pt:K(pt,0)}else gt?K(gt,-1):(ft=H[j],dt[wt++]=ft,++St[ft])}lt.push(j)}return dt[wt++]=256,St[256]++,G.L=St,G.K=Ct,b?dt.subarray(0,wt):dt}function f(G,H){function K(Lt){var Mt=bt[Lt][yt[Lt]];Mt===St?(K(Lt+1),K(Lt+1)):--Vt[Mt],++yt[Lt]}var j,Q,J,tt,st,lt=G.length,pt=new r(572),gt=new(b?Uint8Array:Array)(lt);if(!b)for(tt=0;tt<lt;tt++)gt[tt]=0;for(tt=0;tt<lt;++tt)0<G[tt]&&pt.push(tt,G[tt]);if(j=Array(pt.length/2),Q=new(b?Uint32Array:Array)(pt.length/2),j.length===1)return gt[pt.pop().index]=1,gt;for(tt=0,st=pt.length/2;tt<st;++tt)j[tt]=pt.pop(),Q[tt]=j[tt].value;var ft,ht,dt,wt,Et,St=Q.length,Ct=new(b?Uint16Array:Array)(H),Ot=new(b?Uint8Array:Array)(H),Vt=new(b?Uint8Array:Array)(St),It=Array(H),bt=Array(H),yt=Array(H),Pt=(1<<H)-St,Nt=1<<H-1;for(Ct[H-1]=St,ht=0;ht<H;++ht)Pt<Nt?Ot[ht]=0:(Ot[ht]=1,Pt-=Nt),Pt<<=1,Ct[H-2-ht]=(Ct[H-1-ht]/2|0)+St;for(Ct[0]=Ot[0],It[0]=Array(Ct[0]),bt[0]=Array(Ct[0]),ht=1;ht<H;++ht)Ct[ht]>2*Ct[ht-1]+Ot[ht]&&(Ct[ht]=2*Ct[ht-1]+Ot[ht]),It[ht]=Array(Ct[ht]),bt[ht]=Array(Ct[ht]);for(ft=0;ft<St;++ft)Vt[ft]=H;for(dt=0;dt<Ct[H-1];++dt)It[H-1][dt]=Q[dt],bt[H-1][dt]=dt;for(ft=0;ft<H;++ft)yt[ft]=0;for(Ot[H-1]===1&&(--Vt[0],++yt[H-1]),ht=H-2;0<=ht;--ht){for(wt=ft=0,Et=yt[ht+1],dt=0;dt<Ct[ht];dt++)(wt=It[ht+1][Et]+It[ht+1][Et+1])>Q[ft]?(It[ht][dt]=wt,bt[ht][dt]=St,Et+=2):(It[ht][dt]=Q[ft],bt[ht][dt]=ft,++ft);yt[ht]=0,Ot[ht]===1&&K(ht)}for(J=Vt,tt=0,st=j.length;tt<st;++tt)gt[j[tt].index]=J[tt];return gt}function m(G){var H,K,j,Q,J=new(b?Uint16Array:Array)(G.length),tt=[],st=[],lt=0;for(H=0,K=G.length;H<K;H++)tt[G[H]]=1+(0|tt[G[H]]);for(H=1,K=16;H<=K;H++)st[H]=lt,(lt+=0|tt[H])>1<<H&&s("overcommitted"),lt<<=1;for(65536>lt&&s("undercommitted"),H=0,K=G.length;H<K;H++)for(lt=st[G[H]],st[G[H]]+=1,j=J[H]=0,Q=G[H];j<Q;j++)J[H]=J[H]<<1|1&lt,lt>>>=1;return J}function v(G,H){this.input=G,this.a=new(b?Uint8Array:Array)(32768),this.h=U.j;var K,j={};!H&&(H={})||typeof H.compressionType!="number"||(this.h=H.compressionType);for(K in H)j[K]=H[K];j.outputBuffer=this.a,this.z=new c(this.input,j)}function _(G,H){switch(this.k=[],this.l=32768,this.e=this.g=this.c=this.q=0,this.input=b?new Uint8Array(G):G,this.s=!1,this.m=X,this.B=!1,!H&&(H={})||(H.index&&(this.c=H.index),H.bufferSize&&(this.l=H.bufferSize),H.bufferType&&(this.m=H.bufferType),H.resize&&(this.B=H.resize)),this.m){case k:this.b=32768,this.a=new(b?Uint8Array:Array)(32768+this.l+258);break;case X:this.b=0,this.a=new(b?Uint8Array:Array)(this.l),this.f=this.J,this.t=this.H,this.o=this.I;break;default:s(Error("invalid inflate mode"))}}function p(G,H){for(var K,j=G.g,Q=G.e,J=G.input,tt=G.c;Q<H;)(K=J[tt++])===C&&s(Error("input buffer is broken")),j|=K<<Q,Q+=8;return K=j&(1<<H)-1,G.g=j>>>H,G.e=Q-H,G.c=tt,K}function g(G,H){for(var K,j,Q,J=G.g,tt=G.e,st=G.input,lt=G.c,pt=H[0],gt=H[1];tt<gt;)(K=st[lt++])===C&&s(Error("input buffer is broken")),J|=K<<tt,tt+=8;return j=pt[J&(1<<gt)-1],Q=j>>>16,G.g=J>>Q,G.e=tt-Q,G.c=lt,65535&j}function y(G,H){var K,j;switch(this.input=G,this.c=0,!H&&(H={})||(H.index&&(this.c=H.index),H.verify&&(this.M=H.verify)),K=G[this.c++],j=G[this.c++],15&K){case le:this.method=le;break;default:s(Error("unsupported compression method"))}((K<<8)+j)%31!=0&&s(Error("invalid fcheck flag:"+((K<<8)+j)%31)),32&j&&s(Error("fdict flag is not supported")),this.A=new _(G,{index:this.c,bufferSize:H.bufferSize,bufferType:H.bufferType,resize:H.resize})}var C=void 0,S=!0,I=this,b=typeof Uint8Array!="undefined"&&typeof Uint16Array!="undefined"&&typeof Uint32Array!="undefined";e.prototype.f=function(){var G,H=this.buffer,K=H.length,j=new(b?Uint8Array:Array)(K<<1);if(b)j.set(H);else for(G=0;G<K;++G)j[G]=H[G];return this.buffer=j},e.prototype.d=function(G,H,K){var j,Q=this.buffer,J=this.index,tt=this.i,st=Q[J];if(K&&1<H&&(G=8<H?(x[255&G]<<24|x[G>>>8&255]<<16|x[G>>>16&255]<<8|x[G>>>24&255])>>32-H:x[G]>>8-H),8>H+tt)st=st<<H|G,tt+=H;else for(j=0;j<H;++j)st=st<<1|G>>H-j-1&1,++tt==8&&(tt=0,Q[J++]=x[st],st=0,J===Q.length&&(Q=this.f()));Q[J]=st,this.buffer=Q,this.i=tt,this.index=J},e.prototype.finish=function(){var G,H=this.buffer,K=this.index;return 0<this.i&&(H[K]<<=8-this.i,H[K]=x[H[K]],K++),b?G=H.subarray(0,K):(H.length=K,G=H),G};var A,E=new(b?Uint8Array:Array)(256);for(A=0;256>A;++A){for(var R=P=A,O=7,P=P>>>1;P;P>>>=1)R<<=1,R|=1&P,--O;E[A]=(R<<O&255)>>>0}var x=E;b&&new Uint32Array([0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117]),r.prototype.getParent=function(G){return 2*((G-2)/4|0)},r.prototype.push=function(G,H){var K,j,Q,J=this.buffer;for(K=this.length,J[this.length++]=H,J[this.length++]=G;0<K&&(j=this.getParent(K),J[K]>J[j]);)Q=J[K],J[K]=J[j],J[j]=Q,Q=J[K+1],J[K+1]=J[j+1],J[j+1]=Q,K=j;return this.length},r.prototype.pop=function(){var G,H,K,j,Q,J=this.buffer;for(H=J[0],G=J[1],this.length-=2,J[0]=J[this.length],J[1]=J[this.length+1],Q=0;!((j=2*Q+2)>=this.length)&&(j+2<this.length&&J[j+2]>J[j]&&(j+=2),J[j]>J[Q]);)K=J[Q],J[Q]=J[j],J[j]=K,K=J[Q+1],J[Q+1]=J[j+1],J[j+1]=K,Q=j;return{index:G,value:H,length:this.length}};var w,L=2,D={NONE:0,r:1,j:L,N:3},F=[];for(w=0;288>w;w++)switch(S){case 143>=w:F.push([w+48,8]);break;case 255>=w:F.push([w-144+400,9]);break;case 279>=w:F.push([w-256+0,7]);break;case 287>=w:F.push([w-280+192,8]);break;default:s("invalid literal: "+w)}c.prototype.n=function(){var G,H,K,j,Q=this.input;switch(this.h){case 0:for(K=0,j=Q.length;K<j;){var J=H=b?Q.subarray(K,K+65535):Q.slice(K,K+65535),tt=(K+=H.length)===j,st=C,lt=C,pt=C,gt=C,ft=C,ht=this.a,dt=this.b;if(b){for(ht=new Uint8Array(this.a.buffer);ht.length<=dt+J.length+5;)ht=new Uint8Array(ht.length<<1);ht.set(this.a)}if(st=tt?1:0,ht[dt++]=0|st,lt=J.length,pt=65536+~lt&65535,ht[dt++]=255&lt,ht[dt++]=lt>>>8&255,ht[dt++]=255&pt,ht[dt++]=pt>>>8&255,b)ht.set(J,dt),dt+=J.length,ht=ht.subarray(0,dt);else{for(gt=0,ft=J.length;gt<ft;++gt)ht[dt++]=J[gt];ht.length=dt}this.b=dt,this.a=ht}break;case 1:var wt=new e(new Uint8Array(this.a.buffer),this.b);wt.d(1,1,S),wt.d(1,2,S);var Et,St,Ct,Ot=d(this,Q);for(Et=0,St=Ot.length;Et<St;Et++)if(Ct=Ot[Et],e.prototype.d.apply(wt,F[Ct]),256<Ct)wt.d(Ot[++Et],Ot[++Et],S),wt.d(Ot[++Et],5),wt.d(Ot[++Et],Ot[++Et],S);else if(Ct===256)break;this.a=wt.finish(),this.b=this.a.length;break;case L:var Vt,It,bt,yt,Pt,Nt,Lt,Mt,ae,ce,Xt,ct,Wt,At,mt,Ft=new e(new Uint8Array(this.a),this.b),_e=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],pe=Array(19);for(Vt=L,Ft.d(1,1,S),Ft.d(Vt,2,S),It=d(this,Q),Lt=m(Nt=f(this.L,15)),ae=m(Mt=f(this.K,7)),bt=286;257<bt&&Nt[bt-1]===0;bt--);for(yt=30;1<yt&&Mt[yt-1]===0;yt--);var xt,ee,Dt,ue,Gt,Ht,me=bt,ve=yt,$t=new(b?Uint32Array:Array)(me+ve),jt=new(b?Uint32Array:Array)(316),ie=new(b?Uint8Array:Array)(19);for(xt=ee=0;xt<me;xt++)$t[ee++]=Nt[xt];for(xt=0;xt<ve;xt++)$t[ee++]=Mt[xt];if(!b)for(xt=0,ue=ie.length;xt<ue;++xt)ie[xt]=0;for(xt=Gt=0,ue=$t.length;xt<ue;xt+=ee){for(ee=1;xt+ee<ue&&$t[xt+ee]===$t[xt];++ee);if(Dt=ee,$t[xt]===0)if(3>Dt)for(;0<Dt--;)jt[Gt++]=0,ie[0]++;else for(;0<Dt;)(Ht=138>Dt?Dt:138)>Dt-3&&Ht<Dt&&(Ht=Dt-3),10>=Ht?(jt[Gt++]=17,jt[Gt++]=Ht-3,ie[17]++):(jt[Gt++]=18,jt[Gt++]=Ht-11,ie[18]++),Dt-=Ht;else if(jt[Gt++]=$t[xt],ie[$t[xt]]++,3>--Dt)for(;0<Dt--;)jt[Gt++]=$t[xt],ie[$t[xt]]++;else for(;0<Dt;)(Ht=6>Dt?Dt:6)>Dt-3&&Ht<Dt&&(Ht=Dt-3),jt[Gt++]=16,jt[Gt++]=Ht-3,ie[16]++,Dt-=Ht}for(G=b?jt.subarray(0,Gt):jt.slice(0,Gt),ce=f(ie,7),At=0;19>At;At++)pe[At]=ce[_e[At]];for(Pt=19;4<Pt&&pe[Pt-1]===0;Pt--);for(Xt=m(ce),Ft.d(bt-257,5,S),Ft.d(yt-1,5,S),Ft.d(Pt-4,4,S),At=0;At<Pt;At++)Ft.d(pe[At],3,S);for(At=0,mt=G.length;At<mt;At++)if(ct=G[At],Ft.d(Xt[ct],ce[ct],S),16<=ct){switch(At++,ct){case 16:Wt=2;break;case 17:Wt=3;break;case 18:Wt=7;break;default:s("invalid code: "+ct)}Ft.d(G[At],Wt,S)}var ne,ye,de,ge,Ce,Te,xe,Ee,Se=[Lt,Nt],be=[ae,Mt];for(Ce=Se[0],Te=Se[1],xe=be[0],Ee=be[1],ne=0,ye=It.length;ne<ye;++ne)if(de=It[ne],Ft.d(Ce[de],Te[de],S),256<de)Ft.d(It[++ne],It[++ne],S),ge=It[++ne],Ft.d(xe[ge],Ee[ge],S),Ft.d(It[++ne],It[++ne],S);else if(de===256)break;this.a=Ft.finish(),this.b=this.a.length;break;default:s("invalid compression type")}return this.a};var M,B,W=[];for(M=3;258>=M;M++)B=u(),W[M]=B[2]<<24|B[1]<<16|B[0];var V=b?new Uint32Array(W):W,U=D;v.prototype.n=function(){var G,H,K,j,Q,J,tt,st=0;switch(tt=this.a,G=le){case le:H=Math.LOG2E*Math.log(32768)-8;break;default:s(Error("invalid compression method"))}switch(K=H<<4|G,tt[st++]=K,G){case le:switch(this.h){case U.NONE:Q=0;break;case U.r:Q=1;break;case U.j:Q=2;break;default:s(Error("unsupported compression type"))}break;default:s(Error("invalid compression method"))}return j=Q<<6|0,tt[st++]=j|31-(256*K+j)%31,J=t(this.input),this.z.b=st,tt=this.z.n(),st=tt.length,b&&((tt=new Uint8Array(tt.buffer)).length<=st+4&&(this.a=new Uint8Array(tt.length+4),this.a.set(tt),tt=this.a),tt=tt.subarray(0,st+4)),tt[st++]=J>>24&255,tt[st++]=J>>16&255,tt[st++]=J>>8&255,tt[st++]=255&J,tt},n("Zlib.Deflate",v),n("Zlib.Deflate.compress",function(G,H){return new v(G,H).n()}),n("Zlib.Deflate.CompressionType",U),n("Zlib.Deflate.CompressionType.NONE",U.NONE),n("Zlib.Deflate.CompressionType.FIXED",U.r),n("Zlib.Deflate.CompressionType.DYNAMIC",U.j);var k=0,X=1,Y={D:k,C:X};_.prototype.p=function(){for(;!this.s;){var G=p(this,3);switch(1&G&&(this.s=S),G>>>=1){case 0:var H=this.input,K=this.c,j=this.a,Q=this.b,J=C,tt=C,st=C,lt=j.length,pt=C;switch(this.e=this.g=0,(J=H[K++])===C&&s(Error("invalid uncompressed block header: LEN (first byte)")),tt=J,(J=H[K++])===C&&s(Error("invalid uncompressed block header: LEN (second byte)")),tt|=J<<8,(J=H[K++])===C&&s(Error("invalid uncompressed block header: NLEN (first byte)")),st=J,(J=H[K++])===C&&s(Error("invalid uncompressed block header: NLEN (second byte)")),st|=J<<8,tt===~st&&s(Error("invalid uncompressed block header: length verify")),K+tt>H.length&&s(Error("input buffer is broken")),this.m){case k:for(;Q+tt>j.length;){if(pt=lt-Q,tt-=pt,b)j.set(H.subarray(K,K+pt),Q),Q+=pt,K+=pt;else for(;pt--;)j[Q++]=H[K++];this.b=Q,j=this.f(),Q=this.b}break;case X:for(;Q+tt>j.length;)j=this.f({v:2});break;default:s(Error("invalid inflate mode"))}if(b)j.set(H.subarray(K,K+tt),Q),Q+=tt,K+=tt;else for(;tt--;)j[Q++]=H[K++];this.c=K,this.b=Q,this.a=j;break;case 1:this.o(Zt,re);break;case 2:(function(gt){function ft(It,bt,yt){var Pt,Nt,Lt,Mt;for(Mt=0;Mt<It;)switch(Pt=g(this,bt)){case 16:for(Lt=3+p(this,2);Lt--;)yt[Mt++]=Nt;break;case 17:for(Lt=3+p(this,3);Lt--;)yt[Mt++]=0;Nt=0;break;case 18:for(Lt=11+p(this,7);Lt--;)yt[Mt++]=0;Nt=0;break;default:Nt=yt[Mt++]=Pt}return yt}var ht,dt,wt,Et,St=p(gt,5)+257,Ct=p(gt,5)+1,Ot=p(gt,4)+4,Vt=new(b?Uint8Array:Array)(nt.length);for(Et=0;Et<Ot;++Et)Vt[nt[Et]]=p(gt,3);ht=a(Vt),dt=new(b?Uint8Array:Array)(St),wt=new(b?Uint8Array:Array)(Ct),gt.o(a(ft.call(gt,St,ht,dt)),a(ft.call(gt,Ct,ht,wt)))})(this);break;default:s(Error("unknown BTYPE: "+G))}}return this.t()};var Z,et,$=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],nt=b?new Uint16Array($):$,at=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258],rt=b?new Uint16Array(at):at,it=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0],ot=b?new Uint8Array(it):it,_t=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],ut=b?new Uint16Array(_t):_t,vt=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],Tt=b?new Uint8Array(vt):vt,Rt=new(b?Uint8Array:Array)(288);for(Z=0,et=Rt.length;Z<et;++Z)Rt[Z]=143>=Z?8:255>=Z?9:279>=Z?7:8;var zt,qt,Zt=a(Rt),Kt=new(b?Uint8Array:Array)(30);for(zt=0,qt=Kt.length;zt<qt;++zt)Kt[zt]=5;var re=a(Kt);_.prototype.o=function(G,H){var K=this.a,j=this.b;this.u=G;for(var Q,J,tt,st,lt=K.length-258;(Q=g(this,G))!==256;)if(256>Q)j>=lt&&(this.b=j,K=this.f(),j=this.b),K[j++]=Q;else for(st=rt[J=Q-257],0<ot[J]&&(st+=p(this,ot[J])),Q=g(this,H),tt=ut[Q],0<Tt[Q]&&(tt+=p(this,Tt[Q])),j>=lt&&(this.b=j,K=this.f(),j=this.b);st--;)K[j]=K[j++-tt];for(;8<=this.e;)this.e-=8,this.c--;this.b=j},_.prototype.I=function(G,H){var K=this.a,j=this.b;this.u=G;for(var Q,J,tt,st,lt=K.length;(Q=g(this,G))!==256;)if(256>Q)j>=lt&&(K=this.f(),lt=K.length),K[j++]=Q;else for(st=rt[J=Q-257],0<ot[J]&&(st+=p(this,ot[J])),Q=g(this,H),tt=ut[Q],0<Tt[Q]&&(tt+=p(this,Tt[Q])),j+st>lt&&(K=this.f(),lt=K.length);st--;)K[j]=K[j++-tt];for(;8<=this.e;)this.e-=8,this.c--;this.b=j},_.prototype.f=function(){var G,H,K=new(b?Uint8Array:Array)(this.b-32768),j=this.b-32768,Q=this.a;if(b)K.set(Q.subarray(32768,K.length));else for(G=0,H=K.length;G<H;++G)K[G]=Q[G+32768];if(this.k.push(K),this.q+=K.length,b)Q.set(Q.subarray(j,j+32768));else for(G=0;32768>G;++G)Q[G]=Q[j+G];return this.b=32768,Q},_.prototype.J=function(G){var H,K,j,Q,J=this.input.length/this.c+1|0,tt=this.input,st=this.a;return G&&(typeof G.v=="number"&&(J=G.v),typeof G.F=="number"&&(J+=G.F)),2>J?(K=(tt.length-this.c)/this.u[2],Q=K/2*258|0,j=Q<st.length?st.length+Q:st.length<<1):j=st.length*J,b?(H=new Uint8Array(j)).set(st):H=st,this.a=H},_.prototype.t=function(){var G,H,K,j,Q,J=0,tt=this.a,st=this.k,lt=new(b?Uint8Array:Array)(this.q+(this.b-32768));if(st.length===0)return b?this.a.subarray(32768,this.b):this.a.slice(32768,this.b);for(H=0,K=st.length;H<K;++H)for(j=0,Q=(G=st[H]).length;j<Q;++j)lt[J++]=G[j];for(H=32768,K=this.b;H<K;++H)lt[J++]=tt[H];return this.k=[],this.buffer=lt},_.prototype.H=function(){var G,H=this.b;return b?this.B?(G=new Uint8Array(H)).set(this.a.subarray(0,H)):G=this.a.subarray(0,H):(this.a.length>H&&(this.a.length=H),G=this.a),this.buffer=G},y.prototype.p=function(){var G,H=this.input;return G=this.A.p(),this.c=this.A.c,this.M&&(H[this.c++]<<24|H[this.c++]<<16|H[this.c++]<<8|H[this.c++])>>>0!==t(G)&&s(Error("invalid adler-32 checksum")),G},n("Zlib.Inflate",y),n("Zlib.Inflate.BufferType",Y),Y.ADAPTIVE=Y.C,Y.BLOCK=Y.D,n("Zlib.Inflate.prototype.decompress",y.prototype.p),b&&new Uint16Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),b&&new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258]),b&&new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0]),b&&new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577]),b&&new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]);var te,oe,Qt=new(b?Uint8Array:Array)(288);for(te=0,oe=Qt.length;te<oe;++te)Qt[te]=143>=te?8:255>=te?9:279>=te?7:8;a(Qt);var Jt,he,fe=new(b?Uint8Array:Array)(30);for(Jt=0,he=fe.length;Jt<he;++Jt)fe[Jt]=5;a(fe);var le=8}).call(window);var o=window.Zlib;o.Deflate=o.Deflate,o.Deflate.compress=o.Deflate.compress,o.Inflate=o.Inflate,o.Inflate.BufferType=o.Inflate.BufferType,o.Inflate.prototype.decompress=o.Inflate.prototype.decompress,N.exports=o},{}],32:[function(T,N,z){cc.configuration={ERROR:0,STRING:1,INT:2,DOUBLE:3,BOOLEAN:4,_maxTextureSize:0,_maxModelviewStackDepth:0,_supportsPVRTC:!1,_supportsNPOT:!1,_supportsBGRA8888:!1,_supportsDiscardFramebuffer:!1,_supportsShareableVAO:!1,_maxSamplesAllowed:0,_maxTextureUnits:0,_GlExtensions:"",_valueDict:{},_inited:!1,_init:function(){var o=this._valueDict;o["cocos2d.x.version"]=cc.ENGINE_VERSION,o["cocos2d.x.compiled_with_profiler"]=!1,o["cocos2d.x.compiled_with_gl_state_cache"]=cc.macro.ENABLE_GL_STATE_CACHE,this._inited=!0},getMaxTextureSize:function(){return this._maxTextureSize},getMaxModelviewStackDepth:function(){return this._maxModelviewStackDepth},getMaxTextureUnits:function(){return this._maxTextureUnits},supportsNPOT:function(){return this._supportsNPOT},supportsPVRTC:function(){return this._supportsPVRTC},supportsETC:function(){return!1},supportsS3TC:function(){return!1},supportsATITC:function(){return!1},supportsBGRA8888:function(){return this._supportsBGRA8888},supportsDiscardFramebuffer:function(){return this._supportsDiscardFramebuffer},supportsShareableVAO:function(){return this._supportsShareableVAO},checkForGLExtension:function(o){return this._GlExtensions.indexOf(o)>-1},getValue:function(o,s){this._inited||this._init();var n=this._valueDict;return n[o]?n[o]:s},setValue:function(o,s){this._valueDict[o]=s},gatherGPUInfo:function(){if(cc._renderType!==cc.game.RENDER_TYPE_CANVAS){this._inited||this._init();var o=cc._renderContext,s=this._valueDict;s["gl.vendor"]=o.getParameter(o.VENDOR),s["gl.renderer"]=o.getParameter(o.RENDERER),s["gl.version"]=o.getParameter(o.VERSION),this._GlExtensions="";for(var n=o.getSupportedExtensions(),t=0;t<n.length;t++)this._GlExtensions+=n[t]+" ";this._maxTextureSize=o.getParameter(o.MAX_TEXTURE_SIZE),s["gl.max_texture_size"]=this._maxTextureSize,this._maxTextureUnits=o.getParameter(o.MAX_COMBINED_TEXTURE_IMAGE_UNITS),s["gl.max_texture_units"]=this._maxTextureUnits,this._supportsPVRTC=this.checkForGLExtension("GL_IMG_texture_compression_pvrtc"),s["gl.supports_PVRTC"]=this._supportsPVRTC,this._supportsNPOT=!0,s["gl.supports_NPOT"]=this._supportsNPOT,this._supportsBGRA8888=this.checkForGLExtension("GL_IMG_texture_format_BGRA888"),s["gl.supports_BGRA8888"]=this._supportsBGRA8888,this._supportsDiscardFramebuffer=this.checkForGLExtension("GL_EXT_discard_framebuffer"),s["gl.supports_discard_framebuffer"]=this._supportsDiscardFramebuffer,this._supportsShareableVAO=this.checkForGLExtension("vertex_array_object"),s["gl.supports_vertex_array_object"]=this._supportsShareableVAO,cc.checkGLErrorDebug()}},loadConfigFile:function(o){this._inited||this._init();var s=cc.loader.getRes(o);if(!s)throw new Error("Please load the resource first : "+o);cc.assertID(s,1101,o);var n=s.data;if(n)for(var t in n)this._valueDict[t]=n[t];else cc.logID(1100,o)}}},{}],33:[function(T,N,z){var o=T("./event/event-target"),s=T("./platform/_CCClass"),n=T("./load-pipeline/auto-release-utils"),t=T("./component-scheduler"),e=T("./node-activator"),r=T("./event/event-listeners"),a=T("./event-manager");cc.g_NumberOfDraws=0,cc.Director=s.extend({ctor:function(){var c=this;o.call(c),c._landscape=!1,c._nextDeltaTimeZero=!1,c._paused=!1,c._purgeDirectorInNextLoop=!1,c._sendCleanupToScene=!1,c._animationInterval=0,c._oldAnimationInterval=0,c._projection=0,c._projectionDelegate=null,c._contentScaleFactor=1,c._winSizeInPoints=null,c._openGLView=null,c._scenesStack=null,c._nextScene=null,c._loadingScene="",c._runningScene=null,c._scene=null,c._totalFrames=0,c._lastUpdate=Date.now(),c._deltaTime=0,c._dirtyRegion=null,c._scheduler=null,c._compScheduler=null,c._nodeActivator=null,c._actionManager=null,cc.game.on(cc.game.EVENT_SHOW,function(){c._lastUpdate=Date.now()})},init:function(){return this._oldAnimationInterval=this._animationInterval=1/cc.defaultFPS,this._scenesStack=[],this._projection=cc.Director.PROJECTION_DEFAULT,this._projectionDelegate=null,this._totalFrames=0,this._lastUpdate=Date.now(),this._paused=!1,this._purgeDirectorInNextLoop=!1,this._winSizeInPoints=cc.size(0,0),this._openGLView=null,this._contentScaleFactor=1,this._scheduler=new cc.Scheduler,cc.ActionManager?(this._actionManager=new cc.ActionManager,this._scheduler.scheduleUpdate(this._actionManager,cc.Scheduler.PRIORITY_SYSTEM,!1)):this._actionManager=null,this.sharedInit(),!0},sharedInit:function(){this._compScheduler=new t,this._nodeActivator=new e,cc.AnimationManager?(this._animationManager=new cc.AnimationManager,this._scheduler.scheduleUpdate(this._animationManager,cc.Scheduler.PRIORITY_SYSTEM,!1)):this._animationManager=null,cc.CollisionManager?(this._collisionManager=new cc.CollisionManager,this._scheduler.scheduleUpdate(this._collisionManager,cc.Scheduler.PRIORITY_SYSTEM,!1)):this._collisionManager=null,cc.PhysicsManager?(this._physicsManager=new cc.PhysicsManager,this._scheduler.scheduleUpdate(this._physicsManager,cc.Scheduler.PRIORITY_SYSTEM,!1)):this._physicsManager=null,cc._widgetManager&&cc._widgetManager.init(this),cc.loader.init(this)},calculateDeltaTime:function(){var c=Date.now();this._nextDeltaTimeZero?(this._deltaTime=0,this._nextDeltaTimeZero=!1):(this._deltaTime=(c-this._lastUpdate)/1e3,cc.game.config[cc.game.CONFIG_KEY.debugMode]>0&&this._deltaTime>1&&(this._deltaTime=1/60)),this._lastUpdate=c},convertToGL:function(c){var h=cc.game.container,u=cc.view,d=h.getBoundingClientRect(),f=d.left+window.pageXOffset-h.clientLeft,m=d.top+window.pageYOffset-h.clientTop,v=u._devicePixelRatio*(c.x-f),_=u._devicePixelRatio*(m+d.height-c.y);return u._isRotated?{x:u._viewPortRect.width-_,y:v}:{x:v,y:_}},convertToUI:function(c){var h=cc.game.container,u=cc.view,d=h.getBoundingClientRect(),f=d.left+window.pageXOffset-h.clientLeft,m=d.top+window.pageYOffset-h.clientTop,v={x:0,y:0};return u._isRotated?(v.x=f+c.y/u._devicePixelRatio,v.y=m+d.height-(u._viewPortRect.width-c.x)/u._devicePixelRatio):(v.x=f+c.x*u._devicePixelRatio,v.y=m+d.height-c.y*u._devicePixelRatio),v},_visitScene:function(){if(this._runningScene){var c=cc.renderer;c.childrenOrderDirty?(c.clearRenderCommands(),cc.renderer.assignedZ=0,this._runningScene._renderCmd._curLevel=0,this._runningScene.visit(),c.resetFlag()):c.transformDirty()&&c.transform()}},end:function(){this._purgeDirectorInNextLoop=!0},getContentScaleFactor:function(){return this._contentScaleFactor},getWinSize:function(){return cc.size(this._winSizeInPoints)},getWinSizeInPixels:function(){return cc.size(this._winSizeInPoints.width*this._contentScaleFactor,this._winSizeInPoints.height*this._contentScaleFactor)},getVisibleSize:null,getVisibleOrigin:null,getZEye:null,pause:function(){this._paused||(this._oldAnimationInterval=this._animationInterval,this.setAnimationInterval(.25),this._paused=!0)},popScene:function(){cc.assertID(this._runningScene,1204),this._scenesStack.pop();var c=this._scenesStack.length;c===0?this.end():(this._sendCleanupToScene=!0,this._nextScene=this._scenesStack[c-1])},purgeCachedData:function(){cc.textureCache._clear(),cc.loader.releaseAll()},purgeDirector:function(){this.getScheduler().unscheduleAll(),this._compScheduler.unscheduleAll(),this._nodeActivator.reset(),a&&a.setEnabled(!1),this._runningScene&&(this._runningScene.performRecursive(_ccsg.Node.performType.onExitTransitionDidStart),this._runningScene.performRecursive(_ccsg.Node.performType.onExit),this._runningScene.performRecursive(_ccsg.Node.performType.cleanup),cc.renderer.clearRenderCommands()),this._runningScene=null,this._nextScene=null,this._scenesStack.length=0,this.stopAnimation(),this.purgeCachedData()},reset:function(){this.purgeDirector(),a&&a.setEnabled(!0),this._actionManager&&this._scheduler.scheduleUpdate(this._actionManager,cc.Scheduler.PRIORITY_SYSTEM,!1),this._animationManager&&this._scheduler.scheduleUpdate(this._animationManager,cc.Scheduler.PRIORITY_SYSTEM,!1),this._collisionManager&&this._scheduler.scheduleUpdate(this._collisionManager,cc.Scheduler.PRIORITY_SYSTEM,!1),this._physicsManager&&this._scheduler.scheduleUpdate(this._physicsManager,cc.Scheduler.PRIORITY_SYSTEM,!1),this.startAnimation()},pushScene:function(c){cc.assertID(c,1205),this._sendCleanupToScene=!1,this._scenesStack.push(c),this._nextScene=c},runSceneImmediate:function(c,h,u){c instanceof cc.Scene&&c._load();for(var d=cc.game,f=Object.keys(d._persistRootNodes).map(function(A){return d._persistRootNodes[A]}),m=0;m<f.length;m++){var v=f[m];d._ignoreRemovePersistNode=v,v.parent=null,d._ignoreRemovePersistNode=null}var _=this._scene,p=_&&_.autoReleaseAssets&&_.dependAssets;n.autoRelease(p,c.dependAssets,f),cc.isValid(_)&&_.destroy(),this._scene=null,cc.Object._deferredDestroy(),h&&h(),this.emit(cc.Director.EVENT_BEFORE_SCENE_LAUNCH,c);var g=c;if(c instanceof cc.Scene){this._scene=c,g=c._sgNode;for(var y=0;y<f.length;y++){var C=f[y],S=c.getChildByUuid(C.uuid);if(S){var I=S.getSiblingIndex();S._destroyImmediate(),c.insertChild(C,I)}else C.parent=c}c._activate()}if(this._runningScene){var b=this._scenesStack.length;this._scenesStack[Math.max(b-1,0)]=g,this._sendCleanupToScene=!0,this._nextScene=g}else this.pushScene(g),this.startAnimation();this._nextScene&&this.setNextScene(),u&&u(null,c),this.emit(cc.Director.EVENT_AFTER_SCENE_LAUNCH,c)},runScene:function(c,h,u){cc.assertID(c,1205),c instanceof cc.Scene&&c._load(),this.once(cc.Director.EVENT_AFTER_UPDATE,function(){this.runSceneImmediate(c,h,u)})},_getSceneUuid:function(c){var h=cc.game._sceneInfos;if(typeof c=="string"){c.endsWith(".fire")||(c+=".fire"),c[0]==="/"||c.startsWith("db://assets/")||(c="/"+c);for(var u=0;u<h.length;u++){var d=h[u];if(d.url.endsWith(c))return d}}else if(typeof c=="number"){if(0<=c&&c<h.length)return h[c];cc.errorID(1206,c)}else cc.errorID(1207,c);return null},loadScene:function(c,h,u){if(this._loadingScene)return cc.errorID(1208,c,this._loadingScene),!1;var d=this._getSceneUuid(c);if(d){var f=d.uuid;return this.emit(cc.Director.EVENT_BEFORE_SCENE_LOADING,c),this._loadingScene=c,this._loadSceneByUuid(f,h,u),!0}return cc.errorID(1209,c),!1},preloadScene:function(c,h){var u=this._getSceneUuid(c);if(u)this.emit(cc.Director.EVENT_BEFORE_SCENE_LOADING,c),cc.loader.load({uuid:u.uuid,type:"uuid"},function(f,m){f&&cc.errorID(1210,c,f.message),h&&h(f,m)});else{var d='Can not preload the scene "'+c+'" because it is not in the build settings.';h(new Error(d)),cc.error("preloadScene: "+d)}},_loadSceneByUuid:function(c,h,u,d){console.time("LoadScene "+c),cc.AssetLibrary.loadAsset(c,function(f,m){console.timeEnd("LoadScene "+c);var v=cc.director;if(v._loadingScene="",f)f="Failed to load scene: "+f,cc.error(f);else{if(m instanceof cc.SceneAsset){var _=m.scene;return _._id=m._uuid,_._name=m._name,void v.runSceneImmediate(_,u,h)}f="The asset "+c+" is not a scene",cc.error(f)}h&&h(f)})},resume:function(){this._paused&&(this.setAnimationInterval(this._oldAnimationInterval),this._lastUpdate=Date.now(),this._lastUpdate||cc.logID(1200),this._paused=!1,this._deltaTime=0)},setContentScaleFactor:function(c){c!==this._contentScaleFactor&&(this._contentScaleFactor=c)},setDepthTest:null,setClearColor:null,setDefaultValues:function(){},setNextDeltaTimeZero:function(c){this._nextDeltaTimeZero=c},setNextScene:function(){var c=!1,h=!1;if(cc.TransitionScene&&(c=!!this._runningScene&&this._runningScene instanceof cc.TransitionScene,h=!!this._nextScene&&this._nextScene instanceof cc.TransitionScene),!h){var u=this._runningScene;u&&(u.performRecursive(_ccsg.Node.performType.onExitTransitionDidStart),u.performRecursive(_ccsg.Node.performType.onExit)),this._sendCleanupToScene&&u&&u.performRecursive(_ccsg.Node.performType.cleanup)}this._runningScene=this._nextScene,cc.renderer.childrenOrderDirty=!0,this._nextScene=null,c||this._runningScene===null||(this._runningScene.performRecursive(_ccsg.Node.performType.onEnter),this._runningScene.performRecursive(_ccsg.Node.performType.onEnterTransitionDidFinish))},getDelegate:function(){return this._projectionDelegate},setDelegate:function(c){this._projectionDelegate=c},setOpenGLView:null,setProjection:null,setViewport:null,getOpenGLView:null,getProjection:null,setAlphaBlending:null,isSendCleanupToScene:function(){return this._sendCleanupToScene},getRunningScene:function(){return this._runningScene},getScene:function(){return this._scene},getAnimationInterval:function(){return this._animationInterval},isDisplayStats:function(){return!!cc.profiler&&cc.profiler.isShowingStats()},setDisplayStats:function(c){cc.profiler&&(c?cc.profiler.showStats():cc.profiler.hideStats(),cc.game.config[cc.game.CONFIG_KEY.showFPS]=!!c)},isNextDeltaTimeZero:function(){return this._nextDeltaTimeZero},isPaused:function(){return this._paused},getTotalFrames:function(){return this._totalFrames},popToRootScene:function(){this.popToSceneStackLevel(1)},popToSceneStackLevel:function(c){cc.assertID(this._runningScene,1203);var h=this._scenesStack,u=h.length;if(u!==0){if(!(c>u)){for(;u>c;){var d=h.pop();d.running&&(d.performRecursive(_ccsg.Node.performType.onExitTransitionDidStart),d.performRecursive(_ccsg.Node.performType.onExit)),d.performRecursive(_ccsg.Node.performType.cleanup),u--}this._nextScene=h[h.length-1],this._sendCleanupToScene=!0}}else this.end()},getScheduler:function(){return this._scheduler},setScheduler:function(c){this._scheduler!==c&&(this._scheduler=c)},getActionManager:function(){return this._actionManager},setActionManager:function(c){this._actionManager!==c&&(this._actionManager&&this._scheduler.unscheduleUpdate(this._actionManager),this._actionManager=c,this._scheduler.scheduleUpdate(this._actionManager,cc.Scheduler.PRIORITY_SYSTEM,!1))},getAnimationManager:function(){return this._animationManager},getCollisionManager:function(){return this._collisionManager},getPhysicsManager:function(){return this._physicsManager},getDeltaTime:function(){return this._deltaTime}}),cc.js.addon(cc.Director.prototype,o.prototype),cc.Director.EVENT_PROJECTION_CHANGED="director_projection_changed",cc.Director.EVENT_BEFORE_SCENE_LOADING="director_before_scene_loading",cc.Director.EVENT_BEFORE_SCENE_LAUNCH="director_before_scene_launch",cc.Director.EVENT_AFTER_SCENE_LAUNCH="director_after_scene_launch",cc.Director.EVENT_BEFORE_UPDATE="director_before_update",cc.Director.EVENT_AFTER_UPDATE="director_after_update",cc.Director.EVENT_BEFORE_VISIT="director_before_visit",cc.Director.EVENT_AFTER_VISIT="director_after_visit",cc.Director.EVENT_AFTER_DRAW="director_after_draw",cc.DisplayLinkDirector=cc.Director.extend({invalid:!1,startAnimation:function(){this._nextDeltaTimeZero=!0,this.invalid=!1},mainLoop:function(){if(this._purgeDirectorInNextLoop)this._purgeDirectorInNextLoop=!1,this.purgeDirector();else if(!this.invalid){if(this.calculateDeltaTime(),cc.sys.skipRender)return this._paused||(this._compScheduler.updatePhase(this._deltaTime),cc.Object._deferredDestroy()),this._nextScene&&this.setNextScene(),cc.g_NumberOfDraws=0,this._totalFrames++,void this.emit(cc.Director.EVENT_AFTER_DRAW);this._paused||(this.emit(cc.Director.EVENT_BEFORE_UPDATE),this._compScheduler.startPhase(),this._compScheduler.updatePhase(this._deltaTime),this._scheduler.update(this._deltaTime),this._compScheduler.lateUpdatePhase(this._deltaTime),this.emit(cc.Director.EVENT_AFTER_UPDATE),cc.Object._deferredDestroy()),this._nextScene&&this.setNextScene(),this.emit(cc.Director.EVENT_BEFORE_VISIT),this._visitScene(),this.emit(cc.Director.EVENT_AFTER_VISIT),cc.g_NumberOfDraws=0,cc.renderer.clear(),cc.renderer.rendering(cc._renderContext),this._totalFrames++,this.emit(cc.Director.EVENT_AFTER_DRAW),a.frameUpdateListeners()}},stopAnimation:function(){this.invalid=!0},setAnimationInterval:function(c){this._animationInterval=c,this.invalid||(this.stopAnimation(),this.startAnimation())},__fastOn:function(c,h,u){var d=this._bubblingListeners;d||(d=this._bubblingListeners=new r),d.add(c,h,u),this._addEventFlag(c,d,!1)},__fastOff:function(c,h,u){var d=this._bubblingListeners;d&&(d.remove(c,h,u),this._purgeEventFlag(c,d,!1))}}),cc.Director.sharedDirector=null,cc.Director.firstUseDirector=!0,cc.Director._getInstance=function(){return cc.Director.firstUseDirector&&(cc.Director.firstUseDirector=!1,cc.Director.sharedDirector=new cc.DisplayLinkDirector,cc.Director.sharedDirector.init()),cc.Director.sharedDirector},cc.defaultFPS=60,cc.Director.PROJECTION_2D=0,cc.Director.PROJECTION_3D=1,cc.Director.PROJECTION_CUSTOM=3,cc.Director.PROJECTION_DEFAULT=cc.Director.PROJECTION_2D},{"./component-scheduler":60,"./event-manager":95,"./event/event-listeners":96,"./event/event-target":97,"./load-pipeline/auto-release-utils":119,"./node-activator":132,"./platform/_CCClass":147}],34:[function(T,N,z){T("./CCDirector"),T("./CCGame");var o=T("./event-manager");cc.game.once(cc.game.EVENT_RENDERER_INITED,function(){if(cc._renderType===cc.game.RENDER_TYPE_CANVAS){var s=cc.Director.prototype;s.getProjection=function(n){return this._projection},s.setProjection=function(n){this._projection=n,this.emit(cc.Director.EVENT_PROJECTION_CHANGED,this)},s.setDepthTest=function(){},s.setClearColor=function(n){cc.renderer._clearColor=n,cc.renderer._clearFillStyle="rgb("+n.r+","+n.g+","+n.b+")"},s.setOpenGLView=function(n){this._winSizeInPoints.width=cc._canvas.width,this._winSizeInPoints.height=cc._canvas.height,this._openGLView=n||cc.view,o&&o.setEnabled(!0)},s.getVisibleSize=function(){return this.getWinSize()},s.getVisibleOrigin=function(){return cc.p(0,0)}}})},{"./CCDirector":33,"./CCGame":39,"./event-manager":95}],35:[function(T,N,z){T("./CCDirector"),T("./CCGame"),T("../kazmath");var o=T("./event-manager"),s=cc.math;cc.game.once(cc.game.EVENT_RENDERER_INITED,function(){if(cc._renderType===cc.game.RENDER_TYPE_WEBGL){cc.DirectorDelegate=cc._Class.extend({updateProjection:function(){}});var n=cc.Director.prototype,t=function(e){if(e&&e._renderCmd){e._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty);var r,a=e._children;for(r=0;r<a.length;r++)t(a[r])}};cc.Director._getInstance().on(cc.Director.EVENT_PROJECTION_CHANGED,function(){for(var e=cc.director._scenesStack,r=0;r<e.length;r++)t(e[r])}),n.setProjection=function(e){var r=this._winSizeInPoints;this.setViewport();var a=this._openGLView,c=a._viewPortRect.x/a._scaleX,h=a._viewPortRect.y/a._scaleY;switch(e){case cc.Director.PROJECTION_2D:s.glMatrixMode(s.KM_GL_PROJECTION),s.glLoadIdentity();var u=s.Matrix4.createOrthographicProjection(0,r.width,0,r.height,-1024,1024);s.glMultMatrix(u),s.glMatrixMode(s.KM_GL_MODELVIEW),s.glLoadIdentity();break;case cc.Director.PROJECTION_3D:var d=this.getZEye(),f=new s.Matrix4,m=new s.Matrix4;s.glMatrixMode(s.KM_GL_PROJECTION),s.glLoadIdentity(),f=s.Matrix4.createPerspectiveProjection(60,r.width/r.height,.1,2*d),s.glMultMatrix(f);var v=new s.Vec3(-c+r.width/2,-h+r.height/2,d),_=new s.Vec3(-c+r.width/2,-h+r.height/2,0),p=new s.Vec3(0,1,0);m.lookAt(v,_,p),s.glMultMatrix(m),s.glMatrixMode(s.KM_GL_MODELVIEW),s.glLoadIdentity();break;case cc.Director.PROJECTION_CUSTOM:this._projectionDelegate&&this._projectionDelegate.updateProjection();break;default:cc.logID(1201)}this._projection=e,this.emit(cc.Director.EVENT_PROJECTION_CHANGED,this),cc.gl.setProjectionMatrixDirty(),cc.renderer.childrenOrderDirty=!0},n.setDepthTest=function(e){cc.renderer.setDepthTest(e)},n.setClearColor=function(e){var r=cc.renderer._clearColor;r.r=e.r/255,r.g=e.g/255,r.b=e.b/255,r.a=e.a/255},n.setOpenGLView=function(e){this._winSizeInPoints.width=cc._canvas.width,this._winSizeInPoints.height=cc._canvas.height,this._openGLView=e||cc.view,cc.configuration.gatherGPUInfo(),this.setGLDefaultValues(),o&&o.setEnabled(!0)},n.getVisibleSize=function(){return this._openGLView.getVisibleSize()},n.getVisibleOrigin=function(){return this._openGLView.getVisibleOrigin()},n.getZEye=function(){return this._winSizeInPoints.height/1.1566},n.setViewport=function(){var e=this._openGLView;if(e){var r=this._winSizeInPoints;e.setViewPortInPoints(-e._viewPortRect.x/e._scaleX,-e._viewPortRect.y/e._scaleY,r.width,r.height)}},n.getOpenGLView=function(){return this._openGLView},n.getProjection=function(){return this._projection},n.setAlphaBlending=function(e){e?cc.gl.blendFunc(cc.macro.BLEND_SRC,cc.macro.BLEND_DST):cc.gl.blendFunc(cc.macro.ONE,cc.macro.ZERO)},n.setGLDefaultValues=function(){this.setAlphaBlending(!0),this.setProjection(this._projection),cc._renderContext.clearColor(0,0,0,0)}}})},{"../kazmath":204,"./CCDirector":33,"./CCGame":39,"./event-manager":95}],36:[function(T,N,z){var o=T("./CCGame");cc._drawingUtil=null,o.once(o.EVENT_RENDERER_INITED,function(){cc._renderType===o.RENDER_TYPE_WEBGL?cc._drawingUtil=new(T("./CCDrawingPrimitivesWebGL"))(cc._renderContext):cc._drawingUtil=new(T("./CCDrawingPrimitivesCanvas"))(cc._renderContext)})},{"./CCDrawingPrimitivesCanvas":37,"./CCDrawingPrimitivesWebGL":38,"./CCGame":39}],37:[function(T,N,z){var o=cc._Class.extend({_cacheArray:[],ctor:function(s){this._renderContext=s},drawPoint:function(s,n){n||(n=1);var t=cc.view.getScaleX(),e=cc.view.getScaleY(),r=cc.p(s.x*t,s.y*e),a=this._renderContext.getContext();a.beginPath(),a.arc(r.x,-r.y,n*t,0,2*Math.PI,!1),a.closePath(),a.fill()},drawPoints:function(s,n,t){if(s!=null){t||(t=1);var e=this._renderContext.getContext(),r=cc.view.getScaleX(),a=cc.view.getScaleY();e.beginPath();for(var c=0,h=s.length;c<h;c++)e.arc(s[c].x*r,-s[c].y*a,t*r,0,2*Math.PI,!1);e.closePath(),e.fill()}},drawLine:function(s,n){var t=this._renderContext.getContext(),e=cc.view.getScaleX(),r=cc.view.getScaleY();t.beginPath(),t.moveTo(s.x*e,-s.y*r),t.lineTo(n.x*e,-n.y*r),t.closePath(),t.stroke()},drawRect:function(s,n){this.drawLine(cc.p(s.x,s.y),cc.p(n.x,s.y)),this.drawLine(cc.p(n.x,s.y),cc.p(n.x,n.y)),this.drawLine(cc.p(n.x,n.y),cc.p(s.x,n.y)),this.drawLine(cc.p(s.x,n.y),cc.p(s.x,s.y))},drawSolidRect:function(s,n,t){var e=[s,cc.p(n.x,s.y),n,cc.p(s.x,n.y)];this.drawSolidPoly(e,4,t)},drawPoly:function(s,n,t,e){if(e=e||!1,s!=null){if(s.length<3)throw new Error("Polygon's point must greater than 2");var r=s[0],a=this._renderContext.getContext(),c=cc.view.getScaleX(),h=cc.view.getScaleY();a.beginPath(),a.moveTo(r.x*c,-r.y*h);for(var u=1,d=s.length;u<d;u++)a.lineTo(s[u].x*c,-s[u].y*h);t&&a.closePath(),e?a.fill():a.stroke()}},drawSolidPoly:function(s,n,t){this.setDrawColor(t.r,t.g,t.b,t.a),this.drawPoly(s,n,!0,!0)},drawCircle:function(s,n,t,e,r){r=r||!1;var a=this._renderContext.getContext(),c=cc.view.getScaleX(),h=cc.view.getScaleY();a.beginPath();var u=t-2*Math.PI;a.arc(0|s.x*c,0|-s.y*h,n*c,-t,-u,!1),r&&a.lineTo(0|s.x*c,0|-s.y*h),a.stroke()},drawQuadBezier:function(s,n,t,e){var r=this._cacheArray;r.length=0;for(var a=0,c=0;c<e;c++){var h=Math.pow(1-a,2)*s.x+2*(1-a)*a*n.x+a*a*t.x,u=Math.pow(1-a,2)*s.y+2*(1-a)*a*n.y+a*a*t.y;r.push(cc.p(h,u)),a+=1/e}r.push(cc.p(t.x,t.y)),this.drawPoly(r,e+1,!1,!1)},drawCubicBezier:function(s,n,t,e,r){var a=this._cacheArray;a.length=0;for(var c=0,h=0;h<r;h++){var u=Math.pow(1-c,3)*s.x+3*Math.pow(1-c,2)*c*n.x+3*(1-c)*c*c*t.x+c*c*c*e.x,d=Math.pow(1-c,3)*s.y+3*Math.pow(1-c,2)*c*n.y+3*(1-c)*c*c*t.y+c*c*c*e.y;a.push(cc.p(u,d)),c+=1/r}a.push(cc.p(e.x,e.y)),this.drawPoly(a,r+1,!1,!1)},drawCatmullRom:function(s,n){this.drawCardinalSpline(s,.5,n)},drawCardinalSpline:function(s,n,t){cc._renderContext.setStrokeStyle("rgba(255,255,255,1)");var e=this._cacheArray;e.length=0;for(var r,a,c=1/s.length,h=0;h<t+1;h++){var u=h/t;u===1?(r=s.length-1,a=1):a=(u-c*(r=0|u/c))/c;var d=cc.cardinalSplineAt(cc.getControlPointAt(s,r-1),cc.getControlPointAt(s,r-0),cc.getControlPointAt(s,r+1),cc.getControlPointAt(s,r+2),n,a);e.push(d)}this.drawPoly(e,t+1,!1,!1)},drawImage:function(s,n,t,e,r){var a=arguments.length,c=this._renderContext.getContext();switch(a){case 2:var h=s.height;c.drawImage(s,n.x,-(n.y+h));break;case 3:c.drawImage(s,n.x,-(n.y+t.height),t.width,t.height);break;case 5:c.drawImage(s,n.x,n.y,t.width,t.height,e.x,-(e.y+r.height),r.width,r.height);break;default:throw new Error("Argument must be non-nil")}},drawStar:function(s,n,t){var e=s||this._renderContext,r=e.getContext();n*=cc.view.getScaleX();var a="rgba("+(0|t.r)+","+(0|t.g)+","+(0|t.b);e.setFillStyle(a+",1)");var c=n/10;r.beginPath(),r.moveTo(-n,n),r.lineTo(0,c),r.lineTo(n,n),r.lineTo(c,0),r.lineTo(n,-n),r.lineTo(0,-c),r.lineTo(-n,-n),r.lineTo(-c,0),r.lineTo(-n,n),r.closePath(),r.fill();var h=r.createRadialGradient(0,0,c,0,0,n);h.addColorStop(0,a+", 1)"),h.addColorStop(.3,a+", 0.8)"),h.addColorStop(1,a+", 0.0)"),e.setFillStyle(h),r.beginPath();var u=cc.macro.PI2;r.arc(0,0,n-c,0,u,!1),r.closePath(),r.fill()},drawColorBall:function(s,n,t){var e=s||this._renderContext,r=e.getContext();n*=cc.view.getScaleX();var a="rgba("+(0|t.r)+","+(0|t.g)+","+(0|t.b),c=n/10,h=r.createRadialGradient(0,0,c,0,0,n);h.addColorStop(0,a+", 1)"),h.addColorStop(.3,a+", 0.8)"),h.addColorStop(.6,a+", 0.4)"),h.addColorStop(1,a+", 0.0)"),e.setFillStyle(h),r.beginPath();var u=cc.macro.PI2;r.arc(0,0,n,0,u,!1),r.closePath(),r.fill()},fillText:function(s,n,t){this._renderContext.getContext().fillText(s,n,-t)},setDrawColor:function(s,n,t,e){this._renderContext.setFillStyle("rgba("+s+","+n+","+t+","+e/255+")"),this._renderContext.setStrokeStyle("rgba("+s+","+n+","+t+","+e/255+")")},setPointSize:function(s){},setLineWidth:function(s){this._renderContext.getContext().lineWidth=s*cc.view.getScaleX()}});N.exports=o},{}],38:[function(T,N,z){var o=cc.macro,s=cc._Class.extend({_initialized:!1,_shader:null,_colorLocation:"u_color",_pointSizeLocation:"u_pointSize",_pointSize:-1,ctor:function(n){if(!(n instanceof WebGLRenderingContext))throw new Error("Can't initialise DrawingPrimitiveWebGL. context need is WebGLRenderingContext");this._renderContext=n,this._colorArray=new Float32Array([1,1,1,1])},lazy_init:function(){this._initialized||(this._shader=cc.shaderCache.programForKey(o.SHADER_POSITION_UCOLOR),this._shader._addUniformLocation(this._colorLocation),this._shader._addUniformLocation(this._pointSizeLocation),this._initialized=!0)},drawInit:function(){this._initialized=!1},drawPoint:function(n){this.lazy_init();var t=this._renderContext;this._shader.use(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),t.enableVertexAttribArray(o.VERTEX_ATTRIB_POSITION),this._shader.setUniformLocationWith4fv(this._colorLocation,this._colorArray),this._shader.setUniformLocationWith1f(this._pointSizeLocation,this._pointSize);var e=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,e),t.bufferData(t.ARRAY_BUFFER,new Float32Array([n.x,n.y]),t.STATIC_DRAW),t.vertexAttribPointer(o.VERTEX_ATTRIB_POSITION,2,t.FLOAT,!1,0,0),t.drawArrays(t.POINTS,0,1),t.deleteBuffer(e),cc.incrementGLDraws(1)},drawPoints:function(n,t){if(n&&n.length!==0){this.lazy_init();var e=this._renderContext;this._shader.use(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),e.enableVertexAttribArray(o.VERTEX_ATTRIB_POSITION),this._shader.setUniformLocationWith4fv(this._colorLocation,this._colorArray),this._shader.setUniformLocationWith1f(this._pointSizeLocation,this._pointSize);var r=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,r),e.bufferData(e.ARRAY_BUFFER,this._pointsToTypeArray(n),e.STATIC_DRAW),e.vertexAttribPointer(o.VERTEX_ATTRIB_POSITION,2,e.FLOAT,!1,0,0),e.drawArrays(e.POINTS,0,n.length),e.deleteBuffer(r),cc.incrementGLDraws(1)}},_pointsToTypeArray:function(n){for(var t=new Float32Array(2*n.length),e=0;e<n.length;e++)t[2*e]=n[e].x,t[2*e+1]=n[e].y;return t},drawLine:function(n,t){this.lazy_init();var e=this._renderContext;this._shader.use(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),e.enableVertexAttribArray(o.VERTEX_ATTRIB_POSITION),this._shader.setUniformLocationWith4fv(this._colorLocation,this._colorArray);var r=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,r),e.bufferData(e.ARRAY_BUFFER,this._pointsToTypeArray([n,t]),e.STATIC_DRAW),e.vertexAttribPointer(o.VERTEX_ATTRIB_POSITION,2,e.FLOAT,!1,0,0),e.drawArrays(e.LINES,0,2),e.deleteBuffer(r),cc.incrementGLDraws(1)},drawRect:function(n,t){this.drawLine(cc.p(n.x,n.y),cc.p(t.x,n.y)),this.drawLine(cc.p(t.x,n.y),cc.p(t.x,t.y)),this.drawLine(cc.p(t.x,t.y),cc.p(n.x,t.y)),this.drawLine(cc.p(n.x,t.y),cc.p(n.x,n.y))},drawSolidRect:function(n,t,e){var r=[n,cc.p(t.x,n.y),t,cc.p(n.x,t.y)];this.drawSolidPoly(r,4,e)},drawPoly:function(n,t,e){this.lazy_init();var r=this._renderContext;this._shader.use(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),r.enableVertexAttribArray(o.VERTEX_ATTRIB_POSITION),this._shader.setUniformLocationWith4fv(this._colorLocation,this._colorArray);var a=r.createBuffer();r.bindBuffer(r.ARRAY_BUFFER,a),r.bufferData(r.ARRAY_BUFFER,this._pointsToTypeArray(n),r.STATIC_DRAW),r.vertexAttribPointer(o.VERTEX_ATTRIB_POSITION,2,r.FLOAT,!1,0,0),e?r.drawArrays(r.LINE_LOOP,0,n.length):r.drawArrays(r.LINE_STRIP,0,n.length),r.deleteBuffer(a),cc.incrementGLDraws(1)},drawSolidPoly:function(n,t,e){this.lazy_init(),e&&this.setDrawColor(e.r,e.g,e.b,e.a);var r=this._renderContext;this._shader.use(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),r.enableVertexAttribArray(o.VERTEX_ATTRIB_POSITION),this._shader.setUniformLocationWith4fv(this._colorLocation,this._colorArray);var a=r.createBuffer();r.bindBuffer(r.ARRAY_BUFFER,a),r.bufferData(r.ARRAY_BUFFER,this._pointsToTypeArray(n),r.STATIC_DRAW),r.vertexAttribPointer(o.VERTEX_ATTRIB_POSITION,2,r.FLOAT,!1,0,0),r.drawArrays(r.TRIANGLE_FAN,0,n.length),r.deleteBuffer(a),cc.incrementGLDraws(1)},drawCircle:function(n,t,e,r,a){this.lazy_init();var c=1;a&&c++;var h=2*Math.PI/r,u=new Float32Array(2*(r+2));if(u){for(var d=0;d<=r;d++){var f=d*h,m=t*Math.cos(f+e)+n.x,v=t*Math.sin(f+e)+n.y;u[2*d]=m,u[2*d+1]=v}u[2*(r+1)]=n.x,u[2*(r+1)+1]=n.y;var _=this._renderContext;this._shader.use(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),_.enableVertexAttribArray(o.VERTEX_ATTRIB_POSITION),this._shader.setUniformLocationWith4fv(this._colorLocation,this._colorArray);var p=_.createBuffer();_.bindBuffer(_.ARRAY_BUFFER,p),_.bufferData(_.ARRAY_BUFFER,u,_.STATIC_DRAW),_.vertexAttribPointer(o.VERTEX_ATTRIB_POSITION,2,_.FLOAT,!1,0,0),_.drawArrays(_.LINE_STRIP,0,r+c),_.deleteBuffer(p),cc.incrementGLDraws(1)}},drawQuadBezier:function(n,t,e,r){this.lazy_init();for(var a=new Float32Array(2*(r+1)),c=0,h=0;h<r;h++)a[2*h]=Math.pow(1-c,2)*n.x+2*(1-c)*c*t.x+c*c*e.x,a[2*h+1]=Math.pow(1-c,2)*n.y+2*(1-c)*c*t.y+c*c*e.y,c+=1/r;a[2*r]=e.x,a[2*r+1]=e.y;var u=this._renderContext;this._shader.use(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),u.enableVertexAttribArray(o.VERTEX_ATTRIB_POSITION),this._shader.setUniformLocationWith4fv(this._colorLocation,this._colorArray);var d=u.createBuffer();u.bindBuffer(u.ARRAY_BUFFER,d),u.bufferData(u.ARRAY_BUFFER,a,u.STATIC_DRAW),u.vertexAttribPointer(o.VERTEX_ATTRIB_POSITION,2,u.FLOAT,!1,0,0),u.drawArrays(u.LINE_STRIP,0,r+1),u.deleteBuffer(d),cc.incrementGLDraws(1)},drawCubicBezier:function(n,t,e,r,a){this.lazy_init();for(var c=new Float32Array(2*(a+1)),h=0,u=0;u<a;u++)c[2*u]=Math.pow(1-h,3)*n.x+3*Math.pow(1-h,2)*h*t.x+3*(1-h)*h*h*e.x+h*h*h*r.x,c[2*u+1]=Math.pow(1-h,3)*n.y+3*Math.pow(1-h,2)*h*t.y+3*(1-h)*h*h*e.y+h*h*h*r.y,h+=1/a;c[2*a]=r.x,c[2*a+1]=r.y;var d=this._renderContext;this._shader.use(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),d.enableVertexAttribArray(o.VERTEX_ATTRIB_POSITION),this._shader.setUniformLocationWith4fv(this._colorLocation,this._colorArray);var f=d.createBuffer();d.bindBuffer(d.ARRAY_BUFFER,f),d.bufferData(d.ARRAY_BUFFER,c,d.STATIC_DRAW),d.vertexAttribPointer(o.VERTEX_ATTRIB_POSITION,2,d.FLOAT,!1,0,0),d.drawArrays(d.LINE_STRIP,0,a+1),d.deleteBuffer(f),cc.incrementGLDraws(1)},drawCatmullRom:function(n,t){this.drawCardinalSpline(n,.5,t)},drawCardinalSpline:function(n,t,e){this.lazy_init();for(var r,a,c=new Float32Array(2*(e+1)),h=1/n.length,u=0;u<e+1;u++){var d=u/e;d===1?(r=n.length-1,a=1):a=(d-h*(r=0|d/h))/h;var f=cc.cardinalSplineAt(cc.getControlPointAt(n,r-1),cc.getControlPointAt(n,r),cc.getControlPointAt(n,r+1),cc.getControlPointAt(n,r+2),t,a);c[2*u]=f.x,c[2*u+1]=f.y}var m=this._renderContext;this._shader.use(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),m.enableVertexAttribArray(o.VERTEX_ATTRIB_POSITION),this._shader.setUniformLocationWith4fv(this._colorLocation,this._colorArray);var v=m.createBuffer();m.bindBuffer(m.ARRAY_BUFFER,v),m.bufferData(m.ARRAY_BUFFER,c,m.STATIC_DRAW),m.vertexAttribPointer(o.VERTEX_ATTRIB_POSITION,2,m.FLOAT,!1,0,0),m.drawArrays(m.LINE_STRIP,0,e+1),m.deleteBuffer(v),cc.incrementGLDraws(1)},setDrawColor:function(n,t,e,r){this._colorArray[0]=n/255,this._colorArray[1]=t/255,this._colorArray[2]=e/255,this._colorArray[3]=r/255},setPointSize:function(n){this._pointSize=n},setLineWidth:function(n){this._renderContext.lineWidth&&this._renderContext.lineWidth(n)}});N.exports=s},{}],39:[function(T,N,z){var o,s=T("./event/event-target");o=T("./platform/CCView"),T("../audio/CCAudioEngine");var n=T("./platform/CCInputManager"),t={EVENT_HIDE:"game_on_hide",EVENT_SHOW:"game_on_show",EVENT_GAME_INITED:"game_inited",EVENT_RENDERER_INITED:"renderer_inited",RENDER_TYPE_CANVAS:0,RENDER_TYPE_WEBGL:1,RENDER_TYPE_OPENGL:2,_persistRootNodes:{},_ignoreRemovePersistNode:null,CONFIG_KEY:{width:"width",height:"height",debugMode:"debugMode",exposeClassName:"exposeClassName",showFPS:"showFPS",frameRate:"frameRate",id:"id",renderMode:"renderMode",registerSystemEvent:"registerSystemEvent",jsList:"jsList",scenes:"scenes"},_paused:!0,_configLoaded:!1,_isCloning:!1,_prepareCalled:!1,_prepared:!1,_rendererInitialized:!1,_renderContext:null,_intervalId:null,_lastTime:null,_frameTime:null,_sceneInfos:[],frame:null,container:null,canvas:null,config:null,onStart:null,setFrameRate:function(e){this.config[this.CONFIG_KEY.frameRate]=e,this._intervalId&&window.cancelAnimFrame(this._intervalId),this._intervalId=0,this._paused=!0,this._setAnimFrame(),this._runMainLoop()},step:function(){cc.director.mainLoop()},pause:function(){this._paused||(this._paused=!0,cc.audioEngine&&cc.audioEngine._break(),this._intervalId&&window.cancelAnimFrame(this._intervalId),this._intervalId=0)},resume:function(){this._paused&&(this._paused=!1,cc.audioEngine&&cc.audioEngine._restore(),this._runMainLoop())},isPaused:function(){return this._paused},restart:function(){cc.director.once(cc.Director.EVENT_AFTER_DRAW,function(){for(var e in t._persistRootNodes)t.removePersistRootNode(t._persistRootNodes[e]);cc.director.getScene().destroy(),cc.Object._deferredDestroy(),cc.director.purgeDirector(),cc.audioEngine&&cc.audioEngine.uncacheAll(),cc.director.reset(),t.onStart()})},end:function(){close()},prepare:function(e){var r=this,a=r.config,c=r.CONFIG_KEY;if(this._configLoaded){if(this._prepared)e&&e();else if(!this._prepareCalled)if(cc._engineLoaded){this._prepareCalled=!0,this._initRenderer(a[c.width],a[c.height]),cc.view=o?o._getInstance():null,cc.director=cc.Director._getInstance(),cc.director.setOpenGLView&&cc.director.setOpenGLView(cc.view),cc.winSize=cc.director.getWinSize(),this._initEvents(),this._setAnimFrame(),this._runMainLoop();var h=a[c.jsList];h&&h.length>0?cc.loader.load(h,function(u){if(u)throw new Error(JSON.stringify(u));r._prepared=!0,e&&e(),r.emit(r.EVENT_GAME_INITED)}):(e&&e(),r.emit(r.EVENT_GAME_INITED))}else cc.initEngine(this.config,function(){r.prepare(e)})}else this._loadConfig(function(){r.prepare(e)})},run:function(e,r){typeof e=="function"?t.onStart=e:(e&&(t.config=e),typeof r=="function"&&(t.onStart=r)),this.prepare(t.onStart&&t.onStart.bind(t))},addPersistRootNode:function(e){if(cc.Node.isNode(e)&&e.uuid){var r=e.uuid;if(!this._persistRootNodes[r]){var a=cc.director._scene;if(cc.isValid(a)){if(e.parent){if(!(e.parent instanceof cc.Scene))return void cc.warnID(3801);if(e.parent!==a)return void cc.warnID(3802)}else e.parent=a;this._persistRootNodes[r]=e,e._persistNode=!0}}}else cc.warnID(3800)},removePersistRootNode:function(e){if(e!==this._ignoreRemovePersistNode){var r=e.uuid||"";e===this._persistRootNodes[r]&&(delete this._persistRootNodes[r],e._persistNode=!1)}},isPersistRootNode:function(e){return e._persistNode},_setAnimFrame:function(){this._lastTime=new Date;var e=t.config[t.CONFIG_KEY.frameRate];this._frameTime=1e3/e,e!==60&&e!==30?(window.requestAnimFrame=this._stTime,window.cancelAnimFrame=this._ctTime):(window.requestAnimFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||this._stTime,window.cancelAnimFrame=window.cancelAnimationFrame||window.cancelRequestAnimationFrame||window.msCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.webkitCancelRequestAnimationFrame||window.msCancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.oCancelAnimationFrame||this._ctTime)},_stTime:function(e){var r=new Date().getTime(),a=Math.max(0,t._frameTime-(r-t._lastTime)),c=window.setTimeout(function(){e()},a);return t._lastTime=r+a,c},_ctTime:function(e){window.clearTimeout(e)},_runMainLoop:function(){var e,r=this,a=r.config,c=r.CONFIG_KEY,h=cc.director,u=!0,d=a[c.frameRate];h.setDisplayStats(a[c.showFPS]),e=function(){if(!r._paused){if(r._intervalId=window.requestAnimFrame(e),d===30&&(u=!u))return;h.mainLoop()}},r._intervalId=window.requestAnimFrame(e),r._paused=!1},_loadConfig:function(e){if(this.config)return this._initConfig(this.config),void(e&&e());if(document.ccConfig)return this._initConfig(document.ccConfig),void(e&&e());var r=this;cc.loader.load("project.json",function(a,c){a&&cc.logID(3818),r._initConfig(c||{}),e&&e()})},_initConfig:function(e){var r=this.CONFIG_KEY;typeof e[r.debugMode]!="number"&&(e[r.debugMode]=0),e[r.exposeClassName]=!!e[r.exposeClassName],typeof e[r.frameRate]!="number"&&(e[r.frameRate]=60),typeof e[r.renderMode]!="number"&&(e[r.renderMode]=0),typeof e[r.registerSystemEvent]!="boolean"&&(e[r.registerSystemEvent]=!0),e[r.showFPS]=!(r.showFPS in e)||!!e[r.showFPS],this._sceneInfos=e[r.scenes]||[],this.collisionMatrix=e.collisionMatrix||[],this.groupList=e.groupList||[],cc._initDebugSetting(e[r.debugMode]),this.config=e,this._configLoaded=!0},_initRenderer:function(e,r){if(!this._rendererInitialized){if(!cc._supportRender)throw new Error("The renderer doesn't support the renderMode "+this.config[this.CONFIG_KEY.renderMode]);var a,c,h=this.config[t.CONFIG_KEY.id],u=window,d=cc.sys.platform===cc.sys.WECHAT_GAME,f=cc.sys.platform===cc.sys.QQ_PLAY;if(d)this.container=cc.container=c=document.createElement("DIV"),this.frame=c.parentNode===document.body?document.documentElement:c.parentNode,a=cc.sys.browserType===cc.sys.BROWSER_TYPE_WECHAT_GAME_SUB?wx.getSharedCanvas():canvas,this.canvas=cc._canvas=a;else if(f)this.container=cc.container=document.createElement("DIV"),this.frame=document.documentElement,this.canvas=cc._canvas=a=canvas;else{var m=h instanceof HTMLElement?h:document.querySelector(h)||document.querySelector("#"+h);m.tagName==="CANVAS"?(e=e||m.width,r=r||m.height,this.canvas=cc._canvas=a=m,this.container=cc.container=c=document.createElement("DIV"),a.parentNode&&a.parentNode.insertBefore(c,a)):(m.tagName!=="DIV"&&cc.warnID(3819),e=e||m.clientWidth,r=r||m.clientHeight,this.canvas=cc._canvas=a=document.createElement("CANVAS"),this.container=cc.container=c=document.createElement("DIV"),m.appendChild(c)),c.setAttribute("id","Cocos2dGameContainer"),c.appendChild(a),this.frame=c.parentNode===document.body?document.documentElement:c.parentNode,function(_,p){(" "+_.className+" ").indexOf(" "+p+" ")>-1||(_.className&&(_.className+=" "),_.className+=p)}(a,"gameCanvas"),window.CMPlayScreen&&(c.style.backgroundColor="rgba(0, 0, 0, 255)",c.style.width=window.CMPlayScreen.containerWidth+"px",c.style.height=window.CMPlayScreen.containerHeight+"px",e=window.CMPlayScreen.canvasWidth,r=window.CMPlayScreen.canvasHeight,a.style="width:"+e+"px; height:"+r+"px;"),a.setAttribute("width",e||480),a.setAttribute("height",r||320),a.setAttribute("tabindex",99)}if(cc._renderType===t.RENDER_TYPE_WEBGL){var v={stencil:!0,antialias:cc.macro.ENABLE_WEBGL_ANTIALIAS,alpha:cc.macro.ENABLE_TRANSPARENT_CANVAS};d&&(v.preserveDrawingBuffer=!0),this._renderContext=cc._renderContext=cc.webglContext=cc.create3DContext(a,v)}this._renderContext?(cc.renderer=cc.rendererWebGL,u.gl=this._renderContext,cc.renderer.init()):(cc._renderType=t.RENDER_TYPE_CANVAS,cc.renderer=cc.rendererCanvas,cc.renderer.init(),this._renderContext=cc._renderContext=new cc.CanvasContextWrapper(a.getContext("2d"))),cc._gameDiv=c,t.canvas.oncontextmenu=function(){if(!cc._isContextMenuEnable)return!1},this.emit(this.EVENT_RENDERER_INITED,!0),this._rendererInitialized=!0}},_initEvents:function(){function e(){h||(h=!0,t.emit(t.EVENT_HIDE,t))}function r(){h&&(h=!1,t.emit(t.EVENT_SHOW,t))}var a,c=window;this.config[this.CONFIG_KEY.registerSystemEvent]&&n.registerSystemEvent(this.canvas),document.hidden!==void 0?a="hidden":document.mozHidden!==void 0?a="mozHidden":document.msHidden!==void 0?a="msHidden":document.webkitHidden!==void 0&&(a="webkitHidden");var h=!1;if(a)for(var u=["visibilitychange","mozvisibilitychange","msvisibilitychange","webkitvisibilitychange","qbrowserVisibilityChange"],d=0;d<u.length;d++)document.addEventListener(u[d],function(f){var m=document[a];(m=m||f.hidden)?e():r()},!1);else c.addEventListener("blur",e,!1),c.addEventListener("focus",r,!1);navigator.userAgent.indexOf("MicroMessenger")>-1&&(c.onfocus=r),"onpageshow"in window&&"onpagehide"in window&&(c.addEventListener("pagehide",e,!1),c.addEventListener("pageshow",r,!1)),this.on(t.EVENT_HIDE,function(){t.pause()}),this.on(t.EVENT_SHOW,function(){t.resume()})}};s.call(t),cc.js.addon(t,s.prototype),cc.game=N.exports=t},{"../audio/CCAudioEngine":23,"./event/event-target":97,"./platform/BKInputManager":133,"./platform/CCInputManager":139,"./platform/CCView":145}],40:[function(T,N,z){"use strict";function o(x){var w=cc.Mask;if(w){for(var L=0,D=x;D&&cc.Node.isNode(D);D=D._parent,++L)if(D.getComponent(w))return{index:L,node:D}}return null}var s=T("./utils/prefab-helper"),n=T("./utils/scene-graph-helper"),t=T("./event-manager"),e=cc.Object.Flags,r=e.Destroying,a="position-changed",c="size-changed",h="anchor-changed",u="rotation-changed",d="scale-changed",f=T("./utils/misc"),m=(T("./event/event"),!!cc.ActionManager),v=function(){},_=cc.Enum({TOUCH_START:"touchstart",TOUCH_MOVE:"touchmove",TOUCH_END:"touchend",TOUCH_CANCEL:"touchcancel",MOUSE_DOWN:"mousedown",MOUSE_MOVE:"mousemove",MOUSE_ENTER:"mouseenter",MOUSE_LEAVE:"mouseleave",MOUSE_UP:"mouseup",MOUSE_WHEEL:"mousewheel"}),p=[_.TOUCH_START,_.TOUCH_MOVE,_.TOUCH_END,_.TOUCH_CANCEL],g=[_.MOUSE_DOWN,_.MOUSE_ENTER,_.MOUSE_MOVE,_.MOUSE_LEAVE,_.MOUSE_UP,_.MOUSE_WHEEL],y=null,C=function(x,w){var L=x.getLocation(),D=this.owner;return!!D._hitTest(L,this)&&(w.type=_.TOUCH_START,w.touch=x,w.bubbles=!0,D.dispatchEvent(w),!0)},S=function(x,w){var L=this.owner;w.type=_.TOUCH_MOVE,w.touch=x,w.bubbles=!0,L.dispatchEvent(w)},I=function(x,w){var L=x.getLocation(),D=this.owner;D._hitTest(L,this)?w.type=_.TOUCH_END:w.type=_.TOUCH_CANCEL,w.touch=x,w.bubbles=!0,D.dispatchEvent(w)},b=function(x,w){x.getLocation();var L=this.owner;w.type=_.TOUCH_CANCEL,w.touch=x,w.bubbles=!0,L.dispatchEvent(w)},A=function(x){var w=x.getLocation(),L=this.owner;L._hitTest(w,this)&&(x.type=_.MOUSE_DOWN,x.bubbles=!0,L.dispatchEvent(x),x.stopPropagation())},E=function(x){var w=x.getLocation(),L=this.owner,D=L._hitTest(w,this);if(D)this._previousIn||(y&&(x.type=_.MOUSE_LEAVE,y.dispatchEvent(x),y._mouseListener._previousIn=!1),y=this.owner,x.type=_.MOUSE_ENTER,L.dispatchEvent(x),this._previousIn=!0),x.type=_.MOUSE_MOVE,x.bubbles=!0,L.dispatchEvent(x);else{if(!this._previousIn)return;x.type=_.MOUSE_LEAVE,L.dispatchEvent(x),this._previousIn=!1,y=null}x.stopPropagation()},R=function(x){var w=x.getLocation(),L=this.owner;L._hitTest(w,this)&&(x.type=_.MOUSE_UP,x.bubbles=!0,L.dispatchEvent(x),x.stopPropagation())},O=function(x){var w=x.getLocation(),L=this.owner;L._hitTest(w,this)&&(x.type=_.MOUSE_WHEEL,x.bubbles=!0,L.dispatchEvent(x),x.stopPropagation())},P=cc.Class({name:"cc.Node",extends:T("./utils/base-node"),properties:{_opacity:255,_color:cc.Color.WHITE,_cascadeOpacityEnabled:!0,_anchorPoint:cc.p(.5,.5),_contentSize:cc.size(0,0),_rotationX:0,_rotationY:0,_scaleX:1,_scaleY:1,_position:cc.p(0,0),_skewX:0,_skewY:0,_localZOrder:0,_globalZOrder:0,_opacityModifyRGB:!1,groupIndex:{default:0,type:cc.Integer},group:{get:function(){return cc.game.groupList[this.groupIndex]||""},set:function(x){this.groupIndex=cc.game.groupList.indexOf(x),this.emit("group-changed")}},x:{get:function(){return this._position.x},set:function(x){var w=this._position;if(x!==w.x){w.x=x,this._sgNode.setPositionX(x);var L=this._hasListenerCache;L&&L[a]&&this.emit(a)}}},y:{get:function(){return this._position.y},set:function(x){var w=this._position;if(x!==w.y){w.y=x,this._sgNode.setPositionY(x);var L=this._hasListenerCache;L&&L[a]&&this.emit(a)}}},rotation:{get:function(){return this._rotationX!==this._rotationY&&cc.logID(1602),this._rotationX},set:function(x){if(this._rotationX!==x||this._rotationY!==x){this._rotationX=this._rotationY=x,this._sgNode.rotation=x;var w=this._hasListenerCache;w&&w[u]&&this.emit(u)}}},rotationX:{get:function(){return this._rotationX},set:function(x){if(this._rotationX!==x){this._rotationX=x,this._sgNode.rotationX=x;var w=this._hasListenerCache;w&&w[u]&&this.emit(u)}}},rotationY:{get:function(){return this._rotationY},set:function(x){if(this._rotationY!==x){this._rotationY=x,this._sgNode.rotationY=x;var w=this._hasListenerCache;w&&w[u]&&this.emit(u)}}},scaleX:{get:function(){return this._scaleX},set:function(x){if(this._scaleX!==x){this._scaleX=x,this._sgNode.scaleX=x;var w=this._hasListenerCache;w&&w[d]&&this.emit(d)}}},scaleY:{get:function(){return this._scaleY},set:function(x){if(this._scaleY!==x){this._scaleY=x,this._sgNode.scaleY=x;var w=this._hasListenerCache;w&&w[d]&&this.emit(d)}}},skewX:{get:function(){return this._skewX},set:function(x){this._skewX=x,this._sgNode.skewX=x}},skewY:{get:function(){return this._skewY},set:function(x){this._skewY=x,this._sgNode.skewY=x}},opacity:{get:function(){return this._opacity},set:function(x){if(this._opacity!==x&&(this._opacity=x,this._sgNode.setOpacity(x),!this._cascadeOpacityEnabled)){var w=this._sizeProvider;w instanceof _ccsg.Node&&w!==this._sgNode&&w.setOpacity(x)}},range:[0,255]},cascadeOpacity:{get:function(){return this._cascadeOpacityEnabled},set:function(x){if(this._cascadeOpacityEnabled!==x){this._cascadeOpacityEnabled=x,this._sgNode.cascadeOpacity=x;var w=x?255:this._opacity,L=this._sizeProvider;L instanceof _ccsg.Node&&L.setOpacity(w)}}},color:{get:function(){return this._color.clone()},set:function(x){this._color.equals(x)||(this._color.fromColor(x),this._sizeProvider instanceof _ccsg.Node&&this._sizeProvider.setColor(x))}},anchorX:{get:function(){return this._anchorPoint.x},set:function(x){var w=this._anchorPoint;if(w.x!==x){w.x=x;var L=this._sizeProvider;L instanceof _ccsg.Node&&L.setAnchorPoint(w),this.emit(h)}}},anchorY:{get:function(){return this._anchorPoint.y},set:function(x){var w=this._anchorPoint;if(w.y!==x){w.y=x;var L=this._sizeProvider;L instanceof _ccsg.Node&&L.setAnchorPoint(w),this.emit(h)}}},width:{get:function(){if(this._sizeProvider){var x=this._sizeProvider._getWidth();return this._contentSize.width=x,x}return this._contentSize.width},set:function(x){if(x!==this._contentSize.width){var w=this._sizeProvider;w&&w.setContentSize(x,w._getHeight()),this._contentSize.width=x,this.emit(c)}}},height:{get:function(){if(this._sizeProvider){var x=this._sizeProvider._getHeight();return this._contentSize.height=x,x}return this._contentSize.height},set:function(x){if(x!==this._contentSize.height){var w=this._sizeProvider;w&&w.setContentSize(w._getWidth(),x),this._contentSize.height=x,this.emit(c)}}},zIndex:{get:function(){return this._localZOrder},set:function(x){this._localZOrder!==x&&(this._localZOrder=x,this._sgNode.zIndex=x,this._parent&&function(w){w._parent._delaySort(),t._setDirtyForNode(w)}(this))}}},ctor:function(x){var w=this._sgNode=new _ccsg.Node;cc.game._isCloning||(w.cascadeOpacity=!0),this._sizeProvider=null,this._reorderChildDirty=!1,this._widget=null,this._touchListener=null,this._mouseListener=null},statics:{isNode:function(x){return x instanceof P&&(x.constructor===P||!(x instanceof cc.Scene))}},_onSetParent:function(x){var w=this._sgNode;w.parent&&w.parent.removeChild(w,!1),x&&(x._sgNode.addChild(w),x._delaySort())},_onSiblingIndexChanged:function(x){var w=this._parent,L=w._children,D=0,F=L.length;for(0;D<F;D++)L[D]._sgNode._arrivalOrder=D,t._setDirtyForNode(L[D]);cc.renderer.childrenOrderDirty=!0,w._sgNode._reorderChildDirty=!0,w._delaySort()},_onPreDestroy:function(){var x=this._onPreDestroyBase();m&&cc.director.getActionManager().removeAllActionsFromTarget(this),y===this&&(y=null),this._reorderChildDirty&&cc.director.__fastOff(cc.Director.EVENT_AFTER_UPDATE,this.sortAllChildren,this),t.removeListeners(this),x||this._removeSgNode()},_onPostActivated:function(x){var w=m?cc.director.getActionManager():null;if(x)if(w&&w.resumeTarget(this),t.resumeTarget(this),this._touchListener){var L=this._touchListener.mask=o(this);this._mouseListener&&(this._mouseListener.mask=L)}else this._mouseListener&&(this._mouseListener.mask=o(this));else w&&w.pauseTarget(this),t.pauseTarget(this)},_onHierarchyChanged:function(x){this._onHierarchyChangedBase(x),cc._widgetManager._nodesOrderDirty=!0},_onBatchCreated:function(){var x=this._prefab;x&&x.sync&&!x._synced&&x.root===this&&s.syncWithPrefab(this),this._updateDummySgNode(),this._parent&&this._parent._sgNode.addChild(this._sgNode),this._activeInHierarchy||(m&&cc.director.getActionManager().pauseTarget(this),t.pauseTarget(this));for(var w=this._children,L=0,D=w.length;L<D;L++)w[L]._onBatchCreated()},on:function(x,w,L,D){var F=!1;return p.indexOf(x)!==-1?this._touchListener||(this._touchListener=cc.EventListener.create({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:!0,owner:this,mask:o(this),onTouchBegan:C,onTouchMoved:S,onTouchEnded:I,onTouchCancelled:b}),t.addListener(this._touchListener,this),F=!0):g.indexOf(x)!==-1&&(this._mouseListener||(this._mouseListener=cc.EventListener.create({event:cc.EventListener.MOUSE,_previousIn:!1,owner:this,mask:o(this),onMouseDown:A,onMouseMove:E,onMouseUp:R,onMouseScroll:O}),t.addListener(this._mouseListener,this),F=!0)),F&&!this._activeInHierarchy&&cc.director.getScheduler().schedule(function(){this._activeInHierarchy||t.pauseTarget(this)},this,0,0,0,!1),this._EventTargetOn(x,w,L,D)},off:function(x,w,L,D){this._EventTargetOff(x,w,L,D),p.indexOf(x)!==-1?this._checkTouchListeners():g.indexOf(x)!==-1&&this._checkMouseListeners()},targetOff:function(x){this._EventTargetTargetOff(x),this._checkTouchListeners(),this._checkMouseListeners()},pauseSystemEvents:function(x){t.pauseTarget(this,x)},resumeSystemEvents:function(x){t.resumeTarget(this,x)},_checkTouchListeners:function(){if(!(this._objFlags&r)&&this._touchListener){var x=0;if(this._bubblingListeners){for(;x<p.length;++x)if(this._bubblingListeners.has(p[x]))return}if(this._capturingListeners){for(;x<p.length;++x)if(this._capturingListeners.has(p[x]))return}t.removeListener(this._touchListener),this._touchListener=null}},_checkMouseListeners:function(){if(!(this._objFlags&r)&&this._mouseListener){var x=0;if(this._bubblingListeners){for(;x<g.length;++x)if(this._bubblingListeners.has(g[x]))return}if(this._capturingListeners){for(;x<g.length;++x)if(this._capturingListeners.has(g[x]))return}y===this&&(y=null),t.removeListener(this._mouseListener),this._mouseListener=null}},_hitTest:function(x,w){var L=this.width,D=this.height,F=x,M=cc.Camera;M&&M.main&&M.main.containsNode(this)&&(F=M.main.getCameraToWorldPoint(F));var B=cc.affineTransformInvertIn(this._sgNode.getNodeToWorldTransform());(F=cc.pointApplyAffineTransform(F,B)).x+=this._anchorPoint.x*L,F.y+=this._anchorPoint.y*D;var W=F.x,V=L-F.x,U=F.y,k=D-F.y;if(W>=0&&V>=0&&k>=0&&U>=0){if(w&&w.mask){for(var X=w.mask,Y=this,Z=0;Y&&Z<X.index;++Z,Y=Y.parent);if(Y===X.node){var et=Y.getComponent(cc.Mask);return!et||!et.enabledInHierarchy||et._hitTest(x)}return w.mask=null,!0}return!0}return!1},_getCapturingTargets:function(x,w){for(var L=this.parent;L;)L.hasEventListener(x,!0)&&w.push(L),L=L.parent},_getBubblingTargets:function(x,w){for(var L=this.parent;L;)L.hasEventListener(x)&&w.push(L),L=L.parent},isRunning:function(){return this._activeInHierarchy},runAction:m?function(x){if(this.active)return cc.assertID(x,1618),cc.macro.ENABLE_GC_FOR_NATIVE_OBJECTS||this._retainAction(x),cc.director.getActionManager().addAction(x,this,!1),x}:v,pauseAllActions:m?function(){cc.director.getActionManager().pauseTarget(this)}:v,resumeAllActions:m?function(){cc.director.getActionManager().resumeTarget(this)}:v,stopAllActions:m?function(){cc.director.getActionManager().removeAllActionsFromTarget(this)}:v,stopAction:m?function(x){cc.director.getActionManager().removeAction(x)}:v,stopActionByTag:m?function(x){x!==cc.Action.TAG_INVALID?cc.director.getActionManager().removeActionByTag(x,this):cc.logID(1612)}:v,getActionByTag:m?function(x){return x===cc.Action.TAG_INVALID?(cc.logID(1613),null):cc.director.getActionManager().getActionByTag(x,this)}:function(){return null},getNumberOfRunningActions:m?function(){return cc.director.getActionManager().getNumberOfRunningActionsInTarget(this)}:function(){return 0},_retainAction:function(x){},_releaseAllActions:function(){},setTag:function(x){this._tag=x,this._sgNode.tag=x},getPosition:function(){return new cc.Vec2(this._position)},setPosition:function(x,w){var L;w===void 0?(L=x.x,w=x.y):L=x;var D=this._position;if(D.x!==L||D.y!==w){D.x=L,D.y=w,this._sgNode.setPosition(L,w);var F=this._hasListenerCache;F&&F[a]&&this.emit(a)}},getScale:function(){return this._scaleX!==this._scaleY&&cc.logID(1603),this._scaleX},setScale:function(x,w){if(typeof x=="object"?(w=x.y,x=x.x):w=w||w===0?w:x,this._scaleX!==x||this._scaleY!==w){this._scaleX=x,this._scaleY=w,this._sgNode.setScale(x,w);var L=this._hasListenerCache;L&&L[d]&&this.emit(d)}},getContentSize:function(x){if(this._sizeProvider&&!x){var w=this._sizeProvider.getContentSize();return this._contentSize=w,cc.size(w)}return cc.size(this._contentSize)},setContentSize:function(x,w){var L=this._contentSize;if(w===void 0){if(x.width===L.width&&x.height===L.height)return;L.width=x.width,L.height=x.height}else{if(x===L.width&&w===L.height)return;L.width=x,L.height=w}this._sizeProvider&&this._sizeProvider.setContentSize(L),this.emit(c)},setOpacityModifyRGB:function(x){if(this._opacityModifyRGB!==x){this._opacityModifyRGB=x,this._sgNode.setOpacityModifyRGB(x);var w=this._sizeProvider;w instanceof _ccsg.Node&&w!==this._sgNode&&w.setOpacityModifyRGB(x)}},isOpacityModifyRGB:function(){return this._opacityModifyRGB},setGlobalZOrder:function(x){this._globalZOrder=x,this._sgNode.setGlobalZOrder(x)},getGlobalZOrder:function(){return this._globalZOrder=this._sgNode.getGlobalZOrder(),this._globalZOrder},getAnchorPoint:function(){return cc.p(this._anchorPoint)},setAnchorPoint:function(x,w){var L=this._anchorPoint;if(w===void 0){if(x.x===L.x&&x.y===L.y)return;L.x=x.x,L.y=x.y}else{if(x===L.x&&w===L.y)return;L.x=x,L.y=w}var D=this._sizeProvider;D instanceof _ccsg.Node&&D.setAnchorPoint(L),this.emit(h)},getAnchorPointInPoints:function(){return this._sgNode.getAnchorPointInPoints()},getDisplayedOpacity:function(){return this._sgNode.getDisplayedOpacity()},_updateDisplayedOpacity:function(x){this._sgNode.updateDisplayedOpacity(x)},getDisplayedColor:function(){return this._sgNode.getDisplayedColor()},getNodeToParentTransformAR:function(){var x=this.getContentSize(),w=this._sgNode.getNodeToParentTransform();if(!this._isSgTransformArToMe(x)){var L=this._anchorPoint.x*x.width,D=this._anchorPoint.y*x.height,F=cc.affineTransformMake(1,0,0,1,L,D);w=cc.affineTransformConcatIn(F,w)}return w},getBoundingBox:function(){var x=this.getContentSize(),w=cc.rect(0,0,x.width,x.height);return cc._rectApplyAffineTransformIn(w,this.getNodeToParentTransform())},getBoundingBoxToWorld:function(){var x;return this.parent&&(x=this.parent.getNodeToWorldTransformAR()),this._getBoundingBoxTo(x)},_getBoundingBoxTo:function(x){var w=this.getContentSize(),L=w.width,D=w.height,F=cc.rect(-this._anchorPoint.x*L,-this._anchorPoint.y*D,L,D),M=cc.affineTransformConcat(this.getNodeToParentTransformAR(),x);if(cc._rectApplyAffineTransformIn(F,M),!this._children)return F;for(var B=this._children,W=0;W<B.length;W++){var V=B[W];if(V&&V.active){var U=V._getBoundingBoxTo(M);U&&(F=cc.rectUnion(F,U))}}return F},getNodeToParentTransform:function(){var x=this.getContentSize(),w=this._sgNode.getNodeToParentTransform();if(this._isSgTransformArToMe(x)){var L=-this._anchorPoint.x*x.width,D=-this._anchorPoint.y*x.height,F=cc.affineTransformMake(1,0,0,1,L,D);w=cc.affineTransformConcatIn(F,w)}return w},getNodeToWorldTransform:function(){var x=this.getContentSize();cc._renderType===cc.game.RENDER_TYPE_CANVAS&&cc.director._visitScene();var w=this._sgNode.getNodeToWorldTransform();if(this._isSgTransformArToMe(x)){var L=-this._anchorPoint.x*x.width,D=-this._anchorPoint.y*x.height,F=cc.affineTransformMake(1,0,0,1,L,D);w=cc.affineTransformConcatIn(F,w)}return w},getNodeToWorldTransformAR:function(){var x=this.getContentSize();cc._renderType===cc.game.RENDER_TYPE_CANVAS&&cc.director._visitScene();var w=this._sgNode.getNodeToWorldTransform();if(!this._isSgTransformArToMe(x)){var L=this._anchorPoint.x*x.width,D=this._anchorPoint.y*x.height,F=cc.affineTransformMake(1,0,0,1,L,D);w=cc.affineTransformConcatIn(F,w)}return w},getParentToNodeTransform:function(){return this._sgNode.getParentToNodeTransform()},getWorldToNodeTransform:function(){return cc._renderType===cc.game.RENDER_TYPE_CANVAS&&cc.director._visitScene(),this._sgNode.getWorldToNodeTransform()},_isSgTransformArToMe:function(x){var w=this._sgNode.getContentSize();return w.width===0&&w.height===0&&(x.width!==0||x.height!==0)||!!this._sgNode.isIgnoreAnchorPointForPosition()},convertToNodeSpace:function(x){cc._renderType===cc.game.RENDER_TYPE_CANVAS&&cc.director._visitScene();var w=this._sgNode.convertToNodeSpace(x);return cc.pAdd(w,cc.p(this._anchorPoint.x*this._contentSize.width,this._anchorPoint.y*this._contentSize.height))},convertToWorldSpace:function(x){cc._renderType===cc.game.RENDER_TYPE_CANVAS&&cc.director._visitScene();var w=x.x-this._anchorPoint.x*this._contentSize.width,L=x.y-this._anchorPoint.y*this._contentSize.height;return cc.v2(this._sgNode.convertToWorldSpace(cc.v2(w,L)))},convertToNodeSpaceAR:function(x){return cc._renderType===cc.game.RENDER_TYPE_CANVAS&&cc.director._visitScene(),this._sgNode.isIgnoreAnchorPointForPosition()?cc.v2(this._sgNode.convertToNodeSpace(x)):this._sgNode.convertToNodeSpaceAR(x)},convertToWorldSpaceAR:function(x){return cc._renderType===cc.game.RENDER_TYPE_CANVAS&&cc.director._visitScene(),this._sgNode.isIgnoreAnchorPointForPosition()?cc.v2(this._sgNode.convertToWorldSpace(x)):cc.v2(this._sgNode.convertToWorldSpaceAR(x))},convertTouchToNodeSpace:function(x){return this.convertToNodeSpace(x.getLocation())},convertTouchToNodeSpaceAR:function(x){return this.convertToNodeSpaceAR(x.getLocation())},setNodeDirty:function(){this._sgNode.setNodeDirty()},addChild:function(x,w,L){w=w===void 0?x._localZOrder:w;var D,F=!1;L===void 0?(L=void 0,D=x._name):cc.js.isString(L)?(D=L,L=void 0):cc.js.isNumber(L)&&(F=!0,D=""),cc.assertID(x,1606),cc.assertID(x._parent===null,1605),x.parent=this,x.zIndex=w,F?x.setTag(L):x.setName(D)},cleanup:function(){m&&cc.director.getActionManager().removeAllActionsFromTarget(this),t.removeListeners(this);var x,w,L=this._children.length;for(x=0;x<L;++x)(w=this._children[x])&&w.cleanup()},sortAllChildren:function(){if(this._reorderChildDirty){this._reorderChildDirty=!1;var x=this._children;if(x.length>1){var w,L,D,F=x.length;for(w=1;w<F;w++){for(D=x[w],L=w-1;L>=0;){if(D._localZOrder<x[L]._localZOrder)x[L+1]=x[L];else{if(!(D._localZOrder===x[L]._localZOrder&&D._sgNode._arrivalOrder<x[L]._sgNode._arrivalOrder))break;x[L+1]=x[L]}L--}x[L+1]=D}this.emit("child-reorder")}cc.director.__fastOff(cc.Director.EVENT_AFTER_UPDATE,this.sortAllChildren,this)}},_delaySort:function(){this._reorderChildDirty||(this._reorderChildDirty=!0,cc.director.__fastOn(cc.Director.EVENT_AFTER_UPDATE,this.sortAllChildren,this))},_updateDummySgNode:function(){var x=this._sgNode;x.setPosition(this._position),x.setRotationX(this._rotationX),x.setRotationY(this._rotationY),x.setScale(this._scaleX,this._scaleY),x.setSkewX(this._skewX),x.setSkewY(this._skewY);var w=x._arrivalOrder;x.setLocalZOrder(this._localZOrder),x._arrivalOrder=w,x.setGlobalZOrder(this._globalZOrder),x.setOpacity(this._opacity),x.setOpacityModifyRGB(this._opacityModifyRGB),x.setCascadeOpacityEnabled(this._cascadeOpacityEnabled),x.setTag(this._tag)},_updateSgNode:function(){this._updateDummySgNode();var x=this._sgNode;x.setAnchorPoint(this._anchorPoint),x.setVisible(this._active),x.setColor(this._color);var w=m?cc.director.getActionManager():null;this._activeInHierarchy?(w&&w.resumeTarget(this),t.resumeTarget(this)):(w&&w.pauseTarget(this),t.pauseTarget(this))},_removeSgNode:n.removeSgNode,onRestore:!1});f.propertyDefine(P,["parent","tag","skewX","skewY","position","rotation","rotationX","rotationY","scale","scaleX","scaleY","opacity","color"],{x:["getPositionX","setPositionX"],y:["getPositionY","setPositionY"],zIndex:["getLocalZOrder","setLocalZOrder"],opacityModifyRGB:["isOpacityModifyRGB","setOpacityModifyRGB"],cascadeOpacity:["isCascadeOpacityEnabled","setCascadeOpacityEnabled"]}),P.EventType=_,cc.Node=N.exports=P},{"./event-manager":95,"./event/event":98,"./utils/base-node":180,"./utils/misc":185,"./utils/prefab-helper":187,"./utils/scene-graph-helper":188}],41:[function(T,N,z){cc.Scene=cc.Class({name:"cc.Scene",extends:T("./CCNode"),properties:{autoReleaseAssets:{default:void 0,type:cc.Boolean}},ctor:function(){var o=this._sgNode=new _ccsg.Scene;o.setAnchorPoint(0,0),this._anchorPoint.x=0,this._anchorPoint.y=0,this._activeInHierarchy=!1,this._inited=!cc.game._isCloning,this.dependAssets=null},destroy:function(){this._super(),this._activeInHierarchy=!1},_onHierarchyChanged:function(){},_instantiate:null,_load:function(){this._inited||(this._onBatchCreated(),this._inited=!0)},_activate:function(o){o=o!==!1,cc.director._nodeActivator.activateNode(this,o)}}),N.exports=cc.Scene},{"./CCNode":40}],42:[function(T,N,z){function o(){this._lock=!1,this._scheduler=null,this._elapsed=-1,this._runForever=!1,this._useDelay=!1,this._timesExecuted=0,this._repeat=0,this._delay=0,this._interval=0,this._target=null,this._callback=null}var s=function(d,f,m,v,_,p,g){this.prev=d,this.next=f,this.callback=m,this.target=v,this.priority=_,this.paused=p,this.markedForDeletion=g,this.isUpdate=!m},n=[];s.get=function(d,f,m,v,_,p,g){var y=n.pop();return y?(y.prev=d,y.next=f,y.callback=m,y.target=v,y.priority=_,y.paused=p,y.markedForDeletion=g,y.isUpdate=!m):y=new s(d,f,m,v,_,p,g),y},s.put=function(d){n.length<20&&(d.prev=d.next=d.callback=d.target=null,n.push(d))};var t=function(d,f,m,v){this.list=d,this.entry=f,this.target=m,this.callback=v},e=[];t.get=function(d,f,m,v){var _=e.pop();return _?(_.list=d,_.entry=f,_.target=m,_.callback=v):_=new t(d,f,m,v),_},t.put=function(d){e.length<20&&(d.list=d.entry=d.target=d.callback=null,e.push(d))};var r=function(d,f,m,v,_,p){this.timers=d,this.target=f,this.timerIndex=m,this.currentTimer=v,this.currentTimerSalvaged=_,this.paused=p},a=[];r.get=function(d,f,m,v,_,p){var g=a.pop();return g?(g.timers=d,g.target=f,g.timerIndex=m,g.currentTimer=v,g.currentTimerSalvaged=_,g.paused=p):g=new r(d,f,m,v,_,p),g},r.put=function(d){a.length<20&&(d.timers=d.target=d.currentTimer=null,a.push(d))};var c=o.prototype;c.initWithCallback=function(d,f,m,v,_,p){return this._lock=!1,this._scheduler=d,this._target=m,this._callback=f,this._elapsed=-1,this._interval=v,this._delay=p,this._useDelay=this._delay>0,this._repeat=_,this._runForever=this._repeat===cc.macro.REPEAT_FOREVER,!0},c.getInterval=function(){return this._interval},c.setInterval=function(d){this._interval=d},c.update=function(d){this._elapsed===-1?(this._elapsed=0,this._timesExecuted=0):(this._elapsed+=d,this._runForever&&!this._useDelay?this._elapsed>=this._interval&&(this.trigger(),this._elapsed=0):(this._useDelay?this._elapsed>=this._delay&&(this.trigger(),this._elapsed-=this._delay,this._timesExecuted+=1,this._useDelay=!1):this._elapsed>=this._interval&&(this.trigger(),this._elapsed=0,this._timesExecuted+=1),this._callback&&!this._runForever&&this._timesExecuted>this._repeat&&this.cancel()))},c.getCallback=function(){return this._callback},c.trigger=function(){this._target&&this._callback&&(this._lock=!0,this._callback.call(this._target,this._elapsed),this._lock=!1)},c.cancel=function(){this._scheduler.unschedule(this._callback,this._target)};var h=[];o.get=function(){return h.pop()||new o},o.put=function(d){h.length<20&&!d._lock&&(d._scheduler=d._target=d._callback=null,h.push(d))};var u=function(d){return d.__instanceId||d.uuid};cc.Scheduler=cc._Class.extend({ctor:function(){this._timeScale=1,this._updatesNegList=[],this._updates0List=[],this._updatesPosList=[],this._hashForUpdates={},this._hashForTimers={},this._currentTarget=null,this._currentTargetSalvaged=!1,this._updateHashLocked=!1,this._arrayForTimers=[]},_removeHashElement:function(d){delete this._hashForTimers[u(d.target)];for(var f=this._arrayForTimers,m=0,v=f.length;m<v;m++)if(f[m]===d){f.splice(m,1);break}r.put(d)},_removeUpdateFromHash:function(d){var f=u(d.target),m=this._hashForUpdates[f];if(m){for(var v=m.list,_=m.entry,p=0,g=v.length;p<g;p++)if(v[p]===_){v.splice(p,1);break}delete this._hashForUpdates[f],s.put(_),t.put(m)}},_priorityIn:function(d,f,m){for(var v=0;v<d.length;v++)if(m<d[v].priority)return void d.splice(v,0,f);d.push(f)},_appendIn:function(d,f){d.push(f)},setTimeScale:function(d){this._timeScale=d},getTimeScale:function(){return this._timeScale},update:function(d){this._updateHashLocked=!0,this._timeScale!==1&&(d*=this._timeScale);var f,m,v,_;for(f=0,v=(m=this._updatesNegList).length;f<v;f++)(_=m[f]).paused||_.markedForDeletion||(_.isUpdate?_.target.update(d):_.callback.call(_.target,d));for(f=0,v=(m=this._updates0List).length;f<v;f++)(_=m[f]).paused||_.markedForDeletion||(_.isUpdate?_.target.update(d):_.callback.call(_.target,d));for(f=0,v=(m=this._updatesPosList).length;f<v;f++)(_=m[f]).paused||_.markedForDeletion||(_.isUpdate?_.target.update(d):_.callback.call(_.target,d));var p,g=this._arrayForTimers;for(f=0;f<g.length;f++){if(p=g[f],this._currentTarget=p,this._currentTargetSalvaged=!1,!p.paused)for(p.timerIndex=0;p.timerIndex<p.timers.length;++p.timerIndex)p.currentTimer=p.timers[p.timerIndex],p.currentTimerSalvaged=!1,p.currentTimer.update(d),p.currentTimer=null;this._currentTargetSalvaged&&this._currentTarget.timers.length===0&&(this._removeHashElement(this._currentTarget),--f)}for(f=0,m=this._updatesNegList;f<m.length;)(_=m[f]).markedForDeletion?this._removeUpdateFromHash(_):f++;for(f=0,m=this._updates0List;f<m.length;)(_=m[f]).markedForDeletion?this._removeUpdateFromHash(_):f++;for(f=0,m=this._updatesPosList;f<m.length;)(_=m[f]).markedForDeletion?this._removeUpdateFromHash(_):f++;this._updateHashLocked=!1,this._currentTarget=null},scheduleCallbackForTarget:function(d,f,m,v,_,p){this.schedule(f,d,m,v,_,p)},schedule:function(d,f,m,v,_,p){"use strict";if(typeof d!="function"){var g=d;d=f,f=g}arguments.length!==4&&arguments.length!==5||(p=!!v,v=cc.macro.REPEAT_FOREVER,_=0),cc.assertID(f,1502);var y=u(f);cc.assertID(y,1510);var C=this._hashForTimers[y];C?C.paused!==p&&cc.warnID(1511):(C=r.get(null,f,0,null,null,p),this._arrayForTimers.push(C),this._hashForTimers[y]=C);var S,I;if(C.timers==null)C.timers=[];else for(I=0;I<C.timers.length;++I)if((S=C.timers[I])&&d===S._callback)return cc.logID(1507,S.getInterval(),m),void(S._interval=m);(S=o.get()).initWithCallback(this,d,f,m,v,_),C.timers.push(S),this._currentTarget===C&&this._currentTargetSalvaged&&(this._currentTargetSalvaged=!1)},scheduleUpdate:function(d,f,m,v){var _=u(d);cc.assertID(_,1510);var p=this._hashForUpdates[_];if(p&&p.entry){if(p.entry.priority===f)return p.entry.markedForDeletion=!1,void(p.entry.paused=m);if(this._updateHashLocked)return cc.logID(1506),p.entry.markedForDeletion=!1,void(p.entry.paused=m);this.unscheduleUpdate(d)}v&&cc.warnID(1512);var g,y=s.get(null,null,v,d,f,m,!1);f===0?(g=this._updates0List,this._appendIn(g,y)):(g=f<0?this._updatesNegList:this._updatesPosList,this._priorityIn(g,y,f)),this._hashForUpdates[_]=t.get(g,y,d,null)},unschedule:function(d,f){if(f&&d){var m=u(f);cc.assertID(m,1510);var v=this._hashForTimers[m];if(v)for(var _=v.timers,p=0,g=_.length;p<g;p++){var y=_[p];if(d===y._callback)return y!==v.currentTimer||v.currentTimerSalvaged||(v.currentTimerSalvaged=!0),_.splice(p,1),o.put(y),v.timerIndex>=p&&v.timerIndex--,void(_.length===0&&(this._currentTarget===v?this._currentTargetSalvaged=!0:this._removeHashElement(v)))}}},unscheduleUpdate:function(d){if(d){var f=u(d);cc.assertID(f,1510);var m=this._hashForUpdates[f];m&&(this._updateHashLocked?m.entry.markedForDeletion=!0:this._removeUpdateFromHash(m.entry))}},unscheduleAllForTarget:function(d){if(d){var f=u(d);cc.assertID(f,1510);var m=this._hashForTimers[f];if(m){var v=m.timers;v.indexOf(m.currentTimer)>-1&&!m.currentTimerSalvaged&&(m.currentTimerSalvaged=!0);for(var _=0,p=v.length;_<p;_++)o.put(v[_]);v.length=0,this._currentTarget===m?this._currentTargetSalvaged=!0:this._removeHashElement(m)}this.unscheduleUpdate(d)}},unscheduleAll:function(){this.unscheduleAllWithMinPriority(cc.Scheduler.PRIORITY_SYSTEM)},unscheduleAllWithMinPriority:function(d){var f,m,v=this._arrayForTimers;for(f=v.length-1;f>=0;f--)m=v[f],this.unscheduleAllForTarget(m.target);var _,p=0;if(d<0)for(f=0;f<this._updatesNegList.length;)p=this._updatesNegList.length,(_=this._updatesNegList[f])&&_.priority>=d&&this.unscheduleUpdate(_.target),p==this._updatesNegList.length&&f++;if(d<=0)for(f=0;f<this._updates0List.length;)p=this._updates0List.length,(_=this._updates0List[f])&&this.unscheduleUpdate(_.target),p==this._updates0List.length&&f++;for(f=0;f<this._updatesPosList.length;)p=this._updatesPosList.length,(_=this._updatesPosList[f])&&_.priority>=d&&this.unscheduleUpdate(_.target),p==this._updatesPosList.length&&f++},isScheduled:function(d,f){cc.assertID(d,1508),cc.assertID(f,1509);var m=u(f);cc.assertID(m,1510);var v=this._hashForTimers[m];if(!v||v.timers==null)return!1;for(var _=v.timers,p=0;p<_.length;++p)if(d===_[p]._callback)return!0;return!1},pauseAllTargets:function(){return this.pauseAllTargetsWithMinPriority(cc.Scheduler.PRIORITY_SYSTEM)},pauseAllTargetsWithMinPriority:function(d){var f,m,v,_=[],p=this._arrayForTimers;for(m=0,v=p.length;m<v;m++)(f=p[m])&&(f.paused=!0,_.push(f.target));var g;if(d<0)for(m=0;m<this._updatesNegList.length;m++)(g=this._updatesNegList[m])&&g.priority>=d&&(g.paused=!0,_.push(g.target));if(d<=0)for(m=0;m<this._updates0List.length;m++)(g=this._updates0List[m])&&(g.paused=!0,_.push(g.target));for(m=0;m<this._updatesPosList.length;m++)(g=this._updatesPosList[m])&&g.priority>=d&&(g.paused=!0,_.push(g.target));return _},resumeTargets:function(d){if(d)for(var f=0;f<d.length;f++)this.resumeTarget(d[f])},pauseTarget:function(d){cc.assertID(d,1503);var f=u(d);cc.assertID(f,1510);var m=this._hashForTimers[f];m&&(m.paused=!0);var v=this._hashForUpdates[f];v&&(v.entry.paused=!0)},resumeTarget:function(d){cc.assertID(d,1504);var f=u(d);cc.assertID(f,1510);var m=this._hashForTimers[f];m&&(m.paused=!1);var v=this._hashForUpdates[f];v&&(v.entry.paused=!1)},isTargetPaused:function(d){cc.assertID(d,1505);var f=u(d);cc.assertID(f,1510);var m=this._hashForTimers[f];if(m)return m.paused;var v=this._hashForUpdates[f];return!!v&&v.entry.paused},scheduleUpdateForTarget:function(d,f,m){this.scheduleUpdate(d,f,m)},unscheduleCallbackForTarget:function(d,f){this.unschedule(f,d)},unscheduleUpdateForTarget:function(d){this.unscheduleUpdate(d)},unscheduleAllCallbacksForTarget:function(d){this.unscheduleAllForTarget(d)},unscheduleAllCallbacks:function(){this.unscheduleAllWithMinPriority(cc.Scheduler.PRIORITY_SYSTEM)},unscheduleAllCallbacksWithMinPriority:function(d){this.unscheduleAllWithMinPriority(d)}}),cc.Scheduler.PRIORITY_SYSTEM=1<<31,cc.Scheduler.PRIORITY_NON_SYSTEM=cc.Scheduler.PRIORITY_SYSTEM+1},{}],43:[function(T,N,z){var o=T("./CCRawAsset");cc.Asset=cc.Class({name:"cc.Asset",extends:o,properties:{rawUrl:{get:function(){if(this._rawFiles){if(cc.AssetLibrary)return cc.AssetLibrary.getLibUrlNoExt(this._uuid)+"/"+this._rawFiles[0];cc.errorID(6400)}return""},visible:!1},rawUrls:{get:function(){if(this._rawFiles){if(cc.AssetLibrary){var s=cc.AssetLibrary.getLibUrlNoExt(this._uuid)+"/";return this._rawFiles.map(function(n){return s+n})}cc.errorID(6401)}return[]},visible:!1},_rawFiles:null},statics:{deserialize:function(s){return cc.deserialize(s)},preventDeferredLoadDependents:!1},serialize:function(){return Editor.serialize(this)},createNode:null,_setRawFiles:function(s){this._rawFiles=s.length>0?s:null},_preloadRawFiles:null}),N.exports=cc.Asset},{"./CCRawAsset":49}],44:[function(T,N,z){var o=cc.Class({name:"cc.AudioClip",extends:cc.RawAsset});cc.AudioClip=o,N.exports=o},{}],45:[function(T,N,z){var o=cc.Class({name:"cc.BitmapFont",extends:cc.Font,properties:{fntDataStr:{default:""},spriteFrame:{default:null,type:cc.SpriteFrame},fontSize:{default:-1},_fntConfig:null}});cc.BitmapFont=o,N.exports=o},{}],46:[function(T,N,z){var o=cc.Class({name:"cc.Font",extends:cc.Asset});cc.Font=o,N.exports=o},{}],47:[function(T,N,z){var o=cc.Class({name:"cc.LabelAtlas",extends:cc.BitmapFont});cc.LabelAtlas=o,N.exports=o},{}],48:[function(T,N,z){var o=cc.Class({name:"cc.Prefab",extends:cc.Asset,properties:{data:null,asyncLoadAssets:void 0,_createFunction:{default:null,serializable:!1}},createNode:!1,compileCreateFunction:function(){var s=T("../platform/instantiate-jit");this._createFunction=s.compile(this.data)},_doInstantiate:function(s){return this.data._prefab?this.data._prefab._synced=!0:cc.warnID(3700),this._createFunction||this.compileCreateFunction(),this._createFunction(s)},_instantiate:function(){var s;return s=this._doInstantiate(),this.data._instantiate(s),s}});cc.Prefab=N.exports=o,cc.js.obsolete(cc,"cc._Prefab","Prefab")},{"../platform/instantiate-jit":154}],49:[function(T,N,z){var o=T("../platform/CCObject");cc.RawAsset=cc.Class({name:"cc.RawAsset",extends:o,ctor:function(){Object.defineProperty(this,"_uuid",{value:"",writable:!0})},statics:{createNodeByInfo:null}}),Object.defineProperty(cc.RawAsset,"isRawAssetType",{value:function(s){return cc.isChildClassOf(s,cc.RawAsset)&&!cc.isChildClassOf(s,cc.Asset)}}),N.exports=cc.RawAsset},{"../platform/CCObject":141}],50:[function(T,N,z){var o=cc.Class({name:"cc.SceneAsset",extends:cc.Asset,properties:{scene:null,asyncLoadAssets:void 0}});cc.SceneAsset=o,N.exports=o},{}],51:[function(T,N,z){var o=cc.Class({name:"cc.Script",extends:cc.Asset});cc._Script=o;var s=cc.Class({name:"cc.JavaScript",extends:o});cc._JavaScript=s;var n=cc.Class({name:"cc.CoffeeScript",extends:o});cc._CoffeeScript=n;var t=cc.Class({name:"cc.TypeScript",extends:o});cc._TypeScript=t},{}],52:[function(T,N,z){var o=cc.Class({name:"cc.SpriteAtlas",extends:cc.Asset,properties:{_spriteFrames:{default:{}}},getTexture:function(){var s=Object.keys(this._spriteFrames);if(s.length>0){var n=this._spriteFrames[s[0]];return n?n.getTexture():null}return null},getSpriteFrame:function(s){return this._spriteFrames[s]},getSpriteFrames:function(){var s=[],n=this._spriteFrames;for(var t in n)s.push(n[t]);return s}});cc.SpriteAtlas=o,N.exports=o},{}],53:[function(T,N,z){var o=cc.Class({name:"cc.TTFFont",extends:cc.Font});cc.TTFFont=o,N.exports=o},{}],54:[function(T,N,z){T("./CCRawAsset"),T("./CCAsset"),T("./CCFont"),T("./CCPrefab"),T("./CCAudioClip"),T("./CCScripts"),T("./CCSceneAsset"),T("../sprites/CCSpriteFrame"),T("../textures/CCTexture2D"),T("./CCTTFFont"),T("./CCSpriteAtlas"),T("./CCBitmapFont"),T("./CCLabelAtlas")},{"../sprites/CCSpriteFrame":174,"../textures/CCTexture2D":175,"./CCAsset":43,"./CCAudioClip":44,"./CCBitmapFont":45,"./CCFont":46,"./CCLabelAtlas":47,"./CCPrefab":48,"./CCRawAsset":49,"./CCSceneAsset":50,"./CCScripts":51,"./CCSpriteAtlas":52,"./CCTTFFont":53}],55:[function(T,N,z){var o=T("../utils/misc"),s=T("../event-manager"),n=!!cc.ActionManager,t=function(){};cc.s_globalOrderOfArrival=1,_ccsg.Node=cc.Class({name:"ccsg.Node",properties:{_running:!1,_localZOrder:0,_globalZOrder:0,_arrivalOrder:0,_reorderChildDirty:!1,_vertexZ:0,_customZ:void 0,_rotationX:0,_rotationY:0,_scaleX:1,_scaleY:1,_position:cc.p(0,0),_skewX:0,_skewY:0,_children:[],_visible:!0,_anchorPoint:cc.p(0,0),_contentSize:cc.size(0,0),_parent:null,_ignoreAnchorPointForPosition:!1,tag:cc.macro.NODE_TAG_INVALID,_name:"",_realOpacity:255,_realColor:cc.Color.WHITE,_cascadeColorEnabled:!1,_cascadeOpacityEnabled:!1,_isTransitionFinished:!1,_actionManager:null,_scheduler:null,_renderCmd:null},ctor:function(){this.__instanceId=cc.ClassManager.getNewInstanceId(),this._renderCmd=this._createRenderCmd()},init:function(){return!0},attr:function(e){for(var r in e)this[r]=e[r]},getSkewX:function(){return this._skewX},setSkewX:function(e){this._skewX=e,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty)},getSkewY:function(){return this._skewY},setSkewY:function(e){this._skewY=e,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty)},setLocalZOrder:function(e){this._parent?this._parent.reorderChild(this,e):this._localZOrder=e,s._setDirtyForNode(this)},_setLocalZOrder:function(e){this._localZOrder=e},getLocalZOrder:function(){return this._localZOrder},getZOrder:function(){return cc.logID(1600),this.getLocalZOrder()},setZOrder:function(e){cc.logID(1601),this.setLocalZOrder(e)},setGlobalZOrder:function(e){this._globalZOrder!==e&&(this._globalZOrder=e,s._setDirtyForNode(this))},getGlobalZOrder:function(){return this._globalZOrder},getVertexZ:function(){return this._vertexZ},setVertexZ:function(e){this._customZ=this._vertexZ=e},getRotation:function(){return this._rotationX!==this._rotationY&&cc.logID(1602),this._rotationX},setRotation:function(e){this._rotationX=this._rotationY=e,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty)},getRotationX:function(){return this._rotationX},setRotationX:function(e){this._rotationX=e,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty)},getRotationY:function(){return this._rotationY},setRotationY:function(e){this._rotationY=e,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty)},getScale:function(){return this._scaleX!==this._scaleY&&cc.logID(1603),this._scaleX},setScale:function(e,r){this._scaleX=e,this._scaleY=r||r===0?r:e,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty)},getScaleX:function(){return this._scaleX},setScaleX:function(e){this._scaleX=e,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty)},getScaleY:function(){return this._scaleY},setScaleY:function(e){this._scaleY=e,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty)},setPosition:function(e,r){var a=this._position;if(r===void 0){if(a.x===e.x&&a.y===e.y)return;a.x=e.x,a.y=e.y}else{if(a.x===e&&a.y===r)return;a.x=e,a.y=r}this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty)},getPosition:function(){return cc.p(this._position)},getPositionX:function(){return this._position.x},setPositionX:function(e){this._position.x=e,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty)},getPositionY:function(){return this._position.y},setPositionY:function(e){this._position.y=e,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty)},getChildrenCount:function(){return this._children.length},getChildren:function(){return this._children},isVisible:function(){return this._visible},setVisible:function(e){this._visible!==e&&(this._visible=e,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty),cc.renderer.childrenOrderDirty=!0)},getAnchorPoint:function(){return cc.p(this._anchorPoint)},setAnchorPoint:function(e,r){var a=this._anchorPoint;if(r===void 0){if(e.x===a.x&&e.y===a.y)return;a.x=e.x,a.y=e.y}else{if(e===a.x&&r===a.y)return;a.x=e,a.y=r}this._renderCmd._updateAnchorPointInPoint()},_getAnchorX:function(){return this._anchorPoint.x},_setAnchorX:function(e){this._anchorPoint.x!==e&&(this._anchorPoint.x=e,this._renderCmd._updateAnchorPointInPoint())},_getAnchorY:function(){return this._anchorPoint.y},_setAnchorY:function(e){this._anchorPoint.y!==e&&(this._anchorPoint.y=e,this._renderCmd._updateAnchorPointInPoint())},getAnchorPointInPoints:function(){return this._renderCmd.getAnchorPointInPoints()},_getWidth:function(){return this._contentSize.width},_setWidth:function(e){this._contentSize.width=e,this._renderCmd._updateAnchorPointInPoint()},_getHeight:function(){return this._contentSize.height},_setHeight:function(e){this._contentSize.height=e,this._renderCmd._updateAnchorPointInPoint()},getContentSize:function(){return cc.size(this._contentSize)},setContentSize:function(e,r){var a=this._contentSize;if(r===void 0){if(e.width===a.width&&e.height===a.height)return;a.width=e.width,a.height=e.height}else{if(e===a.width&&r===a.height)return;a.width=e,a.height=r}this._renderCmd._updateAnchorPointInPoint()},isRunning:function(){return this._running},getParent:function(){return this._parent},setParent:function(e){this._parent=e;var r=_ccsg.Node._dirtyFlags;this._renderCmd.setDirtyFlag(r.transformDirty|r.opacityDirty)},isIgnoreAnchorPointForPosition:function(){return this._ignoreAnchorPointForPosition},setIgnoreAnchorPointForPosition:function(e){e!==this._ignoreAnchorPointForPosition&&(this._ignoreAnchorPointForPosition=e,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty))},getTag:function(){return this.tag},setTag:function(e){this.tag=e},setName:function(e){this._name=e},getName:function(){return this._name},updateOrderOfArrival:function(){this._arrivalOrder=++cc.s_globalOrderOfArrival},getScheduler:function(){return this._scheduler||cc.director.getScheduler()},setScheduler:function(e){this._scheduler!==e&&(this.unscheduleAllCallbacks(),this._scheduler=e)},boundingBox:function(){return cc.logID(1608),this.getBoundingBox()},getBoundingBox:function(){var e=cc.rect(0,0,this._contentSize.width,this._contentSize.height);return cc._rectApplyAffineTransformIn(e,this.getNodeToParentTransform())},cleanup:function(){this.stopAllActions(),this.unscheduleAllCallbacks(),s.removeListeners(this)},getChildByTag:function(e){var r=this._children;if(r!==null)for(var a=0;a<r.length;a++){var c=r[a];if(c&&c.tag===e)return c}return null},getChildByName:function(e){if(!e)return cc.log("Invalid name"),null;for(var r=this._children,a=0,c=r.length;a<c;a++)if(r[a]._name===e)return r[a];return null},addChild:function(e,r,a){r=r===void 0?e._localZOrder:r;var c,h=!1;a===void 0?c=e._name:typeof a=="string"?(c=a,a=void 0):typeof a=="number"&&(h=!0,c=""),cc.assertID(e,1606),cc.assertID(e._parent===null,1605),this._addChildHelper(e,r,a,c,h)},_addChildHelper:function(e,r,a,c,h){this._children||(this._children=[]),this._insertChild(e,r),h?e.setTag(a):e.setName(c),e.setParent(this),e.updateOrderOfArrival(),this._running&&(e.performRecursive(_ccsg.Node.performType.onEnter),this._isTransitionFinished&&e.performRecursive(_ccsg.Node.performType.onEnterTransitionDidFinish)),e._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty),this._cascadeColorEnabled&&e._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.colorDirty),this._cascadeOpacityEnabled&&e._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.opacityDirty)},removeFromParent:function(e){this._parent&&(e===void 0&&(e=!0),this._parent.removeChild(this,e))},removeFromParentAndCleanup:function(e){cc.logID(1607),this.removeFromParent(e)},removeChild:function(e,r){this._children.length!==0&&(r===void 0&&(r=!0),this._children.indexOf(e)>-1&&this._detachChild(e,r),cc.renderer.childrenOrderDirty=!0)},removeChildByTag:function(e,r){e===cc.macro.NODE_TAG_INVALID&&cc.logID(1609);var a=this.getChildByTag(e);a?this.removeChild(a,r):cc.logID(1610,e)},removeAllChildrenWithCleanup:function(e){this.removeAllChildren(e)},removeAllChildren:function(e){var r=this._children;if(r!==null){e===void 0&&(e=!0);for(var a=0;a<r.length;a++){var c=r[a];c&&(this._running&&(c.performRecursive(_ccsg.Node.performType.onExitTransitionDidStart),c.performRecursive(_ccsg.Node.performType.onExit)),e&&c.performRecursive(_ccsg.Node.performType.cleanup),c.parent=null,c._renderCmd.detachFromParent())}this._children.length=0,cc.renderer.childrenOrderDirty=!0}},_detachChild:function(e,r){this._running&&(e.performRecursive(_ccsg.Node.performType.onExitTransitionDidStart),e.performRecursive(_ccsg.Node.performType.onExit)),r&&e.performRecursive(_ccsg.Node.performType.cleanup),e.parent=null,e._renderCmd.detachFromParent(),cc.js.array.remove(this._children,e)},_insertChild:function(e,r){cc.renderer.childrenOrderDirty=this._reorderChildDirty=!0,this._children.push(e),e._setLocalZOrder(r)},setNodeDirty:function(){this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty)},reorderChild:function(e,r){cc.assertID(e,1617),this._children.indexOf(e)!==-1?r!==e.zIndex&&(cc.renderer.childrenOrderDirty=this._reorderChildDirty=!0,e.updateOrderOfArrival(),e._setLocalZOrder(r),this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.orderDirty)):cc.logID(1635)},sortAllChildren:function(){if(this._reorderChildDirty){var e,r,a,c=this._children,h=c.length;for(e=1;e<h;e++){for(a=c[e],r=e-1;r>=0;){if(a._localZOrder<c[r]._localZOrder)c[r+1]=c[r];else{if(!(a._localZOrder===c[r]._localZOrder&&a._arrivalOrder<c[r]._arrivalOrder))break;c[r+1]=c[r]}r--}c[r+1]=a}this._reorderChildDirty=!1}},draw:function(e){},transformAncestors:function(){this._parent!==null&&(this._parent.transformAncestors(),this._parent.transform())},onEnter:function(){this._isTransitionFinished=!1,this._running=!0,this.resume()},performRecursive:function(e){var r=_ccsg.Node.performType;if(!(e>=r.max)){var a,c,h,u,d,f=0,m=_ccsg.Node._performStacks[_ccsg.Node._performing];for(m||(m=[],_ccsg.Node._performStacks.push(m)),m.length=0,_ccsg.Node._performing++,h=m[0]=this;h;){if((a=h._children)&&a.length>0)for(u=0,d=a.length;u<d;++u)c=a[u],m.push(c);h=m[++f]}switch(e){case r.onEnter:for(u=m.length-1;u>=0;--u)h=m[u],m[u]=null,h&&h.onEnter();break;case r.onExit:for(u=m.length-1;u>=0;--u)h=m[u],m[u]=null,h&&h.onExit();break;case r.onEnterTransitionDidFinish:for(u=m.length-1;u>=0;--u)h=m[u],m[u]=null,h&&h.onEnterTransitionDidFinish();break;case r.cleanup:for(u=m.length-1;u>=0;--u)h=m[u],m[u]=null,h&&h.cleanup();break;case r.onExitTransitionDidStart:for(u=m.length-1;u>=0;--u)h=m[u],m[u]=null,h&&h.onExitTransitionDidStart()}_ccsg.Node._performing--}},onEnterTransitionDidFinish:function(){this._isTransitionFinished=!0},onExitTransitionDidStart:function(){},onExit:function(){this._running=!1,this.pause()},runAction:n?function(e){return cc.assertID(e,1618),cc.director.getActionManager().addAction(e,this,!this._running),e}:t,stopAllActions:n?function(){cc.director.getActionManager().removeAllActionsFromTarget(this)}:t,stopAction:n?function(e){cc.director.getActionManager().removeAction(e)}:t,stopActionByTag:n?function(e){e!==cc.Action.TAG_INVALID?cc.director.getActionManager().removeActionByTag(e,this):cc.logID(1612)}:t,getActionByTag:n?function(e){return e===cc.Action.TAG_INVALID?(cc.logID(1613),null):cc.director.getActionManager().getActionByTag(e,this)}:function(){return null},getNumberOfRunningActions:n?function(){return cc.director.getActionManager().getNumberOfRunningActionsInTarget(this)}:function(){return 0},scheduleUpdate:function(){this.scheduleUpdateWithPriority(0)},scheduleUpdateWithPriority:function(e){this.scheduler.scheduleUpdate(this,e,!this._running)},unscheduleUpdate:function(){this.scheduler.unscheduleUpdate(this)},schedule:function(e,r,a,c,h){var u=arguments.length;typeof e=="function"?u===1?(r=0,a=cc.macro.REPEAT_FOREVER,c=0,h=this.__instanceId):u===2?typeof r=="number"?(a=cc.macro.REPEAT_FOREVER,c=0,h=this.__instanceId):(h=r,r=0,a=cc.macro.REPEAT_FOREVER,c=0):u===3?(typeof a=="string"?(h=a,a=cc.macro.REPEAT_FOREVER):h=this.__instanceId,c=0):u===4&&(h=this.__instanceId):u===1?(r=0,a=cc.macro.REPEAT_FOREVER,c=0):u===2&&(a=cc.macro.REPEAT_FOREVER,c=0),cc.assertID(e,1619),cc.assertID(r>=0,1620),r=r||0,a=Number.isNaN(a)?cc.macro.REPEAT_FOREVER:a,c=c||0,this.scheduler.schedule(e,this,r,a,c,!this._running,h)},scheduleOnce:function(e,r,a){a===void 0&&(a=this.__instanceId),this.schedule(e,0,0,r,a)},unschedule:function(e){e&&this.scheduler.unschedule(e,this)},unscheduleAllCallbacks:function(){this.scheduler.unscheduleAllForTarget(this)},resumeSchedulerAndActions:function(){cc.logID(1614),this.resume()},resume:function(){this.scheduler.resumeTarget(this),n&&cc.director.getActionManager().resumeTarget(this),s.resumeTarget(this)},pauseSchedulerAndActions:function(){cc.logID(1615),this.pause()},pause:function(){this.scheduler.pauseTarget(this),n&&cc.director.getActionManager().pauseTarget(this),s.pauseTarget(this)},getParentToNodeTransform:function(){return this._renderCmd.getParentToNodeTransform()},parentToNodeTransform:function(){return this.getParentToNodeTransform()},getNodeToWorldTransform:function(){for(var e=this.getNodeToParentTransform(),r=this._parent;r!==null;r=r.parent)e=cc.affineTransformConcat(e,r.getNodeToParentTransform());return e},nodeToWorldTransform:function(){return this.getNodeToWorldTransform()},getWorldToNodeTransform:function(){return cc.affineTransformInvert(this.getNodeToWorldTransform())},worldToNodeTransform:function(){return this.getWorldToNodeTransform()},convertToNodeSpace:function(e){return cc.pointApplyAffineTransform(e,this.getWorldToNodeTransform())},convertToWorldSpace:function(e){return e=e||cc.v2(0,0),cc.pointApplyAffineTransform(e,this.getNodeToWorldTransform())},convertToNodeSpaceAR:function(e){return cc.pSub(this.convertToNodeSpace(e),this._renderCmd.getAnchorPointInPoints())},convertToWorldSpaceAR:function(e){e=e||cc.v2(0,0);var r=cc.pAdd(e,this._renderCmd.getAnchorPointInPoints());return this.convertToWorldSpace(r)},_convertToWindowSpace:function(e){var r=this.convertToWorldSpace(e);return cc.director.convertToUI(r)},convertTouchToNodeSpace:function(e){var r=e.getLocation();return this.convertToNodeSpace(r)},convertTouchToNodeSpaceAR:function(e){var r=cc.director.convertToGL(e.getLocation());return this.convertToNodeSpaceAR(r)},updateTransform:function(){for(var e=this._children,r=0;r<e.length;r++){var a;(a=e[r])&&a.updateTransform()}},retain:function(){},release:function(){},visit:function(e){var r=this._renderCmd,a=e?e._renderCmd:null;if(this._visible){var c=cc.renderer;r.visit(a);var h,u,d=this._children,f=d.length;if(f>0){for(this._reorderChildDirty&&this.sortAllChildren(),h=0;h<f&&(u=d[h])._localZOrder<0;h++)u.visit(this);for(c.pushRenderCommand(r);h<f;h++)d[h].visit(this)}else c.pushRenderCommand(r);r._dirtyFlag=0}else r._propagateFlagsDown(a)},transform:function(e,r){this._renderCmd.transform(e,r)},nodeToParentTransform:function(){return this.getNodeToParentTransform()},getNodeToParentTransform:function(e){var r=this._renderCmd.getNodeToParentTransform();if(e){for(var a={a:r.a,b:r.b,c:r.c,d:r.d,tx:r.tx,ty:r.ty},c=this._parent;c!=null&&c!=e;c=c.getParent())cc.affineTransformConcatIn(a,c.getNodeToParentTransform());return a}return r},getNodeToParentAffineTransform:function(e){return this.getNodeToParentTransform(e)},getShaderProgram:function(){return this._renderCmd.getShaderProgram()},setShaderProgram:function(e){this._renderCmd.setShaderProgram(e)},getGLServerState:function(){return 0},setGLServerState:function(e){},getBoundingBoxToWorld:function(){var e=cc.rect(0,0,this._contentSize.width,this._contentSize.height),r=this.getNodeToWorldTransform();if(cc._rectApplyAffineTransformIn(e,r),!this._children)return e;for(var a=this._children,c=0;c<a.length;c++){var h=a[c];if(h&&h._visible){var u=h._getBoundingBoxToCurrentNode(r);u&&(e=cc.rectUnion(e,u))}}return e},_getBoundingBoxToCurrentNode:function(e){var r=cc.rect(0,0,this._contentSize.width,this._contentSize.height),a=e===void 0?this.getNodeToParentTransform():cc.affineTransformConcat(this.getNodeToParentTransform(),e);if(cc._rectApplyAffineTransformIn(r,a),!this._children)return r;for(var c=this._children,h=0;h<c.length;h++){var u=c[h];if(u&&u._visible){var d=u._getBoundingBoxToCurrentNode(a);d&&(r=cc.rectUnion(r,d))}}return r},getOpacity:function(){return this._realOpacity},getDisplayedOpacity:function(){return this._renderCmd.getDisplayedOpacity()},setOpacity:function(e){this._realOpacity=e,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.opacityDirty)},updateDisplayedOpacity:function(e){this._renderCmd._updateDisplayOpacity(e)},isCascadeOpacityEnabled:function(){return this._cascadeOpacityEnabled},setCascadeOpacityEnabled:function(e){this._cascadeOpacityEnabled!==e&&(this._cascadeOpacityEnabled=e,this._renderCmd.setCascadeOpacityEnabledDirty())},getColor:function(){var e=this._realColor;return cc.color(e.r,e.g,e.b,e.a)},getDisplayedColor:function(){return this._renderCmd.getDisplayedColor()},setColor:function(e){var r=this._realColor;r.r=e.r,r.g=e.g,r.b=e.b,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.colorDirty)},updateDisplayedColor:function(e){this._renderCmd._updateDisplayColor(e)},isCascadeColorEnabled:function(){return this._cascadeColorEnabled},setCascadeColorEnabled:function(e){this._cascadeColorEnabled!==e&&(this._cascadeColorEnabled=e,this._renderCmd.setCascadeColorEnabledDirty())},setOpacityModifyRGB:function(e){},isOpacityModifyRGB:function(){return!1},_createRenderCmd:function(){return cc._renderType===cc.game.RENDER_TYPE_CANVAS?new _ccsg.Node.CanvasRenderCmd(this):new _ccsg.Node.WebGLRenderCmd(this)}}),_ccsg.Node.extend=cc._Class.extend,_ccsg.Node.prototype.ctor=_ccsg.Node,_ccsg.Node.performType={onEnter:1,onExit:2,cleanup:3,onEnterTransitionDidFinish:4,onExitTransitionDidStart:5,max:6},_ccsg.Node._performStacks=[[]],_ccsg.Node._performing=0,o.propertyDefine(_ccsg.Node,["skewX","skewY","vertexZ","rotation","rotationX","rotationY","scale","scaleX","scaleY","children","childrenCount","parent","scheduler","shaderProgram","opacity","color"],{x:["getPositionX","setPositionX"],y:["getPositionY","setPositionY"],width:["_getWidth","_setWidth"],height:["_getHeight","_setHeight"],anchorX:["_getAnchorX","_setAnchorX"],anchorY:["_getAnchorY","_setAnchorY"],zIndex:["getLocalZOrder","setLocalZOrder"],visible:["isVisible","setVisible"],running:["isRunning"],ignoreAnchor:["isIgnoreAnchorPointForPosition","setIgnoreAnchorPointForPosition"],opacityModifyRGB:["isOpacityModifyRGB","setOpacityModifyRGB"],cascadeOpacity:["isCascadeOpacityEnabled","setCascadeOpacityEnabled"],cascadeColor:["isCascadeColorEnabled","setCascadeColorEnabled"]})},{"../event-manager":95,"../utils/misc":185}],56:[function(T,N,z){function o(t,e){var r,a,c,h,u,d,f=1,m=_ccsg.Node._performStacks[_ccsg.Node._performing];for(m||(m=[],_ccsg.Node._performStacks.push(m)),m.length=0,_ccsg.Node._performing++,m[0]=t;f;)if(f--,c=m[f],m[f]=null,c&&(r=c._children)&&r.length>0)for(h=c._renderCmd,u=0,d=r.length;u<d;++u)a=r[u],m[f]=a,f++,a._renderCmd[e](h);_ccsg.Node._performing--}cc.CustomRenderCmd=function(t,e){this._needDraw=!0,this._target=t,this._callback=e},cc.CustomRenderCmd.prototype.rendering=function(t,e,r){this._callback&&this._callback.call(this._target,t,e,r)};var s=_ccsg.Node._dirtyFlags={transformDirty:1,visibleDirty:2,colorDirty:4,opacityDirty:8,cacheDirty:16,orderDirty:32,textDirty:64,gradientDirty:128,textureDirty:256,contentDirty:512,cullingDirty:1024,COUNT:9};cc.js.get(s,"all",function(){return(1<<s.COUNT)-1},!1),_ccsg.Node._requestDirtyFlag=function(t){cc.assertID(!s[t],1622,t);var e=1<<s.COUNT;return s[t]=e,s.COUNT++,e};var n=Math.PI/180;_ccsg.Node.RenderCmd=function(t){this._node=t,this._anchorPointInPoints=new cc.Vec2(0,0),this._needDraw=!1,this._dirtyFlag=1,this._curLevel=-1,this._cameraFlag=0,this._displayedColor=new cc.Color(255,255,255,255),this._displayedOpacity=255,this._cascadeColorEnabledDirty=!1,this._cascadeOpacityEnabledDirty=!1,this._transform={a:1,b:0,c:0,d:1,tx:0,ty:0},this._worldTransform={a:1,b:0,c:0,d:1,tx:0,ty:0},this._inverse={a:1,b:0,c:0,d:1,tx:0,ty:0},this._transformUpdated=!1,cc.renderer.pushDirtyNode(this)},_ccsg.Node.RenderCmd.prototype={constructor:_ccsg.Node.RenderCmd,_ctor:_ccsg.Node.RenderCmd,getAnchorPointInPoints:function(){return cc.p(this._anchorPointInPoints)},getDisplayedColor:function(){var t=this._displayedColor;return cc.color(t.r,t.g,t.b,t.a)},getDisplayedOpacity:function(){return this._displayedOpacity},setCascadeColorEnabledDirty:function(){this._cascadeColorEnabledDirty=!0,this.setDirtyFlag(s.colorDirty)},setCascadeOpacityEnabledDirty:function(){this._cascadeOpacityEnabledDirty=!0,this.setDirtyFlag(s.opacityDirty)},getParentToNodeTransform:function(){return this._dirtyFlag&s.transformDirty&&cc.affineTransformInvertOut(this.getNodeToParentTransform(),this._inverse),this._inverse},detachFromParent:function(){},_updateAnchorPointInPoint:function(){var t=this._anchorPointInPoints,e=this._node._contentSize,r=this._node._anchorPoint;t.x=e.width*r.x,t.y=e.height*r.y,this.setDirtyFlag(s.transformDirty)},setDirtyFlag:function(t){this._dirtyFlag===0&&t!==0&&cc.renderer.pushDirtyNode(this),this._dirtyFlag|=t},getParentRenderCmd:function(){return this._node&&this._node._parent&&this._node._parent._renderCmd?this._node._parent._renderCmd:null},updateTransform:function(t,e){var r=this._node,a=t?t._worldTransform:null,c=this._transform,h=this._worldTransform;if(!this._transformUpdated){var u=r._rotationX||r._rotationY,d=r._skewX||r._skewY,f=r._scaleX,m=r._scaleY,v=this._anchorPointInPoints.x,_=this._anchorPointInPoints.y,p=1,g=0,y=0,C=1;if(u||d){if(c.tx=r._position.x,c.ty=r._position.y,u){var S=r._rotationX*n;if(y=Math.sin(S),C=Math.cos(S),r._rotationY===r._rotationX)p=C,g=-y;else{var I=r._rotationY*n;p=Math.cos(I),g=-Math.sin(I)}}if(c.a=p*=f,c.b=g*=f,c.c=y*=m,c.d=C*=m,d){var b=Math.tan(r._skewX*n),A=Math.tan(r._skewY*n);b===1/0&&(b=99999999),A===1/0&&(A=99999999),c.a=p+y*A,c.b=g+C*A,c.c=y+p*b,c.d=C+g*b}(v||_)&&(c.tx-=c.a*v+c.c*_,c.ty-=c.b*v+c.d*_,r._ignoreAnchorPointForPosition&&(c.tx+=v,c.ty+=_))}else c.a=f,c.b=0,c.c=0,c.d=m,c.tx=r._position.x,c.ty=r._position.y,(v||_)&&(c.tx-=c.a*v,c.ty-=c.d*_,r._ignoreAnchorPointForPosition&&(c.tx+=v,c.ty+=_))}a?(h.a=c.a*a.a+c.b*a.c,h.b=c.a*a.b+c.b*a.d,h.c=c.c*a.a+c.d*a.c,h.d=c.c*a.b+c.d*a.d,h.tx=c.tx*a.a+c.ty*a.c+a.tx,h.ty=c.tx*a.b+c.ty*a.d+a.ty):(h.a=c.a,h.b=c.b,h.c=c.c,h.d=c.d,h.tx=c.tx,h.ty=c.ty)},transform:function(t,e){this.updateTransform(t),this._currentRegion&&(this._updateCurrentRegions(),this._notifyRegionStatus&&this._notifyRegionStatus(_ccsg.Node.CanvasRenderCmd.RegionStatus.DirtyDouble)),cc.macro.ENABLE_CULLING?(this._updateCameraFlag(t),this._doCulling&&this._doCulling()):this._doCulling&&(this._needDraw=!0),e&&o(this._node,"transform")},_updateCameraFlag:function(t){var e=cc.Camera;cc._renderType===cc.game.RENDER_TYPE_WEBGL&&e&&t&&this._cameraFlag!=e.flags.InCamera&&(this._cameraFlag=t._cameraFlag>0?e.flags.ParentInCamera:0)},culling:function(t,e){cc.macro.ENABLE_CULLING?(this._updateCameraFlag(t),this._doCulling&&this._doCulling(),e&&o(this._node,"culling")):this._doCulling&&(this._needDraw=!0)},getNodeToParentTransform:function(){return this._dirtyFlag&s.transformDirty&&this.transform(),this._transform},setNodeToParentTransform:function(t){t?(this._transform=t,this._transformUpdated=!0):this._transformUpdated=!1,this.setDirtyFlag(s.transformDirty)},_propagateFlagsDown:function(t){if(t){var e=this._dirtyFlag,r=t._node,a=t._dirtyFlag;r._cascadeColorEnabled&&a&s.colorDirty&&(e|=s.colorDirty),r._cascadeOpacityEnabled&&a&s.opacityDirty&&(e|=s.opacityDirty),a&s.transformDirty&&(e|=s.transformDirty),a&s.cullingDirty&&(e|=s.cullingDirty),this._dirtyFlag=e}},visit:function(t){var e=this._node,r=cc.renderer;t&&(this._curLevel=t._curLevel+1),this._propagateFlagsDown(t),isNaN(e._customZ)&&(e._vertexZ=r.assignedZ,r.assignedZ+=r.assignedZStep),this._syncStatus(t)},_updateDisplayColor:function(t){var e,r,a,c,h=this._node,u=this._displayedColor,d=h._realColor;if(this._notifyRegionStatus&&this._notifyRegionStatus(_ccsg.Node.CanvasRenderCmd.RegionStatus.Dirty),this._cascadeColorEnabledDirty&&!h._cascadeColorEnabled){u.r=d.r,u.g=d.g,u.b=d.b;var f=new cc.Color(255,255,255,255);for(e=0,r=(a=h._children).length;e<r;e++)(c=a[e])&&c._renderCmd&&c._renderCmd._updateDisplayColor(f);this._cascadeColorEnabledDirty=!1}else{if(t===void 0){var m=h._parent;t=m&&m._cascadeColorEnabled?m.getDisplayedColor():cc.Color.WHITE}if(u.r=0|d.r*t.r/255,u.g=0|d.g*t.g/255,u.b=0|d.b*t.b/255,h._cascadeColorEnabled)for(e=0,r=(a=h._children).length;e<r;e++)(c=a[e])&&c._renderCmd&&(c._renderCmd._updateDisplayColor(u),c._renderCmd._updateColor())}this._dirtyFlag&=~s.colorDirty},_updateDisplayOpacity:function(t){var e,r,a,c,h=this._node;if(this._notifyRegionStatus&&this._notifyRegionStatus(_ccsg.Node.CanvasRenderCmd.RegionStatus.Dirty),this._cascadeOpacityEnabledDirty&&!h._cascadeOpacityEnabled){for(this._displayedOpacity=h._realOpacity,e=0,r=(a=h._children).length;e<r;e++)(c=a[e])&&c._renderCmd&&c._renderCmd._updateDisplayOpacity(255);this._cascadeOpacityEnabledDirty=!1}else{if(t===void 0){var u=h._parent;t=255,u&&u._cascadeOpacityEnabled&&(t=u.getDisplayedOpacity())}if(this._displayedOpacity=h._realOpacity*t/255,h._cascadeOpacityEnabled)for(e=0,r=(a=h._children).length;e<r;e++)(c=a[e])&&c._renderCmd&&(c._renderCmd._updateDisplayOpacity(this._displayedOpacity),c._renderCmd._updateColor())}this._dirtyFlag&=~s.opacityDirty},_syncDisplayColor:function(t){var e=this._node,r=this._displayedColor,a=e._realColor;if(t===void 0){var c=e._parent;t=c&&c._cascadeColorEnabled?c.getDisplayedColor():cc.Color.WHITE}r.r=0|a.r*t.r/255,r.g=0|a.g*t.g/255,r.b=0|a.b*t.b/255},_syncDisplayOpacity:function(t){var e=this._node;if(t===void 0){var r=e._parent;t=255,r&&r._cascadeOpacityEnabled&&(t=r.getDisplayedOpacity())}this._displayedOpacity=e._realOpacity*t/255},_updateColor:function(){},updateStatus:function(){var t=this._dirtyFlag,e=t&s.colorDirty,r=t&s.opacityDirty;if(t&s.contentDirty&&(this._notifyRegionStatus&&this._notifyRegionStatus(_ccsg.Node.CanvasRenderCmd.RegionStatus.Dirty),this._dirtyFlag&=~s.contentDirty),e&&this._updateDisplayColor(),r&&this._updateDisplayOpacity(),(e||r)&&this._updateColor(),t&s.transformDirty){var a=this.getParentRenderCmd();this.transform(a,!0),this._dirtyFlag&=~s.transformDirty,this._dirtyFlag&=~s.cullingDirty}else t&s.cullingDirty&&(this.culling(a,!0),this._dirtyFlag&=~s.cullingDirty)},_syncStatus:function(t){var e=this._dirtyFlag,r=e&s.colorDirty,a=e&s.opacityDirty;r&&this._syncDisplayColor(),a&&this._syncDisplayOpacity(),(r||a)&&this._updateColor(),e&s.transformDirty?this.transform(t):e&s.cullingDirty&&this.culling(t)}},_ccsg.Node.RenderCmd.prototype.originUpdateTransform=_ccsg.Node.RenderCmd.prototype.updateTransform,_ccsg.Node.RenderCmd.prototype.originTransform=_ccsg.Node.RenderCmd.prototype.transform,_ccsg.Node.RenderCmd.prototype.originCulling=_ccsg.Node.RenderCmd.prototype.culling,_ccsg.Node.RenderCmd.prototype.originUpdateStatus=_ccsg.Node.RenderCmd.prototype.updateStatus,_ccsg.Node.RenderCmd.prototype._originSyncStatus=_ccsg.Node.RenderCmd.prototype._syncStatus},{}],57:[function(T,N,z){_ccsg.Node.CanvasRenderCmd=function(n){this._ctor(n),this._currentRegion=new cc.Region,this._oldRegion=new cc.Region,this._regionFlag=0},_ccsg.Node.CanvasRenderCmd.RegionStatus={NotDirty:0,Dirty:1,DirtyDouble:2};var o=_ccsg.Node.CanvasRenderCmd.prototype=Object.create(_ccsg.Node.RenderCmd.prototype);o.constructor=_ccsg.Node.CanvasRenderCmd,o._rootCtor=_ccsg.Node.CanvasRenderCmd,o._notifyRegionStatus=function(n){this._needDraw&&this._regionFlag<n&&(this._regionFlag=n)};var s=new cc.Rect;o.getLocalBB=function(){var n=this._node;return s.x=s.y=0,s.width=n._contentSize.width,s.height=n._contentSize.height,s},o._updateCurrentRegions=function(){var n=this._currentRegion;this._currentRegion=this._oldRegion,this._oldRegion=n,_ccsg.Node.CanvasRenderCmd.RegionStatus.DirtyDouble!==this._regionFlag||this._currentRegion.isEmpty()||this._oldRegion.union(this._currentRegion),this._currentRegion.updateRegion(this.getLocalBB(),this._worldTransform)},o.detachFromParent=function(){for(var n,t=this._node._children,e=0,r=t.length;e<r;e++)(n=t[e])&&n._renderCmd&&n._renderCmd.detachFromParent()},o.setShaderProgram=function(n){},o.getShaderProgram=function(){return null},_ccsg.Node.CanvasRenderCmd._getCompositeOperationByBlendFunc=function(n){return n?n.src===cc.macro.SRC_ALPHA&&n.dst===cc.macro.ONE||n.src===cc.macro.ONE&&n.dst===cc.macro.ONE?"lighter":n.src===cc.macro.ZERO&&n.dst===cc.macro.SRC_ALPHA?"destination-in":n.src===cc.macro.ZERO&&n.dst===cc.macro.ONE_MINUS_SRC_ALPHA?"destination-out":"source-over":"source-over"}},{}],58:[function(T,N,z){_ccsg.Node.WebGLRenderCmd=function(s){this._ctor(s),this._shaderProgram=null};var o=_ccsg.Node.WebGLRenderCmd.prototype=Object.create(_ccsg.Node.RenderCmd.prototype);o.constructor=_ccsg.Node.WebGLRenderCmd,o._rootCtor=_ccsg.Node.WebGLRenderCmd,o._updateColor=function(){},o.setShaderProgram=function(s){this._shaderProgram=s},o.getShaderProgram=function(){return this._shaderProgram}},{}],59:[function(T,N,z){function o(m){return m instanceof cc.Scene?cc.visibleRect:!m._sizeProvider||m._sizeProvider instanceof _ccsg.Node?m._contentSize:m.getContentSize()}function s(m,v,_,p){for(var g=m._parent._scaleX,y=m._parent._scaleY,C=0,S=0,I=m._parent;;){var b=I._position;if(C+=b.x,S+=b.y,!(I=I._parent))return _.x=_.y=0,void(p.x=p.y=1);if(I===v)break;var A=I._scaleX,E=I._scaleY;C*=A,S*=E,g*=A,y*=E}p.x=g!==0?1/g:1,p.y=y!==0?1/y:1,_.x=-C,_.y=-S}function n(m,v){var _,p,g,y=v._target;y?s(m,_=y,p=h,g=u):_=m._parent;var C=o(_),S=_._anchorPoint,I=_ instanceof cc.Scene,b=m._position.x,A=m._position.y,E=m._anchorPoint;if(v._alignFlags&a){var R,O,P=C.width;I?(R=cc.visibleRect.left.x,O=cc.visibleRect.right.x):O=(R=-S.x*P)+P,R+=v._isAbsLeft?v._left:v._left*P,O-=v._isAbsRight?v._right:v._right*P,y&&(R+=p.x,R*=g.x,O+=p.x,O*=g.x);var x,w=E.x,L=m._scaleX;if(L<0&&(w=1-w,L=-L),v.isStretchWidth)x=O-R,L!==0&&(m.width=x/L),b=R+w*x;else if(x=m.width*L,v.isAlignHorizontalCenter){var D=v._isAbsHorizontalCenter?v._horizontalCenter:v._horizontalCenter*P,F=(.5-S.x)*C.width;y&&(D*=g.x,F+=p.x,F*=g.x),b=F+(w-.5)*x+D}else b=v.isAlignLeft?R+w*x:O+(w-1)*x}if(v._alignFlags&c){var M,B,W=C.height;I?(B=cc.visibleRect.bottom.y,M=cc.visibleRect.top.y):M=(B=-S.y*W)+W,B+=v._isAbsBottom?v._bottom:v._bottom*W,M-=v._isAbsTop?v._top:v._top*W,y&&(B+=p.y,B*=g.y,M+=p.y,M*=g.y);var V,U=E.y,k=m._scaleY;if(k<0&&(U=1-U,k=-k),v.isStretchHeight)V=M-B,k!==0&&(m.height=V/k),A=B+U*V;else if(V=m.height*k,v.isAlignVerticalCenter){var X=v._isAbsVerticalCenter?v._verticalCenter:v._verticalCenter*W,Y=(.5-S.y)*C.height;y&&(X*=g.y,Y+=p.y,Y*=g.y),A=Y+(U-.5)*V+X}else A=v.isAlignBottom?B+U*V:M+(U-1)*V}m.setPosition(b,A)}function t(m){var v=m._widget;v&&(n(m,v),v.isAlignOnce?v.enabled=!1:d.push(v));for(var _=m._children,p=0;p<_.length;p++){var g=_[p];g._active&&t(g)}}function e(){var m=cc.director.getScene();if(m){if(f.isAligning=!0,f._nodesOrderDirty)d.length=0,t(m),f._nodesOrderDirty=!1;else{var v,_=f._activeWidgetsIterator;for(_.i=0;_.i<d.length;++_.i)n((v=d[_.i]).node,v)}f.isAligning=!1}}function r(m){var v=m._parent;cc.Node.isNode(v)&&r(v);var _=m._widget||m.getComponent(cc.Widget);_&&n(m,_)}var a=56,c=7,h=cc.Vec2.ZERO,u=cc.Vec2.ONE,d=[],f=cc._widgetManager=N.exports={_AlignFlags:{TOP:1,MID:2,BOT:4,LEFT:8,CENTER:16,RIGHT:32},isAligning:!1,_nodesOrderDirty:!1,_activeWidgetsIterator:new cc.js.array.MutableForwardIterator(d),init:function(m){m.on(cc.Director.EVENT_BEFORE_VISIT,e)},add:function(m){m.node._widget=m,this._nodesOrderDirty=!0},remove:function(m){m.node._widget=null,this._activeWidgetsIterator.remove(m)},updateAlignment:r}},{}],60:[function(T,N,z){function o(g,y){for(var C=y.constructor._executionOrder,S=y.__instanceId,I=0,b=g.length-1,A=b>>>1;I<=b;A=I+b>>>1){var E=g[A],R=E.constructor._executionOrder;if(R>C)b=A-1;else if(R<C)I=A+1;else{var O=E.__instanceId;if(O>S)b=A-1;else{if(!(O<S))return A;I=A+1}}}return~I}function s(g,y){for(var C=g.array,S=g.i+1;S<C.length;){var I=C[S];I._enabled&&I.node._activeInHierarchy?++S:(g.removeAt(S),y&&(I._objFlags&=~y))}}function n(g,y){return g.constructor._executionOrder-y.constructor._executionOrder}function t(g,y){if(typeof g=="function")return y?function(S,I){var b=S.array;for(S.i=0;S.i<b.length;++S.i){var A=b[S.i];g(A,I)}}:function(S){var I=S.array;for(S.i=0;S.i<I.length;++S.i){var b=I[S.i];g(b)}};var C="var a=it.array;for(it.i=0;it.i<a.length;++it.i){var c=a[it.i];"+g+"}";return y?Function("it","dt",C):Function("it",C)}function e(){this.startInvoker=new v(t(u)),this.updateInvoker=new _(t(d,!0)),this.lateUpdateInvoker=new _(t(f,!0)),this.scheduleInNextFrame=[],this._updating=!1}T("./platform/CCClass");var r=T("./platform/CCObject").Flags,a=T("./platform/js").array,c=r.IsStartCalled,h=r.IsOnEnableCalled,u=(r.IsEditorOnEnableCalled,"c.start();c._objFlags|="+c),d="c.update(dt)",f="c.lateUpdate(dt)",m=cc.Class({__ctor__:function(g){var y=a.MutableForwardIterator;this._zero=new y([]),this._neg=new y([]),this._pos=new y([]),this._invoke=g},statics:{stableRemoveInactive:s},add:null,remove:null,invoke:null}),v=cc.Class({extends:m,add:function(g){var y=g.constructor._executionOrder;(y===0?this._zero:y<0?this._neg:this._pos).array.push(g)},remove:function(g){var y=g.constructor._executionOrder;(y===0?this._zero:y<0?this._neg:this._pos).fastRemove(g)},cancelInactive:function(g){s(this._zero,g),s(this._neg,g),s(this._pos,g)},invoke:function(){var g=this._neg;g.array.length>0&&(g.array.sort(n),this._invoke(g),g.array.length=0),this._invoke(this._zero),this._zero.array.length=0;var y=this._pos;y.array.length>0&&(y.array.sort(n),this._invoke(y),y.array.length=0)}}),_=cc.Class({extends:m,add:function(g){var y=g.constructor._executionOrder;if(y===0)this._zero.array.push(g);else{var C=y<0?this._neg.array:this._pos.array,S=o(C,g);S<0&&C.splice(~S,0,g)}},remove:function(g){var y=g.constructor._executionOrder;if(y===0)this._zero.fastRemove(g);else{var C=y<0?this._neg:this._pos,S=o(C.array,g);S>=0&&C.removeAt(S)}},invoke:function(g){this._neg.array.length>0&&this._invoke(this._neg,g),this._invoke(this._zero,g),this._pos.array.length>0&&this._invoke(this._pos,g)}}),p=cc.Class({ctor:e,unscheduleAll:e,statics:{LifeCycleInvoker:m,OneOffInvoker:v,createInvokeImpl:t,invokeOnEnable:function(g){var y=cc.director._compScheduler,C=g.array;for(g.i=0;g.i<C.length;++g.i){var S=C[g.i];S._enabled&&(S.onEnable(),!S.node._activeInHierarchy||y._onEnabled(S))}}},_onEnabled:function(g){cc.director.getScheduler().resumeTarget(g),g._objFlags|=h,this._updating?this.scheduleInNextFrame.push(g):this._scheduleImmediate(g)},_onDisabled:function(g){cc.director.getScheduler().pauseTarget(g),g._objFlags&=~h;var y=this.scheduleInNextFrame.indexOf(g);y>=0?a.fastRemoveAt(this.scheduleInNextFrame,y):(!g.start||g._objFlags&c||this.startInvoker.remove(g),g.update&&this.updateInvoker.remove(g),g.lateUpdate&&this.lateUpdateInvoker.remove(g))},enableComp:function(g,y){if(!(g._objFlags&h)){if(g.onEnable){if(y)return void y.add(g);if(g.onEnable(),!g.node._activeInHierarchy)return}this._onEnabled(g)}},disableComp:function(g){g._objFlags&h&&(g.onDisable&&g.onDisable(),this._onDisabled(g))},_scheduleImmediate:function(g){!g.start||g._objFlags&c||this.startInvoker.add(g),g.update&&this.updateInvoker.add(g),g.lateUpdate&&this.lateUpdateInvoker.add(g)},_deferredSchedule:function(){for(var g=this.scheduleInNextFrame,y=0,C=g.length;y<C;y++){var S=g[y];this._scheduleImmediate(S)}g.length=0},startPhase:function(){this._updating=!0,this.scheduleInNextFrame.length>0&&this._deferredSchedule(),this.startInvoker.invoke()},updatePhase:function(g){this.updateInvoker.invoke(g)},lateUpdatePhase:function(g){this.lateUpdateInvoker.invoke(g),this._updating=!1}});N.exports=p},{"./platform/CCClass":135,"./platform/CCObject":141,"./platform/js":156,"./utils/misc":185}],61:[function(T,N,z){function o(e,r){return e===r||e&&r&&(e.name===r.name||e._uuid===r._uuid)}var s=T("../../animation/animation-animator"),n=T("../../animation/animation-clip"),t=cc.Class({name:"cc.Animation",extends:T("./CCComponent"),mixins:[cc.EventTarget],editor:!1,ctor:function(){cc.EventTarget.call(this),this._animator=null,this._nameToState={},this._didInit=!1,this._currentClip=null},properties:{_defaultClip:{default:null,type:n},defaultClip:{type:n,get:function(){return this._defaultClip},set:function(e){},tooltip:!1},currentClip:{get:function(){return this._currentClip},set:function(e){this._currentClip=e},type:n,visible:!1},_clips:{default:[],type:[n],tooltip:!1,visible:!0},playOnLoad:{default:!1,tooltip:!1}},start:function(){if(this.playOnLoad&&this._defaultClip&&!(this._animator&&this._animator.isPlaying)){var e=this.getAnimationState(this._defaultClip.name);this._animator.playState(e)}},onEnable:function(){this._animator&&this._animator.resume()},onDisable:function(){this._animator&&this._animator.pause()},onDestroy:function(){this.stop()},getClips:function(){return this._clips},play:function(e,r){var a=this.playAdditive(e,r);return this._animator.stopStatesExcept(a),a},playAdditive:function(e,r){this._init();var a=this.getAnimationState(e||this._defaultClip&&this._defaultClip.name);if(a){this.enabled=!0;var c=this._animator;c.isPlaying&&a.isPlaying?a.isPaused?c.resumeState(a):(c.stopState(a),c.playState(a,r)):c.playState(a,r),this.currentClip=a.clip}return a},stop:function(e){if(this._didInit)if(e){var r=this._nameToState[e];r&&this._animator.stopState(r)}else this._animator.stop()},pause:function(e){if(this._didInit)if(e){var r=this._nameToState[e];r&&this._animator.pauseState(r)}else this.enabled=!1},resume:function(e){if(this._didInit)if(e){var r=this._nameToState[e];r&&this._animator.resumeState(r)}else this.enabled=!0},setCurrentTime:function(e,r){if(this._init(),r){var a=this._nameToState[r];a&&this._animator.setStateTime(a,e)}else this._animator.setStateTime(e)},getAnimationState:function(e){this._init();var r=this._nameToState[e];return r&&!r.curveLoaded&&this._animator._reloadClip(r),r||null},addClip:function(e,r){if(e){this._init(),cc.js.array.contains(this._clips,e)||this._clips.push(e),r=r||e.name;var a=this._nameToState[r];if(a){if(a.clip===e)return a;var c=this._clips.indexOf(a.clip);c!==-1&&this._clips.splice(c,1)}var h=new cc.AnimationState(e,r);return this._nameToState[r]=h,h}cc.warnID(3900)},removeClip:function(e,r){if(e){this._init();var a;for(var c in this._nameToState)if((a=this._nameToState[c]).clip===e)break;if(e===this._defaultClip){if(!r)return void cc.warnID(3902);this._defaultClip=null}if(a&&a.isPlaying){if(!r)return void cc.warnID(3903);this.stop(a.name)}this._clips=this._clips.filter(function(h){return h!==e}),a&&delete this._nameToState[a.name]}else cc.warnID(3901)},sample:function(e){if(this._init(),e){var r=this._nameToState[e];r&&r.sample()}else this._animator.sample()},on:function(e,r,a,c){this._init();for(var h=cc.EventTarget.prototype.on.call(this,e,r,a,c),u=this._animator._anims.array,d=0;d<u.length;++d)u[d]._setListeners(this);return h},off:function(e,r,a,c){this._init(),cc.EventTarget.prototype.off.call(this,e,r,a,c);var h=this._nameToState;for(var u in h)h[u]._setListeners(null)},_init:function(){this._didInit||(this._didInit=!0,this._animator=new s(this.node,this),this._createStates())},_createStates:function(){this._nameToState={};for(var e=null,r=!1,a=0;a<this._clips.length;++a){var c=this._clips[a];c&&(e=new cc.AnimationState(c),this._nameToState[e.name]=e,o(this._defaultClip,c)&&(r=e))}this._defaultClip&&!r&&(e=new cc.AnimationState(this._defaultClip),this._nameToState[e.name]=e)}});cc.Animation=N.exports=t},{"../../animation/animation-animator":11,"../../animation/animation-clip":12,"./CCComponent":66}],62:[function(T,N,z){var o=cc.Class({name:"cc.AudioSource",extends:T("./CCComponent"),editor:!1,ctor:function(){this.audio=new cc.Audio},properties:{_clip:{default:"",url:cc.AudioClip},_volume:1,_mute:!1,_loop:!1,_pausedFlag:{default:!1,serializable:!1},isPlaying:{get:function(){return this.audio?this.audio.getState()===cc.Audio.State.PLAYING:!1},visible:!1},clip:{get:function(){return this._clip},set:function(s){s!==this._clip&&(this._clip=s,this.audio.stop(),this.audio.src=this._clip,this.audio.preload&&this.audio.preload())},url:cc.AudioClip,tooltip:!1,animatable:!1},volume:{get:function(){return this._volume},set:function(s){s=cc.clamp01(s),this._volume=s;var n=this.audio;return n&&!this._mute&&(n.setVolume(s),n._loaded||n.on("load",function(){n.setVolume(s)})),s},tooltip:!1},mute:{get:function(){return this._mute},set:function(s){return this._mute=s,this.audio&&this.audio.setVolume(s?0:this._volume),s},animatable:!1,tooltip:!1},loop:{get:function(){return this._loop},set:function(s){return this._loop=s,this.audio&&this.audio.setLoop(s),s},animatable:!1,tooltip:!1},playOnLoad:{default:!1,tooltip:!1,animatable:!1},preload:{default:!1,animatable:!1}},_pausedCallback:function(){var s=this.audio;s&&!s.paused&&(this.audio.pause(),this._pausedFlag=!0)},_restoreCallback:function(){this.audio&&(this._pausedFlag&&this.audio.resume(),this._pausedFlag=!1)},onEnable:function(){this.playOnLoad?this.play():this.preload&&(this.audio.src=this._clip,this.audio.preload()),cc.game.on(cc.game.EVENT_HIDE,this._pausedCallback,this),cc.game.on(cc.game.EVENT_SHOW,this._restoreCallback,this)},onDisable:function(){this.stop(),cc.game.off(cc.game.EVENT_HIDE,this._pausedCallback,this),cc.game.off(cc.game.EVENT_SHOW,this._restoreCallback,this)},onDestroy:function(){this.stop(),this.audio.destroy(),cc.audioEngine.uncache(this._clip)},play:function(){if(this._clip){var s=this._mute?0:this._volume,n=this.audio,t=this._loop;if(n._loaded)return n.stop(),n.setCurrentTime(0),void n.play();n.src=this._clip,n.once("load",function(){n.setLoop(t),n.setVolume(s),n.play()}),n.preload()}},stop:function(){this.audio&&this.audio.stop()},pause:function(){this.audio&&this.audio.pause()},resume:function(){this.audio&&this.audio.resume()},rewind:function(){this.audio&&this.audio.setCurrentTime(0)},getCurrentTime:function(){var s=0;return this.audio&&(s=this.audio.getCurrentTime()),s},setCurrentTime:function(s){var n=this.audio;return n?n._loaded?(n.setCurrentTime(s),s):(n.once("load",function(){n.setCurrentTime(s)}),s):s},getDuration:function(){var s=0;return this.audio&&(s=this.audio.getDuration()),s}});cc.AudioSource=N.exports=o},{"./CCComponent":66}],63:[function(T,N,z){function o(t){t.stopPropagation()}var s=["touchstart","touchmove","touchend","mousedown","mousemove","mouseup","mouseenter","mouseleave","mousewheel"],n=cc.Class({name:"cc.BlockInputEvents",extends:T("./CCComponent"),editor:{menu:"i18n:MAIN_MENU.component.ui/Block Input Events",inspector:"packages://inspector/inspectors/comps/block-input-events.js",help:"i18n:COMPONENT.help_url.block-input-events"},onEnable:function(){for(var t=0;t<s.length;t++)this.node.on(s[t],o,this)},onDisable:function(){for(var t=0;t<s.length;t++)this.node.off(s[t],o,this)}});cc.BlockInputEvents=N.exports=n},{"./CCComponent":66}],64:[function(T,N,z){var o=cc.Enum({NONE:0,COLOR:1,SPRITE:2,SCALE:3}),s=cc.Class({name:"cc.Button",extends:T("./CCComponent"),ctor:function(){this._resetState(),this._fromColor=null,this._toColor=null,this._time=0,this._transitionFinished=!0,this._fromScale=1,this._toScale=1,this._originalScale=1,this._sprite=null},_resetState:function(){this._pressed=!1,this._hovered=!1},editor:!1,properties:{interactable:{default:!0,tooltip:!1,notify:function(n){this._updateState(),this.interactable||this._resetState()},animatable:!1},_resizeToTarget:{animatable:!1,set:function(n){n&&this._resizeNodeToTargetNode()}},enableAutoGrayEffect:{default:!1,tooltip:!1,notify:function(){this._updateDisabledState()}},transition:{default:o.NONE,tooltip:!1,type:o,animatable:!1},normalColor:{default:cc.color(214,214,214),displayName:"Normal",tooltip:!1,notify:function(){this._updateState()}},pressedColor:{default:cc.color(211,211,211),displayName:"Pressed",tooltip:!1},hoverColor:{default:cc.Color.WHITE,displayName:"Hover",tooltip:!1},disabledColor:{default:cc.color(124,124,124),displayName:"Disabled",tooltip:!1,notify:function(){this._updateState()}},duration:{default:.1,range:[0,10],tooltip:!1},zoomScale:{default:1.2,tooltip:!1},normalSprite:{default:null,type:cc.SpriteFrame,displayName:"Normal",tooltip:!1,notify:function(){this._updateState()}},pressedSprite:{default:null,type:cc.SpriteFrame,displayName:"Pressed",tooltip:!1,formerlySerializedAs:"pressedSprite",notify:function(){this._updateState()}},hoverSprite:{default:null,type:cc.SpriteFrame,displayName:"Hover",tooltip:!1,formerlySerializedAs:"hoverSprite",notify:function(){this._updateState()}},disabledSprite:{default:null,type:cc.SpriteFrame,displayName:"Disabled",tooltip:!1,notify:function(){this._updateState()}},target:{default:null,type:cc.Node,tooltip:!1,notify:function(){this._applyTarget()}},clickEvents:{default:[],type:cc.Component.EventHandler,tooltip:!1}},statics:{Transition:o},__preload:function(){this.target||(this.target=this.node),this._applyTarget(),this._updateState()},onEnable:function(){this.normalSprite&&this.normalSprite.ensureLoadTexture(),this.hoverSprite&&this.hoverSprite.ensureLoadTexture(),this.pressedSprite&&this.pressedSprite.ensureLoadTexture(),this.disabledSprite&&this.disabledSprite.ensureLoadTexture(),this._registerEvent()},update:function(n){var t=this.target;if(!this._transitionFinished&&(this.transition===o.COLOR||this.transition===o.SCALE)){this.time+=n;var e=1;this.duration>0&&(e=this.time/this.duration),e>=1&&(e=1,this._transitionFinished=!0),this.transition===o.COLOR?t.color=this._fromColor.lerp(this._toColor,e):this.transition===o.SCALE&&(t.scale=cc.lerp(this._fromScale,this._toScale,e))}},_registerEvent:function(){this.node.on(cc.Node.EventType.TOUCH_START,this._onTouchBegan,this),this.node.on(cc.Node.EventType.TOUCH_MOVE,this._onTouchMove,this),this.node.on(cc.Node.EventType.TOUCH_END,this._onTouchEnded,this),this.node.on(cc.Node.EventType.TOUCH_CANCEL,this._onTouchCancel,this),this.node.on(cc.Node.EventType.MOUSE_ENTER,this._onMouseMoveIn,this),this.node.on(cc.Node.EventType.MOUSE_LEAVE,this._onMouseMoveOut,this)},_getTargetSprite:function(n){var t=null;return n&&(t=n.getComponent(cc.Sprite)),t},_applyTarget:function(){this._sprite=this._getTargetSprite(this.target),this.target&&(this._originalScale=this.target.scale)},_onTouchBegan:function(n){this.interactable&&this.enabledInHierarchy&&(this._pressed=!0,this._updateState(),n.stopPropagation())},_onTouchMove:function(n){if(this.interactable&&this.enabledInHierarchy&&this._pressed){var t=n.touch,e=this.node._hitTest(t.getLocation());if(this.transition===o.SCALE&&this.target)e?(this._fromScale=this._originalScale,this._toScale=this._originalScale*this.zoomScale,this._transitionFinished=!1):(this.time=0,this._transitionFinished=!0,this.target.scale=this._originalScale);else{var r;r=e?"pressed":"normal",this._applyTransition(r)}n.stopPropagation()}},_onTouchEnded:function(n){this.interactable&&this.enabledInHierarchy&&(this._pressed&&(cc.Component.EventHandler.emitEvents(this.clickEvents,n),this.node.emit("click",this)),this._pressed=!1,this._updateState(),n.stopPropagation())},_zoomUp:function(){this._fromScale=this._originalScale,this._toScale=this._originalScale*this.zoomScale,this.time=0,this._transitionFinished=!1},_zoomBack:function(){this._fromScale=this.target.scale,this._toScale=this._originalScale,this.time=0,this._transitionFinished=!1},_onTouchCancel:function(){this.interactable&&this.enabledInHierarchy&&(this._pressed=!1,this._updateState())},_onMouseMoveIn:function(){!this._pressed&&this.interactable&&this.enabledInHierarchy&&(this.transition!==o.SPRITE||this.hoverSprite)&&(this._hovered||(this._hovered=!0,this._updateState()))},_onMouseMoveOut:function(){this._hovered&&(this._hovered=!1,this._updateState())},_updateState:function(){var n=this._getButtonState();this._applyTransition(n),this._updateDisabledState()},onDisable:function(){this._hovered=!1,this._pressed=!1,this.node.off(cc.Node.EventType.TOUCH_START,this._onTouchBegan,this),this.node.off(cc.Node.EventType.TOUCH_MOVE,this._onTouchMove,this),this.node.off(cc.Node.EventType.TOUCH_END,this._onTouchEnded,this),this.node.off(cc.Node.EventType.TOUCH_CANCEL,this._onTouchCancel,this),this.node.off(cc.Node.EventType.MOUSE_ENTER,this._onMouseMoveIn,this),this.node.off(cc.Node.EventType.MOUSE_LEAVE,this._onMouseMoveOut,this)},_getButtonState:function(){return this.interactable?this._pressed?"pressed":this._hovered?"hover":"normal":"disabled"},_updateColorTransition:function(n){var t=this[n+"Color"],e=this.target;this._fromColor=e.color.clone(),this._toColor=t,this.time=0,this._transitionFinished=!1},_updateSpriteTransition:function(n){var t=this[n+"Sprite"];this._sprite&&t&&(this._sprite.spriteFrame=t)},_updateScaleTransition:function(n){n==="pressed"?this._zoomUp():this._zoomBack()},_applyTransition:function(n){var t=this.transition;t===o.COLOR?this._updateColorTransition(n):t===o.SPRITE?this._updateSpriteTransition(n):t===o.SCALE&&this._updateScaleTransition(n)},_resizeNodeToTargetNode:!1,_updateDisabledState:function(){this._sprite&&this._sprite._sgNode.setState(0),this.enableAutoGrayEffect&&this.transition!==o.COLOR&&(this.transition===o.SPRITE&&this.disabledSprite||this._sprite&&!this.interactable&&this._sprite._sgNode.setState(1))}});cc.Button=N.exports=s},{"./CCComponent":66}],65:[function(T,N,z){var o=T("../event-manager"),s={getContentSize:function(){return cc.visibleRect},setContentSize:function(t){},_getWidth:function(){return this.getContentSize().width},_getHeight:function(){return this.getContentSize().height}},n=cc.Class({name:"cc.Canvas",extends:T("./CCComponent"),editor:!1,resetInEditor:!1,statics:{instance:null},properties:{_designResolution:cc.size(960,640),designResolution:{get:function(){return cc.size(this._designResolution)},set:function(t){this._designResolution.width=t.width,this._designResolution.height=t.height,this.applySettings()},tooltip:!1},_fitWidth:!1,_fitHeight:!0,fitHeight:{get:function(){return this._fitHeight},set:function(t){this._fitHeight!==t&&(this._fitHeight=t,this.applySettings())},tooltip:!1},fitWidth:{get:function(){return this._fitWidth},set:function(t){this._fitWidth!==t&&(this._fitWidth=t,this.applySettings())},tooltip:!1}},ctor:function(){this._thisOnResized=this.onResized.bind(this)},__preload:function(){if(n.instance)return cc.errorID(6700,this.node.name,n.instance.node.name);n.instance=this,this.node._sizeProvider||(this.node._sizeProvider=s),cc.director.on(cc.Director.EVENT_BEFORE_VISIT,this.alignWithScreen,this),cc.sys.isMobile?window.addEventListener("resize",this._thisOnResized):o.addCustomListener("canvas-resize",this._thisOnResized),this.applySettings(),this.onResized()},onDestroy:function(){this.node._sizeProvider===s&&(this.node._sizeProvider=null),cc.director.off(cc.Director.EVENT_BEFORE_VISIT,this.alignWithScreen,this),cc.sys.isMobile?window.removeEventListener("resize",this._thisOnResized):o.removeCustomListeners("canvas-resize",this._thisOnResized),n.instance===this&&(n.instance=null)},alignWithScreen:function(){var t,e=cc.visibleRect,r=0,a=0;!this.fitHeight&&!this.fitWidth&&(r=.5*((t=cc.view.getDesignResolutionSize()).width-e.width),a=.5*(t.height-e.height)),this.node.setPosition(.5*e.width+r,.5*e.height+a)},onResized:function(){this.alignWithScreen()},applySettings:function(){var t,e=cc.ResolutionPolicy;t=this.fitHeight&&this.fitWidth?e.SHOW_ALL:this.fitHeight||this.fitWidth?this.fitWidth?e.FIXED_WIDTH:e.FIXED_HEIGHT:e.NO_BORDER;var r=this._designResolution;cc.view.setDesignResolutionSize(r.width,r.height,t)}});cc.Canvas=N.exports=n},{"../event-manager":95,"./CCComponent":66}],66:[function(T,N,z){var o=T("../platform/CCObject"),s=T("../platform/js"),n=new(T("../platform/id-generater"))("Comp"),t=o.Flags.IsOnEnableCalled,e=o.Flags.IsOnLoadCalled,r=cc.Class({name:"cc.Component",extends:o,ctor:function(){this.__instanceId=cc.ClassManager.getNewInstanceId(),this.__eventTargets=[]},properties:{node:{default:null,visible:!1},name:{get:function(){if(this._name)return this._name;var a=cc.js.getClassName(this),c=a.lastIndexOf(".");return c>=0&&(a=a.slice(c+1)),this.node.name+"<"+a+">"},set:function(a){this._name=a},visible:!1},_id:{default:"",serializable:!1},uuid:{get:function(){var a=this._id;return a||(a=this._id=n.getNewId()),a},visible:!1},__scriptAsset:!1,_enabled:!0,enabled:{get:function(){return this._enabled},set:function(a){if(this._enabled!==a&&(this._enabled=a,this.node._activeInHierarchy)){var c=cc.director._compScheduler;a?c.enableComp(this):c.disableComp(this)}},visible:!1},enabledInHierarchy:{get:function(){return(this._objFlags&t)>0},visible:!1},_isOnLoadCalled:{get:function(){return this._objFlags&e}}},update:null,lateUpdate:null,__preload:null,onLoad:null,start:null,onEnable:null,onDisable:null,onDestroy:null,onFocusInEditor:null,onLostFocusInEditor:null,resetInEditor:null,addComponent:function(a){return this.node.addComponent(a)},getComponent:function(a){return this.node.getComponent(a)},getComponents:function(a){return this.node.getComponents(a)},getComponentInChildren:function(a){return this.node.getComponentInChildren(a)},getComponentsInChildren:function(a){return this.node.getComponentsInChildren(a)},_getLocalBounds:null,onRestore:null,destroy:function(){this._super()&&this._enabled&&this.node._activeInHierarchy&&cc.director._compScheduler.disableComp(this)},_onPreDestroy:function(){this.unscheduleAllCallbacks();for(var a=this.__eventTargets,c=0,h=a.length;c<h;++c){var u=a[c];u&&u.targetOff(this)}a.length=0,cc.director._nodeActivator.destroyComp(this),this.node._removeComponent(this)},_instantiate:function(a){return a||(a=cc.instantiate._clone(this,this)),a.node=null,a},isRunning:function(){return this.enabledInHierarchy},schedule:function(a,c,h,u){cc.assertID(a,1619),cc.assertID(c>=0,1620),c=c||0,h=Number.isNaN(h)?cc.macro.REPEAT_FOREVER:h,u=u||0;var d=cc.director.getScheduler(),f=d.isTargetPaused(this);d.schedule(a,this,c,h,u,f)},scheduleOnce:function(a,c){this.schedule(a,0,0,c)},unschedule:function(a){a&&cc.director.getScheduler().unschedule(a,this)},unscheduleAllCallbacks:function(){cc.director.getScheduler().unscheduleAllForTarget(this)}});r._requireComponent=null,r._executionOrder=0,s.value(r,"_registerEditorProps",function(a,c){var h=c.requireComponent;h&&(a._requireComponent=h);var u=c.executionOrder;u&&typeof u=="number"&&(a._executionOrder=u)}),r.prototype.__scriptUuid="",cc.Component=N.exports=r},{"../platform/CCObject":141,"../platform/id-generater":152,"../platform/js":156}],67:[function(T,N,z){cc.Component.EventHandler=cc.Class({name:"cc.ClickEvent",properties:{target:{default:null,type:cc.Node},component:{default:""},handler:{default:""},customEventData:{default:""}},statics:{emitEvents:function(o){"use strict";var s,n,t;if(arguments.length>0)for(n=0,t=(s=new Array(arguments.length-1)).length;n<t;n++)s[n]=arguments[n+1];for(n=0,t=o.length;n<t;n++){var e=o[n];e instanceof cc.Component.EventHandler&&e.emit(s)}}},emit:function(o){var s=this.target;if(cc.isValid(s)){var n=s.getComponent(this.component);if(cc.isValid(n)){var t=n[this.handler];typeof t=="function"&&(this.customEventData!=null&&this.customEventData!==""&&(o=o.slice()).push(this.customEventData),t.apply(n,o))}}}})},{}],68:[function(T,N,z){T("../editbox/CCSGEditBox");var o=_ccsg.EditBox.KeyboardReturnType,s=_ccsg.EditBox.InputMode,n=_ccsg.EditBox.InputFlag,t=cc.Class({name:"cc.EditBox",extends:cc._RendererUnderSG,editor:!1,properties:{_useOriginalSize:!0,_string:"",string:{tooltip:!1,get:function(){return this._sgNode.string},set:function(e){this._sgNode.string=this._string=e}},backgroundImage:{tooltip:!1,default:null,type:cc.SpriteFrame,notify:function(){var e=this._sgNode,r=e.getBackgroundSprite();this.backgroundImage?this._createBackgroundSprite().setContentSize(e.getContentSize()):r.removeFromParent()}},returnType:{default:o.DEFAULT,tooltip:!1,displayName:"KeyboardReturnType",type:o,notify:function(){this._sgNode.returnType=this.returnType}},inputFlag:{tooltip:!1,default:n.DEFAULT,type:n,notify:function(){this._sgNode.inputFlag=this.inputFlag}},inputMode:{tooltip:!1,default:s.ANY,type:s,notify:function(){this._sgNode.inputMode=this.inputMode}},fontSize:{tooltip:!1,default:20,notify:function(){this._sgNode.fontSize=this.fontSize}},lineHeight:{tooltip:!1,default:40,notify:function(){this._sgNode.setLineHeight(this.lineHeight)}},fontColor:{tooltip:!1,default:cc.Color.WHITE,notify:function(){this._sgNode.fontColor=this.fontColor}},placeholder:{tooltip:!1,default:"Enter text here...",notify:function(){this._sgNode.placeholder=this.placeholder}},placeholderFontSize:{tooltip:!1,default:20,notify:function(){this._sgNode.placeholderFontSize=this.placeholderFontSize}},placeholderFontColor:{tooltip:!1,default:cc.Color.GRAY,notify:function(){this._sgNode.placeholderFontColor=this.placeholderFontColor}},maxLength:{tooltip:!1,default:20,notify:function(){this._sgNode.maxLength=this.maxLength}},stayOnTop:{tooltip:!1,default:!1,notify:function(){this._sgNode.stayOnTop(this.stayOnTop),this._sgNode.fontSize=this.fontSize,this._sgNode.fontColor=this.fontColor}},_tabIndex:0,tabIndex:{tooltip:!1,get:function(){return this._tabIndex},set:function(e){this._tabIndex=e,this._sgNode.setTabIndex(e)}},editingDidBegan:{default:[],type:cc.Component.EventHandler},textChanged:{default:[],type:cc.Component.EventHandler},editingDidEnded:{default:[],type:cc.Component.EventHandler},editingReturn:{default:[],type:cc.Component.EventHandler}},statics:{KeyboardReturnType:o,InputFlag:n,InputMode:s},_applyCapInset:function(e){var r=this.backgroundImage;e.setInsetTop(r.insetTop),e.setInsetBottom(r.insetBottom),e.setInsetRight(r.insetRight),e.setInsetLeft(r.insetLeft)},_createSgNode:function(){return new _ccsg.EditBox(cc.size(160,40))},_createBackgroundSprite:function(){var e=this._sgNode,r=new cc.Scale9Sprite;return r.setRenderingType(cc.Scale9Sprite.RenderingType.SLICED),this.backgroundImage&&(this.backgroundImage.ensureLoadTexture(),r.setSpriteFrame(this.backgroundImage),this._applyCapInset(r)),e.initWithSizeAndBackgroundSprite(cc.size(160,40),r),r},_initSgNode:function(){var e=this._sgNode;e.createDomElementIfNeeded(),this._createBackgroundSprite(),e.setContentSize(this.node.getContentSize()),e.inputMode=this.inputMode,e.maxLength=this.maxLength,e.string=this._string,e.fontSize=this.fontSize,e.fontColor=this.fontColor,e.placeholder=this.placeholder,e.placeholderFontSize=this.placeholderFontSize,e.placeholderFontColor=this.placeholderFontColor,e.inputFlag=this.inputFlag,e.returnType=this.returnType,e.setLineHeight(this.lineHeight),e.stayOnTop(this.stayOnTop),e.setTabIndex(this.tabIndex),e.setDelegate(this)},editBoxEditingDidBegan:function(){cc.Component.EventHandler.emitEvents(this.editingDidBegan,this),this.node.emit("editing-did-began",this)},editBoxEditingDidEnded:function(){cc.Component.EventHandler.emitEvents(this.editingDidEnded,this),this.node.emit("editing-did-ended",this)},editBoxTextChanged:function(e,r){cc.Component.EventHandler.emitEvents(this.textChanged,r,this),this.node.emit("text-changed",this)},editBoxEditingReturn:function(){cc.Component.EventHandler.emitEvents(this.editingReturn,this),this.node.emit("editing-return",this)},onDestroy:function(){this._sgNode.setDelegate(null),this._super()},__preload:function(){this._super(),this._registerEvent()},_registerEvent:function(){this.node.on(cc.Node.EventType.TOUCH_START,this._onTouchBegan,this),this.node.on(cc.Node.EventType.TOUCH_END,this._onTouchEnded,this)},_onTouchBegan:function(e){this._sgNode&&this._sgNode._onTouchBegan(e.touch),e.stopPropagation()},_onTouchEnded:function(e){this._sgNode&&this._sgNode._onTouchEnded(),e.stopPropagation()},setFocus:function(){this._sgNode&&this._sgNode.setFocus()},isFocused:function(){var e=!1;return this._sgNode&&(e=this._sgNode.isFocused()),e}});cc.EditBox=N.exports=t},{"../editbox/CCSGEditBox":90}],69:[function(T,N,z){T("../label/CCSGLabel"),T("../label/CCSGLabelCanvasRenderCmd"),T("../label/CCSGLabelWebGLRenderCmd");var o=cc.TextAlignment,s=cc.VerticalTextAlignment,n=_ccsg.Label.Overflow,t=cc.Class({name:"cc.Label",extends:cc._RendererUnderSG,ctor:function(){},editor:!1,_updateSgNodeString:function(){this._sgNode.setString(this.string),this._updateNodeSize()},_updateSgNodeFontSize:function(){this._sgNode&&(this._sgNode.setFontSize(this._fontSize),this._updateNodeSize())},properties:{_useOriginalSize:!0,string:{default:"Label",multiline:!0,tooltip:!1,notify:function(){this._sgNode&&this._updateSgNodeString()}},horizontalAlign:{default:o.LEFT,type:o,tooltip:!1,notify:function(){this._sgNode&&this._sgNode.setHorizontalAlign(this.horizontalAlign)},animatable:!1},verticalAlign:{default:s.TOP,type:s,tooltip:!1,notify:function(){this._sgNode&&this._sgNode.setVerticalAlign(this.verticalAlign)},animatable:!1},_actualFontSize:{default:40},actualFontSize:{displayName:"Actual Font Size",animatable:!1,readonly:!0,get:function(){return this._sgNode&&(this._actualFontSize=this._sgNode.getFontSize()),this._actualFontSize}},_fontSize:40,fontSize:{get:function(){return this._fontSize},set:function(e){this._fontSize=e,this._updateSgNodeFontSize()},tooltip:!1},fontFamily:{default:"Arial",tooltip:!1,notify:function(){this._sgNode&&this._sgNode.setFontFamily(this.fontFamily)},animatable:!1},_lineHeight:40,lineHeight:{get:function(){return this._sgNode&&(this._lineHeight=this._sgNode.getLineHeight()),this._lineHeight},set:function(e){this._lineHeight=e,this._sgNode&&(this._sgNode.setLineHeight(e),this._updateNodeSize())},tooltip:!1},overflow:{default:n.NONE,type:n,tooltip:!1,notify:function(){this._sgNode&&(this._sgNode.setOverflow(this.overflow),this._updateNodeSize())},animatable:!1},_enableWrapText:!0,enableWrapText:{get:function(){return this._sgNode&&(this._enableWrapText=this._sgNode.isWrapTextEnabled()),this._enableWrapText},set:function(e){this._enableWrapText=e,this._sgNode&&this._sgNode.enableWrapText(e)},animatable:!1,tooltip:!1},_N$file:null,font:{get:function(){return this._N$file},set:function(e){if(e||(this._isSystemFontUsed=!0),this._N$file=e,this._bmFontOriginalSize=-1,e&&this._isSystemFontUsed&&(this._isSystemFontUsed=!1),this._sgNode){typeof e=="string"&&cc.warnID(4e3);var r=this.font;r instanceof cc.BitmapFont?r.spriteFrame?this._sgNode.setFontAsset(r):(cc.warnID(4011,r.name),this._sgNode.setFontFamily("")):this._sgNode.setFontAsset(r)}e instanceof cc.BitmapFont&&(this._bmFontOriginalSize=e.fontSize)},type:cc.Font,tooltip:!1,animatable:!1},_isSystemFontUsed:!0,useSystemFont:{get:function(){return this._isSystemFontUsed},set:function(e){this._isSystemFontUsed=!!e,e&&(this.font=null,this._sgNode&&this._sgNode.setFontFamily(this.fontFamily))},animatable:!1,tooltip:!1},_bmFontOriginalSize:{displayName:"BMFont Original Size",default:-1,serializable:!1,readonly:!0,visible:!0,animatable:!1},_spacingX:0,spacingX:{get:function(){return this._spacingX},set:function(e){this._spacingX=e,this._sgNode&&(this._sgNode.setSpacingX(this.spacingX),this._updateNodeSize())}}},statics:{HorizontalAlign:o,VerticalAlign:s,Overflow:n},__preload:function(){this._super(),this._sgNode.on("load",this._updateNodeSize,this),this._updateNodeSize()},_createSgNode:function(){return null},_initSgNode:function(){var e=this.font;typeof e=="string"&&cc.warnID(4e3);var r;e instanceof cc.BitmapFont?e.spriteFrame?r=this._sgNode=_ccsg.Label.pool.get(this.string,e):(cc.warnID(4011,e.name),r=this._sgNode=_ccsg.Label.pool.get(this.string)):r=this._sgNode=_ccsg.Label.pool.get(this.string,e,null,this._fontSize),e instanceof cc.BitmapFont&&(this._bmFontOriginalSize=e.fontSize),r.setVisible(!1),r.setHorizontalAlign(this.horizontalAlign),r.setVerticalAlign(this.verticalAlign),r.setFontSize(this._fontSize),this.useSystemFont&&r.setFontFamily(this.fontFamily),r.setOverflow(this.overflow),r.enableWrapText(this._enableWrapText),r.setLineHeight(this._lineHeight),r.setString(this.string),e instanceof cc.BitmapFont&&r.setSpacingX(this.spacingX),r.setContentSize(this.node.getContentSize()),r.setColor(this.node.color)},_updateNodeSize:function(){this._sgNode&&this._sgNode.parent&&(this.overflow!==n.NONE&&this.overflow!==n.RESIZE_HEIGHT||this.node.setContentSize(this._sgNode.getContentSize()))},onDestroy:function(){var e=this._sgNode;this._super(),e&&(e.removeFromParent(!0),_ccsg.Label.pool.put(e))}});cc.Label=N.exports=t},{"../label/CCSGLabel":111,"../label/CCSGLabelCanvasRenderCmd":112,"../label/CCSGLabelWebGLRenderCmd":113}],70:[function(T,N,z){var o=cc.Class({name:"cc.LabelOutline",extends:T("./CCComponent"),editor:!1,ctor:function(){this._labelSGNode=null},properties:{_color:cc.color(255,255,255,255),_width:1,color:{get:function(){return this._color},set:function(s){this._color=cc.color(s),this._labelSGNode&&this._labelSGNode.setOutlineColor(cc.color(this._color))}},width:{get:function(){return this._width},set:function(s){this._width=s,this._labelSGNode&&(this._labelSGNode.setOutlineWidth(s),this._labelSGNode.setMargin(s))}}},onEnable:function(){var s=this.node.getComponent("cc.Label"),n=this._labelSGNode=s&&s._sgNode;this._labelSGNode&&(n.setOutlined(!0),n.setOutlineColor(cc.color(this._color)),n.setOutlineWidth(this._width),n.setMargin(this._width))},onDisable:function(){this._labelSGNode&&(this._labelSGNode.setOutlined(!1),this._labelSGNode.setMargin(0)),this._labelSGNode=null}});cc.LabelOutline=N.exports=o},{"./CCComponent":66}],71:[function(T,N,z){var o=cc.Enum({NONE:0,HORIZONTAL:1,VERTICAL:2,GRID:3}),s=cc.Enum({NONE:0,CONTAINER:1,CHILDREN:2}),n=cc.Enum({HORIZONTAL:0,VERTICAL:1}),t=cc.Enum({BOTTOM_TO_TOP:0,TOP_TO_BOTTOM:1}),e=cc.Enum({LEFT_TO_RIGHT:0,RIGHT_TO_LEFT:1}),r=cc.Class({name:"cc.Layout",extends:T("./CCComponent"),editor:!1,properties:{_layoutSize:cc.size(300,200),_layoutDirty:{default:!0,serializable:!1},_resize:s.NONE,_N$layoutType:o.NONE,type:{type:o,get:function(){return this._N$layoutType},set:function(a){this._N$layoutType=a,this._doLayoutDirty()},tooltip:!1,animatable:!1},resizeMode:{type:s,tooltip:!1,animatable:!1,get:function(){return this._resize},set:function(a){(this.type!==o.NONE||a!==s.CHILDREN)&&(this._resize=a,this._doLayoutDirty())}},cellSize:{default:cc.size(40,40),tooltip:!1,type:cc.Size,notify:function(){this._doLayoutDirty()}},startAxis:{default:n.HORIZONTAL,tooltip:!1,type:n,notify:function(){this._doLayoutDirty()},animatable:!1},_N$padding:{default:0},paddingLeft:{default:0,tooltip:!1,notify:function(){this._doLayoutDirty()}},paddingRight:{default:0,tooltip:!1,notify:function(){this._doLayoutDirty()}},paddingTop:{default:0,tooltip:!1,notify:function(){this._doLayoutDirty()}},paddingBottom:{default:0,tooltip:!1,notify:function(){this._doLayoutDirty()}},spacingX:{default:0,notify:function(){this._doLayoutDirty()},tooltip:!1},spacingY:{default:0,notify:function(){this._doLayoutDirty()},tooltip:!1},verticalDirection:{default:t.TOP_TO_BOTTOM,type:t,notify:function(){this._doLayoutDirty()},tooltip:!1,animatable:!1},horizontalDirection:{default:e.LEFT_TO_RIGHT,type:e,notify:function(){this._doLayoutDirty()},tooltip:!1,animatable:!1}},statics:{Type:o,VerticalDirection:t,HorizontalDirection:e,ResizeMode:s,AxisDirection:n},_migratePaddingData:function(){this.paddingLeft=this._N$padding,this.paddingRight=this._N$padding,this.paddingTop=this._N$padding,this.paddingBottom=this._N$padding,this._N$padding=0},onEnable:function(){this._addEventListeners(),cc.sizeEqualToSize(this.node.getContentSize(),cc.size(0,0))&&this.node.setContentSize(this._layoutSize),this._N$padding!==0&&this._migratePaddingData(),this._doLayoutDirty()},onDisable:function(){this._removeEventListeners()},_doLayoutDirty:function(){this._layoutDirty=!0},_addEventListeners:function(){cc.director.on(cc.Director.EVENT_BEFORE_VISIT,this.updateLayout,this),this.node.on("size-changed",this._resized,this),this.node.on("anchor-changed",this._doLayoutDirty,this),this.node.on("child-added",this._childAdded,this),this.node.on("child-removed",this._childRemoved,this),this.node.on("child-reorder",this._doLayoutDirty,this),this._addChildrenEventListeners()},_removeEventListeners:function(){cc.director.off(cc.Director.EVENT_BEFORE_VISIT,this.updateLayout,this),this.node.off("size-changed",this._resized,this),this.node.off("anchor-changed",this._doLayoutDirty,this),this.node.off("child-added",this._childAdded,this),this.node.off("child-removed",this._childRemoved,this),this.node.off("child-reorder",this._doLayoutDirty,this),this._removeChildrenEventListeners()},_addChildrenEventListeners:function(){this.node.children.forEach(function(a){a.on("size-changed",this._doLayoutDirty,this),a.on("position-changed",this._doLayoutDirty,this),a.on("anchor-changed",this._doLayoutDirty,this),a.on("active-in-hierarchy-changed",this._doLayoutDirty,this)}.bind(this))},_removeChildrenEventListeners:function(){this.node.children.forEach(function(a){a.off("size-changed",this._doLayoutDirty,this),a.off("position-changed",this._doLayoutDirty,this),a.off("anchor-changed",this._doLayoutDirty,this),a.off("active-in-hierarchy-changed",this._doLayoutDirty,this)}.bind(this))},_childAdded:function(a){var c=a.detail;c.on("size-changed",this._doLayoutDirty,this),c.on("position-changed",this._doLayoutDirty,this),c.on("anchor-changed",this._doLayoutDirty,this),c.on("active-in-hierarchy-changed",this._doLayoutDirty,this),this._doLayoutDirty()},_childRemoved:function(a){var c=a.detail;c.off("size-changed",this._doLayoutDirty,this),c.off("position-changed",this._doLayoutDirty,this),c.off("anchor-changed",this._doLayoutDirty,this),c.off("active-in-hierarchy-changed",this._doLayoutDirty,this),this._doLayoutDirty()},_resized:function(){this._layoutSize=this.node.getContentSize(),this._doLayoutDirty()},_doLayoutHorizontally:function(a,c,h,u){var d=this.node.getAnchorPoint(),f=this.node.children,m=1,v=this.paddingLeft,_=-d.x*a;this.horizontalDirection===e.RIGHT_TO_LEFT&&(m=-1,_=(1-d.x)*a,v=this.paddingRight);var p=_+m*v-m*this.spacingX,g=0,y=0,C=0,S=0,I=0,b=0,A=this.cellSize.width;return this.type!==o.GRID&&this.resizeMode===s.CHILDREN&&(A=(a-(this.paddingLeft+this.paddingRight)-(f.length-1)*this.spacingX)/f.length),f.forEach(function(E){if(E.activeInHierarchy){this._resize===s.CHILDREN&&(E.width=A,this.type===o.GRID&&(E.height=this.cellSize.height));var R=E.anchorX;C>y&&(y=C),E.height>=y&&(C=y,y=E.height,b=E.getAnchorPoint().y),this.horizontalDirection===e.RIGHT_TO_LEFT&&(R=1-E.anchorX),p=p+m*R*E.width+m*this.spacingX;var O=m*(1-R)*E.width;if(c){var P=p+O+m*(m>0?this.paddingRight:this.paddingLeft),x=this.horizontalDirection===e.LEFT_TO_RIGHT&&P>(1-d.x)*a,w=this.horizontalDirection===e.RIGHT_TO_LEFT&&P<-d.x*a;(x||w)&&(E.height>=y?(C===0&&(C=y),g+=C,C=y):(g+=y,C=E.height,y=0),p=_+m*(v+R*E.width),S++)}var L=h(E,g,S);a>=E.width+this.paddingLeft+this.paddingRight&&u&&E.setPosition(cc.p(p,L));var D,F=1,M=y===0?E.height:y;this.verticalDirection===t.TOP_TO_BOTTOM?(I=I||this.node._contentSize.height,(D=L+(F=-1)*(M*b+this.paddingBottom))<I&&(I=D)):(I=I||-this.node._contentSize.height,(D=L+F*(M*b+this.paddingTop))>I&&(I=D)),p+=O}}.bind(this)),I},_getVerticalBaseHeight:function(a){var c=0,h=0;return this.resizeMode===s.CONTAINER?(a.forEach(function(u){u.activeInHierarchy&&(h++,c+=u.height)}),c+=(h-1)*this.spacingY+this.paddingBottom+this.paddingTop):c=this.node.getContentSize().height,c},_doLayoutVertically:function(a,c,h,u){var d=this.node.getAnchorPoint(),f=this.node.children,m=1,v=this.paddingBottom,_=-d.y*a;this.verticalDirection===t.TOP_TO_BOTTOM&&(m=-1,_=(1-d.y)*a,v=this.paddingTop);var p=_+m*v-m*this.spacingY,g=0,y=0,C=0,S=0,I=0,b=0,A=this.cellSize.height;return this.type!==o.GRID&&this.resizeMode===s.CHILDREN&&(A=(a-(this.paddingTop+this.paddingBottom)-(f.length-1)*this.spacingY)/f.length),f.forEach(function(E){if(E.activeInHierarchy){this.resizeMode===s.CHILDREN&&(E.height=A,this.type===o.GRID&&(E.width=this.cellSize.width));var R=E.anchorY;C>y&&(y=C),E.width>=y&&(C=y,y=E.width,b=E.getAnchorPoint().x),this.verticalDirection===t.TOP_TO_BOTTOM&&(R=1-E.anchorY),p=p+m*R*E.height+m*this.spacingY;var O=m*(1-R)*E.height;if(c){var P=p+O+m*(m>0?this.paddingTop:this.paddingBottom),x=this.verticalDirection===t.BOTTOM_TO_TOP&&P>(1-d.y)*a,w=this.verticalDirection===t.TOP_TO_BOTTOM&&P<-d.y*a;(x||w)&&(E.width>=y?(C===0&&(C=y),g+=C,C=y):(g+=y,C=E.width,y=0),p=_+m*(v+R*E.height),S++)}var L=h(E,g,S);a>=E.height+(this.paddingTop+this.paddingBottom)&&u&&E.setPosition(cc.p(L,p));var D,F=1,M=y===0?E.width:y;this.horizontalDirection===e.RIGHT_TO_LEFT?(F=-1,I=I||this.node._contentSize.width,(D=L+F*(M*b+this.paddingLeft))<I&&(I=D)):(I=I||-this.node._contentSize.width,(D=L+F*(M*b+this.paddingRight))>I&&(I=D)),p+=O}}.bind(this)),I},_doLayoutBasic:function(){var a=null;if(this.node.children.forEach(function(_){_.activeInHierarchy&&(a=a?cc.rectUnion(a,_.getBoundingBoxToWorld()):_.getBoundingBoxToWorld())}),a){var c=this.node.parent.convertToNodeSpaceAR(cc.p(a.x,a.y));c=cc.pAdd(c,cc.p(-this.paddingLeft,-this.paddingBottom));var h=this.node.parent.convertToNodeSpaceAR(cc.p(a.x+a.width,a.y+a.height));h=cc.pAdd(h,cc.p(this.paddingRight,this.paddingTop));var u=cc.size(parseFloat((h.x-c.x).toFixed(2)),parseFloat((h.y-c.y).toFixed(2))),d=this.node.getPosition(),f=(d.x-c.x)/u.width,m=(d.y-c.y)/u.height,v=cc.p(parseFloat(f.toFixed(2)),parseFloat(m.toFixed(2)));this.node.setAnchorPoint(v),this.node.setContentSize(u)}},_doLayoutGridAxisHorizontal:function(a,c){var h=c.width,u=1,d=-a.y*c.height,f=this.paddingBottom;this.verticalDirection===t.TOP_TO_BOTTOM&&(u=-1,d=(1-a.y)*c.height,f=this.paddingTop);var m=function(p,g,y){return d+u*(g+p.anchorY*p.height+f+y*this.spacingY)}.bind(this),v=0;if(this.resizeMode===s.CONTAINER){var _=this._doLayoutHorizontally(h,!0,m,!1);(v=d-_)<0&&(v*=-1),d=-a.y*v,this.verticalDirection===t.TOP_TO_BOTTOM&&(u=-1,d=(1-a.y)*v)}this._doLayoutHorizontally(h,!0,m,!0),this.resizeMode===s.CONTAINER&&this.node.setContentSize(h,v)},_doLayoutGridAxisVertical:function(a,c){var h=c.height,u=1,d=-a.x*c.width,f=this.paddingLeft;this.horizontalDirection===e.RIGHT_TO_LEFT&&(u=-1,d=(1-a.x)*c.width,f=this.paddingRight);var m=function(p,g,y){return d+u*(g+p.anchorX*p.width+f+y*this.spacingX)}.bind(this),v=0;if(this.resizeMode===s.CONTAINER){var _=this._doLayoutVertically(h,!0,m,!1);(v=d-_)<0&&(v*=-1),d=-a.x*v,this.horizontalDirection===e.RIGHT_TO_LEFT&&(u=-1,d=(1-a.x)*v)}this._doLayoutVertically(h,!0,m,!0),this.resizeMode===s.CONTAINER&&this.node.setContentSize(v,h)},_doLayoutGrid:function(){var a=this.node.getAnchorPoint(),c=this.node.getContentSize();this.startAxis===n.HORIZONTAL?this._doLayoutGridAxisHorizontal(a,c):this.startAxis===n.VERTICAL&&this._doLayoutGridAxisVertical(a,c)},_getHorizontalBaseWidth:function(a){var c=0,h=0;return this.resizeMode===s.CONTAINER?(a.forEach(function(u){u.activeInHierarchy&&(h++,c+=u.width)}),c+=(h-1)*this.spacingX+this.paddingLeft+this.paddingRight):c=this.node.getContentSize().width,c},_doLayout:function(){if(this.type===o.HORIZONTAL){var a=this._getHorizontalBaseWidth(this.node.children),c=function(d){return d.y};this._doLayoutHorizontally(a,!1,c,!0),this.node.width=a}else if(this.type===o.VERTICAL){var h=this._getVerticalBaseHeight(this.node.children),u=function(d){return d.x};this._doLayoutVertically(h,!1,u,!0),this.node.height=h}else this.type===o.NONE?this.resizeMode===s.CONTAINER&&this._doLayoutBasic():this.type===o.GRID&&this._doLayoutGrid()},updateLayout:function(){this._layoutDirty&&this.node.children.length>0&&(this._doLayout(),this._layoutDirty=!1)}});Object.defineProperty(r.prototype,"padding",{get:function(){return cc.warnID(4100),this.paddingLeft},set:function(a){this._N$padding=a,this._migratePaddingData(),this._doLayoutDirty()}}),cc.Layout=N.exports=r},{"./CCComponent":66}],72:[function(T,N,z){T("../../clipping-nodes/CCClippingNode"),T("../../clipping-nodes/CCClippingNodeCanvasRenderCmd"),T("../../clipping-nodes/CCClippingNodeWebGLRenderCmd"),T("../../shape-nodes/CCDrawNode");var o=cc._RendererInSG,s=cc.Enum({RECT:0,ELLIPSE:1,IMAGE_STENCIL:2}),n=cc.Class({name:"cc.Mask",extends:o,editor:!1,properties:{_clippingStencil:{default:null,serializable:!1},_type:s.RECT,type:{get:function(){return this._type},set:function(t){this._type=t,this._refreshStencil()},type:s,tooltip:!1},spriteFrame:{default:null,type:cc.SpriteFrame,tooltip:!1,notify:function(){this._refreshStencil()}},alphaThreshold:{default:1,type:cc.Float,range:[0,1,.1],slide:!0,tooltip:!1,notify:function(){cc._renderType!==cc.game.RENDER_TYPE_CANVAS?this._sgNode.setAlphaThreshold(this.alphaThreshold):cc.warnID(4201)}},inverted:{default:!1,type:cc.Boolean,tooltip:!1,notify:function(){cc._renderType!==cc.game.RENDER_TYPE_CANVAS?this._sgNode.setInverted(this.inverted):cc.warnID(4202)}},_segements:64,segements:{get:function(){return this._segements},set:function(t){this._segements=cc.clampf(t,3,1e4),this._refreshStencil()},tooltip:!1},_resizeToTarget:{animatable:!1,set:function(t){t&&this._resizeNodeToTargetNode()}}},statics:{Type:s},_resizeNodeToTargetNode:!1,_initSgNode:function(){},_createSgNode:function(){return new cc.ClippingNode},_hitTest:function(t){var e=this.node.getContentSize(),r=e.width,a=e.height,c=this.node.getNodeToWorldTransform();if(this.type===s.RECT||this.type===s.IMAGE_STENCIL){var h=cc.rect(0,0,r,a);cc._rectApplyAffineTransformIn(h,c);var u=t.x-h.x,d=h.x+h.width-t.x,f=t.y-h.y,m=h.y+h.height-t.y;return u>=0&&d>=0&&m>=0&&f>=0}if(this.type===s.ELLIPSE){var v=r/2,_=a/2,p=c.a*v+c.c*_+c.tx,g=c.b*v+c.d*_+c.ty,y=t.x-p,C=t.y-g;return y*y/(v*v)+C*C/(_*_)<1}},onEnable:function(){this._super(),this.spriteFrame&&this.spriteFrame.ensureLoadTexture(),this._refreshStencil(),this.node.on("size-changed",this._refreshStencil,this),this.node.on("anchor-changed",this._refreshStencil,this)},onDisable:function(){this._super(),this.node.off("size-changed",this._refreshStencil,this),this.node.off("anchor-changed",this._refreshStencil,this)},_calculateCircle:function(t,e,r){for(var a=[],c=2*Math.PI/r,h=0;h<r;++h)a.push(cc.v2(e.x*Math.cos(c*h)+t.x,e.y*Math.sin(c*h)+t.y));return a},_refreshStencil:function(){if(this.type!==s.IMAGE_STENCIL||cc._renderType===cc.game.RENDER_TYPE_WEBGL){var t=this.node.getContentSize(),e=this.node.getAnchorPoint(),r=this._clippingStencil;if(this._type===s.IMAGE_STENCIL)r instanceof cc.Scale9Sprite&&r._spriteFrame===this.spriteFrame||((r=new cc.Scale9Sprite).setSpriteFrame(this.spriteFrame),this._sgNode.setStencil(r)),r.setContentSize(t),r.setAnchorPoint(e),this._sgNode.setAlphaThreshold(this.alphaThreshold);else{r instanceof cc.DrawNode||(r=new cc.DrawNode,this._sgNode.setStencil(r));var a=t.width,c=t.height,h=-a*e.x,u=-c*e.y,d=cc.color(255,255,255,0);if(r.clear(),this._type===s.RECT){var f=[cc.v2(h,u),cc.v2(h+a,u),cc.v2(h+a,u+c),cc.v2(h,u+c)];r.drawPoly(f,d,0,d)}else if(this._type===s.ELLIPSE){var m=cc.v2(h+a/2,u+c/2),v={x:a/2,y:c/2};r.drawPoly(this._calculateCircle(m,v,this._segements),d,0,d)}}this._sgNode.setInverted(this.inverted),this._clippingStencil=r,cc.renderer.childrenOrderDirty=!0}else cc.warnID(4200)}});cc.Mask=N.exports=n},{"../../clipping-nodes/CCClippingNode":25,"../../clipping-nodes/CCClippingNodeCanvasRenderCmd":26,"../../clipping-nodes/CCClippingNodeWebGLRenderCmd":27,"../../shape-nodes/CCDrawNode":229}],73:[function(T,N,z){var o=cc.Enum({Unified:0,Free:1}),s=cc.Enum({Horizontal:0,Vertical:1}),n=cc.Enum({PAGE_TURNING:0}),t=cc.Class({name:"cc.PageView",extends:cc.ScrollView,editor:!1,ctor:function(){this._curPageIdx=0,this._lastPageIdx=0,this._pages=[],this._scrollCenterOffsetX=[],this._scrollCenterOffsetY=[]},properties:{sizeMode:{default:o.Unified,type:o,tooltip:!1,notify:function(){this._syncSizeMode()}},direction:{default:s.Horizontal,type:s,tooltip:!1,notify:function(){this._syncScrollDirection()}},scrollThreshold:{default:.5,type:cc.Float,slide:!0,range:[0,1,.01],tooltip:!1},autoPageTurningThreshold:{default:100,type:cc.Float,tooltip:!1},pageTurningEventTiming:{default:.1,type:cc.Float,range:[0,1,.01],tooltip:!1},indicator:{default:null,type:cc.PageViewIndicator,tooltip:!1,notify:function(){this.indicator&&this.indicator.setPageView(this)}},pageTurningSpeed:{default:.3,type:cc.Float,tooltip:!1},pageEvents:{default:[],type:cc.Component.EventHandler,tooltip:!1}},statics:{SizeMode:o,Direction:s,EventType:n},__preload:function(){this.node.on("size-changed",this._updateAllPagesSize,this)},onEnable:function(){this._super(),this.node.on("scroll-ended-with-threshold",this._dispatchPageTurningEvent,this)},onDisable:function(){this._super(),this.node.off("scroll-ended-with-threshold",this._dispatchPageTurningEvent,this)},onLoad:function(){this._initPages(),this.indicator&&this.indicator.setPageView(this)},onDestroy:function(){this.node.off("size-changed",this._updateAllPagesSize,this)},getCurrentPageIndex:function(){return this._curPageIdx},setCurrentPageIndex:function(e){this.scrollToPage(e,!0)},getPages:function(){return this._pages},addPage:function(e){e&&this._pages.indexOf(e)===-1&&this.content&&(this.content.addChild(e),this._pages.push(e),this._updatePageView())},insertPage:function(e,r){!(r<0)&&e&&this._pages.indexOf(e)===-1&&this.content&&(r>=this._pages.length?this.addPage(e):(this._pages.splice(r,0,e),this.content.addChild(e),this._updatePageView()))},removePage:function(e){if(e&&this.content){var r=this._pages.indexOf(e);r!==-1?this.removePageAtIndex(r):cc.warnID(4300,e.name)}},removePageAtIndex:function(e){var r=this._pages;if(!(e<0||e>=r.length)){var a=r[e];a&&(this.content.removeChild(a),r.splice(e,1),this._updatePageView())}},removeAllPages:function(){if(this.content){for(var e=this._pages,r=0,a=e.length;r<a;r++)this.content.removeChild(e[r]);this._pages.length=0,this._updatePageView()}},scrollToPage:function(e,r){e<0||e>=this._pages.length||(r=r!==void 0?r:.3,this._curPageIdx=e,this.scrollToOffset(this._moveOffsetValue(e),r,!0),this.indicator&&this.indicator._changedState())},getScrollEndedEventTiming:function(){return this.pageTurningEventTiming},_syncScrollDirection:function(){this.horizontal=this.direction===s.Horizontal,this.vertical=this.direction===s.Vertical},_syncSizeMode:function(){if(this.content){var e=this.content.getComponent(cc.Layout);if(e){if(this._pages.length===0)e.padding=0;else{var r=this._pages[this._pages.length-1];this.sizeMode===o.Free&&(this.direction===s.Horizontal?(e.paddingLeft=(this.node.width-this._pages[0].width)/2,e.paddingRight=(this.node.width-r.width)/2):this.direction===s.Vertical&&(e.paddingTop=(this.node.height-this._pages[0].height)/2,e.paddingBottom=(this.node.height-r.height)/2))}e.updateLayout()}}},_updatePageView:function(){var e=this._pages.length;this._curPageIdx>=e&&(this._curPageIdx=e===0?0:e-1,this._lastPageIdx=this._curPageIdx);for(var r=0;r<e;++r)this._pages[r].setSiblingIndex(r),this.direction===s.Horizontal?this._scrollCenterOffsetX[r]=Math.abs(this.content.x+this._pages[r].x):this._scrollCenterOffsetY[r]=Math.abs(this.content.y+this._pages[r].y);var a=this.content.getComponent(cc.Layout);a&&a.enabled&&a.updateLayout(),this.indicator&&this.indicator._refresh()},_updateAllPagesSize:function(){if(this.sizeMode===o.Unified)for(var e=this._pages,r=this.node.getContentSize(),a=0,c=e.length;a<c;a++)e[a].setContentSize(r)},_initPages:function(){if(this.content){for(var e=this.content.children,r=0;r<e.length;++r){var a=e[r];this._pages.indexOf(a)>=0||this._pages.push(a)}this._syncScrollDirection(),this._syncSizeMode(),this._updatePageView()}},_dispatchPageTurningEvent:function(){this._lastPageIdx!==this._curPageIdx&&(this._lastPageIdx=this._curPageIdx,cc.Component.EventHandler.emitEvents(this.pageEvents,this,n.PAGE_TURNING),this.node.emit("page-turning",this))},_isScrollable:function(e,r,a){if(this.sizeMode===o.Free){var c,h;if(this.direction===s.Horizontal)return c=this._scrollCenterOffsetX[r],h=this._scrollCenterOffsetX[a],Math.abs(e.x)>=Math.abs(c-h)*this.scrollThreshold;if(this.direction===s.Vertical)return c=this._scrollCenterOffsetY[r],h=this._scrollCenterOffsetY[a],Math.abs(e.y)>=Math.abs(c-h)*this.scrollThreshold}else{if(this.direction===s.Horizontal)return Math.abs(e.x)>=this.node.width*this.scrollThreshold;if(this.direction===s.Vertical)return Math.abs(e.y)>=this.node.height*this.scrollThreshold}},_isQuicklyScrollable:function(e){if(this.direction===s.Horizontal){if(Math.abs(e.x)>this.autoPageTurningThreshold)return!0}else if(this.direction===s.Vertical&&Math.abs(e.y)>this.autoPageTurningThreshold)return!0;return!1},_moveOffsetValue:function(e){var r=cc.p(0,0);return this.sizeMode===o.Free?this.direction===s.Horizontal?r.x=this._scrollCenterOffsetX[e]:this.direction===s.Vertical&&(r.y=this._scrollCenterOffsetY[e]):this.direction===s.Horizontal?r.x=e*this.node.width:this.direction===s.Vertical&&(r.y=e*this.node.height),r},_getDragDirection:function(e){return this.direction===s.Horizontal?e.x===0?0:e.x>0?1:-1:this.direction===s.Vertical?e.y===0?0:e.y<0?1:-1:void 0},_handleReleaseLogic:function(e){var r=this._startBounceBackIfNeeded(),a=cc.pSub(this._touchBeganPosition,this._touchEndPosition);if(r){var c=this._getDragDirection(a);if(c===0)return;this._curPageIdx=c>0?this._pages.length-1:0,this.indicator&&this.indicator._changedState()}else{var h=this._curPageIdx,u=h+this._getDragDirection(a),d=this.pageTurningSpeed*Math.abs(h-u);if(u<this._pages.length){if(this._isScrollable(a,h,u))return void this.scrollToPage(u,d);var f=this._calculateTouchMoveVelocity();if(this._isQuicklyScrollable(f))return void this.scrollToPage(u,d)}this.scrollToPage(h,d)}},_onTouchBegan:function(e,r){this._touchBeganPosition=e.touch.getLocation(),this._super(e,r)},_onTouchMoved:function(e,r){this._super(e,r)},_onTouchEnded:function(e,r){this._touchEndPosition=e.touch.getLocation(),this._super(e,r)},_onTouchCancelled:function(e,r){this._touchEndPosition=e.touch.getLocation(),this._super(e,r)},_onMouseWheel:function(){}});cc.PageView=N.exports=t},{}],74:[function(T,N,z){var o=cc.Enum({HORIZONTAL:0,VERTICAL:1,FILLED:2}),s=cc.Class({name:"cc.ProgressBar",extends:T("./CCComponent"),editor:!1,_initBarSprite:function(){if(this.barSprite){var n=this.barSprite.node;if(!n)return;var t=this.node.getContentSize(),e=this.node.getAnchorPoint(),r=n.getContentSize();n.parent===this.node&&this.node.setContentSize(r),this.barSprite.fillType===cc.Sprite.FillType.RADIAL&&(this.mode=o.FILLED);var a=n.getContentSize();if(this.mode===o.HORIZONTAL?this.totalLength=a.width:this.mode===o.VERTICAL?this.totalLength=a.height:this.totalLength=this.barSprite.fillRange,n.parent===this.node){var c=-t.width*e.x;n.setPosition(cc.p(c,0))}}},_updateBarStatus:function(){if(this.barSprite){var n=this.barSprite.node;if(!n)return;var t,e,r,a=n.getAnchorPoint(),c=n.getContentSize(),h=n.getPosition(),u=cc.p(0,.5),d=cc.clamp01(this.progress),f=this.totalLength*d;switch(this.mode){case o.HORIZONTAL:this.reverse&&(u=cc.p(1,.5)),t=cc.size(f,c.height),e=this.totalLength,r=c.height;break;case o.VERTICAL:u=this.reverse?cc.p(.5,1):cc.p(.5,0),t=cc.size(c.width,f),e=c.width,r=this.totalLength}if(this.mode===o.FILLED)this.barSprite.type!==cc.Sprite.Type.FILLED?cc.warn("ProgressBar FILLED mode only works when barSprite's Type is FILLED!"):(this.reverse&&(f*=-1),this.barSprite.fillRange=f);else if(this.barSprite.type!==cc.Sprite.Type.FILLED){var m=u.x-a.x,v=u.y-a.y,_=cc.p(e*m,r*v);n.setPosition(cc.pAdd(h,_)),n.setAnchorPoint(u),n.setContentSize(t)}else cc.warn("ProgressBar non-FILLED mode only works when barSprite's Type is non-FILLED!")}},properties:{barSprite:{default:null,type:cc.Sprite,tooltip:!1,notify:function(){this._initBarSprite()},animatable:!1},mode:{default:o.HORIZONTAL,type:o,tooltip:!1,notify:function(){if(this.barSprite){var n=this.barSprite.node;if(!n)return;var t=n.getContentSize();this.mode===o.HORIZONTAL?this.totalLength=t.width:this.mode===o.VERTICAL?this.totalLength=t.height:this.mode===o.FILLED&&(this.totalLength=this.barSprite.fillRange)}},animatable:!1},_N$totalLength:1,totalLength:{range:[0,Number.MAX_VALUE],tooltip:!1,get:function(){return this._N$totalLength},set:function(n){this.mode===o.FILLED&&(n=cc.clamp01(n)),this._N$totalLength=n,this._updateBarStatus()}},progress:{default:1,type:"Float",range:[0,1,.1],slide:!0,tooltip:!1,notify:function(){this._updateBarStatus()}},reverse:{default:!1,tooltip:!1,notify:function(){this.barSprite&&(this.barSprite.fillStart=1-this.barSprite.fillStart),this._updateBarStatus()},animatable:!1}},statics:{Mode:o}});cc.ProgressBar=N.exports=s},{"./CCComponent":66}],75:[function(T,N,z){var o=cc.Class({extends:T("./CCSGComponent"),name:"cc._RendererInSG",ctor:function(){var s=this._sgNode=this._createSgNode();s.setVisible(!1),this._plainNode=new _ccsg.Node},__preload:function(){this._initSgNode()},onEnable:function(){this._replaceSgNode(this._sgNode)},onDisable:function(){this._replaceSgNode(this._plainNode)},onDestroy:function(){this._removeSgNode()},_replaceSgNode:function(s){var n=this.node,t=n._sgNode;t._entity=null;var e=t.getChildren().slice();t.removeAllChildren(!1),s.getChildrenCount()>0&&s.removeAllChildren(!1);for(var r=0,a=e.length;r<a;++r)s.addChild(e[r]);var c=t.getParent();c&&(c.removeChild(t,!1),c.addChild(s),s._arrivalOrder=t._arrivalOrder,cc.renderer.childrenOrderDirty=c._reorderChildDirty=!0),n._sgNode=s,n._sgNode._entity=n,n._updateSgNode()}});cc._RendererInSG=N.exports=o},{"./CCSGComponent":78}],76:[function(T,N,z){var o=cc.Class({extends:T("./CCSGComponent"),name:"cc._RendererUnderSG",ctor:function(){var s=this._sgNode=this._createSgNode();s&&s.setVisible(!1)},__preload:function(){this._initSgNode(),this._registSizeProvider(),this._appendSgNode(this._sgNode)},onEnable:function(){this._sgNode&&this._sgNode.setVisible(!0)},onDisable:function(){this._sgNode&&this._sgNode.setVisible(!1)},onDestroy:function(){this.node._sizeProvider===this._sgNode&&(this.node._sizeProvider=null),this._removeSgNode()},_appendSgNode:function(s){if(s){var n=this.node;s.setColor(n._color),n._cascadeOpacityEnabled||s.setOpacity(n._opacity),s.setAnchorPoint(n._anchorPoint),s.setOpacityModifyRGB(n._opacityModifyRGB),s.setLocalZOrder(-1),n._sgNode.addChild(s)}}});cc._RendererUnderSG=N.exports=o},{"./CCSGComponent":78}],77:[function(T,N,z){T("../label/CCHtmlTextParser"),T("../label/CCTextUtils");var o=cc.TextAlignment,s=cc.VerticalTextAlignment,n=cc.Class({name:"cc.RichText",extends:cc._RendererUnderSG,ctor:function(){this._textArray=null,this._labelSegments=[],this._labelSegmentsCache=[],this._linesWidth=[],this._resetState(),this._updateRichTextStatus=this._updateRichText},editor:!1,properties:{string:{default:"<color=#00ff00>Rich</c><color=#0fffff>Text</color>",multiline:!0,tooltip:!1,notify:function(){this._updateRichTextStatus()}},horizontalAlign:{default:o.LEFT,type:o,tooltip:!1,animatable:!1,notify:function(t){this.horizontalAlign!==t&&(this._layoutDirty=!0,this._updateRichTextStatus())}},fontSize:{default:40,tooltip:!1,notify:function(t){this.fontSize!==t&&(this._layoutDirty=!0,this._updateRichTextStatus())}},font:{default:null,type:cc.TTFFont,tooltip:!1,notify:function(t){this.font!==t&&(this._layoutDirty=!0,this.font&&this._onTTFLoaded(),this._updateRichTextStatus())}},maxWidth:{default:0,tooltip:!1,notify:function(t){this.maxWidth!==t&&(this._layoutDirty=!0,this._updateRichTextStatus())}},lineHeight:{default:40,tooltip:!1,notify:function(t){this.lineHeight!==t&&(this._layoutDirty=!0,this._updateRichTextStatus())}},imageAtlas:{default:null,type:cc.SpriteAtlas,tooltip:!1,notify:function(t){this.imageAtlas!==t&&(this._layoutDirty=!0,this._updateRichTextStatus())}},handleTouchEvent:{default:!0,tooltip:!1,notify:function(t){this.handleTouchEvent!==t&&this.enabledInHierarchy&&(this.handleTouchEvent?this._addEventListeners():this._removeEventListeners())}}},statics:{HorizontalAlign:o,VerticalAlign:s},onEnable:function(){this._super(),this.handleTouchEvent&&this._addEventListeners()},onDisable:function(){this._super(),this.handleTouchEvent&&this._removeEventListeners()},_addEventListeners:function(){this.node.on(cc.Node.EventType.TOUCH_END,this._onTouchEnded,this)},_removeEventListeners:function(){this.node.off(cc.Node.EventType.TOUCH_END,this._onTouchEnded,this)},_createSgNode:function(){var t=new _ccsg.Node;t.setCascadeOpacityEnabled(!0);var e=this;return t.setColor=function(){e._updateLabelSegmentTextAttributes()},t._setContentSize=t.setContentSize,t.setContentSize=function(){},t},_updateLabelSegmentTextAttributes:function(){this._labelSegments.forEach(function(t){this._applyTextAttribute(t)}.bind(this))},_initSgNode:function(){this._updateRichText(),this._onTTFLoaded()},_createFontLabel:function(t){return _ccsg.Label.pool.get(t,this.font,null,this.fontSize)},_getFontRawUrl:function(){return this.font instanceof cc.TTFFont?this.font.rawUrl:""},_onTTFLoaded:function(){var t=this._getFontRawUrl();if(t){var e=this;cc.CustomFontLoader.loadTTF(t,function(){e._layoutDirty=!0,e._updateRichText()})}},_measureText:function(t,e){var r=this,a=function(c){var h;return r._labelSegmentsCache.length===0?(h=r._createFontLabel(c),r._labelSegmentsCache.push(h)):(h=r._labelSegmentsCache[0]).setString(c),h._styleIndex=t,r._applyTextAttribute(h),h.getContentSize().width};return e?a(e):a},_onTouchEnded:function(t){for(var e=this.node.getComponents(cc.Component),r=0;r<this._labelSegments.length;++r){var a=this._labelSegments[r],c=a._clickHandler;c&&this._containsTouchLocation(a,t.touch.getLocation())&&(e.forEach(function(h){h.enabledInHierarchy&&h[c]&&h[c](t)}),t.stopPropagation())}},_containsTouchLocation:function(t,e){var r=t.getBoundingBoxToWorld();return cc.rectContainsPoint(r,e)},_resetState:function(){var t=this._sgNode;t&&t.removeAllChildren(),this._labelSegments.length=0,this._labelSegmentsCache.length=0,this._linesWidth.length=0,this._lineOffsetX=0,this._lineCount=1,this._labelWidth=0,this._labelHeight=0,this._layoutDirty=!0},_addLabelSegment:function(t,e){var r;return this._labelSegmentsCache.length===0?r=this._createFontLabel(t):(r=this._labelSegmentsCache.pop()).setString(t),r._styleIndex=e,r._lineCount=this._lineCount,this._applyTextAttribute(r),r.setAnchorPoint(0,0),this._sgNode.addChild(r),this._labelSegments.push(r),r},_updateRichTextWithMaxWidth:function(t,e,r){var a=e;if(this._lineOffsetX>0&&a+this._lineOffsetX>this.maxWidth)for(var c=0;this._lineOffsetX<=this.maxWidth;){var h=this._getFirstWordLen(t,c,t.length),u=t.substr(c,h),d=this._measureText(r,u);if(!(this._lineOffsetX+d<=this.maxWidth)){if(c>0){var f=t.substr(0,c);this._addLabelSegment(f,r),t=t.substr(c,t.length),a=this._measureText(r,t)}this._updateLineInfo();break}this._lineOffsetX+=d,c+=h}if(a>this.maxWidth)for(var m=cc.TextUtils.fragmentText(t,a,this.maxWidth,this._measureText(r)),v=0;v<m.length;++v){var _=m[v],p=this._addLabelSegment(_,r).getContentSize();this._lineOffsetX+=p.width,m.length>1&&v<m.length-1&&this._updateLineInfo()}else this._lineOffsetX+=a,this._addLabelSegment(t,r)},_isLastComponentCR:function(t){return t.length-1===t.lastIndexOf(`
`)},_updateLineInfo:function(){this._linesWidth.push(this._lineOffsetX),this._lineOffsetX=0,this._lineCount++},_needsUpdateTextLayout:function(t){if(this._layoutDirty||!this._textArray||!t||this._textArray.length!==t.length)return!0;for(var e=0;e<this._textArray.length;++e){var r=this._textArray[e],a=t[e];if(r.text!=a.text)return!0;if(r.style){if(a.style){if(r.style.size!==a.style.size||r.style.italic!==a.style.italic||r.style.isImage!==a.style.isImage||r.style.isImage===a.style.isImage&&r.style.src!==a.style.src)return!0}else if(r.style.size||r.style.italic||r.style.isImage)return!0}else if(a.style&&(a.style.size||a.style.italic||a.style.isImage))return!0}return!1},_onSpriteFrameLoaded:function(t,e){var r;(r=e||t.target).__sprite.setSpriteFrame(r)},_applySpriteFrame:function(t){t&&(t.textureLoaded()?this._onSpriteFrameLoaded(null,t):(t.once("load",this._onSpriteFrameLoaded,this),t.ensureLoadTexture()))},_addRichTextImageElement:function(t){var e=t.style.src,r=this.imageAtlas.getSpriteFrame(e);if(r){var a=new cc.Scale9Sprite;a.setAnchorPoint(0,0),r.__sprite=a,this._sgNode.addChild(a),this._labelSegments.push(a);var c=r.getRect(),h=1,u=c.width,d=c.height,f=t.style.imageWidth,m=t.style.imageHeight;m>0&&m<this.lineHeight?(u*=h=m/d,d*=h):(u*=h=this.lineHeight/d,d*=h),f>0&&(u=f),this.maxWidth>0?(this._lineOffsetX+u>this.maxWidth&&this._updateLineInfo(),this._lineOffsetX+=u):(this._lineOffsetX+=u,this._lineOffsetX>this._labelWidth&&(this._labelWidth=this._lineOffsetX)),this._applySpriteFrame(r),a.setContentSize(u,d),a._lineCount=this._lineCount,t.style.event&&t.style.event.click&&(a._clickHandler=t.style.event.click)}else cc.warnID(4400)},_updateRichText:function(){if(this.enabled){var t=cc.htmlTextParser.parse(this.string);if(!this._needsUpdateTextLayout(t))return this._textArray=t,void this._updateLabelSegmentTextAttributes();this._textArray=t,this._resetState();for(var e,r=!1,a=0;a<this._textArray.length;++a){var c=this._textArray[a],h=c.text;if(h===""){if(c.style&&c.style.newline){this._updateLineInfo();continue}if(c.style&&c.style.isImage&&this.imageAtlas){this._addRichTextImageElement(c);continue}}for(var u=h.split(`
`),d=0;d<u.length;++d){var f=u[d];if(f!=="")if(r=!1,this.maxWidth>0){var m=this._measureText(a,f);this._updateRichTextWithMaxWidth(f,m,a),u.length>1&&d<u.length-1&&this._updateLineInfo()}else e=this._addLabelSegment(f,a).getContentSize(),this._lineOffsetX+=e.width,this._lineOffsetX>this._labelWidth&&(this._labelWidth=this._lineOffsetX),u.length>1&&d<u.length-1&&this._updateLineInfo();else{if(this._isLastComponentCR(h)&&d==u.length-1)continue;this._updateLineInfo(),r=!0}}}r||this._linesWidth.push(this._lineOffsetX),this.maxWidth>0&&(this._labelWidth=this.maxWidth),this._labelHeight=this._lineCount*this.lineHeight,this.node.setContentSize(this._labelWidth,this._labelHeight),this._sgNode._setContentSize(this._labelWidth,this._labelHeight),this._updateRichTextPosition(),this._layoutDirty=!1}},_getFirstWordLen:function(t,e,r){var a=t.charAt(e);if(cc.TextUtils.isUnicodeCJK(a)||cc.TextUtils.isUnicodeSpace(a))return 1;for(var c=1,h=e+1;h<r&&(a=t.charAt(h),!cc.TextUtils.isUnicodeSpace(a)&&!cc.TextUtils.isUnicodeCJK(a));++h)c++;return c},_updateRichTextPosition:function(){for(var t=0,e=1,r=this._lineCount,a=0;a<this._labelSegments.length;++a){var c=this._labelSegments[a],h=c._lineCount;h>e&&(t=0,e=h);var u=0;switch(this.horizontalAlign){case cc.TextAlignment.LEFT:u=0;break;case cc.TextAlignment.CENTER:u=(this._labelWidth-this._linesWidth[h-1])/2;break;case cc.TextAlignment.RIGHT:u=this._labelWidth-this._linesWidth[h-1]}c.setPositionX(t+u);var d=c.getContentSize(),f=(r-h)*this.lineHeight;c instanceof cc.Scale9Sprite&&(f+=(this.lineHeight-c.getContentSize().height)/2),c.setPositionY(f),h===e&&(t+=d.width)}},_convertLiteralColorValue:function(t){var e=t.toUpperCase();return cc.Color[e]?cc.Color[e]:cc.hexToColor(t)},_applyTextAttribute:function(t){if(!(t instanceof cc.Scale9Sprite)){var e=t._styleIndex;t.setLineHeight(this.lineHeight),t.setVerticalAlign(s.CENTER);var r=null;this._textArray[e]&&(r=this._textArray[e].style),r&&r.color?t.setColor(this._convertLiteralColorValue(r.color)):t.setColor(this.node.color),r&&r.bold?t.enableBold(!0):t.enableBold(!1),r&&r.italic?t.enableItalics(!0):t.enableItalics(!1),r&&r.underline?t.enableUnderline(!0):t.enableUnderline(!1),r&&r.outline?(t.setOutlined(!0),t.setOutlineColor(this._convertLiteralColorValue(r.outline.color)),t.setOutlineWidth(r.outline.width),t.setMargin(r.outline.width)):(t.setOutlined(!1),t.setMargin(0)),r&&r.size?t.setFontSize(r.size):t.setFontSize(this.fontSize),r&&r.event&&r.event.click&&(t._clickHandler=r.event.click)}},onDestroy:function(){this._super();for(var t=0;t<this._labelSegments.length;++t)this._labelSegments[t].removeFromParent(!0),_ccsg.Label.pool.put(this._labelSegments[t]);this._resetState()}});cc.RichText=N.exports=n},{"../label/CCHtmlTextParser":110,"../label/CCTextUtils":114}],78:[function(T,N,z){var o=T("../utils/scene-graph-helper"),s=cc.Class({extends:T("./CCComponent"),name:"cc._SGComponent",editor:!1,properties:{_sgNode:{default:null,serializable:!1}},_createSgNode:null,_initSgNode:null,_removeSgNode:o.removeSgNode,_registSizeProvider:function(){this.node._sizeProvider||(this.node._sizeProvider=this._sgNode)}});cc._SGComponent=N.exports=s},{"../utils/scene-graph-helper":188,"./CCComponent":66}],79:[function(T,N,z){var o=cc.Enum({HORIZONTAL:0,VERTICAL:1}),s=cc.Class({name:"cc.Scrollbar",extends:T("./CCComponent"),editor:!1,properties:{_scrollView:null,_touching:!1,_autoHideRemainingTime:{default:0,serializable:!1},_opacity:255,handle:{default:null,type:cc.Sprite,tooltip:!1,notify:function(){this._onScroll(cc.p(0,0))},animatable:!1},direction:{default:o.HORIZONTAL,type:o,tooltip:!1,notify:function(){this._onScroll(cc.p(0,0))},animatable:!1},enableAutoHide:{default:!0,animatable:!1,tooltip:!1},autoHideTime:{default:1,animatable:!1,tooltip:!1}},statics:{Direction:o},setTargetScrollView:function(n){this._scrollView=n},_convertToScrollViewSpace:function(n){var t=n.convertToWorldSpace(cc.p(0,0));return this._scrollView.node.convertToNodeSpace(t)},_setOpacity:function(n){this.handle&&this.node.setOpacity(n)},_onScroll:function(n){if(this._scrollView){var t=this._scrollView.content;if(t){var e=t.getContentSize(),r=this._scrollView.node.getContentSize(),a=this.node.getContentSize();if(this._conditionalDisableScrollBar(e,r))return;this.enableAutoHide&&(this._autoHideRemainingTime=this.autoHideTime,this._setOpacity(this._opacity));var c=0,h=0,u=0,d=0,f=0;this.direction===o.HORIZONTAL?(c=e.width,h=r.width,f=a.width,u=n.x,d=-this._convertToScrollViewSpace(t).x):this.direction===o.VERTICAL&&(c=e.height,h=r.height,f=a.height,u=n.y,d=-this._convertToScrollViewSpace(t).y);var m=this._calculateLength(c,h,f,u),v=this._calculatePosition(c,h,f,d,u,m);this._updateLength(m),this._updateHanlderPosition(v)}}},_updateHanlderPosition:function(n){if(this.handle){var t=this._fixupHandlerPosition();this.handle.node.setPosition(cc.pAdd(n,t))}},_fixupHandlerPosition:function(){var n=this.node.getContentSize(),t=this.node.getAnchorPoint(),e=this.handle.node.getContentSize(),r=this.handle.node.parent,a=this.node.convertToWorldSpaceAR(cc.p(-n.width*t.x,-n.height*t.y)),c=r.convertToNodeSpaceAR(a);return this.direction===o.HORIZONTAL?c=cc.pAdd(c,cc.p(0,(n.height-e.height)/2)):this.direction===o.VERTICAL&&(c=cc.pAdd(c,cc.p((n.width-e.width)/2,0))),this.handle.node.setPosition(c),c},_onTouchBegan:function(){this.enableAutoHide&&(this._touching=!0)},_conditionalDisableScrollBar:function(n,t){return n.width<=t.width&&this.direction===o.HORIZONTAL||n.height<=t.height&&this.direction===o.VERTICAL},_onTouchEnded:function(){if(this.enableAutoHide&&(this._touching=!1,!(this.autoHideTime<=0))){if(this._scrollView){var n=this._scrollView.content;if(n){var t=n.getContentSize(),e=this._scrollView.node.getContentSize();if(this._conditionalDisableScrollBar(t,e))return}}this._autoHideRemainingTime=this.autoHideTime}},_calculateLength:function(n,t,e,r){var a=n;return r&&(a+=20*(r>0?r:-r)),e*(t/a)},_calculatePosition:function(n,t,e,r,a,c){var h=n-t;a&&(h+=Math.abs(a));var u=0;h&&(u=r/h,u=cc.clamp01(u));var d=(e-c)*u;return this.direction===o.VERTICAL?cc.p(0,d):cc.p(d,0)},_updateLength:function(n){if(this.handle){var t=this.handle.node,e=t.getContentSize();t.setAnchorPoint(cc.p(0,0)),this.direction===o.HORIZONTAL?t.setContentSize(n,e.height):t.setContentSize(e.width,n)}},_processAutoHide:function(n){if(this.enableAutoHide&&!(this._autoHideRemainingTime<=0)&&!this._touching&&(this._autoHideRemainingTime-=n,this._autoHideRemainingTime<=this.autoHideTime)){this._autoHideRemainingTime=Math.max(0,this._autoHideRemainingTime);var t=this._opacity*(this._autoHideRemainingTime/this.autoHideTime);this._setOpacity(t)}},start:function(){this.enableAutoHide&&this._setOpacity(0)},hide:function(){this._autoHideRemainingTime=0,this._setOpacity(0)},show:function(){this._autoHideRemainingTime=this.autoHideTime,this._setOpacity(this._opacity)},update:function(n){this._processAutoHide(n)}});cc.Scrollbar=N.exports=s},{"./CCComponent":66}],80:[function(T,N,z){var o=function(){return new Date().getMilliseconds()},s=cc.Enum({SCROLL_TO_TOP:0,SCROLL_TO_BOTTOM:1,SCROLL_TO_LEFT:2,SCROLL_TO_RIGHT:3,SCROLLING:4,BOUNCE_TOP:5,BOUNCE_BOTTOM:6,BOUNCE_LEFT:7,BOUNCE_RIGHT:8,SCROLL_ENDED:9,TOUCH_UP:10,AUTOSCROLL_ENDED_WITH_THRESHOLD:11,SCROLL_BEGAN:12}),n={"scroll-to-top":s.SCROLL_TO_TOP,"scroll-to-bottom":s.SCROLL_TO_BOTTOM,"scroll-to-left":s.SCROLL_TO_LEFT,"scroll-to-right":s.SCROLL_TO_RIGHT,scrolling:s.SCROLLING,"bounce-bottom":s.BOUNCE_BOTTOM,"bounce-left":s.BOUNCE_LEFT,"bounce-right":s.BOUNCE_RIGHT,"bounce-top":s.BOUNCE_TOP,"scroll-ended":s.SCROLL_ENDED,"touch-up":s.TOUCH_UP,"scroll-ended-with-threshold":s.AUTOSCROLL_ENDED_WITH_THRESHOLD,"scroll-began":s.SCROLL_BEGAN},t=cc.Class({name:"cc.ScrollView",extends:T("./CCViewGroup"),editor:!1,ctor:function(){this._topBoundary=0,this._bottomBoundary=0,this._leftBoundary=0,this._rightBoundary=0,this._touchMoveDisplacements=[],this._touchMoveTimeDeltas=[],this._touchMovePreviousTimestamp=0,this._touchMoved=!1,this._autoScrolling=!1,this._autoScrollAttenuate=!1,this._autoScrollStartPosition=cc.p(0,0),this._autoScrollTargetDelta=cc.p(0,0),this._autoScrollTotalTime=0,this._autoScrollAccumulatedTime=0,this._autoScrollCurrentlyOutOfBoundary=!1,this._autoScrollBraking=!1,this._autoScrollBrakingStartPosition=cc.p(0,0),this._outOfBoundaryAmount=cc.p(0,0),this._outOfBoundaryAmountDirty=!0,this._stopMouseWheel=!1,this._mouseWheelEventElapsedTime=0,this._isScrollEndedWithThresholdEventFired=!1,this._scrollEventEmitMask=0,this._isBouncing=!1,this._scrolling=!1},properties:{content:{default:void 0,type:cc.Node,tooltip:!1},horizontal:{default:!0,animatable:!1,tooltip:!1},vertical:{default:!0,animatable:!1,tooltip:!1},inertia:{default:!0,tooltip:!1},brake:{default:.5,type:"Float",range:[0,1,.1],tooltip:!1},elastic:{default:!0,animatable:!1,tooltip:!1},bounceDuration:{default:1,range:[0,10],tooltip:!1},horizontalScrollBar:{default:void 0,type:cc.Scrollbar,tooltip:!1,notify:function(){this.horizontalScrollBar&&(this.horizontalScrollBar.setTargetScrollView(this),this._updateScrollBar(0))},animatable:!1},verticalScrollBar:{default:void 0,type:cc.Scrollbar,tooltip:!1,notify:function(){this.verticalScrollBar&&(this.verticalScrollBar.setTargetScrollView(this),this._updateScrollBar(0))},animatable:!1},scrollEvents:{default:[],type:cc.Component.EventHandler,tooltip:!1},cancelInnerEvents:{default:!0,animatable:!1,tooltip:!1}},statics:{EventType:s},scrollToBottom:function(e,r){var a=this._calculateMovePercentDelta({anchor:cc.p(0,0),applyToHorizontal:!1,applyToVertical:!0});e?this._startAutoScroll(a,e,r!==!1):this._moveContent(a,!0)},scrollToTop:function(e,r){var a=this._calculateMovePercentDelta({anchor:cc.p(0,1),applyToHorizontal:!1,applyToVertical:!0});e?this._startAutoScroll(a,e,r!==!1):this._moveContent(a)},scrollToLeft:function(e,r){var a=this._calculateMovePercentDelta({anchor:cc.p(0,0),applyToHorizontal:!0,applyToVertical:!1});e?this._startAutoScroll(a,e,r!==!1):this._moveContent(a)},scrollToRight:function(e,r){var a=this._calculateMovePercentDelta({anchor:cc.p(1,0),applyToHorizontal:!0,applyToVertical:!1});e?this._startAutoScroll(a,e,r!==!1):this._moveContent(a)},scrollToTopLeft:function(e,r){var a=this._calculateMovePercentDelta({anchor:cc.p(0,1),applyToHorizontal:!0,applyToVertical:!0});e?this._startAutoScroll(a,e,r!==!1):this._moveContent(a)},scrollToTopRight:function(e,r){var a=this._calculateMovePercentDelta({anchor:cc.p(1,1),applyToHorizontal:!0,applyToVertical:!0});e?this._startAutoScroll(a,e,r!==!1):this._moveContent(a)},scrollToBottomLeft:function(e,r){var a=this._calculateMovePercentDelta({anchor:cc.p(0,0),applyToHorizontal:!0,applyToVertical:!0});e?this._startAutoScroll(a,e,r!==!1):this._moveContent(a)},scrollToBottomRight:function(e,r){var a=this._calculateMovePercentDelta({anchor:cc.p(1,0),applyToHorizontal:!0,applyToVertical:!0});e?this._startAutoScroll(a,e,r!==!1):this._moveContent(a)},scrollToOffset:function(e,r,a){var c=this.getMaxScrollOffset(),h=cc.p(0,0);c.x===0?h.x=0:h.x=e.x/c.x,c.y===0?h.y=1:h.y=(c.y-e.y)/c.y,this.scrollTo(h,r,a)},getScrollOffset:function(){var e=this._getContentTopBoundary()-this._topBoundary,r=this._getContentLeftBoundary()-this._leftBoundary;return cc.p(r,e)},getMaxScrollOffset:function(){var e=this.node.getContentSize(),r=this.content.getContentSize(),a=r.width-e.width,c=r.height-e.height;return a=a>=0?a:0,c=c>=0?c:0,cc.p(a,c)},scrollToPercentHorizontal:function(e,r,a){var c=this._calculateMovePercentDelta({anchor:cc.p(e,0),applyToHorizontal:!0,applyToVertical:!1});r?this._startAutoScroll(c,r,a!==!1):this._moveContent(c)},scrollTo:function(e,r,a){var c=this._calculateMovePercentDelta({anchor:e,applyToHorizontal:!0,applyToVertical:!0});r?this._startAutoScroll(c,r,a!==!1):this._moveContent(c)},scrollToPercentVertical:function(e,r,a){var c=this._calculateMovePercentDelta({anchor:cc.p(0,e),applyToHorizontal:!1,applyToVertical:!0});r?this._startAutoScroll(c,r,a!==!1):this._moveContent(c)},stopAutoScroll:function(){this._autoScrolling=!1,this._autoScrollAccumulatedTime=this._autoScrollTotalTime},setContentPosition:function(e){cc.pFuzzyEqual(e,this.getContentPosition(),1e-4)||(this.content.setPosition(e),this._outOfBoundaryAmountDirty=!0)},getContentPosition:function(){return this.content.getPosition()},isScrolling:function(){return this._scrolling},isAutoScrolling:function(){return this._autoScrolling},_registerEvent:function(){this.node.on(cc.Node.EventType.TOUCH_START,this._onTouchBegan,this,!0),this.node.on(cc.Node.EventType.TOUCH_MOVE,this._onTouchMoved,this,!0),this.node.on(cc.Node.EventType.TOUCH_END,this._onTouchEnded,this,!0),this.node.on(cc.Node.EventType.TOUCH_CANCEL,this._onTouchCancelled,this,!0),this.node.on(cc.Node.EventType.MOUSE_WHEEL,this._onMouseWheel,this,!0)},_unregisterEvent:function(){this.node.off(cc.Node.EventType.TOUCH_START,this._onTouchBegan,this,!0),this.node.off(cc.Node.EventType.TOUCH_MOVE,this._onTouchMoved,this,!0),this.node.off(cc.Node.EventType.TOUCH_END,this._onTouchEnded,this,!0),this.node.off(cc.Node.EventType.TOUCH_CANCEL,this._onTouchCancelled,this,!0),this.node.off(cc.Node.EventType.MOUSE_WHEEL,this._onMouseWheel,this,!0)},_onMouseWheel:function(e,r){if(this.enabledInHierarchy&&!this._hasNestedViewGroup(e,r)){var a=cc.p(0,0),c=-.1;this.vertical?a=cc.p(0,e.getScrollY()*c):this.horizontal&&(a=cc.p(e.getScrollY()*c,0)),this._mouseWheelEventElapsedTime=0,this._processDeltaMove(a),this._stopMouseWheel||(this._handlePressLogic(),this.schedule(this._checkMouseWheel,1/60),this._stopMouseWheel=!0),this._stopPropagationIfTargetIsMe(e)}},_checkMouseWheel:function(e){var r=this._getHowMuchOutOfBoundary();if(!cc.pFuzzyEqual(r,cc.p(0,0),1e-4))return this._processInertiaScroll(),this.unschedule(this._checkMouseWheel),void(this._stopMouseWheel=!1);this._mouseWheelEventElapsedTime+=e,this._mouseWheelEventElapsedTime>.1&&(this._onScrollBarTouchEnded(),this.unschedule(this._checkMouseWheel),this._stopMouseWheel=!1)},_calculateMovePercentDelta:function(e){var r=e.anchor,a=e.applyToHorizontal,c=e.applyToVertical;this._calculateBoundary(),r=cc.pClamp(r,cc.p(0,0),cc.p(1,1));var h=this.node.getContentSize(),u=this.content.getContentSize(),d=this._getContentBottomBoundary()-this._bottomBoundary;d=-d;var f=this._getContentLeftBoundary()-this._leftBoundary;f=-f;var m=cc.p(0,0),v=0;return a&&(v=u.width-h.width,m.x=f-v*r.x),c&&(v=u.height-h.height,m.y=d-v*r.y),m},_moveContentToTopLeft:function(e){var r=this.content.getContentSize(),a=this._getContentBottomBoundary()-this._bottomBoundary;a=-a;var c=cc.p(0,0),h=0,u=this._getContentLeftBoundary()-this._leftBoundary;u=-u,r.height<e.height?(h=r.height-e.height,c.y=a-h,this.verticalScrollBar&&this.verticalScrollBar.hide()):this.verticalScrollBar&&this.verticalScrollBar.show(),r.width<e.width?(h=r.width-e.width,c.x=u,this.horizontalScrollBar&&this.horizontalScrollBar.hide()):this.horizontalScrollBar&&this.horizontalScrollBar.show(),this._moveContent(c),this._adjustContentOutOfBoundary()},_calculateBoundary:function(){if(this.content){var e=this.content.getComponent(cc.Layout);e&&e.enabledInHierarchy&&e.updateLayout();var r=this.node.getContentSize(),a=this._convertToContentParentSpace(cc.p(0,0));this._leftBoundary=a.x,this._bottomBoundary=a.y;var c=this._convertToContentParentSpace(cc.p(r.width,r.height));this._rightBoundary=c.x,this._topBoundary=c.y,this._moveContentToTopLeft(r)}},_convertToContentParentSpace:function(e){var r=this.node.convertToWorldSpace(e);return this.content.parent.convertToNodeSpaceAR(r)},_hasNestedViewGroup:function(e,r){if(e.eventPhase===cc.Event.CAPTURING_PHASE){if(r)for(var a=0;a<r.length;++a){var c=r[a];if(this.node===c)return!!e.target.getComponent(cc.ViewGroup);if(c.getComponent(cc.ViewGroup))return!0}return!1}},_stopPropagationIfTargetIsMe:function(e){e.eventPhase===cc.Event.AT_TARGET&&e.target===this.node&&e.stopPropagation()},_onTouchBegan:function(e,r){if(this.enabledInHierarchy&&!this._hasNestedViewGroup(e,r)){var a=e.touch;this.content&&this._handlePressLogic(a),this._touchMoved=!1,this._stopPropagationIfTargetIsMe(e)}},_onTouchMoved:function(e,r){if(this.enabledInHierarchy&&!this._hasNestedViewGroup(e,r)){var a=e.touch;if(this.content&&this._handleMoveLogic(a),this.cancelInnerEvents){var c=cc.pSub(a.getLocation(),a.getStartLocation());if(cc.pLength(c)>7&&!this._touchMoved&&e.target!==this.node){var h=new cc.Event.EventTouch(e.getTouches(),e.bubbles);h.type=cc.Node.EventType.TOUCH_CANCEL,h.touch=e.touch,h.simulate=!0,e.target.dispatchEvent(h),this._touchMoved=!0}this._stopPropagationIfTargetIsMe(e)}}},_onTouchEnded:function(e,r){if(this.enabledInHierarchy&&!this._hasNestedViewGroup(e,r)){this._dispatchEvent("touch-up");var a=e.touch;this.content&&this._handleReleaseLogic(a),this._touchMoved?e.stopPropagation():this._stopPropagationIfTargetIsMe(e)}},_onTouchCancelled:function(e,r){if(this.enabledInHierarchy&&!this._hasNestedViewGroup(e,r)){if(!e.simulate){var a=e.touch;this.content&&this._handleReleaseLogic(a)}this._stopPropagationIfTargetIsMe(e)}},_processDeltaMove:function(e){this._scrollChildren(e),this._gatherTouchMove(e)},_handleMoveLogic:function(e){var r=e.getDelta();this._processDeltaMove(r)},_scrollChildren:function(e){var r,a=e=this._clampDelta(e);this.elastic&&(r=this._getHowMuchOutOfBoundary(),a.x*=r.x===0?1:.5,a.y*=r.y===0?1:.5),this.elastic||(r=this._getHowMuchOutOfBoundary(a),a=cc.pAdd(a,r));var c=-1;a.y>0?this.content.y-this.content.anchorY*this.content.height+a.y>this._bottomBoundary&&(c="scroll-to-bottom"):a.y<0?this.content.y-this.content.anchorY*this.content.height+this.content.height+a.y<=this._topBoundary&&(c="scroll-to-top"):a.x<0?this.content.x-this.content.anchorX*this.content.width+this.content.width+a.x<=this._rightBoundary&&(c="scroll-to-right"):a.x>0&&this.content.x-this.content.anchorX*this.content.width+a.x>=this._leftBoundary&&(c="scroll-to-left"),this._moveContent(a,!1),a.x===0&&a.y===0||(this._scrolling||(this._scrolling=!0,this._dispatchEvent("scroll-began")),this._dispatchEvent("scrolling")),c!==-1&&this._dispatchEvent(c)},_handlePressLogic:function(){this._autoScrolling&&this._dispatchEvent("scroll-ended"),this._autoScrolling=!1,this._isBouncing=!1,this._touchMovePreviousTimestamp=o(),this._touchMoveDisplacements.length=0,this._touchMoveTimeDeltas.length=0,this._onScrollBarTouchBegan()},_clampDelta:function(e){var r=this.content.getContentSize(),a=this.node.getContentSize();return r.width<a.width&&(e.x=0),r.height<a.height&&(e.y=0),e},_gatherTouchMove:function(e){for(e=this._clampDelta(e);this._touchMoveDisplacements.length>=5;)this._touchMoveDisplacements.shift(),this._touchMoveTimeDeltas.shift();this._touchMoveDisplacements.push(e);var r=o();this._touchMoveTimeDeltas.push((r-this._touchMovePreviousTimestamp)/1e3),this._touchMovePreviousTimestamp=r},_startBounceBackIfNeeded:function(){if(!this.elastic)return!1;var e=this._getHowMuchOutOfBoundary();if(e=this._clampDelta(e),cc.pFuzzyEqual(e,cc.p(0,0),1e-4))return!1;var r=Math.max(this.bounceDuration,0);return this._startAutoScroll(e,r,!0),this._isBouncing||(e.y>0&&this._dispatchEvent("bounce-top"),e.y<0&&this._dispatchEvent("bounce-bottom"),e.x>0&&this._dispatchEvent("bounce-right"),e.x<0&&this._dispatchEvent("bounce-left"),this._isBouncing=!0),!0},_processInertiaScroll:function(){if(!this._startBounceBackIfNeeded()&&this.inertia){var e=this._calculateTouchMoveVelocity();!cc.pFuzzyEqual(e,cc.p(0,0),1e-4)&&this.brake<1&&this._startInertiaScroll(e)}this._onScrollBarTouchEnded()},_handleReleaseLogic:function(e){var r=e.getDelta();this._gatherTouchMove(r),this._processInertiaScroll(),this._scrolling&&(this._scrolling=!1,this._autoScrolling||this._dispatchEvent("scroll-ended"))},_isOutOfBoundary:function(){var e=this._getHowMuchOutOfBoundary();return!cc.pFuzzyEqual(e,cc.p(0,0),1e-4)},_isNecessaryAutoScrollBrake:function(){if(this._autoScrollBraking)return!0;if(this._isOutOfBoundary()){if(!this._autoScrollCurrentlyOutOfBoundary)return this._autoScrollCurrentlyOutOfBoundary=!0,this._autoScrollBraking=!0,this._autoScrollBrakingStartPosition=this.getContentPosition(),!0}else this._autoScrollCurrentlyOutOfBoundary=!1;return!1},getScrollEndedEventTiming:function(){return 1e-4},_processAutoScrolling:function(e){var r=this._isNecessaryAutoScrollBrake(),a=r?.05:1;this._autoScrollAccumulatedTime+=e*(1/a);var c=Math.min(1,this._autoScrollAccumulatedTime/this._autoScrollTotalTime);this._autoScrollAttenuate&&(c=function(_){return(_-=1)*_*_*_*_+1}(c));var h=cc.pAdd(this._autoScrollStartPosition,cc.pMult(this._autoScrollTargetDelta,c)),u=Math.abs(c-1)<=1e-4;if(Math.abs(c-1)<=this.getScrollEndedEventTiming()&&!this._isScrollEndedWithThresholdEventFired&&(this._dispatchEvent("scroll-ended-with-threshold"),this._isScrollEndedWithThresholdEventFired=!0),this.elastic){var d=cc.pSub(h,this._autoScrollBrakingStartPosition);r&&(d=cc.pMult(d,a)),h=cc.pAdd(this._autoScrollBrakingStartPosition,d)}else{var f=cc.pSub(h,this.getContentPosition()),m=this._getHowMuchOutOfBoundary(f);cc.pFuzzyEqual(m,cc.p(0,0),1e-4)||(h=cc.pAdd(h,m),u=!0)}u&&(this._autoScrolling=!1);var v=cc.pSub(h,this.getContentPosition());this._moveContent(this._clampDelta(v),u),this._dispatchEvent("scrolling"),this._autoScrolling||(this._isBouncing=!1,this._dispatchEvent("scroll-ended"))},_startInertiaScroll:function(e){var r=cc.pMult(e,.7);this._startAttenuatingAutoScroll(r,e)},_calculateAttenuatedFactor:function(e){return this.brake<=0?1-this.brake:(1-this.brake)*(1/(1+14e-6*e+e*e*8e-9))},_startAttenuatingAutoScroll:function(e,r){var a=this._calculateAutoScrollTimeByInitalSpeed(cc.pLength(r)),c=cc.pNormalize(e),h=this.content.getContentSize(),u=this.node.getContentSize(),d=h.width-u.width,f=h.height-u.height,m=this._calculateAttenuatedFactor(d),v=this._calculateAttenuatedFactor(f);c=cc.p(c.x*d*(1-this.brake)*m,c.y*f*v*(1-this.brake));var _=cc.pLength(e),p=cc.pLength(c)/_;c=cc.pAdd(c,e),this.brake>0&&p>7&&(p=Math.sqrt(p),c=cc.pAdd(cc.pMult(e,p),e)),this.brake>0&&p>3&&(a*=p=3),this.brake===0&&p>1&&(a*=p),this._startAutoScroll(c,a,!0)},_calculateAutoScrollTimeByInitalSpeed:function(e){return Math.sqrt(Math.sqrt(e/5))},_startAutoScroll:function(e,r,a){var c=this._flattenVectorByDirection(e);this._autoScrolling=!0,this._autoScrollTargetDelta=c,this._autoScrollAttenuate=a,this._autoScrollStartPosition=this.getContentPosition(),this._autoScrollTotalTime=r,this._autoScrollAccumulatedTime=0,this._autoScrollBraking=!1,this._isScrollEndedWithThresholdEventFired=!1,this._autoScrollBrakingStartPosition=cc.p(0,0);var h=this._getHowMuchOutOfBoundary();if(!cc.pFuzzyEqual(h,cc.p(0,0),1e-4)){this._autoScrollCurrentlyOutOfBoundary=!0;var u=this._getHowMuchOutOfBoundary(c);(h.x*u.x>0||h.y*u.y>0)&&(this._autoScrollBraking=!0)}},_calculateTouchMoveVelocity:function(){var e=0;if((e=this._touchMoveTimeDeltas.reduce(function(a,c){return a+c},e))<=0||e>=.5)return cc.p(0,0);var r=cc.p(0,0);return r=this._touchMoveDisplacements.reduce(function(a,c){return cc.pAdd(a,c)},r),cc.p(r.x*(1-this.brake)/e,r.y*(1-this.brake)/e)},_flattenVectorByDirection:function(e){var r=e;return r.x=this.horizontal?r.x:0,r.y=this.vertical?r.y:0,r},_moveContent:function(e,r){var a=this._flattenVectorByDirection(e),c=cc.pAdd(this.getContentPosition(),a);this.setContentPosition(c);var h=this._getHowMuchOutOfBoundary();this._updateScrollBar(h),this.elastic&&r&&this._startBounceBackIfNeeded()},_getContentLeftBoundary:function(){return this.getContentPosition().x-this.content.getAnchorPoint().x*this.content.getContentSize().width},_getContentRightBoundary:function(){var e=this.content.getContentSize();return this._getContentLeftBoundary()+e.width},_getContentTopBoundary:function(){var e=this.content.getContentSize();return this._getContentBottomBoundary()+e.height},_getContentBottomBoundary:function(){return this.getContentPosition().y-this.content.getAnchorPoint().y*this.content.getContentSize().height},_getHowMuchOutOfBoundary:function(e){if(e=e||cc.p(0,0),cc.pFuzzyEqual(e,cc.p(0,0),1e-4)&&!this._outOfBoundaryAmountDirty)return this._outOfBoundaryAmount;var r=cc.p(0,0);return this._getContentLeftBoundary()+e.x>this._leftBoundary?r.x=this._leftBoundary-(this._getContentLeftBoundary()+e.x):this._getContentRightBoundary()+e.x<this._rightBoundary&&(r.x=this._rightBoundary-(this._getContentRightBoundary()+e.x)),this._getContentTopBoundary()+e.y<this._topBoundary?r.y=this._topBoundary-(this._getContentTopBoundary()+e.y):this._getContentBottomBoundary()+e.y>this._bottomBoundary&&(r.y=this._bottomBoundary-(this._getContentBottomBoundary()+e.y)),cc.pFuzzyEqual(e,cc.p(0,0),1e-4)&&(this._outOfBoundaryAmount=r,this._outOfBoundaryAmountDirty=!1),r=this._clampDelta(r)},_updateScrollBar:function(e){this.horizontalScrollBar&&this.horizontalScrollBar._onScroll(e),this.verticalScrollBar&&this.verticalScrollBar._onScroll(e)},_onScrollBarTouchBegan:function(){this.horizontalScrollBar&&this.horizontalScrollBar._onTouchBegan(),this.verticalScrollBar&&this.verticalScrollBar._onTouchBegan()},_onScrollBarTouchEnded:function(){this.horizontalScrollBar&&this.horizontalScrollBar._onTouchEnded(),this.verticalScrollBar&&this.verticalScrollBar._onTouchEnded()},_dispatchEvent:function(e){if(e==="scroll-ended")this._scrollEventEmitMask=0;else if(e==="scroll-to-top"||e==="scroll-to-bottom"||e==="scroll-to-left"||e==="scroll-to-right"){var r=1<<n[e];if(this._scrollEventEmitMask&r)return;this._scrollEventEmitMask|=r}cc.Component.EventHandler.emitEvents(this.scrollEvents,this,n[e]),this.node.emit(e,this)},_adjustContentOutOfBoundary:function(){if(this._outOfBoundaryAmountDirty=!0,this._isOutOfBoundary()){var e=this._getHowMuchOutOfBoundary(cc.p(0,0)),r=cc.pAdd(this.getContentPosition(),e);this.content&&(this.content.setPosition(r),this._updateScrollBar(0))}},start:function(){this._calculateBoundary(),this.content&&cc.director.once(cc.Director.EVENT_AFTER_VISIT,this._adjustContentOutOfBoundary,this)},_hideScrollbar:function(){this.horizontalScrollBar&&this.horizontalScrollBar.hide(),this.verticalScrollBar&&this.verticalScrollBar.hide()},_showScrollbar:function(){this.horizontalScrollBar&&this.horizontalScrollBar.show(),this.verticalScrollBar&&this.verticalScrollBar.show()},onDisable:function(){this._unregisterEvent(),this.node.off("size-changed",this._calculateBoundary,this),this.node.off("scale-changed",this._calculateBoundary,this),this.content&&(this.content.off("size-changed",this._calculateBoundary,this),this.content.off("scale-changed",this._calculateBoundary,this)),this._hideScrollbar(),this.stopAutoScroll()},onEnable:function(){this._registerEvent(),this.node.on("size-changed",this._calculateBoundary,this),this.node.on("scale-changed",this._calculateBoundary,this),this.content&&(this.content.on("size-changed",this._calculateBoundary,this),this.content.on("scale-changed",this._calculateBoundary,this)),this._showScrollbar()},update:function(e){this._autoScrolling&&this._processAutoScrolling(e)}});cc.ScrollView=N.exports=t},{"./CCViewGroup":86}],81:[function(T,N,z){var o=cc.Enum({Horizontal:0,Vertical:1}),s=cc.Class({name:"cc.Slider",extends:T("./CCComponent"),editor:!1,ctor:function(){this._dragging=!1},properties:{handle:{default:null,type:cc.Button,tooltip:!1,notify:function(){}},direction:{default:o.Horizontal,type:o,tooltip:!1},progress:{default:.5,type:cc.Float,range:[0,1,.1],slide:!0,tooltip:!1,notify:function(){this._updateHandlePosition()}},slideEvents:{default:[],type:cc.Component.EventHandler,tooltip:!1}},statics:{Direction:o},__preload:function(){this._updateHandlePosition()},onEnable:function(){this.node.on(cc.Node.EventType.TOUCH_START,this._onTouchBegan,this),this.node.on(cc.Node.EventType.TOUCH_MOVE,this._onTouchMoved,this),this.node.on(cc.Node.EventType.TOUCH_END,this._onTouchEnded,this),this.node.on(cc.Node.EventType.TOUCH_CANCEL,this._onTouchCancelled,this),this.handle&&this.handle.isValid&&(this.handle.node.on(cc.Node.EventType.TOUCH_START,this._onHandleDragStart,this),this.handle.node.on(cc.Node.EventType.TOUCH_MOVE,this._onTouchMoved,this),this.handle.node.on(cc.Node.EventType.TOUCH_END,this._onTouchEnded,this))},onDisable:function(){this.node.off(cc.Node.EventType.TOUCH_START,this._onTouchBegan,this),this.node.off(cc.Node.EventType.TOUCH_MOVE,this._onTouchMoved,this),this.node.off(cc.Node.EventType.TOUCH_END,this._onTouchEnded,this),this.node.off(cc.Node.EventType.TOUCH_CANCEL,this._onTouchCancelled,this),this.handle&&this.handle.isValid&&(this.handle.node.off(cc.Node.EventType.TOUCH_START,this._onHandleDragStart,this),this.handle.node.off(cc.Node.EventType.TOUCH_MOVE,this._onTouchMoved,this),this.handle.node.off(cc.Node.EventType.TOUCH_END,this._onTouchEnded,this))},_onHandleDragStart:function(n){this._dragging=!0,n.stopPropagation()},_onTouchBegan:function(n){this.handle&&(this._dragging=!0,this._handleSliderLogic(n.touch),n.stopPropagation())},_onTouchMoved:function(n){this._dragging&&(this._handleSliderLogic(n.touch),n.stopPropagation())},_onTouchEnded:function(n){this._dragging=!1,n.stopPropagation()},_onTouchCancelled:function(n){this._dragging=!1,n.stopPropagation()},_handleSliderLogic:function(n){this._updateProgress(n),this._emitSlideEvent()},_emitSlideEvent:function(){cc.Component.EventHandler.emitEvents(this.slideEvents,this),this.node.emit("slide",this)},_updateProgress:function(n){if(this.handle){var t=null,e=0,r=this.node.convertTouchToNodeSpaceAR(n);this.direction===o.Horizontal?(t=this.node.width/2-this.handle.node.width*this.handle.node.anchorX,e=cc.clamp01((r.x+t)/(2*t),0,1)):this.direction===o.Vertical&&(t=this.node.height/2-this.handle.node.height*this.handle.node.anchorY,e=cc.clamp01((r.y+t)/(2*t),0,1)),this.progress=e}},_updateHandlePosition:function(){if(this.handle){var n;n=this.direction===o.Horizontal?cc.p(-this.node.width*this.node.anchorX+this.progress*this.node.width,0):cc.p(0,-this.node.height*this.node.anchorY+this.progress*this.node.height);var t=this.node.convertToWorldSpaceAR(n);this.handle.node.position=this.handle.node.parent.convertToNodeSpaceAR(t)}}});cc.Slider=N.exports=s},{"./CCComponent":66}],82:[function(T,N,z){var o=T("./CCRendererUnderSG"),s=cc.Scale9Sprite.RenderingType,n=cc.Scale9Sprite.FillType,t=cc.BlendFunc.BlendFactor,e=cc.Enum({CUSTOM:0,TRIMMED:1,RAW:2}),r=cc.Class({name:"cc.Sprite",extends:o,editor:!1,ctor:function(){this._blendFunc=new cc.BlendFunc(this._srcBlendFactor,this._dstBlendFactor)},properties:{_spriteFrame:{default:null,type:cc.SpriteFrame},_type:s.SIMPLE,_sizeMode:e.TRIMMED,_fillType:0,_fillCenter:cc.v2(0,0),_fillStart:0,_fillRange:0,_isTrimmedMode:!0,_srcBlendFactor:t.SRC_ALPHA,_dstBlendFactor:t.ONE_MINUS_SRC_ALPHA,_atlas:{default:null,type:cc.SpriteAtlas,tooltip:!1,editorOnly:!0,visible:!0,animatable:!1},spriteFrame:{get:function(){return this._spriteFrame},set:function(a,c){var h=this._spriteFrame;h!==a&&(this._spriteFrame=a,this._applySpriteFrame(h))},type:cc.SpriteFrame},type:{get:function(){return this._type},set:function(a){this._type=a,this._sgNode.setRenderingType(a)},type:s,animatable:!1,tooltip:!1},fillType:{get:function(){return this._fillType},set:function(a){this._fillType=a,this._sgNode&&this._sgNode.setFillType(a)},type:n,tooltip:!1},fillCenter:{get:function(){return this._fillCenter},set:function(a){this._fillCenter=cc.v2(a),this._sgNode&&this._sgNode.setFillCenter(this._fillCenter)},tooltip:!1},fillStart:{get:function(){return this._fillStart},set:function(a){this._fillStart=cc.clampf(a,-1,1),this._sgNode&&this._sgNode.setFillStart(a)},tooltip:!1},fillRange:{get:function(){return this._fillRange},set:function(a){this._fillRange=cc.clampf(a,-1,1),this._sgNode&&this._sgNode.setFillRange(a)},tooltip:!1},trim:{get:function(){return this._isTrimmedMode},set:function(a){this._isTrimmedMode!==a&&(this._isTrimmedMode=a,this._sgNode.enableTrimmedContentSize(a))},animatable:!1,tooltip:!1},srcBlendFactor:{get:function(){return this._srcBlendFactor},set:function(a){this._srcBlendFactor=a,this._blendFunc.src=a,this._sgNode.setBlendFunc(this._blendFunc)},animatable:!1,type:t,tooltip:!1},dstBlendFactor:{get:function(){return this._dstBlendFactor},set:function(a){this._dstBlendFactor=a,this._blendFunc.dst=a,this._sgNode.setBlendFunc(this._blendFunc)},animatable:!1,type:t,tooltip:!1},sizeMode:{get:function(){return this._sizeMode},set:function(a){this._sizeMode=a,a!==e.CUSTOM&&this._applySpriteSize()},animatable:!1,type:e,tooltip:!1}},statics:{FillType:n,Type:s,SizeMode:e},setVisible:function(a){this.enabled=a},setInsetLeft:function(a){this._sgNode.setInsetLeft(a)},getInsetLeft:function(){return this._sgNode.getInsetLeft()},setInsetTop:function(a){this._sgNode.setInsetTop(a)},getInsetTop:function(){return this._sgNode.getInsetTop()},setInsetRight:function(a){this._sgNode.setInsetRight(a)},getInsetRight:function(){return this._sgNode.getInsetRight()},setInsetBottom:function(a){this._sgNode.setInsetBottom(a)},getInsetBottom:function(){return this._sgNode.getInsetBottom()},onEnable:function(){this._sgNode&&this._spriteFrame&&this._spriteFrame.textureLoaded()&&this._sgNode.setVisible(!0)},_applyAtlas:!1,_applySpriteFrameInsets:function(){var a=this._spriteFrame,c=this._sgNode;c.setInsetTop(a.insetTop),c.setInsetBottom(a.insetBottom),c.setInsetRight(a.insetRight),c.setInsetLeft(a.insetLeft)},_applySpriteSize:function(){if(this._spriteFrame){if(e.RAW===this._sizeMode){var a=this._spriteFrame.getOriginalSize();this.node.setContentSize(a)}else if(e.TRIMMED===this._sizeMode){var c=this._spriteFrame.getRect();this.node.setContentSize(c.width,c.height)}}},_onTextureLoaded:function(a){if(this.isValid){var c=this._sgNode;c.setSpriteFrame(this._spriteFrame),this._applySpriteSize(),this.enabledInHierarchy&&!c.isVisible()&&c.setVisible(!0)}},_applySpriteFrame:function(a,c){var h=this._sgNode;a&&a.off&&a.off("load",this._onTextureLoaded,this);var u=this._spriteFrame;u?(c||this._applySpriteFrameInsets(),u.textureLoaded()?this._onTextureLoaded(null):(u.once("load",this._onTextureLoaded,this),u.ensureLoadTexture())):(h.setSpriteFrame(null),h.setVisible(!1))},_createSgNode:function(){return new cc.Scale9Sprite},_initSgNode:function(){var a=this._sgNode,c=a.getInsetLeft()!==0||a.getInsetRight()!==0||a.getInsetTop()!==0||a.getInsetBottom()!==0;this._applySpriteFrame(null,c),a.setContentSize(this.node.getContentSize(!0)),this._applySpriteSize(),a.setRenderingType(this._type),a.setFillType(this._fillType),a.setFillCenter(this._fillCenter),a.setFillStart(this._fillStart),a.setFillRange(this._fillRange),a.enableTrimmedContentSize(this._isTrimmedMode),this._blendFunc.src=this._srcBlendFactor,this._blendFunc.dst=this._dstBlendFactor,a.setBlendFunc(this._blendFunc)},_resized:!1});T("../utils/misc").propertyDefine(r,["insetLeft","insetTop","insetRight","insetBottom"],{type:[null,"setRenderingType"]}),cc.Sprite=N.exports=r},{"../utils/misc":185,"./CCRendererUnderSG":76}],83:[function(T,N,z){var o=cc.Class({name:"cc.Toggle",extends:T("./CCButton"),editor:!1,properties:{isChecked:{default:!0,tooltip:!1,notify:function(){this._updateCheckMark()}},toggleGroup:{default:null,tooltip:!1,type:T("./CCToggleGroup")},checkMark:{default:null,type:cc.Sprite,tooltip:!1},checkEvents:{default:[],type:cc.Component.EventHandler},_resizeToTarget:{animatable:!1,set:function(s){s&&this._resizeNodeToTargetNode()}}},onEnable:function(){this._super(),this._registerToggleEvent(),this.toggleGroup&&this.toggleGroup.enabled&&this.toggleGroup.addToggle(this)},onDisable:function(){this._super(),this._unregisterToggleEvent(),this.toggleGroup&&this.toggleGroup.enabled&&this.toggleGroup.removeToggle(this)},_updateCheckMark:function(){this.checkMark&&(this.checkMark.node.active=!!this.isChecked)},_updateDisabledState:function(){this._super(),this.checkMark&&this.checkMark._sgNode.setState(0),this.enableAutoGrayEffect&&this.checkMark&&!this.interactable&&this.checkMark._sgNode.setState(1)},_registerToggleEvent:function(){this.node.on("click",this.toggle,this)},_unregisterToggleEvent:function(){this.node.off("click",this.toggle,this)},toggle:function(s){var n=this.toggleGroup||this._toggleContainer;n&&n.enabled&&this.isChecked&&!n.allowSwitchOff||(this.isChecked=!this.isChecked,this._updateCheckMark(),n&&n.enabled&&n.updateToggles(this),this._emitToggleEvents(s))},_emitToggleEvents:function(){this.node.emit("toggle",this),this.checkEvents&&cc.Component.EventHandler.emitEvents(this.checkEvents,this)},check:function(){var s=this.toggleGroup||this._toggleContainer;s&&s.enabled&&this.isChecked&&!s.allowSwitchOff||(this.isChecked=!0,s&&s.enabled&&s.updateToggles(this),this._emitToggleEvents())},uncheck:function(){var s=this.toggleGroup||this._toggleContainer;s&&s.enabled&&this.isChecked&&!s.allowSwitchOff||(this.isChecked=!1,this._emitToggleEvents())}});cc.Toggle=N.exports=o,T("../platform/js").get(o.prototype,"_toggleContainer",function(){var s=this.node.parent;return cc.Node.isNode(s)?s.getComponent(cc.ToggleContainer):null})},{"../platform/js":156,"./CCButton":64,"./CCToggleGroup":85}],84:[function(T,N,z){var o=cc.Class({name:"cc.ToggleContainer",extends:cc.Component,editor:!1,properties:{allowSwitchOff:{tooltip:!1,default:!1}},updateToggles:function(s){this.toggleItems.forEach(function(n){s.isChecked&&n!==s&&(n.isChecked=!1)})},_allowOnlyOneToggleChecked:function(){var s=!1;return this.toggleItems.forEach(function(n){s?n.isChecked=!1:n.isChecked&&(s=!0)}),s},_makeAtLeastOneToggleChecked:function(){if(!this._allowOnlyOneToggleChecked()&&!this.allowSwitchOff){var s=this.toggleItems;s.length>0&&s[0].check()}},onEnable:function(){this.node.on("child-added",this._allowOnlyOneToggleChecked,this),this.node.on("child-removed",this._makeAtLeastOneToggleChecked,this)},onDisable:function(){this.node.off("child-added",this._allowOnlyOneToggleChecked,this),this.node.off("child-removed",this._makeAtLeastOneToggleChecked,this)},start:function(){this._makeAtLeastOneToggleChecked()}});T("../platform/js").get(o.prototype,"toggleItems",function(){return this.node.getComponentsInChildren(cc.Toggle)}),cc.ToggleContainer=N.exports=o},{"../platform/js":156}],85:[function(T,N,z){var o=cc.Class({name:"cc.ToggleGroup",extends:cc.Component,ctor:function(){this._toggleItems=[]},editor:!1,properties:{allowSwitchOff:{tooltip:!1,default:!1},toggleItems:{get:function(){return this._toggleItems}}},updateToggles:function(n){this.enabledInHierarchy&&this._toggleItems.forEach(function(t){n.isChecked&&t!==n&&t.isChecked&&t.enabled&&(t.isChecked=!1)})},addToggle:function(n){this._toggleItems.indexOf(n)===-1&&this._toggleItems.push(n),this._allowOnlyOneToggleChecked()},removeToggle:function(n){var t=this._toggleItems.indexOf(n);t>-1&&this._toggleItems.splice(t,1),this._makeAtLeastOneToggleChecked()},_allowOnlyOneToggleChecked:function(){var n=!1;return this._toggleItems.forEach(function(t){n&&t.enabled&&(t.isChecked=!1),t.isChecked&&t.enabled&&(n=!0)}),n},_makeAtLeastOneToggleChecked:function(){this._allowOnlyOneToggleChecked()||this.allowSwitchOff||this._toggleItems.length>0&&(this._toggleItems[0].isChecked=!0)},start:function(){this._makeAtLeastOneToggleChecked()}}),s=(T("../platform/js"),!1);cc.js.get(cc,"ToggleGroup",function(){return s||(cc.logID(1405,"cc.ToggleGroup","cc.ToggleContainer"),s=!0),o}),cc.ToggleGroup=N.exports=o},{"../platform/js":156}],86:[function(T,N,z){var o=cc.Class({name:"cc.ViewGroup",extends:T("./CCComponent")});cc.ViewGroup=N.exports=o},{"./CCComponent":66}],87:[function(T,N,z){var o=T("../base-ui/CCWidgetManager"),s=o._AlignFlags,n=s.TOP,t=s.MID,e=s.BOT,r=s.LEFT,a=s.CENTER,c=s.RIGHT,h=n|e,u=r|c,d=cc.Class({name:"cc.Widget",extends:T("./CCComponent"),editor:!1,properties:{target:{get:function(){return this._target},set:function(f){this._target=f},type:cc.Node,tooltip:!1},isAlignTop:{get:function(){return(this._alignFlags&n)>0},set:function(f){this._setAlign(n,f)},animatable:!1,tooltip:!1},isAlignVerticalCenter:{get:function(){return(this._alignFlags&t)>0},set:function(f){f?(this.isAlignTop=!1,this.isAlignBottom=!1,this._alignFlags|=t):this._alignFlags&=~t},animatable:!1,tooltip:!1},isAlignBottom:{get:function(){return(this._alignFlags&e)>0},set:function(f){this._setAlign(e,f)},animatable:!1,tooltip:!1},isAlignLeft:{get:function(){return(this._alignFlags&r)>0},set:function(f){this._setAlign(r,f)},animatable:!1,tooltip:!1},isAlignHorizontalCenter:{get:function(){return(this._alignFlags&a)>0},set:function(f){f?(this.isAlignLeft=!1,this.isAlignRight=!1,this._alignFlags|=a):this._alignFlags&=~a},animatable:!1,tooltip:!1},isAlignRight:{get:function(){return(this._alignFlags&c)>0},set:function(f){this._setAlign(c,f)},animatable:!1,tooltip:!1},isStretchWidth:{get:function(){return(this._alignFlags&u)===u},visible:!1},isStretchHeight:{get:function(){return(this._alignFlags&h)===h},visible:!1},top:{get:function(){return this._top},set:function(f){this._top=f},tooltip:!1},bottom:{get:function(){return this._bottom},set:function(f){this._bottom=f},tooltip:!1},left:{get:function(){return this._left},set:function(f){this._left=f},tooltip:!1},right:{get:function(){return this._right},set:function(f){this._right=f},tooltip:!1},horizontalCenter:{get:function(){return this._horizontalCenter},set:function(f){this._horizontalCenter=f},tooltip:!1},verticalCenter:{get:function(){return this._verticalCenter},set:function(f){this._verticalCenter=f},tooltip:!1},isAbsoluteHorizontalCenter:{get:function(){return this._isAbsHorizontalCenter},set:function(f){this._isAbsHorizontalCenter=f},animatable:!1},isAbsoluteVerticalCenter:{get:function(){return this._isAbsVerticalCenter},set:function(f){this._isAbsVerticalCenter=f},animatable:!1},isAbsoluteTop:{get:function(){return this._isAbsTop},set:function(f){this._isAbsTop=f},animatable:!1},isAbsoluteBottom:{get:function(){return this._isAbsBottom},set:function(f){this._isAbsBottom=f},animatable:!1},isAbsoluteLeft:{get:function(){return this._isAbsLeft},set:function(f){this._isAbsLeft=f},animatable:!1},isAbsoluteRight:{get:function(){return this._isAbsRight},set:function(f){this._isAbsRight=f},animatable:!1},isAlignOnce:{default:!0,tooltip:!1,displayName:"AlignOnce"},_target:null,_alignFlags:0,_left:0,_right:0,_top:0,_bottom:0,_verticalCenter:0,_horizontalCenter:0,_isAbsLeft:!0,_isAbsRight:!0,_isAbsTop:!0,_isAbsBottom:!0,_isAbsHorizontalCenter:!0,_isAbsVerticalCenter:!0,_originalWidth:0,_originalHeight:0},onEnable:function(){o.add(this)},onDisable:function(){o.remove(this)},_setAlign:function(f,m){if(m!=(this._alignFlags&f)>0){var v=(f&u)>0;m?(this._alignFlags|=f,v?(this.isAlignHorizontalCenter=!1,this.isStretchWidth&&(this._originalWidth=this.node.width)):(this.isAlignVerticalCenter=!1,this.isStretchHeight&&(this._originalHeight=this.node.height))):(v?this.isStretchWidth&&(this.node.width=this._originalWidth):this.isStretchHeight&&(this.node.height=this._originalHeight),this._alignFlags&=~f)}},updateAlignment:function(){o.updateAlignment(this.node)}});cc.Widget=N.exports=d},{"../base-ui/CCWidgetManager":59,"./CCComponent":66}],88:[function(T,N,z){T("./CCComponent"),T("./CCRendererInSG"),T("./CCRendererUnderSG"),T("./CCComponentEventHandler"),T("./missing-script"),N.exports=[T("./CCSprite"),T("./CCWidget"),T("./CCCanvas"),T("./CCAudioSource"),T("./CCAnimation"),T("./CCButton"),T("./CCLabel"),T("./CCProgressBar"),T("./CCMask"),T("./CCScrollBar"),T("./CCScrollView"),T("./CCPageViewIndicator"),T("./CCPageView"),T("./CCSlider"),T("./CCLayout"),T("./CCEditBox"),T("./CCVideoPlayer"),T("./CCWebView"),T("./CCSpriteDistortion"),T("./CCLabelOutline"),T("./CCRichText"),T("./CCToggleContainer"),T("./CCToggleGroup"),T("./CCToggle"),T("./CCBlockInputEvents")]},{"./CCAnimation":61,"./CCAudioSource":62,"./CCBlockInputEvents":63,"./CCButton":64,"./CCCanvas":65,"./CCComponent":66,"./CCComponentEventHandler":67,"./CCEditBox":68,"./CCLabel":69,"./CCLabelOutline":70,"./CCLayout":71,"./CCMask":72,"./CCPageView":73,"./CCPageViewIndicator":237,"./CCProgressBar":74,"./CCRendererInSG":75,"./CCRendererUnderSG":76,"./CCRichText":77,"./CCScrollBar":79,"./CCScrollView":80,"./CCSlider":81,"./CCSprite":82,"./CCSpriteDistortion":237,"./CCToggle":83,"./CCToggleContainer":84,"./CCToggleGroup":85,"./CCVideoPlayer":237,"./CCWebView":237,"./CCWidget":87,"./missing-script":89}],89:[function(T,N,z){var o=cc.js,s=T("../utils/misc").BUILTIN_CLASSID_RE,n=cc.Class({name:"cc.MissingClass",properties:{_$erialized:{default:null,visible:!1,editorOnly:!0}}}),t=cc.Class({name:"cc.MissingScript",extends:cc.Component,editor:{inspector:"packages://inspector/inspectors/comps/missing-script.js"},properties:{compiled:{default:!1,serializable:!1},_$erialized:{default:null,visible:!1,editorOnly:!0}},ctor:!1,statics:{safeFindClass:function(e,r){var a=o._getClassById(e);return a||(e?(cc.deserialize.reportMissingClass(e),t.getMissingWrapper(e,r)):null)},getMissingWrapper:function(e,r){return r.node&&(/^[0-9a-zA-Z+/]{23}$/.test(e)||s.test(e))?t:n}},onLoad:function(){cc.warnID(4600,this.node.name)}});cc._MissingScript=N.exports=t},{"../utils/misc":185}],90:[function(T,N,z){function o(u){var d=u.convertToWorldSpace(cc.p(0,0)),f=cc.visibleRect.height,m=.5;cc.visibleRect.width>f&&(m=.7),setTimeout(function(){if(window.scrollY<s&&d.y<f*m){var v=f*m-d.y-window.scrollY;v<35&&(v=35),v>320&&(v=320),window.scrollTo(v,v)}},n)}var s=40,n=400,t=T("../platform/utils"),e=T("../platform/CCSys"),r=cc.Enum({DEFAULT:0,DONE:1,SEND:2,SEARCH:3,GO:4}),a=cc.Enum({ANY:0,EMAIL_ADDR:1,NUMERIC:2,PHONE_NUMBER:3,URL:4,DECIMAL:5,SINGLE_LINE:6}),c=cc.Enum({PASSWORD:0,SENSITIVE:1,INITIAL_CAPS_WORD:2,INITIAL_CAPS_SENTENCE:3,INITIAL_CAPS_ALL_CHARACTERS:4,DEFAULT:5});cc.EditBoxDelegate=cc._Class.extend({editBoxEditingDidBegan:function(u){},editBoxEditingDidEnded:function(u){},editBoxTextChanged:function(u,d){},editBoxEditingReturn:function(u){}}),_ccsg.EditBox=_ccsg.Node.extend({_backgroundSprite:null,_delegate:null,_editBoxInputMode:a.ANY,_editBoxInputFlag:c.DEFAULT,_keyboardReturnType:r.DEFAULT,_maxLength:50,_text:"",_placeholderText:"",_alwaysOnTop:!1,_placeholderFontName:"",_placeholderFontSize:14,__fullscreen:!1,__autoResize:!1,_placeholderColor:null,_className:"EditBox",ctor:function(u,d){_ccsg.Node.prototype.ctor.call(this),this._textColor=cc.Color.WHITE,this._placeholderColor=cc.Color.GRAY,this.initWithSizeAndBackgroundSprite(u,d),this._renderCmd._createLabels()},_createRenderCmd:function(){return cc._renderType===cc.game.RENDER_TYPE_CANVAS?new _ccsg.EditBox.CanvasRenderCmd(this):new _ccsg.EditBox.WebGLRenderCmd(this)},setContentSize:function(u,d){u.width!==void 0&&u.height!==void 0&&(d=u.height,u=u.width),_ccsg.Node.prototype.setContentSize.call(this,u,d),this._updateEditBoxSize(u,d)},setVisible:function(u){_ccsg.Node.prototype.setVisible.call(this,u),this._renderCmd.updateVisibility()},createDomElementIfNeeded:function(){this._renderCmd._edTxt||this._renderCmd.setInputMode(this._editBoxInputMode)},setTabIndex:function(u){this._renderCmd._edTxt&&(this._renderCmd._edTxt.tabIndex=u)},getTabIndex:function(){return this._renderCmd._edTxt?this._renderCmd._edTxt.tabIndex:(cc.warnID(4700),-1)},setFocus:function(){this._renderCmd._edTxt&&this._renderCmd._edTxt.focus()},isFocused:function(){return this._renderCmd._edTxt?document.activeElement===this._renderCmd._edTxt:(cc.warnID(4700),!1)},stayOnTop:function(u){this._alwaysOnTop!==u&&(this._alwaysOnTop=u,this._renderCmd.stayOnTop(this._alwaysOnTop))},cleanup:function(){this._super(),this._renderCmd.removeDom()},_onTouchBegan:function(u){var d=u.getLocation(),f=cc.rect(0,0,this._contentSize.width,this._contentSize.height);return!!cc.rectContainsPoint(f,this.convertToNodeSpace(d))||(this._renderCmd._endEditing(),!1)},_onTouchEnded:function(){this._renderCmd._beginEditing()},_updateBackgroundSpriteSize:function(u,d){this._backgroundSprite&&this._backgroundSprite.setContentSize(u,d)},_updateEditBoxSize:function(u,d){var f=typeof u.width=="number"?u.width:u,m=typeof u.height=="number"?u.height:d;this._updateBackgroundSpriteSize(f,m),this._renderCmd.updateSize(f,m)},setLineHeight:function(u){this._renderCmd.setLineHeight(u)},setFont:function(u,d){this._renderCmd.setFont(u,d)},_setFont:function(u){this._renderCmd._setFont(u)},getBackgroundSprite:function(){return this._backgroundSprite},setFontName:function(u){this._renderCmd.setFontName(u)},setFontSize:function(u){this._renderCmd.setFontSize(u)},setString:function(u){u.length>=this._maxLength&&(u=u.slice(0,this._maxLength)),this._text=u,this._renderCmd.setString(u)},setFontColor:function(u){this._textColor=u,this._renderCmd.setFontColor(u)},setMaxLength:function(u){Number.isNaN(u)||(u<0&&(u=65535),this._maxLength=u,this._renderCmd.setMaxLength(u))},getMaxLength:function(){return this._maxLength},setPlaceHolder:function(u){u!==null&&(this._renderCmd.setPlaceHolder(u),this._placeholderText=u)},setPlaceholderFont:function(u,d){this._placeholderFontName=u,this._placeholderFontSize=d,this._renderCmd._updateDOMPlaceholderFontStyle()},_setPlaceholderFont:function(u){var d=cc.LabelTTF._fontStyleRE.exec(u);d&&(this._placeholderFontName=d[2],this._placeholderFontSize=parseInt(d[1]),this._renderCmd._updateDOMPlaceholderFontStyle())},setPlaceholderFontName:function(u){this._placeholderFontName=u,this._renderCmd._updateDOMPlaceholderFontStyle()},setPlaceholderFontSize:function(u){this._placeholderFontSize=u,this._renderCmd._updateDOMPlaceholderFontStyle()},setPlaceholderFontColor:function(u){this._placeholderColor=u,this._renderCmd.setPlaceholderFontColor(u)},setInputFlag:function(u){this._editBoxInputFlag=u,this._renderCmd.setInputFlag(u)},getString:function(){return this._text},initWithSizeAndBackgroundSprite:function(u,d){return this._backgroundSprite&&this._backgroundSprite.removeFromParent(),this._backgroundSprite=d,_ccsg.Node.prototype.setContentSize.call(this,u),this._backgroundSprite&&!this._backgroundSprite.parent&&(this._backgroundSprite.setAnchorPoint(cc.p(0,0)),this.addChild(this._backgroundSprite),this._updateBackgroundSpriteSize(u.width,u.height)),this.x=0,this.y=0,!0},setDelegate:function(u){this._delegate=u},getPlaceHolder:function(){return this._placeholderText},setInputMode:function(u){if(this._editBoxInputMode!==u){var d=this.getString();this._editBoxInputMode=u,this._renderCmd.setInputMode(u),this._renderCmd.transform(),this.setString(d),this._renderCmd._updateLabelPosition(this.getContentSize())}},setReturnType:function(u){this._keyboardReturnType=u,this._renderCmd._updateDomInputType()},initWithBackgroundColor:function(u,d){this._edWidth=u.width,this.dom.style.width=this._edWidth.toString()+"px",this._edHeight=u.height,this.dom.style.height=this._edHeight.toString()+"px",this.dom.style.backgroundColor=cc.colorToHex(d)}});var h=_ccsg.EditBox.prototype;cc.defineGetterSetter(h,"font",null,h._setFont),cc.defineGetterSetter(h,"fontName",null,h.setFontName),cc.defineGetterSetter(h,"fontSize",null,h.setFontSize),cc.defineGetterSetter(h,"fontColor",null,h.setFontColor),cc.defineGetterSetter(h,"string",h.getString,h.setString),cc.defineGetterSetter(h,"maxLength",h.getMaxLength,h.setMaxLength),cc.defineGetterSetter(h,"placeholder",h.getPlaceHolder,h.setPlaceHolder),cc.defineGetterSetter(h,"placeholderFont",null,h._setPlaceholderFont),cc.defineGetterSetter(h,"placeholderFontName",null,h.setPlaceholderFontName),cc.defineGetterSetter(h,"placeholderFontSize",null,h.setPlaceholderFontSize),cc.defineGetterSetter(h,"placeholderFontColor",null,h.setPlaceholderFontColor),cc.defineGetterSetter(h,"inputFlag",null,h.setInputFlag),cc.defineGetterSetter(h,"delegate",null,h.setDelegate),cc.defineGetterSetter(h,"inputMode",null,h.setInputMode),cc.defineGetterSetter(h,"returnType",null,h.setReturnType),h=null,_ccsg.EditBox.InputMode=a,_ccsg.EditBox.InputFlag=c,_ccsg.EditBox.KeyboardReturnType=r,function(u){u._polyfill={zoomInvalid:!1},e.OS_ANDROID!==e.os||e.browserType!==e.BROWSER_TYPE_SOUGOU&&e.browserType!==e.BROWSER_TYPE_360||(u._polyfill.zoomInvalid=!0)}(_ccsg.EditBox),function(u){var d=function(){}.prototype=Object.create(Object.prototype);d.updateMatrix=function(){if(this._edTxt){var v=this._node,_=cc.view._scaleX,p=cc.view._scaleY,g=cc.view._devicePixelRatio,y=this._worldTransform;_/=g,p/=g;var C=cc.game.container,S=y.a*_,I=y.b,b=y.c,A=y.d*p,E=C&&C.style.paddingLeft&&parseInt(C.style.paddingLeft),R=C&&C.style.paddingBottom&&parseInt(C.style.paddingBottom),O=y.tx*_+E,P=y.ty*p+R;u.zoomInvalid&&(this.updateSize(v._contentSize.width*S,v._contentSize.height*A),S=1,A=1);var x="matrix("+S+","+-I+","+-b+","+A+","+O+","+-P+")";this._edTxt.style.transform=x,this._edTxt.style["-webkit-transform"]=x,this._edTxt.style["transform-origin"]="0px 100% 0px",this._edTxt.style["-webkit-transform-origin"]="0px 100% 0px"}},d.updateVisibility=function(){this._edTxt&&(this._node.visible?this._edTxt.style.visibility="visible":this._edTxt.style.visibility="hidden")},d.stayOnTop=function(v){v?(this._removeLabels(),this._edTxt.style.display=""):(this._createLabels(),this._edTxt.style.display="none",this._showLabels())},d._beginEditingOnMobile=function(v){this.__orientationChanged=function(){o(v)},window.addEventListener("orientationchange",this.__orientationChanged),cc.view.isAutoFullScreenEnabled()?(this.__fullscreen=!0,cc.view.enableAutoFullScreen(!1),cc.screen.exitFullScreen()):this.__fullscreen=!1,this.__autoResize=cc.view.__resizeWithBrowserSize,cc.view.resizeWithBrowserSize(!1)},d._endEditingOnMobile=function(){if(this.__rotateScreen){cc.container.style["-webkit-transform"]="rotate(90deg)",cc.container.style.transform="rotate(90deg)";var v=cc.view,_=v._originalDesignResolutionSize.width,p=v._originalDesignResolutionSize.height;_>0&&v.setDesignResolutionSize(_,p,v._resolutionPolicy),this.__rotateScreen=!1}window.removeEventListener("orientationchange",this.__orientationChanged),window.scrollTo(0,0),this.__fullscreen&&cc.view.enableAutoFullScreen(!0),this.__autoResize&&cc.view.resizeWithBrowserSize(!0)},d._onFocusOnMobile=function(v){cc.view._isRotated?(cc.container.style["-webkit-transform"]="rotate(0deg)",cc.container.style.transform="rotate(0deg)",cc.view._isRotated=!1,cc.view.getResolutionPolicy().apply(cc.view,cc.view.getDesignResolutionSize()),cc.view._isRotated=!0,window.scrollTo(35,35),this.__rotateScreen=!0):this.__rotateScreen=!1,o(v)},d._createDomInput=function(){function v(y){var C=_._editBox;y.value.length>y.maxLength&&(y.value=y.value.slice(0,y.maxLength)),C._delegate&&C._delegate.editBoxTextChanged&&C._text!==y.value&&(C._text=y.value,_._updateDomTextCases(),C._delegate.editBoxTextChanged(C,C._text))}this.removeDom();var _=this,p=this._edTxt=document.createElement("input");p.type="text",p.style.fontSize=this._edFontSize+"px",p.style.color="#000000",p.style.border=0,p.style.background="transparent",p.style.width="100%",p.style.height="100%",p.style.active=0,p.style.outline="medium",p.style.padding="0",p.style.textTransform="uppercase",p.style.display="none",p.style.position="absolute",p.style.bottom="0px",p.style.left="2px",p.style["-moz-appearance"]="textfield",p.style.className="cocosEditBox";var g=!1;return p.addEventListener("compositionstart",function(){g=!0}),p.addEventListener("compositionend",function(){g=!1,v(this)}),p.addEventListener("input",function(){g||v(this)}),p.addEventListener("keypress",function(y){var C=_._editBox;y.keyCode===cc.KEY.enter&&(y.stopPropagation(),y.preventDefault(),this.value===""&&(this.style.fontSize=C._placeholderFontSize+"px",this.style.color=cc.colorToHex(C._placeholderColor)),C._text=this.value,_._updateDomTextCases(),_._endEditing(),C._delegate&&C._delegate.editBoxEditingReturn&&C._delegate.editBoxEditingReturn(C),cc._canvas.focus())}),p.addEventListener("focus",function(){var y=_._editBox;this.style.fontSize=_._edFontSize+"px",this.style.color=cc.colorToHex(y._textColor),_._hiddenLabels(),e.isMobile&&_._onFocusOnMobile(y),y._delegate&&y._delegate.editBoxEditingDidBegan&&y._delegate.editBoxEditingDidBegan(y)}),p.addEventListener("blur",function(){var y=_._editBox;y._text=this.value,_._updateDomTextCases(),y._delegate&&y._delegate.editBoxEditingDidEnded&&y._delegate.editBoxEditingDidEnded(y),this.value===""&&(this.style.fontSize=y._placeholderFontSize+"px",this.style.color=cc.colorToHex(y._placeholderColor)),_._endEditing()}),this._addDomToGameContainer(),p},d._createDomTextArea=function(){function v(y){y.value.length>y.maxLength&&(y.value=y.value.slice(0,y.maxLength));var C=_._editBox;C._delegate&&C._delegate.editBoxTextChanged&&C._text.toLowerCase()!==y.value.toLowerCase()&&(C._text=y.value,_._updateDomTextCases(),C._delegate.editBoxTextChanged(C,C._text))}this.removeDom();var _=this,p=this._edTxt=document.createElement("textarea");p.type="text",p.style.fontSize=this._edFontSize+"px",p.style.color="#000000",p.style.border=0,p.style.background="transparent",p.style.width="100%",p.style.height="100%",p.style.active=0,p.style.outline="medium",p.style.padding="0",p.style.resize="none",p.style.textTransform="uppercase",p.style.overflow_y="scroll",p.style.display="none",p.style.position="absolute",p.style.bottom="0px",p.style.left="2px",p.style.className="cocosEditBox";var g=!1;return p.addEventListener("compositionstart",function(){g=!0}),p.addEventListener("compositionend",function(){g=!1,v(this)}),p.addEventListener("input",function(){g||v(this)}),p.addEventListener("focus",function(){var y=_._editBox;_._hiddenLabels(),this.style.fontSize=_._edFontSize+"px",this.style.color=cc.colorToHex(y._textColor),e.isMobile&&_._onFocusOnMobile(y),y._delegate&&y._delegate.editBoxEditingDidBegan&&y._delegate.editBoxEditingDidBegan(y)}),p.addEventListener("keypress",function(y){var C=_._editBox;y.keyCode===cc.KEY.enter&&(y.stopPropagation(),C._delegate&&C._delegate.editBoxEditingReturn&&C._delegate.editBoxEditingReturn(C))}),p.addEventListener("blur",function(){var y=_._editBox;y._text=this.value,_._updateDomTextCases(),y._delegate&&y._delegate.editBoxEditingDidEnded&&y._delegate.editBoxEditingDidEnded(y),this.value===""&&(this.style.fontSize=y._placeholderFontSize+"px",this.style.color=cc.colorToHex(y._placeholderColor)),_._endEditing()}),this._addDomToGameContainer(),p},d._createWXInput=function(v){this.removeDom();var _=this,p=this._edTxt=document.createElement("input");p.type="text",p.focus=function(){var g=_._editBox;wx.showKeyboard({defaultValue:g._text,maxLength:140,multiple:v,confirmHold:!0,confirmType:"done",success:function(y){g._delegate&&g._delegate.editBoxEditingDidBegan&&g._delegate.editBoxEditingDidBegan(g)},fail:function(y){cc.warn(y.errMsg),_._endEditing()}}),wx.onKeyboardConfirm(function(y){g._text=y.value,_._updateDomTextCases(),g._delegate&&g._delegate.editBoxEditingReturn&&g._delegate.editBoxEditingReturn(g),wx.hideKeyboard({success:function(C){g._delegate&&g._delegate.editBoxEditingDidEnded&&g._delegate.editBoxEditingDidEnded(g)},fail:function(C){cc.warn(C.errMsg)}})}),wx.onKeyboardInput(function(y){g._delegate&&g._delegate.editBoxTextChanged&&g._text!==y.value&&(g._text=y.value,_._updateDomTextCases(),g._delegate.editBoxTextChanged(g,g._text))}),wx.onKeyboardComplete(function(){_._endEditing(),wx.offKeyboardConfirm(),wx.offKeyboardInput(),wx.offKeyboardComplete()})}},d._createLabels=function(){var v=this._editBox.getContentSize();this._textLabel||(this._textLabel=_ccsg.Label.pool.get(),this._textLabel.setAnchorPoint(cc.p(0,1)),this._textLabel.setOverflow(_ccsg.Label.Overflow.CLAMP),this._editBox.addChild(this._textLabel,100)),this._placeholderLabel||(this._placeholderLabel=_ccsg.Label.pool.get(),this._placeholderLabel.setAnchorPoint(cc.p(0,1)),this._placeholderLabel.setColor(cc.Color.GRAY),this._editBox.addChild(this._placeholderLabel,100)),this._updateLabelPosition(v)},d._removeLabels=function(){this._textLabel&&(this._editBox.removeChild(this._textLabel),this._textLabel=null)},d._updateLabelPosition=function(v){if(this._textLabel&&this._placeholderLabel){var _=cc.size(v.width-2,v.height);this._textLabel.setContentSize(_),this._placeholderLabel.setLineHeight(v.height);var p=this._placeholderLabel.getContentSize();this._editBox._editBoxInputMode===a.ANY?(this._textLabel.setPosition(2,v.height),this._placeholderLabel.setPosition(2,v.height),this._placeholderLabel.setVerticalAlign(cc.VerticalTextAlignment.TOP),this._textLabel.setVerticalAlign(cc.VerticalTextAlignment.TOP),this._textLabel.enableWrapText(!0)):(this._textLabel.enableWrapText(!1),this._textLabel.setPosition(2,v.height),this._placeholderLabel.setPosition(2,(v.height+p.height)/2),this._placeholderLabel.setVerticalAlign(cc.VerticalTextAlignment.CENTER),this._textLabel.setVerticalAlign(cc.VerticalTextAlignment.CENTER))}},d.setLineHeight=function(v){this._textLabel&&this._textLabel.setLineHeight(v)},d._hiddenLabels=function(){this._textLabel&&this._textLabel.setVisible(!1),this._placeholderLabel&&this._placeholderLabel.setVisible(!1)},d._updateDomTextCases=function(){var v=this._editBox._editBoxInputFlag;v===c.INITIAL_CAPS_ALL_CHARACTERS?this._editBox._text=this._editBox._text.toUpperCase():v===c.INITIAL_CAPS_WORD?this._editBox._text=function(_){return _.replace(/(?:^|\s)\S/g,function(p){return p.toUpperCase()})}(this._editBox._text):v===c.INITIAL_CAPS_SENTENCE&&(this._editBox._text=function(_){return _.charAt(0).toUpperCase()+_.slice(1)}(this._editBox._text)),this._edTxt&&(this._edTxt.value=this._editBox._text)},d._updateLabelStringStyle=function(){if(this._edTxt.type==="password"){for(var v="",_=this._editBox._text.length,p=0;p<_;++p)v+="\u25CF";this._textLabel&&this._textLabel.setString(v)}else this._updateDomTextCases(),this._textLabel&&this._textLabel.setString(this._editBox._text)},d._showLabels=function(){this._hiddenLabels(),this._edTxt.value===""?this._placeholderLabel&&(this._placeholderLabel.setVisible(!0),this._placeholderLabel.setString(this._editBox._placeholderText)):this._textLabel&&(this._textLabel.setVisible(!0),this._textLabel.setString(this._editBox._text)),this._updateLabelStringStyle()},d._beginEditing=function(){var v=this;if(e.platform===e.WECHAT_GAME)this._edTxt.focus();else if(!v._editBox._alwaysOnTop&&e.platform!==e.QQ_PLAY&&v._edTxt.style.display==="none"){var _=function(){v._edTxt.focus()},p=_;v._edTxt.style.display="",e.browserType===e.BROWSER_TYPE_UC?setTimeout(_,400):e.browserType===e.BROWSER_TYPE_FIREFOX?setTimeout(_,0):_()}e.isMobile&&!v._editingMode&&e.platform!==e.QQ_PLAY&&v._beginEditingOnMobile(v._editBox),v._editingMode=!0},d._endEditing=function(){if(this._editBox._alwaysOnTop||e.platform===e.QQ_PLAY||this._edTxt&&this._edTxt.style&&(this._edTxt.style.display="none"),this._edTxt&&this._showLabels(),e.platform!==e.WECHAT_GAME&&e.platform!==e.QQ_PLAY&&e.isMobile&&this._editingMode){var v=this;setTimeout(function(){v._endEditingOnMobile()},n)}this._editingMode=!1},d._setFont=function(v){var _=cc.LabelTTF._fontStyleRE.exec(v),p=_[2],g=parseInt(_[1]);_&&this.setFont(p,g)},d.setFont=function(v,_){this._edFontName=v||this._edFontName,this._edFontSize=_||this._edFontSize,this._updateDOMFontStyle()},d.setFontName=function(v){this._edFontName=v||this._edFontName,this._updateDOMFontStyle()},d.setFontSize=function(v){this._edFontSize=v||this._edFontSize,this._updateDOMFontStyle()},d.setFontColor=function(v){this._edTxt&&(this._edTxt.value!==this._editBox._placeholderText&&(this._edTxt.style.color=cc.colorToHex(v)),this._textLabel&&this._textLabel.setColor(v))},d.setPlaceHolder=function(v){this._placeholderLabel.setString(v)},d.setMaxLength=function(v){this._edTxt&&(this._edTxt.maxLength=v)},d._updateDOMPlaceholderFontStyle=function(){this._placeholderLabel.setFontFamily(this._editBox._placeholderFontName),this._placeholderLabel.setFontSize(this._editBox._placeholderFontSize)},d.setPlaceholderFontColor=function(v){this._placeholderLabel.setColor(v)},d._updateDomInputType=function(){if(this._edTxt){var v=this._editBox._editBoxInputMode;v===a.EMAIL_ADDR?this._edTxt.type="email":v===a.NUMERIC||v===a.DECIMAL?this._edTxt.type="number":v===a.PHONE_NUMBER?(this._edTxt.type="number",this._edTxt.pattern="[0-9]*"):v===a.URL?this._edTxt.type="url":(this._edTxt.type="text",this._editBox._keyboardReturnType===r.SEARCH&&(this._edTxt.type="search")),this._editBox._editBoxInputFlag===c.PASSWORD&&(this._edTxt.type="password")}},d.setInputFlag=function(v){this._edTxt&&(this._updateDomInputType(),this._edTxt.style.textTransform="none",v===c.INITIAL_CAPS_ALL_CHARACTERS?this._edTxt.style.textTransform="uppercase":v===c.INITIAL_CAPS_WORD&&(this._edTxt.style.textTransform="capitalize"),this._updateLabelStringStyle())},d.setInputMode=function(v){e.platform===e.WECHAT_GAME?this._createWXInput(v===a.ANY):v===a.ANY?this._createDomTextArea():this._createDomInput(),this._updateDomInputType();var _=this._node.getContentSize();this.updateSize(_.width,_.height)},d.setString=function(v){this._edTxt&&v!==null&&(this._edTxt.value=v,v===""?(this._placeholderLabel&&(this._placeholderLabel.setString(this._editBox._placeholderText),this._placeholderLabel.setColor(this._editBox._placeholderColor)),this._editingMode||(this._placeholderLabel&&this._placeholderLabel.setVisible(!0),this._textLabel&&this._textLabel.setVisible(!1))):(this._edTxt.style.color=cc.colorToHex(this._editBox._textColor),this._textLabel&&this._textLabel.setColor(this._editBox._textColor),this._editingMode||(this._placeholderLabel&&this._placeholderLabel.setVisible(!1),this._textLabel&&this._textLabel.setVisible(!0)),this._updateLabelStringStyle()))},d._updateDOMFontStyle=function(){this._edTxt&&(this._edTxt.value!==""&&(this._edTxt.style.fontFamily=this._edFontName,this._edTxt.style.fontSize=this._edFontSize+"px"),this._textLabel&&(this._textLabel.setFontSize(this._edFontSize),this._textLabel.setFontFamily(this._edFontName)))},d.updateSize=function(v,_){var p=this._edTxt;p&&(p.style.width=v+"px",p.style.height=_+"px",this._updateLabelPosition(cc.size(v,_)))},d._addDomToGameContainer=function(){cc.game.container.appendChild(this._edTxt)},d.removeDom=function(){var v=this._edTxt;v&&t.contains(cc.game.container,v)&&cc.game.container.removeChild(v),this._edTxt=null},d.initializeRenderCmd=function(v){this._editBox=v,this._edFontSize=14,this._edFontName="Arial",this._textLabel=null,this._placeholderLabel=null,this._editingMode=!1,this.__fullscreen=!1,this.__autoResize=!1,this.__rotateScreen=!1,this.__orientationChanged=null},_ccsg.EditBox.CanvasRenderCmd=function(v){this._rootCtor(v),this.initializeRenderCmd(v)};var f=_ccsg.EditBox.CanvasRenderCmd.prototype=Object.create(_ccsg.Node.CanvasRenderCmd.prototype);cc.js.mixin(f,d),f.constructor=_ccsg.EditBox.CanvasRenderCmd,f.transform=function(v,_){this.originTransform(v,_),this.updateMatrix()},_ccsg.EditBox.WebGLRenderCmd=function(v){this._rootCtor(v),this.initializeRenderCmd(v)};var m=_ccsg.EditBox.WebGLRenderCmd.prototype=Object.create(_ccsg.Node.WebGLRenderCmd.prototype);cc.js.mixin(m,d),m.constructor=_ccsg.EditBox.WebGLRenderCmd,m.transform=function(v,_){this.originTransform(v,_),this.updateMatrix()}}(_ccsg.EditBox._polyfill)},{"../platform/CCSys":144,"../platform/utils":160}],91:[function(T,N,z){var o=cc.js;T("../event/event");var s=function(a,c){cc.Event.call(this,cc.Event.MOUSE,c),this._eventType=a,this._button=0,this._x=0,this._y=0,this._prevX=0,this._prevY=0,this._scrollX=0,this._scrollY=0};o.extend(s,cc.Event);var n=s.prototype;n.setScrollData=function(a,c){this._scrollX=a,this._scrollY=c},n.getScrollX=function(){return this._scrollX},n.getScrollY=function(){return this._scrollY},n.setLocation=function(a,c){this._x=a,this._y=c},n.getLocation=function(){return{x:this._x,y:this._y}},n.getLocationInView=function(){return{x:this._x,y:cc.view._designResolutionSize.height-this._y}},n._setPrevCursor=function(a,c){this._prevX=a,this._prevY=c},n.getPreviousLocation=function(){return{x:this._prevX,y:this._prevY}},n.getDelta=function(){return{x:this._x-this._prevX,y:this._y-this._prevY}},n.getDeltaX=function(){return this._x-this._prevX},n.getDeltaY=function(){return this._y-this._prevY},n.setButton=function(a){this._button=a},n.getButton=function(){return this._button},n.getLocationX=function(){return this._x},n.getLocationY=function(){return this._y},s.NONE=0,s.DOWN=1,s.UP=2,s.MOVE=3,s.SCROLL=4,s.BUTTON_LEFT=0,s.BUTTON_RIGHT=2,s.BUTTON_MIDDLE=1,s.BUTTON_4=3,s.BUTTON_5=4,s.BUTTON_6=5,s.BUTTON_7=6,s.BUTTON_8=7;var t=function(a,c){cc.Event.call(this,cc.Event.TOUCH,c),this._eventCode=0,this._touches=a||[],this.touch=null,this.currentTouch=null};o.extend(t,cc.Event),(n=t.prototype).getEventCode=function(){return this._eventCode},n.getTouches=function(){return this._touches},n._setEventCode=function(a){this._eventCode=a},n._setTouches=function(a){this._touches=a},n.setLocation=function(a,c){this.touch&&this.touch.setTouchInfo(this.touch.getID(),a,c)},n.getLocation=function(){return this.touch?this.touch.getLocation():cc.v2()},n.getLocationInView=function(){return this.touch?this.touch.getLocationInView():cc.v2()},n.getPreviousLocation=function(){return this.touch?this.touch.getPreviousLocation():cc.v2()},n.getStartLocation=function(){return this.touch?this.touch.getStartLocation():cc.v2()},n.getID=function(){return this.touch?this.touch.getID():null},n.getDelta=function(){return this.touch?this.touch.getDelta():cc.v2()},n.getDeltaX=function(){return this.touch?this.touch.getDelta().x:0},n.getDeltaY=function(){return this.touch?this.touch.getDelta().y:0},n.getLocationX=function(){return this.touch?this.touch.getLocationX():0},n.getLocationY=function(){return this.touch?this.touch.getLocationY():0},t.MAX_TOUCHES=5,t.BEGAN=0,t.MOVED=1,t.ENDED=2,t.CANCELED=3;var e=function(a,c){cc.Event.call(this,cc.Event.ACCELERATION,c),this.acc=a};o.extend(e,cc.Event);var r=function(a,c,h){cc.Event.call(this,cc.Event.KEYBOARD,h),this.keyCode=a,this.isPressed=c};o.extend(r,cc.Event),cc.Event.EventMouse=s,cc.Event.EventTouch=t,cc.Event.EventAcceleration=e,cc.Event.EventKeyboard=r,N.exports=cc.Event},{"../event/event":98}],92:[function(T,N,z){cc.EventListener=cc._Class.extend({ctor:function(o,s,n){this._onEvent=n,this._type=o||0,this._listenerID=s||"",this._registered=!1,this._fixedPriority=0,this._node=null,this._target=null,this._paused=!0,this._isEnabled=!0},_setPaused:function(o){this._paused=o},_isPaused:function(){return this._paused},_setRegistered:function(o){this._registered=o},_isRegistered:function(){return this._registered},_getType:function(){return this._type},_getListenerID:function(){return this._listenerID},_setFixedPriority:function(o){this._fixedPriority=o},_getFixedPriority:function(){return this._fixedPriority},_setSceneGraphPriority:function(o){this._target=o,this._node=o},_getSceneGraphPriority:function(){return this._node},checkAvailable:function(){return this._onEvent!==null},clone:function(){return null},setEnabled:function(o){this._isEnabled=o},isEnabled:function(){return this._isEnabled},retain:function(){},release:function(){}}),cc.EventListener.UNKNOWN=0,cc.EventListener.TOUCH_ONE_BY_ONE=1,cc.EventListener.TOUCH_ALL_AT_ONCE=2,cc.EventListener.KEYBOARD=3,cc.EventListener.MOUSE=4,cc.EventListener.ACCELERATION=6,cc.EventListener.CUSTOM=8,cc._EventListenerCustom=cc.EventListener.extend({_onCustomEvent:null,ctor:function(o,s){this._onCustomEvent=s,cc.EventListener.prototype.ctor.call(this,cc.EventListener.CUSTOM,o,this._callback)},_callback:function(o){this._onCustomEvent!==null&&this._onCustomEvent(o)},checkAvailable:function(){return cc.EventListener.prototype.checkAvailable.call(this)&&this._onCustomEvent!==null},clone:function(){return new cc._EventListenerCustom(this._listenerID,this._onCustomEvent)}}),cc._EventListenerMouse=cc.EventListener.extend({onMouseDown:null,onMouseUp:null,onMouseMove:null,onMouseScroll:null,ctor:function(){cc.EventListener.prototype.ctor.call(this,cc.EventListener.MOUSE,cc._EventListenerMouse.LISTENER_ID,this._callback)},_callback:function(o){var s=cc.Event.EventMouse;switch(o._eventType){case s.DOWN:this.onMouseDown&&this.onMouseDown(o);break;case s.UP:this.onMouseUp&&this.onMouseUp(o);break;case s.MOVE:this.onMouseMove&&this.onMouseMove(o);break;case s.SCROLL:this.onMouseScroll&&this.onMouseScroll(o)}},clone:function(){var o=new cc._EventListenerMouse;return o.onMouseDown=this.onMouseDown,o.onMouseUp=this.onMouseUp,o.onMouseMove=this.onMouseMove,o.onMouseScroll=this.onMouseScroll,o},checkAvailable:function(){return!0}}),cc._EventListenerMouse.LISTENER_ID="__cc_mouse",cc._EventListenerTouchOneByOne=cc.EventListener.extend({_claimedTouches:null,swallowTouches:!1,onTouchBegan:null,onTouchMoved:null,onTouchEnded:null,onTouchCancelled:null,ctor:function(){cc.EventListener.prototype.ctor.call(this,cc.EventListener.TOUCH_ONE_BY_ONE,cc._EventListenerTouchOneByOne.LISTENER_ID,null),this._claimedTouches=[]},setSwallowTouches:function(o){this.swallowTouches=o},isSwallowTouches:function(){return this.swallowTouches},clone:function(){var o=new cc._EventListenerTouchOneByOne;return o.onTouchBegan=this.onTouchBegan,o.onTouchMoved=this.onTouchMoved,o.onTouchEnded=this.onTouchEnded,o.onTouchCancelled=this.onTouchCancelled,o.swallowTouches=this.swallowTouches,o},checkAvailable:function(){return!!this.onTouchBegan||(cc.logID(1801),!1)}}),cc._EventListenerTouchOneByOne.LISTENER_ID="__cc_touch_one_by_one",cc._EventListenerTouchAllAtOnce=cc.EventListener.extend({onTouchesBegan:null,onTouchesMoved:null,onTouchesEnded:null,onTouchesCancelled:null,ctor:function(){cc.EventListener.prototype.ctor.call(this,cc.EventListener.TOUCH_ALL_AT_ONCE,cc._EventListenerTouchAllAtOnce.LISTENER_ID,null)},clone:function(){var o=new cc._EventListenerTouchAllAtOnce;return o.onTouchesBegan=this.onTouchesBegan,o.onTouchesMoved=this.onTouchesMoved,o.onTouchesEnded=this.onTouchesEnded,o.onTouchesCancelled=this.onTouchesCancelled,o},checkAvailable:function(){return this.onTouchesBegan!==null||this.onTouchesMoved!==null||this.onTouchesEnded!==null||this.onTouchesCancelled!==null||(cc.logID(1802),!1)}}),cc._EventListenerTouchAllAtOnce.LISTENER_ID="__cc_touch_all_at_once",cc.EventListener.create=function(o){cc.assertID(o&&o.event,1900);var s=o.event;delete o.event;var n=null;s===cc.EventListener.TOUCH_ONE_BY_ONE?n=new cc._EventListenerTouchOneByOne:s===cc.EventListener.TOUCH_ALL_AT_ONCE?n=new cc._EventListenerTouchAllAtOnce:s===cc.EventListener.MOUSE?n=new cc._EventListenerMouse:s===cc.EventListener.CUSTOM?(n=new cc._EventListenerCustom(o.eventName,o.callback),delete o.eventName,delete o.callback):s===cc.EventListener.KEYBOARD?n=new cc._EventListenerKeyboard:s===cc.EventListener.ACCELERATION&&(n=new cc._EventListenerAcceleration(o.callback),delete o.callback);for(var t in o)n[t]=o[t];return n},cc._EventListenerAcceleration=cc.EventListener.extend({_onAccelerationEvent:null,ctor:function(o){this._onAccelerationEvent=o,cc.EventListener.prototype.ctor.call(this,cc.EventListener.ACCELERATION,cc._EventListenerAcceleration.LISTENER_ID,this._callback)},_callback:function(o){this._onAccelerationEvent(o.acc,o)},checkAvailable:function(){return cc.assertID(this._onAccelerationEvent,1803),!0},clone:function(){return new cc._EventListenerAcceleration(this._onAccelerationEvent)}}),cc._EventListenerAcceleration.LISTENER_ID="__cc_acceleration",cc._EventListenerKeyboard=cc.EventListener.extend({onKeyPressed:null,onKeyReleased:null,ctor:function(){cc.EventListener.prototype.ctor.call(this,cc.EventListener.KEYBOARD,cc._EventListenerKeyboard.LISTENER_ID,this._callback)},_callback:function(o){o.isPressed?this.onKeyPressed&&this.onKeyPressed(o.keyCode,o):this.onKeyReleased&&this.onKeyReleased(o.keyCode,o)},clone:function(){var o=new cc._EventListenerKeyboard;return o.onKeyPressed=this.onKeyPressed,o.onKeyReleased=this.onKeyReleased,o},checkAvailable:function(){return this.onKeyPressed!==null||this.onKeyReleased!==null||(cc.logID(1800),!1)}}),cc._EventListenerKeyboard.LISTENER_ID="__cc_keyboard"},{}],93:[function(T,N,z){var o=T("../platform/js"),s=cc._Class.extend({ctor:function(){this._fixedListeners=[],this._sceneGraphListeners=[],this.gt0Index=0},size:function(){return this._fixedListeners.length+this._sceneGraphListeners.length},empty:function(){return this._fixedListeners.length===0&&this._sceneGraphListeners.length===0},push:function(t){t._getFixedPriority()===0?this._sceneGraphListeners.push(t):this._fixedListeners.push(t)},clearSceneGraphListeners:function(){this._sceneGraphListeners.length=0},clearFixedListeners:function(){this._fixedListeners.length=0},clear:function(){this._sceneGraphListeners.length=0,this._fixedListeners.length=0},getFixedPriorityListeners:function(){return this._fixedListeners},getSceneGraphPriorityListeners:function(){return this._sceneGraphListeners}}),n={DIRTY_NONE:0,DIRTY_FIXED_PRIORITY:1,DIRTY_SCENE_GRAPH_PRIORITY:2,DIRTY_ALL:3,_listenersMap:{},_priorityDirtyFlagMap:{},_nodeListenersMap:{},_nodePriorityMap:{},_globalZOrderNodeMap:{},_toAddedListeners:[],_toRemovedListeners:[],_dirtyNodes:[],_inDispatch:0,_isEnabled:!1,_nodePriorityIndex:0,_internalCustomListenerIDs:[],_setDirtyForNode:function(t){if(this._nodeListenersMap[t.__instanceId]!==void 0&&this._dirtyNodes.push(t),t.getChildren)for(var e=t.getChildren(),r=0,a=e?e.length:0;r<a;r++)this._setDirtyForNode(e[r])},pauseTarget:function(t,e){if(t instanceof cc._BaseNode||t instanceof _ccsg.Node){var r,a,c=this._nodeListenersMap[t.__instanceId];if(c)for(r=0,a=c.length;r<a;r++)c[r]._setPaused(!0);if(e===!0){var h=t.getChildren();for(r=0,a=h?h.length:0;r<a;r++)this.pauseTarget(h[r],!0)}}else cc.warnID(3506)},resumeTarget:function(t,e){if(t instanceof cc._BaseNode||t instanceof _ccsg.Node){var r,a,c=this._nodeListenersMap[t.__instanceId];if(c)for(r=0,a=c.length;r<a;r++)c[r]._setPaused(!1);if(this._setDirtyForNode(t),e===!0&&t.getChildren){var h=t.getChildren();for(r=0,a=h?h.length:0;r<a;r++)this.resumeTarget(h[r],!0)}}else cc.warnID(3506)},_addListener:function(t){this._inDispatch===0?this._forceAddEventListener(t):this._toAddedListeners.push(t)},_forceAddEventListener:function(t){var e=t._getListenerID(),r=this._listenersMap[e];if(r||(r=new s,this._listenersMap[e]=r),r.push(t),t._getFixedPriority()===0){this._setDirty(e,this.DIRTY_SCENE_GRAPH_PRIORITY);var a=t._getSceneGraphPriority();a===null&&cc.logID(3507),this._associateNodeAndEventListener(a,t),a.isRunning()&&this.resumeTarget(a)}else this._setDirty(e,this.DIRTY_FIXED_PRIORITY)},_getListeners:function(t){return this._listenersMap[t]},_updateDirtyFlagForSceneGraph:function(){if(this._dirtyNodes.length!==0){for(var t,e,r=this._dirtyNodes,a=this._nodeListenersMap,c=0,h=r.length;c<h;c++)if(t=a[r[c].__instanceId])for(var u=0,d=t.length;u<d;u++)(e=t[u])&&this._setDirty(e._getListenerID(),this.DIRTY_SCENE_GRAPH_PRIORITY);this._dirtyNodes.length=0}},_removeAllListenersInVector:function(t){if(t)for(var e,r=0;r<t.length;)(e=t[r])._setRegistered(!1),e._getSceneGraphPriority()!=null&&(this._dissociateNodeAndEventListener(e._getSceneGraphPriority(),e),e._setSceneGraphPriority(null)),this._inDispatch===0?cc.js.array.remove(t,e):++r},_removeListenersForListenerID:function(t){var e,r=this._listenersMap[t];if(r){var a=r.getFixedPriorityListeners(),c=r.getSceneGraphPriorityListeners();this._removeAllListenersInVector(c),this._removeAllListenersInVector(a),delete this._priorityDirtyFlagMap[t],this._inDispatch||(r.clear(),delete this._listenersMap[t])}var h,u=this._toAddedListeners;for(e=0;e<u.length;)(h=u[e])&&h._getListenerID()===t?cc.js.array.remove(u,h):++e},_sortEventListeners:function(t){var e=this.DIRTY_NONE,r=this._priorityDirtyFlagMap;if(r[t]&&(e=r[t]),e!==this.DIRTY_NONE&&(r[t]=this.DIRTY_NONE,e&this.DIRTY_FIXED_PRIORITY&&this._sortListenersOfFixedPriority(t),e&this.DIRTY_SCENE_GRAPH_PRIORITY)){var a=cc.director.getScene();a&&this._sortListenersOfSceneGraphPriority(t,a)}},_sortListenersOfSceneGraphPriority:function(t,e){var r=this._getListeners(t);if(r){var a=r.getSceneGraphPriorityListeners();a&&a.length!==0&&(this._nodePriorityIndex=0,this._nodePriorityMap={},this._visitTarget(e,!0),r.getSceneGraphPriorityListeners().sort(this._sortEventListenersOfSceneGraphPriorityDes))}},_sortEventListenersOfSceneGraphPriorityDes:function(t,e){var r=n._nodePriorityMap,a=t._getSceneGraphPriority(),c=e._getSceneGraphPriority();return e&&c&&r[c.__instanceId]?t&&a&&r[a.__instanceId]?r[c.__instanceId]-r[a.__instanceId]:1:-1},_sortListenersOfFixedPriority:function(t){var e=this._listenersMap[t];if(e){var r=e.getFixedPriorityListeners();if(r&&r.length!==0){r.sort(this._sortListenersOfFixedPriorityAsc);for(var a=0,c=r.length;a<c&&!(r[a]._getFixedPriority()>=0);)++a;e.gt0Index=a}}},_sortListenersOfFixedPriorityAsc:function(t,e){return t._getFixedPriority()-e._getFixedPriority()},_onUpdateListeners:function(t){var e,r,a,c=t.getFixedPriorityListeners(),h=t.getSceneGraphPriorityListeners(),u=this._toRemovedListeners;if(h)for(e=0;e<h.length;)(r=h[e])._isRegistered()?++e:(cc.js.array.remove(h,r),(a=u.indexOf(r))!==-1&&u.splice(a,1));if(c)for(e=0;e<c.length;)(r=c[e])._isRegistered()?++e:(cc.js.array.remove(c,r),(a=u.indexOf(r))!==-1&&u.splice(a,1));h&&h.length===0&&t.clearSceneGraphListeners(),c&&c.length===0&&t.clearFixedListeners()},frameUpdateListeners:function(){var t=this._listenersMap,e=this._priorityDirtyFlagMap;for(var r in t)t[r].empty()&&(delete e[r],delete t[r]);var a=this._toAddedListeners;if(a.length!==0){for(var c=0,h=a.length;c<h;c++)this._forceAddEventListener(a[c]);a.length=0}this._toRemovedListeners.length!==0&&this._cleanToRemovedListeners()},_updateTouchListeners:function(t){var e=this._inDispatch;if(cc.assertID(e>0,3508),!(e>1)){var r;(r=this._listenersMap[cc._EventListenerTouchOneByOne.LISTENER_ID])&&this._onUpdateListeners(r),(r=this._listenersMap[cc._EventListenerTouchAllAtOnce.LISTENER_ID])&&this._onUpdateListeners(r),cc.assertID(e===1,3509);var a=this._toAddedListeners;if(a.length!==0){for(var c=0,h=a.length;c<h;c++)this._forceAddEventListener(a[c]);this._toAddedListeners.length=0}this._toRemovedListeners.length!==0&&this._cleanToRemovedListeners()}},_cleanToRemovedListeners:function(){for(var t=this._toRemovedListeners,e=0;e<t.length;e++){var r=t[e],a=this._listenersMap[r._getListenerID()];if(a){var c,h=a.getFixedPriorityListeners(),u=a.getSceneGraphPriorityListeners();u&&(c=u.indexOf(r))!==-1&&u.splice(c,1),h&&(c=h.indexOf(r))!==-1&&h.splice(c,1)}}t.length=0},_onTouchEventCallback:function(t,e){if(!t._isRegistered)return!1;var r=e.event,a=r.currentTouch;r.currentTarget=t._node;var c,h=!1,u=r.getEventCode(),d=cc.Event.EventTouch;return u===d.BEGAN?t.onTouchBegan&&(h=t.onTouchBegan(a,r))&&t._registered&&t._claimedTouches.push(a):t._claimedTouches.length>0&&(c=t._claimedTouches.indexOf(a))!==-1&&(h=!0,u===d.MOVED&&t.onTouchMoved?t.onTouchMoved(a,r):u===d.ENDED?(t.onTouchEnded&&t.onTouchEnded(a,r),t._registered&&t._claimedTouches.splice(c,1)):u===d.CANCELLED&&(t.onTouchCancelled&&t.onTouchCancelled(a,r),t._registered&&t._claimedTouches.splice(c,1))),r.isStopped()?(n._updateTouchListeners(r),!0):!!(h&&t._registered&&t.swallowTouches)&&(e.needsMutableSet&&e.touches.splice(a,1),!0)},_dispatchTouchEvent:function(t){this._sortEventListeners(cc._EventListenerTouchOneByOne.LISTENER_ID),this._sortEventListeners(cc._EventListenerTouchAllAtOnce.LISTENER_ID);var e=this._getListeners(cc._EventListenerTouchOneByOne.LISTENER_ID),r=this._getListeners(cc._EventListenerTouchAllAtOnce.LISTENER_ID);if(e!==null||r!==null){var a=t.getTouches(),c=cc.js.array.copy(a),h={event:t,needsMutableSet:e&&r,touches:c,selTouch:null};if(e)for(var u=0;u<a.length;u++)t.currentTouch=a[u],t._propagationStopped=t._propagationImmediateStopped=!1,this._dispatchEventToListeners(e,this._onTouchEventCallback,h);r&&c.length>0&&(this._dispatchEventToListeners(r,this._onTouchesEventCallback,{event:t,touches:c}),t.isStopped())||this._updateTouchListeners(t)}},_onTouchesEventCallback:function(t,e){if(!t._registered)return!1;var r=cc.Event.EventTouch,a=e.event,c=e.touches,h=a.getEventCode();return a.currentTarget=t._node,h===r.BEGAN&&t.onTouchesBegan?t.onTouchesBegan(c,a):h===r.MOVED&&t.onTouchesMoved?t.onTouchesMoved(c,a):h===r.ENDED&&t.onTouchesEnded?t.onTouchesEnded(c,a):h===r.CANCELLED&&t.onTouchesCancelled&&t.onTouchesCancelled(c,a),!!a.isStopped()&&(n._updateTouchListeners(a),!0)},_associateNodeAndEventListener:function(t,e){var r=this._nodeListenersMap[t.__instanceId];r||(r=[],this._nodeListenersMap[t.__instanceId]=r),r.push(e)},_dissociateNodeAndEventListener:function(t,e){var r=this._nodeListenersMap[t.__instanceId];r&&(cc.js.array.remove(r,e),r.length===0&&delete this._nodeListenersMap[t.__instanceId])},_dispatchEventToListeners:function(t,e,r){var a,c,h=!1,u=t.getFixedPriorityListeners(),d=t.getSceneGraphPriorityListeners(),f=0;if(u&&u.length!==0){for(;f<t.gt0Index;++f)if((c=u[f]).isEnabled()&&!c._isPaused()&&c._isRegistered()&&e(c,r)){h=!0;break}}if(d&&!h){for(a=0;a<d.length;a++)if((c=d[a]).isEnabled()&&!c._isPaused()&&c._isRegistered()&&e(c,r)){h=!0;break}}if(u&&!h){for(;f<u.length;++f)if((c=u[f]).isEnabled()&&!c._isPaused()&&c._isRegistered()&&e(c,r)){h=!0;break}}},_setDirty:function(t,e){var r=this._priorityDirtyFlagMap;r[t]==null?r[t]=e:r[t]=e|r[t]},_visitTarget:function(t,e){t._reorderChildDirty&&t.sortAllChildren();var r=t.getChildren(),a=0,c=r.length,h=this._globalZOrderNodeMap,u=this._nodeListenersMap;if(c>0){for(var d;a<c&&(d=r[a])&&d.getLocalZOrder()<0;a++)this._visitTarget(d,!1);for(u[t.__instanceId]!==void 0&&(h[t.getGlobalZOrder()]||(h[t.getGlobalZOrder()]=[]),h[t.getGlobalZOrder()].push(t.__instanceId));a<c;a++)(d=r[a])&&this._visitTarget(d,!1)}else u[t.__instanceId]!==void 0&&(h[t.getGlobalZOrder()]||(h[t.getGlobalZOrder()]=[]),h[t.getGlobalZOrder()].push(t.__instanceId));if(e){var f=[];for(var m in h)f.push(m);f.sort(this._sortNumberAsc);var v,_,p=f.length,g=this._nodePriorityMap;for(a=0;a<p;a++)for(v=h[f[a]],_=0;_<v.length;_++)g[v[_]]=++this._nodePriorityIndex;this._globalZOrderNodeMap={}}},_sortNumberAsc:function(t,e){return t-e},hasEventListener:function(t){return!!this._getListeners(t)},addListener:function(t,e){if(cc.assertID(t&&e,3503),cc.js.isNumber(e)||e instanceof cc._BaseNode||e instanceof _ccsg.Node){if(t instanceof cc.EventListener){if(t._isRegistered())return void cc.logID(3505)}else cc.assertID(!cc.js.isNumber(e),3504),t=cc.EventListener.create(t);if(t.checkAvailable()){if(cc.js.isNumber(e)){if(e===0)return void cc.logID(3500);t._setSceneGraphPriority(null),t._setFixedPriority(e),t._setRegistered(!0),t._setPaused(!1),this._addListener(t)}else t._setSceneGraphPriority(e),t._setFixedPriority(0),t._setRegistered(!0),this._addListener(t);return t}}else cc.warnID(3506)},addCustomListener:function(t,e){var r=new cc._EventListenerCustom(t,e);return this.addListener(r,1),r},removeListener:function(t){if(t!=null){var e,r=this._listenersMap;for(var a in r){var c=r[a],h=c.getFixedPriorityListeners(),u=c.getSceneGraphPriorityListeners();if((e=this._removeListenerInVector(u,t))?this._setDirty(t._getListenerID(),this.DIRTY_SCENE_GRAPH_PRIORITY):(e=this._removeListenerInVector(h,t))&&this._setDirty(t._getListenerID(),this.DIRTY_FIXED_PRIORITY),c.empty()&&(delete this._priorityDirtyFlagMap[t._getListenerID()],delete r[a]),e)break}if(!e)for(var d=this._toAddedListeners,f=0,m=d.length;f<m;f++){var v=d[f];if(v===t){cc.js.array.remove(d,v),v._setRegistered(!1);break}}}},_removeListenerInCallback:function(t,e){if(t==null)return!1;for(var r=0,a=t.length;r<a;r++){var c=t[r];if(c._onCustomEvent===e||c._onEvent===e)return c._setRegistered(!1),c._getSceneGraphPriority()!=null&&(this._dissociateNodeAndEventListener(c._getSceneGraphPriority(),c),c._setSceneGraphPriority(null)),this._inDispatch===0?cc.js.array.remove(t,c):this._toRemovedListeners.push(c),!0}return!1},_removeListenerInVector:function(t,e){if(t==null)return!1;for(var r=0,a=t.length;r<a;r++){var c=t[r];if(c===e)return c._setRegistered(!1),c._getSceneGraphPriority()!=null&&(this._dissociateNodeAndEventListener(c._getSceneGraphPriority(),c),c._setSceneGraphPriority(null)),this._inDispatch===0?cc.js.array.remove(t,c):this._toRemovedListeners.push(c),!0}return!1},removeListeners:function(t,e){if(cc.js.isNumber(t)||t instanceof cc._BaseNode||t instanceof _ccsg.Node)if(t.__instanceId!==void 0){delete this._nodePriorityMap[t.__instanceId],cc.js.array.remove(this._dirtyNodes,t);var r,a=this._nodeListenersMap[t.__instanceId];if(a){var c=cc.js.array.copy(a);for(r=0;r<c.length;r++)this.removeListener(c[r]);delete this._nodeListenersMap[t.__instanceId]}var h=this._toAddedListeners;for(r=0;r<h.length;){var u=h[r];u._getSceneGraphPriority()===t?(u._setSceneGraphPriority(null),u._setRegistered(!1),h.splice(r,1)):++r}if(e===!0){var d,f=t.getChildren();for(r=0,d=f.length;r<d;r++)this.removeListeners(f[r],!0)}}else t===cc.EventListener.TOUCH_ONE_BY_ONE?this._removeListenersForListenerID(cc._EventListenerTouchOneByOne.LISTENER_ID):t===cc.EventListener.TOUCH_ALL_AT_ONCE?this._removeListenersForListenerID(cc._EventListenerTouchAllAtOnce.LISTENER_ID):t===cc.EventListener.MOUSE?this._removeListenersForListenerID(cc._EventListenerMouse.LISTENER_ID):t===cc.EventListener.ACCELERATION?this._removeListenersForListenerID(cc._EventListenerAcceleration.LISTENER_ID):t===cc.EventListener.KEYBOARD?this._removeListenersForListenerID(cc._EventListenerKeyboard.LISTENER_ID):cc.logID(3501);else cc.warnID(3506)},removeCustomListeners:function(t){this._removeListenersForListenerID(t)},removeAllListeners:function(){var t=this._listenersMap,e=this._internalCustomListenerIDs;for(var r in t)e.indexOf(r)===-1&&this._removeListenersForListenerID(r)},setPriority:function(t,e){if(t!=null){var r=this._listenersMap;for(var a in r){var c=r[a].getFixedPriorityListeners();if(c&&c.indexOf(t)!==-1)return t._getSceneGraphPriority()!=null&&cc.logID(3502),void(t._getFixedPriority()!==e&&(t._setFixedPriority(e),this._setDirty(t._getListenerID(),this.DIRTY_FIXED_PRIORITY)))}}},setEnabled:function(t){this._isEnabled=t},isEnabled:function(){return this._isEnabled},dispatchEvent:function(t){if(this._isEnabled){if(this._updateDirtyFlagForSceneGraph(),this._inDispatch++,!t||!t.getType)throw new Error("event is undefined");if(t.getType().startsWith(cc.Event.TOUCH))return this._dispatchTouchEvent(t),void this._inDispatch--;var e=function(a){var c=cc.Event,h=a.type;return h===c.ACCELERATION?cc._EventListenerAcceleration.LISTENER_ID:h===c.KEYBOARD?cc._EventListenerKeyboard.LISTENER_ID:h.startsWith(c.MOUSE)?cc._EventListenerMouse.LISTENER_ID:(h.startsWith(c.TOUCH)&&cc.logID(2e3),"")}(t);this._sortEventListeners(e);var r=this._listenersMap[e];r!=null&&(this._dispatchEventToListeners(r,this._onListenerCallback,t),this._onUpdateListeners(r)),this._inDispatch--}},_onListenerCallback:function(t,e){return e.currentTarget=t._target,t._onEvent(e),e.isStopped()},dispatchCustomEvent:function(t,e){var r=new cc.Event.EventCustom(t);r.setUserData(e),this.dispatchEvent(r)}};o.get(cc,"eventManager",function(){return cc.warnID(1405,"cc.eventManager","cc.EventTarget or cc.systemEvent"),n}),N.exports=n},{"../platform/js":156}],94:[function(T,N,z){cc.Touch=cc._Class.extend({ctor:function(o,s,n){this._lastModified=0,this.setTouchInfo(n,o,s)},getLocation:function(){return{x:this._point.x,y:this._point.y}},getLocationX:function(){return this._point.x},getLocationY:function(){return this._point.y},getPreviousLocation:function(){return{x:this._prevPoint.x,y:this._prevPoint.y}},getStartLocation:function(){return{x:this._startPoint.x,y:this._startPoint.y}},getDelta:function(){return cc.pSub(this._point,this._prevPoint)},getLocationInView:function(){return{x:this._point.x,y:cc.view._designResolutionSize.height-this._point.y}},getPreviousLocationInView:function(){return{x:this._prevPoint.x,y:cc.view._designResolutionSize.height-this._prevPoint.y}},getStartLocationInView:function(){return{x:this._startPoint.x,y:cc.view._designResolutionSize.height-this._startPoint.y}},getID:function(){return this._id},setTouchInfo:function(o,s,n){this._prevPoint=this._point,this._point=cc.p(s||0,n||0),this._id=o,this._startPointCaptured||(this._startPoint=cc.p(this._point),cc.view._convertPointWithScale(this._startPoint),this._startPointCaptured=!0)},_setPoint:function(o,s){s===void 0?(this._point.x=o.x,this._point.y=o.y):(this._point.x=o,this._point.y=s)},_setPrevPoint:function(o,s){this._prevPoint=s===void 0?cc.p(o.x,o.y):cc.p(o||0,s||0)}})},{}],95:[function(T,N,z){T("./CCEvent");var o;T("./CCTouch"),T("./CCEventListener"),o=T("./CCEventManager"),N.exports=o},{"./CCEvent":91,"./CCEventListener":92,"./CCEventManager":93,"./CCTouch":94}],96:[function(T,N,z){function o(){n.call(this)}var s=cc.js,n=T("../platform/callbacks-invoker").CallbacksHandler;s.extend(o,n),o.prototype.invoke=function(t,e){var r=t.type,a=this._callbackTable[r];if(a){var c=!a.isInvoking;a.isInvoking=!0;for(var h=a.callbacks,u=a.targets,d=0,f=h.length;d<f;++d){var m=h[d];if(m){var v=u[d]||t.currentTarget;if(m.call(v,t,e),t._propagationImmediateStopped)break}}c&&(a.isInvoking=!1,a.containCanceled&&a.purgeCanceled())}},N.exports=o},{"../platform/callbacks-invoker":149}],97:[function(T,N,z){function o(){this._capturingListeners=null,this._bubblingListeners=null,this._hasListenerCache=null}var s=T("./event-listeners");T("./event");var n=cc.js.array.fastRemove,t=new Array(16);t.length=0;var e=o.prototype;e._addEventFlag=function(r,a,c){var h=this._hasListenerCache;h||(h=this._hasListenerCache=cc.js.createMap()),h[r]===void 0&&(h[r]=0);var u=c?2:4;h[r]|=u},e._purgeEventFlag=function(r,a,c){var h=this._hasListenerCache;if(h&&!a.has(r)){var u=c?2:4;h[r]&=~u,h[r]===0&&delete h[r]}},e._resetFlagForTarget=function(r,a,c){var h=this._hasListenerCache;if(h){var u=c?2:4;for(var d in h)a.has(d)||(h[d]&=~u,h[d]===0&&delete h[d])}},e.hasEventListener=function(r,a){var c=this._hasListenerCache;if(!c)return!1;var h=a?2:4;return(c[r]&h)>0},e.on=function(r,a,c,h){if(typeof c=="boolean"?(h=c,c=void 0):h=!!h,a){var u=null;return(u=h?this._capturingListeners=this._capturingListeners||new s:this._bubblingListeners=this._bubblingListeners||new s).has(r,a,c)||(u.add(r,a,c),c&&c.__eventTargets&&c.__eventTargets.push(this),this._addEventFlag(r,u,h)),a}cc.errorID(6800)},e.off=function(r,a,c,h){if(typeof c=="boolean"?(h=c,c=void 0):h=!!h,a){var u=h?this._capturingListeners:this._bubblingListeners;u&&(u.remove(r,a,c),c&&c.__eventTargets&&n(c.__eventTargets,this),this._purgeEventFlag(r,u,h))}else this._capturingListeners&&this._capturingListeners.removeAll(r),this._bubblingListeners&&this._bubblingListeners.removeAll(r),this._hasListenerCache&&delete this._hasListenerCache[r]},e.targetOff=function(r){this._capturingListeners&&(this._capturingListeners.removeAll(r),this._resetFlagForTarget(r,this._capturingListeners,!0)),this._bubblingListeners&&(this._bubblingListeners.removeAll(r),this._resetFlagForTarget(r,this._bubblingListeners,!1))},e.once=function(r,a,c,h){var u="__ONCE_FLAG:"+r,d=h?this._capturingListeners:this._bubblingListeners;if(!(d&&d.has(u,a,c))){var f=this,m=function(v){f.off(r,m,c,h),d.remove(u,a,c),a.call(this,v)};this.on(r,m,c,h),d||(d=h?this._capturingListeners:this._bubblingListeners),d.add(u,a,c)}},e.dispatchEvent=function(r){(function(a,c){var h,u;for(c.target=a,t.length=0,a._getCapturingTargets(c.type,t),c.eventPhase=1,u=t.length-1;u>=0;--u)if((h=t[u])._isTargetActive(c.type)&&h._capturingListeners&&(c.currentTarget=h,h._capturingListeners.invoke(c,t),c._propagationStopped))return void(t.length=0);if(t.length=0,a._isTargetActive(c.type)&&(c.eventPhase=2,c.currentTarget=a,a._capturingListeners&&a._capturingListeners.invoke(c),!c._propagationImmediateStopped&&a._bubblingListeners&&a._bubblingListeners.invoke(c)),!c._propagationStopped&&c.bubbles){for(a._getBubblingTargets(c.type,t),c.eventPhase=3,u=0;u<t.length;++u)if((h=t[u])._isTargetActive(c.type)&&h._bubblingListeners&&(c.currentTarget=h,h._bubblingListeners.invoke(c),c._propagationStopped))return void(t.length=0)}t.length=0})(this,r),t.length=0},e.emit=function(r,a){var c=this._hasListenerCache;if(c){var h=c[r];if(h){var u=cc.Event.EventCustom.get(r);u.detail=a,u.eventPhase=2,u.target=u.currentTarget=this;var d=this._capturingListeners;d&&2&h&&d.invoke(u);var f=this._bubblingListeners;f&&4&h&&!u._propagationImmediateStopped&&f.invoke(u),u.detail=null,cc.Event.EventCustom.put(u)}}},e._isTargetActive=function(r){return!0},e._getCapturingTargets=function(r,a){},e._getBubblingTargets=function(r,a){},o.prototype._EventTargetOn=o.prototype.on,o.prototype._EventTargetOnce=o.prototype.once,o.prototype._EventTargetOff=o.prototype.off,o.prototype._EventTargetTargetOff=o.prototype.targetOff,cc.EventTarget=N.exports=o},{"./event":98,"./event-listeners":96}],98:[function(T,N,z){var o=T("../platform/js");cc.Event=function(t,e){this.type=t,this.bubbles=!!e,this.target=null,this.currentTarget=null,this.eventPhase=0,this._propagationStopped=!1,this._propagationImmediateStopped=!1},cc.Event.prototype={constructor:cc.Event,unuse:function(){this.type=cc.Event.NO_TYPE,this.target=null,this.currentTarget=null,this.eventPhase=cc.Event.NONE,this._propagationStopped=!1,this._propagationImmediateStopped=!1},reuse:function(t,e){this.type=t,this.bubbles=e||!1},stopPropagation:function(){this._propagationStopped=!0},stopPropagationImmediate:function(){this._propagationImmediateStopped=!0},isStopped:function(){return this._propagationStopped||this._propagationImmediateStopped},getCurrentTarget:function(){return this.currentTarget},getType:function(){return this.type}},cc.Event.NO_TYPE="no_type",cc.Event.TOUCH="touch",cc.Event.MOUSE="mouse",cc.Event.KEYBOARD="keyboard",cc.Event.ACCELERATION="acceleration",cc.Event.NONE=0,cc.Event.CAPTURING_PHASE=1,cc.Event.AT_TARGET=2,cc.Event.BUBBLING_PHASE=3;var s=function(t,e){cc.Event.call(this,t,e),this.detail=null};o.extend(s,cc.Event),s.prototype.reset=s,s.prototype.setUserData=function(t){this.detail=t},s.prototype.getUserData=function(){return this.detail},s.prototype.getEventName=cc.Event.prototype.getType;var n=new o.Pool(10);s.put=function(t){n.put(t)},s.get=function(t,e){var r=n._get();return r?r.reset(t,e):r=new s(t,e),r},cc.Event.EventCustom=s,N.exports=cc.Event},{"../platform/js":156}],99:[function(T,N,z){T("./event"),T("./event-listeners"),T("./event-target"),T("./system-event")},{"./event":98,"./event-listeners":96,"./event-target":97,"./system-event":100}],100:[function(T,N,z){var o,s=T("../event/event-target"),n=T("../event-manager");o=T("../platform/CCInputManager");var t=cc.Enum({KEY_DOWN:"keydown",KEY_UP:"keyup",DEVICEMOTION:"devicemotion"}),e=null,r=null,a=0,c=cc.Class({name:"SystemEvent",extends:s,statics:{EventType:t},setAccelerometerEnabled:function(h){o.setAccelerometerEnabled(h)},setAccelerometerInterval:function(h){o.setAccelerometerInterval(h)},on:function(h,u,d,f){if(this._super(h,u,d,f),(h===t.KEY_DOWN||h===t.KEY_UP)&&(e||(e=cc.EventListener.create({event:cc.EventListener.KEYBOARD,onKeyPressed:function(v,_){_.type=t.KEY_DOWN,cc.systemEvent.dispatchEvent(_)},onKeyReleased:function(v,_){_.type=t.KEY_UP,cc.systemEvent.dispatchEvent(_)}})),!n.hasEventListener(cc._EventListenerKeyboard.LISTENER_ID))){var m=cc.director.getTotalFrames();m!==a&&(n.addListener(e,1),a=m)}h===t.DEVICEMOTION&&(r||(r=cc.EventListener.create({event:cc.EventListener.ACCELERATION,callback:function(v,_){_.type=t.DEVICEMOTION,cc.systemEvent.dispatchEvent(_)}})),n.hasEventListener(cc._EventListenerAcceleration.LISTENER_ID)||n.addListener(r,1))},off:function(h,u,d,f){if(this._super(h,u,d,f),e&&(h===t.KEY_DOWN||h===t.KEY_UP)){var m=this.hasEventListener(t.KEY_DOWN),v=this.hasEventListener(t.KEY_UP);m||v||n.removeListener(e)}r&&h===t.DEVICEMOTION&&n.removeListener(r)}});cc.SystemEvent=N.exports=c,cc.systemEvent=new cc.SystemEvent},{"../event-manager":95,"../event/event-target":97,"../platform/CCInputManager":139}],101:[function(T,N,z){"use strict";function o(g,y,C){C=C||2;var S=y&&y.length,I=S?y[0]*C:g.length,b=s(g,0,I,C,!0),A=[];if(!b)return A;var E,R,O,P,x,w,L;if(S&&(b=function(F,M,B,W){var V,U,k,X,Y,Z=[];for(V=0,U=M.length;V<U;V++)k=M[V]*W,X=V<U-1?M[V+1]*W:F.length,(Y=s(F,k,X,W,!1))===Y.next&&(Y.steiner=!0),Z.push(function(et){var $=et,nt=et;do $.x<nt.x&&(nt=$),$=$.next;while($!==et);return nt}(Y));for(Z.sort(e),V=0;V<Z.length;V++)(function(et,$){if($=function(at,rt){var it,ot=rt,_t=at.x,ut=at.y,vt=-1/0;do{if(ut<=ot.y&&ut>=ot.next.y){var Tt=ot.x+(ut-ot.y)*(ot.next.x-ot.x)/(ot.next.y-ot.y);if(Tt<=_t&&Tt>vt){if(vt=Tt,Tt===_t){if(ut===ot.y)return ot;if(ut===ot.next.y)return ot.next}it=ot.x<ot.next.x?ot:ot.next}}ot=ot.next}while(ot!==rt);if(!it)return null;if(_t===vt)return it.prev;var Rt,zt=it,qt=it.x,Zt=it.y,Kt=1/0;for(ot=it.next;ot!==zt;)_t>=ot.x&&ot.x>=qt&&a(ut<Zt?_t:vt,ut,qt,Zt,ut<Zt?vt:_t,ut,ot.x,ot.y)&&((Rt=Math.abs(ut-ot.y)/(_t-ot.x))<Kt||Rt===Kt&&ot.x>it.x)&&d(ot,at)&&(it=ot,Kt=Rt),ot=ot.next;return it}(et,$)){var nt=f($,et);n(nt,nt.next)}})(Z[V],B),B=n(B,B.next);return B}(g,y,b,C)),g.length>80*C){E=O=g[0],R=P=g[1];for(var D=C;D<I;D+=C)x=g[D],w=g[D+1],x<E&&(E=x),w<R&&(R=w),x>O&&(O=x),w>P&&(P=w);L=Math.max(O-E,P-R)}return t(b,A,C,E,R,L),A}function s(g,y,C,S,I){var b,A;if(I===p(g,y,C,S)>0)for(b=y;b<C;b+=S)A=m(b,g[b],g[b+1],A);else for(b=C-S;b>=y;b-=S)A=m(b,g[b],g[b+1],A);return A&&h(A,A.next)&&(v(A),A=A.next),A}function n(g,y){if(!g)return g;y||(y=g);var C,S=g;do if(C=!1,S.steiner||!h(S,S.next)&&c(S.prev,S,S.next)!==0)S=S.next;else{if(v(S),(S=y=S.prev)===S.next)return null;C=!0}while(C||S!==y);return y}function t(g,y,C,S,I,b,A){if(g){!A&&b&&function(P,x,w,L){var D=P;do D.z===null&&(D.z=r(D.x,D.y,x,w,L)),D.prevZ=D.prev,D.nextZ=D.next,D=D.next;while(D!==P);D.prevZ.nextZ=null,D.prevZ=null,function(F){var M,B,W,V,U,k,X,Y,Z=1;do{for(B=F,F=null,U=null,k=0;B;){for(k++,W=B,X=0,M=0;M<Z&&(X++,W=W.nextZ);M++);for(Y=Z;X>0||Y>0&&W;)X===0?(V=W,W=W.nextZ,Y--):Y!==0&&W?B.z<=W.z?(V=B,B=B.nextZ,X--):(V=W,W=W.nextZ,Y--):(V=B,B=B.nextZ,X--),U?U.nextZ=V:F=V,V.prevZ=U,U=V;B=W}U.nextZ=null,Z*=2}while(k>1)}(D)}(g,S,I,b);for(var E,R,O=g;g.prev!==g.next;)if(E=g.prev,R=g.next,b?function(P,x,w,L){var D=P.prev,F=P,M=P.next;if(c(D,F,M)>=0)return!1;for(var B=D.x<F.x?D.x<M.x?D.x:M.x:F.x<M.x?F.x:M.x,W=D.y<F.y?D.y<M.y?D.y:M.y:F.y<M.y?F.y:M.y,V=D.x>F.x?D.x>M.x?D.x:M.x:F.x>M.x?F.x:M.x,U=D.y>F.y?D.y>M.y?D.y:M.y:F.y>M.y?F.y:M.y,k=r(B,W,x,w,L),X=r(V,U,x,w,L),Y=P.nextZ;Y&&Y.z<=X;){if(Y!==P.prev&&Y!==P.next&&a(D.x,D.y,F.x,F.y,M.x,M.y,Y.x,Y.y)&&c(Y.prev,Y,Y.next)>=0)return!1;Y=Y.nextZ}for(Y=P.prevZ;Y&&Y.z>=k;){if(Y!==P.prev&&Y!==P.next&&a(D.x,D.y,F.x,F.y,M.x,M.y,Y.x,Y.y)&&c(Y.prev,Y,Y.next)>=0)return!1;Y=Y.prevZ}return!0}(g,S,I,b):function(P){var x=P.prev,w=P,L=P.next;if(c(x,w,L)>=0)return!1;for(var D=P.next.next;D!==P.prev;){if(a(x.x,x.y,w.x,w.y,L.x,L.y,D.x,D.y)&&c(D.prev,D,D.next)>=0)return!1;D=D.next}return!0}(g))y.push(E.i/C),y.push(g.i/C),y.push(R.i/C),v(g),g=R.next,O=R.next;else if((g=R)===O){A?A===1?t(g=function(P,x,w){var L=P;do{var D=L.prev,F=L.next.next;!h(D,F)&&u(D,L,L.next,F)&&d(D,F)&&d(F,D)&&(x.push(D.i/w),x.push(L.i/w),x.push(F.i/w),v(L),v(L.next),L=P=F),L=L.next}while(L!==P);return L}(g,y,C),y,C,S,I,b,2):A===2&&function(P,x,w,L,D,F){var M=P;do{for(var B=M.next.next;B!==M.prev;){if(M.i!==B.i&&function(V,U){return V.next.i!==U.i&&V.prev.i!==U.i&&!function(k,X){var Y=k;do{if(Y.i!==k.i&&Y.next.i!==k.i&&Y.i!==X.i&&Y.next.i!==X.i&&u(Y,Y.next,k,X))return!0;Y=Y.next}while(Y!==k);return!1}(V,U)&&d(V,U)&&d(U,V)&&function(k,X){var Y=k,Z=!1,et=(k.x+X.x)/2,$=(k.y+X.y)/2;do Y.y>$!=Y.next.y>$&&et<(Y.next.x-Y.x)*($-Y.y)/(Y.next.y-Y.y)+Y.x&&(Z=!Z),Y=Y.next;while(Y!==k);return Z}(V,U)}(M,B)){var W=f(M,B);return M=n(M,M.next),W=n(W,W.next),t(M,x,w,L,D,F),void t(W,x,w,L,D,F)}B=B.next}M=M.next}while(M!==P)}(g,y,C,S,I,b):t(n(g),y,C,S,I,b,1);break}}}function e(g,y){return g.x-y.x}function r(g,y,C,S,I){return g=32767*(g-C)/I,y=32767*(y-S)/I,g=16711935&(g|g<<8),g=252645135&(g|g<<4),g=858993459&(g|g<<2),g=1431655765&(g|g<<1),y=16711935&(y|y<<8),y=252645135&(y|y<<4),y=858993459&(y|y<<2),y=1431655765&(y|y<<1),g|y<<1}function a(g,y,C,S,I,b,A,E){return(I-A)*(y-E)-(g-A)*(b-E)>=0&&(g-A)*(S-E)-(C-A)*(y-E)>=0&&(C-A)*(b-E)-(I-A)*(S-E)>=0}function c(g,y,C){return(y.y-g.y)*(C.x-y.x)-(y.x-g.x)*(C.y-y.y)}function h(g,y){return g.x===y.x&&g.y===y.y}function u(g,y,C,S){return!!(h(g,y)&&h(C,S)||h(g,S)&&h(C,y))||c(g,y,C)>0!=c(g,y,S)>0&&c(C,S,g)>0!=c(C,S,y)>0}function d(g,y){return c(g.prev,g,g.next)<0?c(g,y,g.next)>=0&&c(g,g.prev,y)>=0:c(g,y,g.prev)<0||c(g,g.next,y)<0}function f(g,y){var C=new _(g.i,g.x,g.y),S=new _(y.i,y.x,y.y),I=g.next,b=y.prev;return g.next=y,y.prev=g,C.next=I,I.prev=C,S.next=C,C.prev=S,b.next=S,S.prev=b,S}function m(g,y,C,S){var I=new _(g,y,C);return S?(I.next=S.next,I.prev=S,S.next.prev=I,S.next=I):(I.prev=I,I.next=I),I}function v(g){g.next.prev=g.prev,g.prev.next=g.next,g.prevZ&&(g.prevZ.nextZ=g.nextZ),g.nextZ&&(g.nextZ.prevZ=g.prevZ)}function _(g,y,C){this.i=g,this.x=y,this.y=C,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function p(g,y,C,S){for(var I=0,b=y,A=C-S;b<C;b+=S)I+=(g[A]-g[b])*(g[b+1]+g[A+1]),A=b;return I}N.exports=o,o.deviation=function(g,y,C,S){var I=y&&y.length,b=I?y[0]*C:g.length,A=Math.abs(p(g,0,b,C));if(I)for(var E=0,R=y.length;E<R;E++){var O=y[E]*C,P=E<R-1?y[E+1]*C:g.length;A-=Math.abs(p(g,O,P,C))}var x=0;for(E=0;E<S.length;E+=3){var w=S[E]*C,L=S[E+1]*C,D=S[E+2]*C;x+=Math.abs((g[w]-g[D])*(g[L+1]-g[w+1])-(g[w]-g[L])*(g[D+1]-g[w+1]))}return A===0&&x===0?0:Math.abs((x-A)/A)},o.flatten=function(g){for(var y=g[0][0].length,C={vertices:[],holes:[],dimensions:y},S=0,I=0;I<g.length;I++){for(var b=0;b<g[I].length;b++)for(var A=0;A<y;A++)C.vertices.push(g[I][b][A]);I>0&&(S+=g[I-1].length,C.holes.push(S))}return C}},{}],102:[function(T,N,z){cc.js;var o=T("./types").LineCap,s=T("./types").LineJoin,n=T("./helper"),t=function(r){this._rootCtor(r),this._needDraw=!0,this.cmds=[],this.style={strokeStyle:"black",fillStyle:"white",lineCap:"butt",lineJoin:"miter",miterLimit:10}},e=t.prototype=Object.create(_ccsg.Node.CanvasRenderCmd.prototype);e.constructor=t,e._updateCurrentRegions=function(){var r=this._currentRegion;this._currentRegion=this._oldRegion,this._oldRegion=r,this._currentRegion.setTo(0,0,cc.visibleRect.width,cc.visibleRect.height)},e.rendering=function(r,a,c){var h=r||cc._renderContext,u=h.getContext();h.setTransform(this._worldTransform,a,c),u.save(),u.scale(1,-1);var d=this.style;u.strokeStyle=d.strokeStyle,u.fillStyle=d.fillStyle,u.lineWidth=d.lineWidth,u.lineJoin=d.lineJoin,u.miterLimit=d.miterLimit;for(var f=!0,m=this.cmds,v=0,_=m.length;v<_;v++){var p=m[v],g=p[0],y=p[1];g==="moveTo"&&f?(u.beginPath(),f=!1):g!=="fill"&&g!=="stroke"&&g!=="fillRect"||(f=!0),typeof u[g]=="function"?u[g].apply(u,y):u[g]=y}u.restore()},e.setStrokeColor=function(r){var a="rgba("+(0|r.r)+","+(0|r.g)+","+(0|r.b)+","+r.a/255+")";this.cmds.push(["strokeStyle",a]),this.style.strokeStyle=a},e.setFillColor=function(r){var a="rgba("+(0|r.r)+","+(0|r.g)+","+(0|r.b)+","+r.a/255+")";this.cmds.push(["fillStyle",a]),this.style.fillStyle=a},e.setLineWidth=function(r){this.cmds.push(["lineWidth",r]),this.style.lineWidth=r},e.setLineCap=function(r){var a="butt";r===o.BUTT?a="butt":r===o.ROUND?a="round":r===o.SQUARE&&(a="square"),this.cmds.push(["lineCap",a]),this.style.lineCap=a},e.setLineJoin=function(r){var a="bevel";r===s.BEVEL?a="bevel":r===s.ROUND?a="round":r===s.MITER&&(a="miter"),this.cmds.push(["lineJoin",a]),this.style.lineJoin=a},e.setMiterLimit=function(r){this.cmds.push(["miterLimit",r]),this.style.miterLimit=r},e.beginPath=function(){},e.moveTo=function(r,a){this.cmds.push(["moveTo",[r,a]])},e.lineTo=function(r,a){this.cmds.push(["lineTo",[r,a]])},e.bezierCurveTo=function(r,a,c,h,u,d){this.cmds.push(["bezierCurveTo",[r,a,c,h,u,d]])},e.quadraticCurveTo=function(r,a,c,h){this.cmds.push(["quadraticCurveTo",[r,a,c,h]])},e.arc=function(r,a,c,h,u,d){n.arc(this,r,a,c,h,u,d)},e.ellipse=function(r,a,c,h){n.ellipse(this,r,a,c,h)},e.circle=function(r,a,c){n.ellipse(this,r,a,c,c)},e.rect=function(r,a,c,h){this.moveTo(r,a),this.lineTo(r+c,a),this.lineTo(r+c,a+h),this.lineTo(r,a+h),this.close()},e.roundRect=function(r,a,c,h,u){n.roundRect(this,r,a,c,h,u)},e.fillRect=function(r,a,c,h){this.cmds.push(["fillRect",[r,a,c,h]]),this.setDirtyFlag(_ccsg.Node._dirtyFlags.contentDirty)},e.close=function(){this.cmds.push(["closePath",[]])},e.stroke=function(){this.cmds.push(["stroke",[]]),this.setDirtyFlag(_ccsg.Node._dirtyFlags.contentDirty)},e.fill=function(){this.cmds.push(["fill",[]]),this.setDirtyFlag(_ccsg.Node._dirtyFlags.contentDirty)},e.clear=function(){this.cmds.length=0,this.setDirtyFlag(_ccsg.Node._dirtyFlags.contentDirty)},N.exports=t},{"./helper":106,"./types":108}],103:[function(T,N,z){var o=T("./graphics-canvas-cmd"),s=T("./graphics-webgl-cmd"),n=T("./types").LineCap,t=T("./types").LineJoin,e=(cc.js,_ccsg.Node.extend({ctor:function(){this._super(),this.strokeColor=cc.Color.BLACK,this.fillColor=cc.Color.WHITE},clear:function(a){this._renderCmd.clear(a)},_createRenderCmd:function(){return cc._renderType===cc.game.RENDER_TYPE_CANVAS?new o(this):new s(this)}})),r=e.prototype;r._strokeColor=null,r._fillColor=null,r._lineWidth=1,r._lineCap=n.BUTT,r._lineJoin=t.MITER,r._miterLimit=10,r.setStrokeColor=function(a){this._strokeColor=a,this._renderCmd.setStrokeColor(a)},r.getStrokeColor=function(){return this._strokeColor},r.setFillColor=function(a){this._fillColor=a,this._renderCmd.setFillColor(a)},r.getFillColor=function(){return this._fillColor},r.setLineWidth=function(a){this._lineWidth=a,this._renderCmd.setLineWidth(a)},r.getLineWidth=function(){return this._lineWidth},r.setLineCap=function(a){this._lineCap=a,this._renderCmd.setLineCap(a)},r.getLineCap=function(){return this._lineCap},r.setLineJoin=function(a){this._lineJoin=a,this._renderCmd.setLineJoin(a)},r.getLineJoin=function(){return this._lineJoin},r.setMiterLimit=function(a){this._miterLimit=a,this._renderCmd.setMiterLimit(a)},r.getMiterLimit=function(){return this._miterLimit},r.beginPath=function(){this._renderCmd.beginPath()},r.moveTo=function(a,c){this._renderCmd.moveTo(a,c)},r.lineTo=function(a,c){this._renderCmd.lineTo(a,c)},r.bezierCurveTo=function(a,c,h,u,d,f){this._renderCmd.bezierCurveTo(a,c,h,u,d,f)},r.quadraticCurveTo=function(a,c,h,u){this._renderCmd.quadraticCurveTo(a,c,h,u)},r.arc=function(a,c,h,u,d,f){this._renderCmd.arc(a,c,h,u,d,f)},r.ellipse=function(a,c,h,u){this._renderCmd.ellipse(a,c,h,u)},r.circle=function(a,c,h){this._renderCmd.circle(a,c,h)},r.rect=function(a,c,h,u){this._renderCmd.rect(a,c,h,u)},r.roundRect=function(a,c,h,u,d){this._renderCmd.roundRect(a,c,h,u,d)},r.fillRect=function(a,c,h,u){this._renderCmd.fillRect(a,c,h,u)},r.close=function(){this._renderCmd.close()},r.stroke=function(){this._renderCmd.stroke()},r.fill=function(){this._renderCmd.fill()},N.exports=e},{"./graphics-canvas-cmd":102,"./graphics-webgl-cmd":104,"./types":108}],104:[function(T,N,z){function o(E,R,O){return E<R?R:E>O?O:E}function s(E,R){u.call(this,E,R),this.reset()}function n(){this.reset()}function t(){this.vertsOffset=0,this.vertsVBO=gl.createBuffer(),this.vertsBuffer=null,this.uint32VertsBuffer=null,this.vertsDirty=!1,this.indicesOffset=0,this.indicesVBO=gl.createBuffer(),this.indicesBuffer=null,this.indicesDirty=!1}function e(E){this._rootCtor(E),this._needDraw=!0,cc._renderContext,this._buffers=[],this._buffer=null,this._allocBuffer(),this._matrix=new cc.math.Matrix4,this._matrix.identity(),this._paths=[],this._points=[],this._curColorValue=0,this._blendFunc=new cc.BlendFunc(cc.macro.BLEND_SRC,cc.macro.BLEND_DST);var R=new cc.GLProgram;R.initWithVertexShaderByteArray(cc.PresetShaders.POSITION_COLOR_VERT,cc.PresetShaders.POSITION_COLOR_FRAG),R.retain(),R.addAttribute(cc.macro.ATTRIBUTE_NAME_POSITION,cc.macro.VERTEX_ATTRIB_POSITION),R.addAttribute(cc.macro.ATTRIBUTE_NAME_COLOR,cc.macro.VERTEX_ATTRIB_COLOR),R.link(),R.updateUniforms(),this._shaderProgram=R,this._allocVerts(f)}var r=T("./types").LineCap,a=T("./types").LineJoin,c=T("./earcut"),h=T("./helper"),u=cc.Vec2,d=cc.js,f=32,m=Math.PI,v=Math.min,_=Math.max,p=Math.ceil,g=Math.acos,y=Math.cos,C=Math.sin,S=Math.atan2,I=Math.abs,b=cc.Enum({PT_CORNER:1,PT_LEFT:2,PT_BEVEL:4,PT_INNERBEVEL:8});d.extend(s,u),s.prototype.reset=function(){this.dx=0,this.dy=0,this.dmx=0,this.dmy=0,this.flags=0,this.len=0},n.prototype.reset=function(){this.closed=!1,this.nbevel=0,this.complex=!0,this.points?this.points.length=0:this.points=[]},t.prototype.clear=function(){this.vertsOffset=0,this.indicesOffset=0},t.prototype.alloc=function(E,R){var O=this.vertsOffset+E;if(O>65535)return!1;var P=this.vertsBuffer,x=P?P.length/3:0;if(O>x){for(x===0&&(x=f);O>x;)x*=2;var w=new Float32Array(3*x),L=new Uint32Array(w.buffer);if(P)for(var D=this.uint32VertsBuffer,F=0,M=P.length;F<M;F+=3)w[F]=P[F],w[F+1]=P[F+1],L[F+2]=D[F+2];this.vertsBuffer=w,this.uint32VertsBuffer=L}var B=this.indicesBuffer,W=this.indicesOffset+R,V=B?B.length:0;if(W>V){for(V===0&&(V=3*f);W>V;)V*=2;var U=new Uint16Array(V);if(B)for(F=0,M=B.length;F<M;F++)U[F]=B[F];this.indicesBuffer=U}return!0},(e.prototype=Object.create(_ccsg.Node.WebGLRenderCmd.prototype)).constructor=e;var A=e.prototype;A._tessTol=.25,A._distTol=.01,A.lineWidth=1,A.lineCap=r.BUTT,A.lineJoin=a.MITER,A.miterLimit=10,A.beginPath=function(){this._pathOffset=this._pathLength},A.moveTo=function(E,R){this._updatePathOffset&&(this._pathOffset=this._pathLength,this._updatePathOffset=!1),this._addPath(),this._addPoint(E,R,b.PT_CORNER),this._commandx=E,this._commandy=R},A.lineTo=function(E,R){this._addPoint(E,R,b.PT_CORNER),this._commandx=E,this._commandy=R},A.bezierCurveTo=function(E,R,O,P,x,w){var L=this._curPath,D=L.points[L.points.length-1];D.x!==E||D.y!==R||O!==x||P!==w?(this._tesselateBezier(D.x,D.y,E,R,O,P,x,w,0,b.PT_CORNER),this._commandx=x,this._commandy=w):this.lineTo(x,w)},A.quadraticCurveTo=function(E,R,O,P){var x=this._commandx,w=this._commandy;this.bezierCurveTo(x+2/3*(E-x),w+2/3*(R-w),O+2/3*(E-O),P+2/3*(R-P),O,P)},A.arc=function(E,R,O,P,x,w){h.arc(this,E,R,O,P,x,w)},A.ellipse=function(E,R,O,P){h.ellipse(this,E,R,O,P),this._curPath.complex=!1},A.circle=function(E,R,O){h.ellipse(this,E,R,O,O),this._curPath.complex=!1},A.rect=function(E,R,O,P){this.moveTo(E,R),this.lineTo(E,R+P),this.lineTo(E+O,R+P),this.lineTo(E+O,R),this.close(),this._curPath.complex=!1},A.roundRect=function(E,R,O,P,x){h.roundRect(this,E,R,O,P,x),this._curPath.complex=!1},A.fillRect=function(E,R,O,P){this.rect(E,R,O,P),this.fill()},A.close=function(){this._curPath.closed=!0},A.stroke=function(){this._flattenPaths();var E=this._strokeColor;this._curColorValue=(E.a<<24>>>0)+(E.b<<16)+(E.g<<8)+E.r,this._expandStroke(),this._updatePathOffset=!0},A.fill=function(){var E=this._fillColor;this._curColorValue=(E.a<<24>>>0)+(E.b<<16)+(E.g<<8)+E.r,this._expandFill(),this._updatePathOffset=!0,this._filling=!1},A._strokeColor=null,A._fillColor=null,A.setStrokeColor=function(E){this._strokeColor=E},A.getStrokeColor=function(){return this._strokeColor},A.setFillColor=function(E){this._fillColor=E},A.getFillColor=function(){return this._fillColor},A.setLineWidth=function(E){this.lineWidth=E},A.setLineJoin=function(E){this.lineJoin=E},A.setLineCap=function(E){this.lineCap=E},A.setMiterLimit=function(E){this.miterLimit=E},d.getset(A,"strokeColor",A.getStrokeColor,A.setStrokeColor),d.getset(A,"fillColor",A.getFillColor,A.setFillColor),A._render=function(){var E=this._buffers;if(E.length!==0)for(var R=cc._renderContext,O=0,P=E.length;O<P;O++){var x=E[O];R.bindBuffer(R.ARRAY_BUFFER,x.vertsVBO),R.bindBuffer(R.ELEMENT_ARRAY_BUFFER,x.indicesVBO),x.vertsDirty&&(R.bufferData(R.ARRAY_BUFFER,x.vertsBuffer,R.STREAM_DRAW),x.vertsDirty=!1),x.indicesDirty&&x.indicesBuffer&&(R.bufferData(R.ELEMENT_ARRAY_BUFFER,x.indicesBuffer,R.STREAM_DRAW),x.indicesDirty=!1),R.enableVertexAttribArray(cc.macro.VERTEX_ATTRIB_POSITION),R.enableVertexAttribArray(cc.macro.VERTEX_ATTRIB_COLOR),R.vertexAttribPointer(cc.macro.VERTEX_ATTRIB_POSITION,2,R.FLOAT,!1,12,0),R.vertexAttribPointer(cc.macro.VERTEX_ATTRIB_COLOR,4,R.UNSIGNED_BYTE,!0,12,8),R.drawElements(R.TRIANGLES,x.indicesOffset,R.UNSIGNED_SHORT,0),cc.g_NumberOfDraws++}},A.rendering=function(){cc.gl.blendFunc(this._blendFunc.src,this._blendFunc.dst);var E=this._worldTransform,R=this._matrix.mat;R[0]=E.a,R[4]=E.c,R[12]=E.tx,R[1]=E.b,R[5]=E.d,R[13]=E.ty;var O=this._shaderProgram;O.use(),O._setUniformForMVPMatrixWithMat4(this._matrix),this._render()},A.clear=function(E){if(this._pathLength=0,this._pathOffset=0,this._pointsOffset=0,this._curPath=null,E)this._paths.length=0,this._points.length=0,this._buffer=null,this._buffers=[];else{for(var R=this._buffers,O=0;O<R.length;O++)R[O].clear();this._buffer=R[0]}},A._updatePathOffset=!1,A._paths=null,A._pathLength=0,A._pathOffset=0,A._points=null,A._pointsOffset=0,A._commandx=0,A._commandy=0,A._addPath=function(){var E=this._pathLength,R=this._paths[E];return R?R.reset():(R=new n,this._paths.push(R)),this._pathLength++,this._curPath=R,R},A._addPoint=function(E,R,O){var P=this._curPath;if(P){var x,w=this._points,L=P.points;(x=w[this._pointsOffset++])?(x.x=E,x.y=R):(x=new s(E,R),w.push(x)),x.flags=O,L.push(x)}},A._flattenPaths=function(){for(var E=this._paths,R=this._pathOffset,O=this._pathLength;R<O;R++){var P=E[R],x=P.points,w=x[x.length-1],L=x[0];w.equals(L)&&(P.closed=!0,x.pop(),w=x[x.length-1]);for(var D=0,F=x.length;D<F;D++){var M=L.sub(w);w.len=M.mag(),(M.x||M.y)&&M.normalizeSelf(),w.dx=M.x,w.dy=M.y,w=L,L=x[D+1]}}},A._allocBuffer=function(){if(this._buffer){var E=this._buffers.indexOf(this._buffer);if(E<this._buffers.length-1)return void(this._buffer=this._buffers[E+1])}var R=new t;this._buffers.push(R),this._buffer=R},A._allocVerts=function(E){this._buffer||this._allocBuffer();var R=3*(E-2*(this._pathLength-this._pathOffset));this._buffer.alloc(E,R)||(this._allocBuffer(),this._buffer.alloc(E,R)),this._buffer.vertsDirty=!0},A._expandStroke=function(){var E=.5*this.lineWidth,R=this.lineCap,O=this.lineJoin,P=this.miterLimit,x=this._curveDivs(E,m,this._tessTol),w=this._paths;this._calculateJoins(E,O,P);for(var L=0,D=this._pathOffset,F=this._pathLength;D<F;D++){var M=(W=w[D]).points.length;O===a.ROUND?L+=2*(M+W.nbevel*(x+2)+1):L+=2*(M+5*W.nbevel+1),W.closed||(R===r.ROUND?L+=2*(2*x+2):L+=12)}this._allocVerts(L);var B=this._buffer;for(D=this._pathOffset,F=this._pathLength;D<F;D++){var W,V,U,k,X,Y,Z=(W=w[D]).points;M=W.points.length,Y=W.closed;var et=B.vertsOffset;if(Y?(V=Z[M-1],U=Z[0],k=0,X=M):(V=Z[0],U=Z[1],k=1,X=M-1),!Y){(it=U.sub(V)).normalizeSelf();var $=it.x,nt=it.y;R===r.BUTT?this._buttCap(V,$,nt,E,0):R===r.SQUARE?this._buttCap(V,$,nt,E,E):R===r.ROUND&&this._roundCapStart(V,$,nt,E,x)}for(var at=k;at<X;++at)O===a.ROUND?this._roundJoin(V,U,E,E,x):U.flags&(b.PT_BEVEL|b.PT_INNERBEVEL)?this._bevelJoin(V,U,E,E):(this._vset(U.x+U.dmx*E,U.y+U.dmy*E),this._vset(U.x-U.dmx*E,U.y-U.dmy*E)),V=U,U=Z[at+1];if(Y){var rt=B.vertsBuffer;this._vset(rt[3*et],rt[3*et+1]),this._vset(rt[3*(et+1)],rt[3*(et+1)+1])}else{var it;(it=U.sub(V)).normalizeSelf(),$=it.x,nt=it.y,R===r.BUTT?this._buttCap(U,$,nt,E,0):R===r.BUTT||R===r.SQUARE?this._buttCap(U,$,nt,E,E):R===r.ROUND&&this._roundCapEnd(U,$,nt,E,x)}for(var ot=B.indicesOffset,_t=B.indicesBuffer,ut=et+2,vt=B.vertsOffset;ut<vt;ut++)_t[ot++]=ut-2,_t[ot++]=ut-1,_t[ot++]=ut;B.indicesOffset=ot,B.indicesDirty=!0}},A._expandFill=function(){for(var E=this._paths,R=0,O=this._pathOffset,P=this._pathLength;O<P;O++)R+=L=(w=E[O]).points.length;this._allocVerts(R);var x=this._buffer;for(O=this._pathOffset,P=this._pathLength;O<P;O++){var w,L,D=(w=E[O]).points;if((L=D.length)!==0){for(var F=x.vertsOffset,M=0;M<L;++M)this._vset(D[M].x,D[M].y,.5,1);var B=w.indicesOffset=x.indicesOffset,W=x.indicesBuffer,V=0;if(w.complex){var U=[],k=3*F,X=3*x.vertsOffset;for(M=k;M<X;M+=3)U.push(x.vertsBuffer[M]),U.push(x.vertsBuffer[M+1]);var Y=c(U,null,2);if(!Y||Y.length===0)continue;M=0;for(var Z=V=Y.length;M<Z;M++)W[B+M]=Y[M]+F}else{var et=F;for(k=F+2,X=x.vertsOffset;k<X;k++)W[B++]=et,W[B++]=k-1,W[B++]=k;V=B-x.indicesOffset}x.indicesOffset+=V,x.indicesDirty=!0}}},A._curveDivs=function(E,R,O){var P=2*g(E/(E+O));return _(2,p(R/P))},A._calculateJoins=function(E,R,O){var P=0;E>0&&(P=1/E);for(var x=this._paths,w=this._pathOffset,L=this._pathLength;w<L;w++){var D=x[w],F=D.points,M=F.length,B=F[M-1],W=F[0];D.nbevel=0;for(var V=0;V<M;V++){var U,k,X=B.dy,Y=-B.dx,Z=W.dy,et=-W.dx;if(W.dmx=.5*(X+Z),W.dmy=.5*(Y+et),(U=W.dmx*W.dmx+W.dmy*W.dmy)>1e-6){var $=1/U;$>600&&($=600),W.dmx*=$,W.dmy*=$}W.dx*B.dy-B.dx*W.dy>0&&(W.flags|=b.PT_LEFT),U*(k=_(11,v(B.len,W.len)*P))*k<1&&(W.flags|=b.PT_INNERBEVEL),W.flags&b.PT_CORNER&&(U*O*O<1||R===a.BEVEL||R===a.ROUND)&&(W.flags|=b.PT_BEVEL),W.flags&(b.PT_BEVEL|b.PT_INNERBEVEL)&&D.nbevel++,B=W,W=F[V+1]}}},A._vset=function(E,R){var O=this._buffer,P=3*O.vertsOffset,x=O.vertsBuffer;x[P]=E,x[P+1]=R,O.uint32VertsBuffer[P+2]=this._curColorValue,O.vertsOffset++},A._chooseBevel=function(E,R,O,P){var x,w,L,D,F=O.x,M=O.y;return E!==0?(x=F+R.dy*P,w=M-R.dx*P,L=F+O.dy*P,D=M-O.dx*P):(x=L=F+O.dmx*P,w=D=M+O.dmy*P),[x,w,L,D]},A._buttCap=function(E,R,O,P,x){var w=E.x-R*x,L=E.y-O*x,D=O,F=-R;this._vset(w+D*P,L+F*P),this._vset(w-D*P,L-F*P)},A._roundCapStart=function(E,R,O,P,x){for(var w=E.x,L=E.y,D=O,F=-R,M=0;M<x;M++){var B=M/(x-1)*m,W=y(B)*P,V=C(B)*P;this._vset(w-D*W-R*V,L-F*W-O*V),this._vset(w,L)}this._vset(w+D*P,L+F*P),this._vset(w-D*P,L-F*P)},A._roundCapEnd=function(E,R,O,P,x){var w=E.x,L=E.y,D=O,F=-R;this._vset(w+D*P,L+F*P),this._vset(w-D*P,L-F*P);for(var M=0;M<x;M++){var B=M/(x-1)*m,W=y(B)*P,V=C(B)*P;this._vset(w,L),this._vset(w-D*W+R*V,L-F*W+O*V)}},A._roundJoin=function(E,R,O,P,x){var w=E.dy,L=-E.dx,D=R.dy,F=-R.dx,M=R.x,B=R.y;if(R.flags&b.PT_LEFT){var W=(nt=this._chooseBevel(R.flags&b.PT_INNERBEVEL,E,R,O))[0],V=nt[1],U=nt[2],k=nt[3],X=S(-L,-w);(at=S(-F,-D))>X&&(at-=2*m),this._vset(W,V),this._vset(M-w*P,R.y-L*P);for(var Y=o(p((X-at)/m)*x,2,x),Z=0;Z<Y;Z++){var et=M+y(ut=X+Z/(Y-1)*(at-X))*P,$=B+C(ut)*P;this._vset(M,B),this._vset(et,$)}this._vset(U,k),this._vset(M-D*P,B-F*P)}else{var nt,at,rt=(nt=this._chooseBevel(R.flags&b.PT_INNERBEVEL,E,R,-P))[0],it=nt[1],ot=nt[2],_t=nt[3];for(X=S(L,w),(at=S(F,D))<X&&(at+=2*m),this._vset(M+w*P,B+L*P),this._vset(rt,it),Y=o(p((at-X)/m)*x,2,x),Z=0;Z<Y;Z++){var ut,vt=M+y(ut=X+Z/(Y-1)*(at-X))*O,Tt=B+C(ut)*O;this._vset(vt,Tt),this._vset(M,B)}this._vset(M+D*P,B+F*P),this._vset(ot,_t)}},A._bevelJoin=function(E,R,O,P){var x,w,L,D,F,M,B,W,V=E.dy,U=-E.dx,k=R.dy,X=-R.dx;if(R.flags&b.PT_LEFT)F=(Y=this._chooseBevel(R.flags&b.PT_INNERBEVEL,E,R,O))[0],M=Y[1],B=Y[2],W=Y[3],this._vset(F,M),this._vset(R.x-V*P,R.y-U*P),this._vset(B,W),this._vset(R.x-k*P,R.y-X*P);else{var Y;x=(Y=this._chooseBevel(R.flags&b.PT_INNERBEVEL,E,R,-P))[0],w=Y[1],L=Y[2],D=Y[3],this._vset(R.x+V*O,R.y+U*O),this._vset(x,w),this._vset(R.x+k*O,R.y+X*O),this._vset(L,D)}},A._tesselateBezier=function(E,R,O,P,x,w,L,D,F,M){var B,W,V,U,k,X,Y,Z,et,$,nt,at,rt,it,ot,_t;F>10||(k=.5*(x+L),X=.5*(w+D),Y=.5*((B=.5*(E+O))+(V=.5*(O+x))),Z=.5*((W=.5*(R+P))+(U=.5*(P+w))),((ot=I((O-L)*(it=D-R)-(P-D)*(rt=L-E)))+(_t=I((x-L)*it-(w-D)*rt)))*(ot+_t)<this._tessTol*(rt*rt+it*it)?this._addPoint(L,D,M===0?M|b.PT_BEVEL:M):(nt=.5*(Y+(et=.5*(V+k))),at=.5*(Z+($=.5*(U+X))),this._tesselateBezier(E,R,B,W,Y,Z,nt,at,F+1,0),this._tesselateBezier(nt,at,et,$,k,X,L,D,F+1,M)))},N.exports=e},{"./earcut":101,"./helper":106,"./types":108}],105:[function(T,N,z){var o=T("./types").LineCap,s=T("./types").LineJoin,n=cc.Class({name:"cc.Graphics",extends:cc._RendererUnderSG,editor:!1,properties:{_lineWidth:1,_strokeColor:cc.Color.BLACK,_lineJoin:s.MITER,_lineCap:o.BUTT,_fillColor:cc.Color.WHITE,_miterLimit:10,lineWidth:{get:function(){return this._lineWidth},set:function(t){this._sgNode.lineWidth=this._lineWidth=t}},lineJoin:{get:function(){return this._lineJoin},set:function(t){this._sgNode.lineJoin=this._lineJoin=t},type:s},lineCap:{get:function(){return this._lineCap},set:function(t){this._sgNode.lineCap=this._lineCap=t},type:o},strokeColor:{get:function(){return this._strokeColor},set:function(t){this._sgNode.strokeColor=this._strokeColor=t}},fillColor:{get:function(){return this._fillColor},set:function(t){this._sgNode.fillColor=this._fillColor=t}},miterLimit:{get:function(){return this._miterLimit},set:function(t){this._sgNode.miterLimit=this._miterLimit=t}}},statics:{LineJoin:s,LineCap:o},_createSgNode:function(){return new _ccsg.GraphicsNode},_initSgNode:function(){var t=this._sgNode;t.lineWidth=this._lineWidth,t.lineJoin=this._lineJoin,t.lineCap=this._lineCap,t.strokeColor=this._strokeColor,t.fillColor=this._fillColor,t.miterLimit=this._miterLimit,t.setContentSize(this.node.getContentSize(!0))},moveTo:function(t,e){this._sgNode.moveTo(t,e)},lineTo:function(t,e){this._sgNode.lineTo(t,e)},bezierCurveTo:function(t,e,r,a,c,h){this._sgNode.bezierCurveTo(t,e,r,a,c,h)},quadraticCurveTo:function(t,e,r,a){this._sgNode.quadraticCurveTo(t,e,r,a)},arc:function(t,e,r,a,c,h){h=h||!1,this._sgNode.arc(t,e,r,a,c,h)},ellipse:function(t,e,r,a){this._sgNode.ellipse(t,e,r,a)},circle:function(t,e,r){this._sgNode.circle(t,e,r)},rect:function(t,e,r,a){this._sgNode.rect(t,e,r,a)},roundRect:function(t,e,r,a,c){this._sgNode.roundRect(t,e,r,a,c)},fillRect:function(t,e,r,a){this._sgNode.fillRect(t,e,r,a)},clear:function(t){this._sgNode.clear(!!t)},close:function(){this._sgNode.close()},stroke:function(){this._sgNode.stroke()},fill:function(){this._sgNode.fill()}});cc.Graphics=N.exports=n},{"./types":108}],106:[function(T,N,z){var o=Math.PI,s=Math.min,n=Math.max,t=Math.cos,e=Math.sin,r=Math.abs,a=Math.sign,c=.5522847493;N.exports={arc:function(h,u,d,f,m,v,_){var p,g,y=0,C=0,S=0,I=0,b=0,A=0,E=0,R=0,O=0,P=0,x=0,w=0,L=0,D=0;if(C=v-m,_=_||!1)if(r(C)>=2*o)C=2*o;else for(;C<0;)C+=2*o;else if(r(C)>=2*o)C=2*-o;else for(;C>0;)C-=2*o;for(g=0|n(1,s(r(C)/(.5*o)+.5,5)),I=r(4/3*(1-t(S=C/g/2))/e(S)),_||(I=-I),p=0;p<=g;p++)E=u+(b=t(y=m+C*(p/g)))*f,R=d+(A=e(y))*f,O=-A*f*I,P=b*f*I,p===0?h.moveTo(E,R):h.bezierCurveTo(x+L,w+D,E-O,R-P,E,R),x=E,w=R,L=O,D=P},ellipse:function(h,u,d,f,m){h.moveTo(u-f,d),h.bezierCurveTo(u-f,d+m*c,u-f*c,d+m,u,d+m),h.bezierCurveTo(u+f*c,d+m,u+f,d+m*c,u+f,d),h.bezierCurveTo(u+f,d-m*c,u+f*c,d-m,u,d-m),h.bezierCurveTo(u-f*c,d-m,u-f,d-m*c,u-f,d),h.close()},roundRect:function(h,u,d,f,m,v){if(v<.1)h.rect(u,d,f,m);else{var _=s(v,.5*r(f))*a(f),p=s(v,.5*r(m))*a(m);h.moveTo(u,d+p),h.lineTo(u,d+m-p),h.bezierCurveTo(u,d+m-p*(1-c),u+_*(1-c),d+m,u+_,d+m),h.lineTo(u+f-_,d+m),h.bezierCurveTo(u+f-_*(1-c),d+m,u+f,d+m-p*(1-c),u+f,d+m-p),h.lineTo(u+f,d+p),h.bezierCurveTo(u+f,d+p*(1-c),u+f-_*(1-c),d,u+f-_,d),h.lineTo(u+_,d),h.bezierCurveTo(u+_*(1-c),d,u,d+p*(1-c),u,d+p),h.close()}}}},{}],107:[function(T,N,z){"use strict";var o;(o=_ccsg.GraphicsNode=T("./graphics-node"))&&T("../utils/misc").propertyDefine(o,["lineWidth","lineCap","lineJoin","miterLimit","strokeColor","fillColor"],{}),T("./graphics")},{"../utils/misc":185,"./graphics":105,"./graphics-node":103}],108:[function(T,N,z){"use strict";var o=cc.Enum({BUTT:0,ROUND:1,SQUARE:2}),s=cc.Enum({BEVEL:0,ROUND:1,MITER:2});N.exports={LineCap:o,LineJoin:s}},{}],109:[function(T,N,z){T("./platform"),T("./assets"),T("./CCNode"),T("./CCScene"),T("./components"),T("./graphics"),T("./collider"),T("./collider/CCIntersection"),T("./physics"),T("./camera/CCCamera"),T("./base-ui/CCWidgetManager")},{"./CCNode":40,"./CCScene":41,"./assets":54,"./base-ui/CCWidgetManager":59,"./camera/CCCamera":237,"./collider":237,"./collider/CCIntersection":237,"./components":88,"./graphics":107,"./physics":237,"./platform":153}],110:[function(T,N,z){var o=/^(click)(\s)*=/,s=/(\s)*src(\s)*=|(\s)*height(\s)*=|(\s)*width(\s)*=|(\s)*click(\s)*=/;cc.HtmlTextParser=function(){this._parsedObject={},this._specialSymbolArray=[],this._specialSymbolArray.push([/&lt;/g,"<"]),this._specialSymbolArray.push([/&gt;/g,">"]),this._specialSymbolArray.push([/&amp;/g,"&"]),this._specialSymbolArray.push([/&quot;/g,'"']),this._specialSymbolArray.push([/&apos;/g,"'"])},cc.HtmlTextParser.prototype={constructor:cc.HtmlTextParser,parse:function(n){this._resultObjectArray=[],this._stack=[];for(var t=0,e=n.length;t<e;){var r=n.indexOf("<",t);if(r<0)this._stack.pop(),this._processResult(n.substring(t)),t=e;else{this._processResult(n.substring(t,r));var a=n.indexOf(">",t);a===-1?a=r:n.charAt(r+1)==="/"?this._stack.pop():this._addToStack(n.substring(r+1,a)),t=a+1}}return this._resultObjectArray},_attributeToObject:function(n){var t,e,r,a,c={},h=(n=n.trim()).match(/^(color|size)(\s)*=/);if(h){if(t=h[0],(n=n.substring(t.length).trim())==="")return c;switch(e=n.indexOf(" "),t[0]){case"c":c.color=e>-1?n.substring(0,e).trim():n;break;case"s":c.size=parseInt(n)}return e>-1&&(a=n.substring(e+1).trim(),r=this._processEventHandler(a),c.event=r),c}if((h=n.match(/^(br(\s)*\/)/))&&h[0].length>0&&(t=h[0].trim()).startsWith("br")&&t[t.length-1]==="/")return c.isNewLine=!0,this._resultObjectArray.push({text:"",style:{newline:!0}}),c;if((h=n.match(/^(img(\s)*src(\s)*=[^>]+\/)/))&&h[0].length>0&&(t=h[0].trim()).startsWith("img")&&t[t.length-1]==="/"){h=n.match(s);for(var u,d=!1;h;)t=(n=n.substring(n.indexOf(h[0]))).substr(0,h[0].length),v=(e=(u=n.substring(t.length).trim()).indexOf(" "))>-1?u.substr(0,e):u,t=(t=t.replace(/[^a-zA-Z]/g,"").trim()).toLocaleLowerCase(),n=u.substring(e).trim(),t==="src"?(c.isImage=!0,v.endsWith("/")&&(v=v.substring(0,v.length-1)),(v.indexOf("'")===0||v.indexOf('"')===0)&&(d=!0,v=v.substring(1,v.length-1)),c.src=v):t==="height"?c.imageHeight=parseInt(v):t==="width"?c.imageWidth=parseInt(v):t==="click"&&(c.event=this._processEventHandler(t+"="+v)),h=n.match(s);return d&&c.isImage&&this._resultObjectArray.push({text:"",style:c}),{}}if(h=n.match(/^(outline(\s)*[^>]*)/)){var f={color:"#ffffff",width:1};if(n=h[0].substring(7).trim()){var m=/(\s)*color(\s)*=|(\s)*width(\s)*=|(\s)*click(\s)*=/;h=n.match(m);for(var v;h;)t=(n=n.substring(n.indexOf(h[0]))).substr(0,h[0].length),v=(e=(u=n.substring(t.length).trim()).indexOf(" "))>-1?u.substr(0,e):u,t=(t=t.replace(/[^a-zA-Z]/g,"").trim()).toLocaleLowerCase(),n=u.substring(e).trim(),t==="click"?c.event=this._processEventHandler(t+"="+v):t==="color"?f.color=v:t==="width"&&(f.width=parseInt(v)),h=n.match(m)}c.outline=f}if((h=n.match(/^(on|u|b|i)(\s)*/))&&h[0].length>0){switch(t=h[0],n=n.substring(t.length).trim(),t[0]){case"u":c.underline=!0;break;case"i":c.italic=!0;break;case"b":c.bold=!0}if(n==="")return c;r=this._processEventHandler(n),c.event=r}return c},_processEventHandler:function(n){for(var t=0,e={},r=n.match(o),a=!1;r;){var c=r[0],h="";if(a=!1,(n=n.substring(c.length).trim()).charAt(0)==='"')(t=n.indexOf('"',1))>-1&&(h=n.substring(1,t).trim(),a=!0),t++;else if(n.charAt(0)==="'")(t=n.indexOf("'",1))>-1&&(h=n.substring(1,t).trim(),a=!0),t++;else{var u=n.match(/(\S)+/);t=(h=u?u[0]:"").length}a&&(e[c=c.substring(0,c.length-1).trim()]=h),r=(n=n.substring(t).trim()).match(o)}return e},_addToStack:function(n){var t=this._attributeToObject(n);if(this._stack.length===0)this._stack.push(t);else{if(t.isNewLine||t.isImage)return;var e=this._stack[this._stack.length-1];for(var r in e)t[r]||(t[r]=e[r]);this._stack.push(t)}},_processResult:function(n){n!==""&&(n=this._escapeSpecialSymbol(n),this._stack.length>0?this._resultObjectArray.push({text:n,style:this._stack[this._stack.length-1]}):this._resultObjectArray.push({text:n}))},_escapeSpecialSymbol:function(n){for(var t=0;t<this._specialSymbolArray.length;++t){var e=this._specialSymbolArray[t][0],r=this._specialSymbolArray[t][1];n=n.replace(e,r)}return n}},cc.htmlTextParser=new cc.HtmlTextParser},{}],111:[function(T,N,z){T("./CCTextUtils");var o=T("../event/event-target"),s=T("../platform/js"),n=function(){this._u=0,this._v=0,this._width=0,this._height=0,this._offsetX=0,this._offsetY=0,this._textureID=0,this._validDefinition=!1,this._xAdvance=0};cc.FontAtlas=function(a){this._lineHeight=a.commonHeight,this._fontSize=a.fontSize,this._letterDefinitions={},this._fntConfig=a},cc.FontAtlas.prototype={constructor:cc.FontAtlas,setFontSize:function(a){this._fontSize=a},getOriginalFontSize:function(){return this._fntConfig.fontSize},addLetterDefinitions:function(a,c){this._letterDefinitions[a]=c},cloneLetterDefinition:function(){var a={};for(var c in this._letterDefinitions){var h=new n;cc.js.mixin(h,this._letterDefinitions[c]),a[c]=h}return a},assignLetterDefinitions:function(a){for(var c in this._letterDefinitions){var h=a[c],u=this._letterDefinitions[c];cc.js.mixin(u,h)}},scaleFontLetterDefinition:function(a){for(var c in this._letterDefinitions){var h=this._letterDefinitions[c];h._width*=a,h._height*=a,h._offsetX*=a,h._offsetY*=a,h._xAdvance*=a}},getLetterDefinitionForChar:function(a){return this._letterDefinitions.hasOwnProperty(a.charCodeAt(0))?this._letterDefinitions[a.charCodeAt(0)]:null}};var t=function(){this._char="",this._valid=!0,this._positionX=0,this._positionY=0,this._lineIndex=0};_ccsg.Label=_ccsg.Node.extend({_hAlign:cc.TextAlignment.LEFT,_vAlign:cc.VerticalTextAlignment.TOP,_string:"",_fontSize:40,_drawFontsize:40,_overFlow:0,_isWrapText:!0,_spacingX:0,_blendFunc:null,_labelType:0,_fontHandle:"",_lineSpacing:0,_maxLineWidth:0,_labelDimensions:cc.size(0,0),_labelWidth:0,_labelHeight:0,_lineHeight:40,_outlined:!1,_outlineColor:null,_outlineWidth:1,_gradientEnabled:!1,_gradientStartColor:cc.color(255,255,255,255),_gradientEndColor:cc.color(255,255,255,255),_gradientDirection:0,_className:"Label",_margin:0,_isBold:!1,_isItalic:!1,_isUnderline:!1,_fontAsset:null,onExit:function(){this._super(),this._renderCmd._texture.releaseTexture(),this._notifyLabelSkinDirty()},ctor:function(a,c){o.call(this);var h=c instanceof cc.Font,u=h?c.rawUrl:"";this._fontHandle=u,typeof a!="string"&&(a=""+a),this._string=a,_ccsg.Node.prototype.ctor.call(this),this.setAnchorPoint(.5,.5),_ccsg.Node.prototype.setContentSize.call(this,10,10),this._blendFunc=cc.BlendFunc._alphaNonPremultiplied(),this._imageOffset=cc.p(0,0),this._numberOfLines=0,this._lettersInfo=[],this._linesWidth=[],this._linesOffsetX=[],this._horizontalKernings=[],this._reusedRect=cc.rect(0,0,0,0),h?this.setFontAsset(c):this.setFontFamily(u),this.setString(this._string)},_resetBMFont:function(){this._imageOffset.x=this._imageOffset.y=0,this._cascadeColorEnabled=!0,this._cascadeOpacityEnabled=!0,this._fontAtlas=null,this._config=null,this._numberOfLines=0,this._lettersInfo.length=0,this._linesWidth.length=0,this._linesOffsetX.length=0,this._textDesiredHeight=0,this._letterOffsetY=0,this._tailoredTopY=0,this._tailoredBottomY=0,this._bmfontScale=1,this._horizontalKernings.length=0,this._lineBreakWithoutSpaces=!1,this._reusedRect.x=this._reusedRect.y=this._reusedRect.width=this._reusedRect.height=0,this._textureLoaded=!1,this._spriteBatchNode&&(this.removeChild(this._spriteBatchNode),this._spriteBatchNode=null)},setHorizontalAlign:function(a){this._hAlign!==a&&(this._hAlign=a,this._notifyLabelSkinDirty())},getHorizontalAlign:function(){return this._hAlign},setVerticalAlign:function(a){this._vAlign!==a&&(this._vAlign=a,this._notifyLabelSkinDirty())},getVerticalAlign:function(){return this._vAlign},setString:function(a){typeof a!="string"&&(a=""+a),this._string!==a&&(this._string=a,this._notifyLabelSkinDirty())},setMargin:function(a){this._margin!==a&&(this._margin=a,this._notifyLabelSkinDirty())},getString:function(){return this._string},getStringLength:function(){return this._string.length},enableWrapText:function(a){this._isWrapText!==a&&this._overFlow!==_ccsg.Label.Overflow.RESIZE_HEIGHT&&this._overFlow!==_ccsg.Label.Overflow.NONE&&(this._isWrapText=a,this._rescaleWithOriginalFontSize(),this._notifyLabelSkinDirty())},enableItalics:function(a){this._isItalic=a,a?this.setSkewX(12):this.setSkewX(0)},enableBold:function(a){this._isBold!==a&&(this._isBold=a,this._notifyLabelSkinDirty())},enableUnderline:function(a){this._isUnderline!==a&&(this._isUnderline=a,this._notifyLabelSkinDirty())},isWrapTextEnabled:function(){return this._isWrapText},getFontName:function(){return this._fontHandle},setFontSize:function(a){this._fontSize!==a&&(this._fontSize=a,this._drawFontsize=a,this._notifyLabelSkinDirty())},getFontSize:function(){return this._fontSize},isOutlined:function(){return this._outlined},setOutlined:function(a){this._outlined!==a&&(this._outlined=!!a,this._notifyLabelSkinDirty())},setFillColorGradientEnabled:function(a){this._gradientEnabled!==a&&(this._gradientEnabled=!!a,this._notifyLabelSkinDirty())},getFillColorGradientEnabled:function(){return this._gradientEnabled},setGradientStartColor:function(a){this._gradientStartColor!==a&&(this._gradientStartColor=a,this._notifyLabelSkinDirty())},getGradientStartColor:function(){return this._gradientStartColor},setGradientEndColor:function(a){this._gradientEndColor!==a&&(this._gradientEndColor=a,this._notifyLabelSkinDirty())},getGradientEndColor:function(){return this._gradientEndColor},setFillColorGradientDirection:function(a){this._gradientDirection=a,this._notifyLabelSkinDirty()},getFillColorGradientDirection:function(){return this._gradientDirection},getOutlineColor:function(){return this._outlineColor},setOutlineColor:function(a){this._outlineColor!==a&&(this._outlineColor=cc.color(a),this._notifyLabelSkinDirty())},setOutlineWidth:function(a){this._outlineWidth!==a&&(this._outlineWidth=a,this._notifyLabelSkinDirty())},getOutlineWidth:function(){return this._outlineWidth},_updateWrapText:function(a){a===_ccsg.Label.Overflow.RESIZE_HEIGHT&&(this._isWrapText=!0),a===_ccsg.Label.Overflow.NONE&&(this._isWrapText=!1)},_setOverflowBMFont:function(){this._labelType===_ccsg.Label.Type.BMFont&&(this._overFlow===_ccsg.Label.Overflow.RESIZE_HEIGHT&&this._setDimensions(this._labelDimensions.width,0),this._overFlow===_ccsg.Label.Overflow.NONE&&this._setDimensions(0,0),this._rescaleWithOriginalFontSize())},setOverflow:function(a){this._overFlow!==a&&(this._overFlow=a,this._updateWrapText(this._overFlow),this._setOverflowBMFont(),this._notifyLabelSkinDirty())},getOverflow:function(){return this._overFlow},setSpacingX:function(a){this._spacingX!==a&&(this._spacingX=a,this._notifyLabelSkinDirty())},setLineHeight:function(a){this._lineHeight!==a&&(this._lineHeight=a,this._notifyLabelSkinDirty())},setLineBreakWithoutSpace:function(a){this._lineBreakWithoutSpaces!==a&&(this._lineBreakWithoutSpaces=a,this._notifyLabelSkinDirty())},getSpacingX:function(){return this._spacingX},getLineHeight:function(){return this._lineHeight},getBMFontLineHeight:function(){if(this._fontAtlas)return this._fontAtlas._lineHeight},setFontFamily:function(a){this._resetBMFont(),this._fontHandle=a||"Arial",this._labelType=_ccsg.Label.Type.SystemFont,this._blendFunc=cc.BlendFunc._alphaPremultiplied(),this._renderCmd._needDraw=!0,this._notifyLabelSkinDirty(),this.emit("load")},setFontAsset:function(a){this._fontAsset=a;var c=a instanceof cc.Font;if(c){var h=c?a.rawUrl:"",u=cc.path.extname(h);this._resetBMFont(),u===".ttf"?(this._labelType=_ccsg.Label.Type.TTF,this._blendFunc=cc.BlendFunc._alphaPremultiplied(),this._renderCmd._needDraw=!0,this._fontHandle=this._loadTTFFont(h)):a.spriteFrame&&(this._labelType=_ccsg.Label.Type.BMFont,this._blendFunc=cc.BlendFunc._alphaNonPremultiplied(),this._renderCmd._needDraw=!1,this._initBMFontWithString(this._string,a)),this._notifyLabelSkinDirty()}else this.setFontFamily("")},_loadTTFFont:function(a){var c=this,h=function(){c._notifyLabelSkinDirty(),c.emit("load")},u="";return u=cc.CustomFontLoader._getFontFamily(a),cc.CustomFontLoader.loadTTF(a,h),u},setContentSize:function(a,c){this._overFlow!==_ccsg.Label.Overflow.NONE&&this._setDimensions(a,c)},setBlendFunc:function(a,c){var h=this._blendFunc;c===void 0?(h.src=a.src,h.dst=a.dst):(h.src=a,h.dst=c)},getBlendFunc:function(){return new cc.BlendFunc(this._blendFunc.src,this._blendFunc.dst)},_setupBMFontOverflowMetrics:function(a,c){this._overFlow===_ccsg.Label.Overflow.RESIZE_HEIGHT&&(c=0),this._overFlow===_ccsg.Label.Overflow.NONE&&(a=0,c=0),this._labelWidth=a,this._labelHeight=c,this._labelDimensions.width=a,this._labelDimensions.height=c,this._maxLineWidth=a},_updateLabel:function(){if(this._labelType===_ccsg.Label.Type.BMFont){var a=this._contentSize,c=a.width,h=a.height;this._setupBMFontOverflowMetrics(c,h),this._updateContent(),this.setColor(this.color)}else this._labelType!==_ccsg.Label.Type.TTF&&this._labelType!==_ccsg.Label.Type.SystemFont||this._renderCmd._bakeLabel()},_notifyLabelSkinDirty:function(){this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.textDirty|_ccsg.Node._dirtyFlags.contentDirty)},_createRenderCmd:function(){return cc._renderType===cc.game.RENDER_TYPE_WEBGL?new _ccsg.Label.WebGLRenderCmd(this):new _ccsg.Label.CanvasRenderCmd(this)},getContentSize:function(){return this._renderCmd._dirtyFlag&_ccsg.Node._dirtyFlags.textDirty&&(this._updateLabel(),this._renderCmd._dirtyFlag&=~_ccsg.Node._dirtyFlags.textDirty),_ccsg.Node.prototype.getContentSize.call(this)},_getWidth:function(){return this._renderCmd._dirtyFlag&_ccsg.Node._dirtyFlags.textDirty&&(this._updateLabel(),this._renderCmd._dirtyFlag&=~_ccsg.Node._dirtyFlags.textDirty),_ccsg.Node.prototype._getWidth.call(this)},_getHeight:function(){return this._renderCmd._dirtyFlag&_ccsg.Node._dirtyFlags.textDirty&&(this._updateLabel(),this._renderCmd._dirtyFlag&=~_ccsg.Node._dirtyFlags.textDirty),_ccsg.Node.prototype._getHeight.call(this)},_alignText:function(){var a=!0;do{if(!this._spriteBatchNode)return!0;if(this._textDesiredHeight=0,this._linesWidth=[],this._lineBreakWithoutSpaces?this._multilineTextWrapByChar():this._multilineTextWrapByWord(),this._computeAlignmentOffset(),this._overFlow===_ccsg.Label.Overflow.SHRINK&&this.getFontSize()>0&&this._isVerticalClamp()&&this._shrinkLabelToContentSize(this._isVerticalClamp.bind(this)),!this._updateQuads()){a=!1,this._overFlow===_ccsg.Label.Overflow.SHRINK&&this._shrinkLabelToContentSize(this._isHorizontalClamp.bind(this));break}}while(!1);return a},_isHorizontalClamped:function(a,c){var h=this._linesWidth[c],u=a>this._contentSize.width||a<0;return this._isWrapText?h>this._contentSize.width&&u:u},_updateQuads:function(){var a=!0;this._spriteBatchNode.removeAllChildren();for(var c=0;c<this._string.length;++c)if(this._lettersInfo[c]._valid){var h=this._fontAtlas._letterDefinitions[this._lettersInfo[c]._char];this._reusedRect.height=h._height,this._reusedRect.width=h._width,this._reusedRect.x=h._u,this._reusedRect.y=h._v;var u=this._lettersInfo[c]._positionY+this._letterOffsetY;if(this._labelHeight>0){if(u>this._tailoredTopY){var d=u-this._tailoredTopY;this._reusedRect.y+=d,this._reusedRect.height-=d,u-=d}u-h._height*this._bmfontScale<this._tailoredBottomY&&(this._reusedRect.height=u<this._tailoredBottomY?0:u-this._tailoredBottomY)}var f=this._lettersInfo[c]._lineIndex,m=this._lettersInfo[c]._positionX+h._width/2*this._bmfontScale+this._linesOffsetX[f];if(this._labelWidth>0&&this._isHorizontalClamped(m,f)){if(this._overFlow===_ccsg.Label.Overflow.CLAMP)this._reusedRect.width=0;else if(this._overFlow===_ccsg.Label.Overflow.SHRINK){if(this._contentSize.width>h._width){a=!1;break}this._reusedRect.width=0}}if(this._reusedRect.height>0&&this._reusedRect.width>0){var v=this.getChildByTag(c),_=this._spriteBatchNode._texture,p=this._spriteFrame,g=this._spriteFrame.isRotated(),y=p._originalSize,C=p._rect,S=p._offset,I=S.x+(y.width-C.width)/2,b=S.y-(y.height-C.height)/2;if(g){var A=this._reusedRect.x;this._reusedRect.x=C.x+C.height-this._reusedRect.y-this._reusedRect.height-b,this._reusedRect.y=A+C.y-I,this._reusedRect.y<0&&(this._reusedRect.height=this._reusedRect.height+b)}else this._reusedRect.x+=C.x-I,this._reusedRect.y+=C.y+b;v?v.setTextureRect(this._reusedRect,g):((v=new _ccsg.Sprite).initWithTexture(_,this._reusedRect,g),v.setAnchorPoint(cc.p(0,1)));var E=this._lettersInfo[c]._positionX+this._linesOffsetX[this._lettersInfo[c]._lineIndex];v.setPosition(E,u),this._updateLetterSpriteScale(v),this._spriteBatchNode.addChild(v)}}return a},_updateLetterSpriteScale:function(a){this._labelType===_ccsg.Label.Type.BMFont&&this._fontSize>0&&a.setScale(this._bmfontScale)},_recordPlaceholderInfo:function(a,c){if(a>=this._lettersInfo.length){var h=new t;this._lettersInfo.push(h)}this._lettersInfo[a]._char=c,this._lettersInfo[a]._valid=!1},_recordLetterInfo:function(a,c,h,u){if(h>=this._lettersInfo.length){var d=new t;this._lettersInfo.push(d)}c=c.charCodeAt(0),this._lettersInfo[h]._lineIndex=u,this._lettersInfo[h]._char=c,this._lettersInfo[h]._valid=this._fontAtlas._letterDefinitions[c]._validDefinition,this._lettersInfo[h]._positionX=a.x,this._lettersInfo[h]._positionY=a.y},_setDimensions:function(a,c){var h=typeof a.width=="number"?a.width:a,u=typeof a.height=="number"?a.height:c,d=this.getContentSize();_ccsg.Node.prototype.setContentSize.call(this,a,c),u===d.height&&h===d.width||(this._setupBMFontOverflowMetrics(h,u),this._drawFontsize>0&&this._restoreFontSize(),this._notifyLabelSkinDirty())},_restoreFontSize:function(){this._fontSize=this._drawFontsize},_multilineTextWrap:function(a){var c=this.getStringLength(),h=0,u=0,d=0,f=0,m=0,v=this._lineSpacing,_=0,p=0,g=null,y=cc.p(0,0);this._updateBMFontScale();for(var C=0;C<c;){var S=this._string.charAt(C);if(S!==`
`){for(var I=a(this._string,C,c),b=_,A=p,E=m,R=u,O=!1,P=0;P<I;++P){var x=C+P;if((S=this._string.charAt(x))!=="\r")if(g=this._fontAtlas.getLetterDefinitionForChar(S)){var w=R+g._offsetX*this._bmfontScale;if(this._isWrapText&&this._maxLineWidth>0&&u>0&&w+g._width*this._bmfontScale>this._maxLineWidth&&!cc.TextUtils.isUnicodeSpace(S)){this._linesWidth.push(m),m=0,h++,u=0,d-=this._lineHeight*this._bmfontScale+v,O=!0;break}y.x=w,y.y=d-g._offsetY*this._bmfontScale,this._recordLetterInfo(y,S,x,h),x+1<this._horizontalKernings.length&&x<c-1&&(R+=this._horizontalKernings[x+1]),R+=g._xAdvance*this._bmfontScale+this._spacingX,E=y.x+g._width*this._bmfontScale,b<y.y&&(b=y.y),A>y.y-g._height*this._bmfontScale&&(A=y.y-g._height*this._bmfontScale)}else this._recordPlaceholderInfo(x,S),console.log("Can't find letter definition in texture atlas "+this._config.atlasName+" for letter:"+S);else this._recordPlaceholderInfo(x,S)}O||(u=R,m=E,_<b&&(_=b),p>A&&(p=A),f<m&&(f=m),C+=I)}else this._linesWidth.push(m),m=0,h++,u=0,d-=this._lineHeight*this._bmfontScale+v,this._recordPlaceholderInfo(C,S),C++}this._linesWidth.push(m),this._numberOfLines=h+1,this._textDesiredHeight=this._numberOfLines*this._lineHeight*this._bmfontScale,this._numberOfLines>1&&(this._textDesiredHeight+=(this._numberOfLines-1)*this._lineSpacing);var L=cc.size(this._labelWidth,this._labelHeight);return this._labelWidth<=0&&(L.width=parseFloat(f.toFixed(2))),this._labelHeight<=0&&(L.height=parseFloat(this._textDesiredHeight.toFixed(2))),_ccsg.Node.prototype.setContentSize.call(this,L),this._tailoredTopY=L.height,this._tailoredBottomY=0,_>0&&(this._tailoredTopY=L.height+_),p<-this._textDesiredHeight&&(this._tailoredBottomY=this._textDesiredHeight+p),!0},_multilineTextWrapByWord:function(){return this._multilineTextWrap(this._getFirstWordLen.bind(this))},_multilineTextWrapByChar:function(){return this._multilineTextWrap(this._getFirstCharLen.bind(this))},_isVerticalClamp:function(){return this._textDesiredHeight>this._contentSize.height},_isHorizontalClamp:function(){for(var a=!1,c=0;c<this.getStringLength();++c)if(this._lettersInfo[c]._valid){var h=this._fontAtlas._letterDefinitions[this._lettersInfo[c]._char],u=this._lettersInfo[c]._positionX+h._width/2*this._bmfontScale,d=this._lettersInfo[c]._lineIndex;if(this._labelWidth>0){if(this._isWrapText){if(this._linesWidth[d]>this._contentSize.width&&(u>this._contentSize.width||u<0)){a=!0;break}}else if(u>this._contentSize.width){a=!0;break}}}return a},_shrinkLabelToContentSize:function(a){for(var c=this.getFontSize(),h=0,u=this._fontAtlas.cloneLetterDefinition(),d=this._lineHeight,f=!0;a();){var m=c-++h;if(f=!1,m<=0)break;var v=m/c;this._fontAtlas.assignLetterDefinitions(u),this._fontAtlas.scaleFontLetterDefinition(v),this._lineHeight=d*v,this._lineBreakWithoutSpaces?this._multilineTextWrapByChar():this._multilineTextWrapByWord(),this._computeAlignmentOffset()}this._lineHeight=d,this._fontAtlas.assignLetterDefinitions(u),f||c-h>=0&&this._scaleFontSizeDown(c-h)},_scaleFontSizeDown:function(a){var c=!0;this._labelType===_ccsg.Label.Type.BMFont&&(a||(a=.1,c=!1),this._fontSize=a,c&&this._updateContent())},_updateContent:function(){this._fontAtlas&&(this._computeHorizontalKerningForText(this._string),this._alignText())},_computeAlignmentOffset:function(){switch(this._linesOffsetX=[],this._hAlign){case cc.TextAlignment.LEFT:for(var a=0;a<this._numberOfLines;++a)this._linesOffsetX.push(0);break;case cc.TextAlignment.CENTER:this._linesWidth.forEach(function(c){this._linesOffsetX.push((this._contentSize.width-c)/2)}.bind(this));break;case cc.TextAlignment.RIGHT:this._linesWidth.forEach(function(c){this._linesOffsetX.push(this._contentSize.width-c)}.bind(this))}switch(this._vAlign){case cc.VerticalTextAlignment.TOP:this._letterOffsetY=this._contentSize.height;break;case cc.VerticalTextAlignment.CENTER:this._letterOffsetY=(this._contentSize.height+this._textDesiredHeight)/2;break;case cc.VerticalTextAlignment.BOTTOM:this._letterOffsetY=this._textDesiredHeight}},_getFirstCharLen:function(){return 1},_getFirstWordLen:function(a,c,h){var u=a.charAt(c);if(cc.TextUtils.isUnicodeCJK(u)||u===`
`||cc.TextUtils.isUnicodeSpace(u))return 1;var d=1;if(!(f=this._fontAtlas.getLetterDefinitionForChar(u)))return d;for(var f,m=f._xAdvance*this._bmfontScale+this._spacingX,v=c+1;v<h&&(u=a.charAt(v),f=this._fontAtlas.getLetterDefinitionForChar(u));++v){if(m+f._offsetX*this._bmfontScale+f._width*this._bmfontScale>this._maxLineWidth&&!cc.TextUtils.isUnicodeSpace(u)&&this._maxLineWidth>0)return d;if(m+=f._xAdvance*this._bmfontScale+this._spacingX,u===`
`||cc.TextUtils.isUnicodeSpace(u)||cc.TextUtils.isUnicodeCJK(u))break;d++}return d},_updateBMFontScale:function(){if(this._labelType===_ccsg.Label.Type.BMFont){var a=this._fontAtlas._fontSize;this._bmfontScale=this._fontSize/a}else this._bmfontScale=1},_initBMFontWithString:function(a,c){if(this._config)return cc.logID(4002),!1;this._string=a,this._setBMFontFile(c)},_createSpriteBatchNode:function(a){this._spriteBatchNode=new cc.SpriteBatchNode(a,this._string.length),this._spriteBatchNode.setCascadeColorEnabled(!0),this._spriteBatchNode.setCascadeOpacityEnabled(!0),this.addChild(this._spriteBatchNode),this._updateContent(),this.setColor(this.color)},_createFontChars:function(){if(this._config){this._fontAtlas=new cc.FontAtlas(this._config),this._lineHeight||(this._lineHeight=this._fontAtlas._lineHeight);var a=this._config.fontDefDictionary;for(var c in a){var h=new n,u=a[c].rect;h._offsetX=parseInt(a[c].xOffset),h._offsetY=parseInt(a[c].yOffset),h._width=parseInt(u.width),h._height=parseInt(u.height),h._u=parseInt(u.x)+this._imageOffset.x,h._v=parseInt(u.y)+this._imageOffset.y,h._textureID=0,h._validDefinition=!0,h._xAdvance=parseInt(a[c].xAdvance),this._fontAtlas.addLetterDefinitions(c,h)}}},_rescaleWithOriginalFontSize:function(){var a=this.getFontSize();this._drawFontsize-a>=1&&this._overFlow===_ccsg.Label.Overflow.SHRINK&&(this._labelType===_ccsg.Label.Type.BMFont?this._scaleFontSizeDown(this._drawFontsize):this._fontSize=this._drawFontsize)},_computeHorizontalKerningForText:function(){for(var a=this.getStringLength(),c=this._config.kerningDict,h=-1,u=0;u<a;++u){var d=this._string.charCodeAt(u),f=c[h<<16|65535&d]||0;this._horizontalKernings[u]=u<a-1?f:0,h=d}},_setBMFontFile:function(a){if(a&&this._labelType===_ccsg.Label.Type.BMFont){var c=this;this._resetBMFont();var h=this._fontAsset._fntConfig;h?c._config=h:cc.warn("Invalid BMFont Assets!");var u=a.spriteFrame;c._createFontChars(),c._spriteFrame=u;var d=function(){var f=u.getTexture();c._textureLoaded=f.loaded,c._createSpriteBatchNode(f),c.emit("load")};u.textureLoaded()?d():(u.once("load",d),u.ensureLoadTexture())}}}),_ccsg.Label.pool=new s.Pool(function(a){return a instanceof _ccsg.Label&&(a._string="",a._fontAsset=null,a._fontHandle="",a._labelType=0,a._resetBMFont(),!0)},10),_ccsg.Label.pool.get=function(a,c){var h=this._get();if(h){var u=c instanceof cc.Font,d=u?c.rawUrl:"";return h._fontHandle=d,typeof a!="string"&&(a=""+a),h._string=a,h._position.x=0,h._position.y=0,h.setAnchorPoint(.5,.5),_ccsg.Node.prototype.setContentSize.call(h,10,10),u?h.setFontAsset(c):h.setFontFamily("Arial"),h.setString(a),h.setHorizontalAlign(cc.TextAlignment.LEFT),h.setVerticalAlign(cc.VerticalTextAlignment.TOP),h.setFontSize(40),h.setOverflow(0),h.enableWrapText(!0),h.setVisible(!0),h.setLineHeight(40),h.setOutlined(!1),h.enableBold(!1),h.enableItalics(!1),h.enableUnderline(!1),h}return new _ccsg.Label(a||"",c)};var e=_ccsg.Label.prototype;cc.js.addon(e,o.prototype),_ccsg.Label.Type=cc.Enum({TTF:0,BMFont:1,SystemFont:2}),_ccsg.Label.Overflow=cc.Enum({NONE:0,CLAMP:1,SHRINK:2,RESIZE_HEIGHT:3});var r=_ccsg.Label.prototype;Object.defineProperty(r,"width",{get:r._getWidth,set:_ccsg.Node.prototype._setWidth}),Object.defineProperty(r,"height",{get:r._getHeight,set:_ccsg.Node.prototype._setHeight})},{"../event/event-target":97,"../platform/js":156,"./CCTextUtils":114}],112:[function(T,N,z){(function(){_ccsg.Label.TTFLabelBaker=function(){};var o=_ccsg.Label.TTFLabelBaker.prototype=Object.create(Object.prototype);o.updateStatus=function(){var s=_ccsg.Node._dirtyFlags,n=this._dirtyFlag,t=n&s.colorDirty,e=n&s.opacityDirty;t&&this._updateDisplayColor(),e&&(this._updateDisplayOpacity(),this._notifyRegionStatus&&this._notifyRegionStatus(_ccsg.Node.CanvasRenderCmd.RegionStatus.Dirty)),n&s.contentDirty&&(this._notifyRegionStatus&&this._notifyRegionStatus(_ccsg.Node.CanvasRenderCmd.RegionStatus.Dirty),this._dirtyFlag&=~s.contentDirty),(t||n&s.textDirty)&&(this._notifyRegionStatus&&this._notifyRegionStatus(_ccsg.Node.CanvasRenderCmd.RegionStatus.Dirty),this._rebuildLabelSkin()),this._dirtyFlag&s.transformDirty&&(this.transform(this.getParentRenderCmd(),!0),this._dirtyFlag&=~s.transformDirty)},o._syncStatus=function(s){var n=_ccsg.Node._dirtyFlags,t=this._dirtyFlag,e=s?s._node:null;e&&e._cascadeColorEnabled&&s._dirtyFlag&n.colorDirty&&(t|=n.colorDirty),e&&e._cascadeOpacityEnabled&&s._dirtyFlag&n.opacityDirty&&(t|=n.opacityDirty),s&&s._dirtyFlag&n.transformDirty&&(t|=n.transformDirty);var r=t&n.colorDirty,a=t&n.opacityDirty;this._dirtyFlag=t,r&&this._syncDisplayColor(),a&&this._syncDisplayOpacity(),(r||a||this._dirtyFlag&n.textDirty)&&this._rebuildLabelSkin(),this._dirtyFlag&n.transformDirty&&this.transform(s)},o._getLineHeight=function(){var s=this._node.getLineHeight(),n=this._node;return 0|(s=s===0?n._fontSize:s*n._fontSize/this._drawFontsize)},o._constructFontDesc=function(){var s=this._node,n=s._fontSize.toString()+"px ";return n+=s._fontHandle.length===0?"serif":s._fontHandle,s._isBold&&(n="bold "+n),n},o._measureText=function(s){return function(n){return s.measureText(n).width}},o._calculateLabelFont=function(){var s=this._node,n=s._string.split(`
`);s._fontSize=s._drawFontsize;var t=this._constructFontDesc();this._labelContext.font=t;var e=this._calculateParagraphLength(n,this._labelContext);if(_ccsg.Label.Overflow.SHRINK===s._overFlow){this._splitedStrings=n;var r=0,a=0,c=0;if(s._isWrapText){var h=this._canvasSize.width-2*this._getMargin(),u=this._canvasSize.height-2*this._getMargin();if(h<0||u<0)return t=this._constructFontDesc(),this._labelContext.font=t,t;a=u+1,c=h+1;for(var d=this._drawFontsize+1,f="",m=!0,v=0|d;a>u||c>h;){if(m?d=v/2|0:v=d=v-1,d<=0){cc.logID(4003);break}for(s._fontSize=d,t=this._constructFontDesc(),this._labelContext.font=t,this._splitedStrings=[],a=0,r=0;r<n.length;++r){var _=0,p=this._labelContext.measureText(n[r]).width;for(f=cc.TextUtils.fragmentText(n[r],p,h,this._measureText(this._labelContext));_<f.length;)c=this._labelContext.measureText(f[_]).width,a+=this._getLineHeight(),++_;this._splitedStrings=this._splitedStrings.concat(f)}m&&(a>u?v=0|d:(m=!1,a=u+1))}}else{for(a=n.length*this._getLineHeight(),r=0;r<n.length;++r)c<e[r]&&(c=e[r]);var g=(this._canvasSize.width-2*this._getMargin())/c,y=this._canvasSize.height/a;s._fontSize=this._drawFontsize*Math.min(1,g,y)|0,t=this._constructFontDesc(),this._labelContext.font=t}}return t},o._getMargin=function(){return this._node&&this._node._margin||0},o._calculateParagraphLength=function(s,n){for(var t=[],e=0;e<s.length;++e){var r=n.measureText(s[e]);t.push(r.width)}return t},o._calculateCanvasSize=function(){var s=this._node,n=s._contentSize.width,t=s._contentSize.height;return n<=0&&(n=1),t<=0&&(t=1),cc.size(n,t)},o._calculateSplitedStrings=function(){var s,n=this._node,t=n._string.split(`
`);if(n._isWrapText){this._splitedStrings=[];var e=this._canvasSize.width-2*this._getMargin();for(s=0;s<t.length;++s){var r=this._labelContext.measureText(t[s]).width,a=cc.TextUtils.fragmentText(t[s],r,e,this._measureText(this._labelContext));this._splitedStrings=this._splitedStrings.concat(a)}}else this._splitedStrings=t},o._updateLabelDimensions=function(){var s,n=this._node,t=n._string.split(`
`),e=this._labelContext;if(_ccsg.Label.Overflow.RESIZE_HEIGHT===n._overFlow)this._canvasSize.height=this._splitedStrings.length*this._getLineHeight(),_ccsg.Node.prototype.setContentSize.call(n,this._canvasSize);else if(_ccsg.Label.Overflow.NONE===n._overFlow){this._splitedStrings=t;var r=0,a=0;for(s=0;s<t.length;++s){var c=e.measureText(t[s]).width;r=r>c?r:c}a=this._splitedStrings.length*this._getLineHeight(),this._canvasSize.width=Math.round(r.toFixed(2))+2*this._getMargin(),this._canvasSize.height=Math.round(a.toFixed(2)),n._isItalic&&(this._canvasSize.width+=n._drawFontsize*Math.tan(.20943951)),_ccsg.Node.prototype.setContentSize.call(n,this._canvasSize)}this._labelCanvas.width=this._canvasSize.width,this._labelCanvas.height=this._canvasSize.height},o._calculateFillTextStartPosition=function(){var s,n,t=this._node,e=this._getLineHeight(),r=this._splitedStrings.length;return s=cc.TextAlignment.RIGHT===t._hAlign?this._canvasSize.width-this._getMargin():cc.TextAlignment.CENTER===t._hAlign?this._canvasSize.width/2:0+this._getMargin(),n=cc.VerticalTextAlignment.TOP===t._vAlign?0:cc.VerticalTextAlignment.CENTER===t._vAlign?this._canvasSize.height/2-e*(r-1)/2:this._canvasSize.height-e*(r-1),cc.p(s,n)},o._calculateTextBaseline=function(){var s,n,t=this._node;s=cc.TextAlignment.RIGHT===t._hAlign?"right":cc.TextAlignment.CENTER===t._hAlign?"center":"left",this._labelContext.textAlign=s,n=cc.VerticalTextAlignment.TOP===t._vAlign?"top":cc.VerticalTextAlignment.CENTER===t._vAlign?"middle":"bottom",this._labelContext.textBaseline=n},o._bakeLabel=function(){var s=this._node;this._drawFontsize=s._drawFontsize,this._canvasSize=this._calculateCanvasSize(),this._fontDesc=this._calculateLabelFont(),this._calculateSplitedStrings(),this._updateLabelDimensions(),this._calculateTextBaseline(),this._updateTexture()},o._calculateUnderlineStartPosition=function(){var s,n,t=this._node,e=this._getLineHeight(),r=this._splitedStrings.length;return s=0+this._getMargin(),n=cc.VerticalTextAlignment.TOP===t._vAlign?t._fontSize:cc.VerticalTextAlignment.CENTER===t._vAlign?this._canvasSize.height/2-e*(r-1)/2+t._fontSize/2:this._canvasSize.height-e*(r-1),cc.p(s,n)},o._updateTexture=function(){this._labelContext.clearRect(0,0,this._canvasSize.width,this._canvasSize.height),this._labelContext.font=this._fontDesc;var s=this._calculateFillTextStartPosition(),n=this._getLineHeight();this._labelContext.lineJoin="round";var t=this._displayedColor;this._labelContext.fillStyle="rgb("+t.r+","+t.g+","+t.b+")";for(var e,r=0;r<this._splitedStrings.length;++r){if(this._node.isOutlined()){var a=this._node.getOutlineColor()||cc.color(255,255,255,255);this._labelContext.globalCompositeOperation="source-over",this._labelContext.strokeStyle="rgb("+a.r+","+a.g+","+a.b+")",this._labelContext.lineWidth=2*this._node.getOutlineWidth(),this._labelContext.strokeText(this._splitedStrings[r],s.x,s.y+r*n)}if(this._node.getFillColorGradientEnabled()){var c=this._node.getGradientStartColor()||cc.color(255,255,255,255),h=this._node.getGradientEndColor()||cc.color(255,255,255,255),u=this._getGradientArgs(),d=this._labelContext.createLinearGradient(u.left,u.top,u.right,u.bottom);d.addColorStop(0,cc.colorToHex(c)),d.addColorStop(1,cc.colorToHex(h)),this._labelContext.fillStyle=d}this._labelContext.fillText(this._splitedStrings[r],s.x,s.y+r*n),this._node._isUnderline&&(e=this._calculateUnderlineStartPosition(),this._labelContext.save(),this._labelContext.beginPath(),this._labelContext.lineWidth=this._node._fontSize/8,this._labelContext.strokeStyle="rgb("+t.r+","+t.g+","+t.b+")",this._labelContext.moveTo(e.x,e.y+r*n-1),this._labelContext.lineTo(e.x+this._labelCanvas.width,e.y+r*n-1),this._labelContext.stroke(),this._labelContext.restore())}this._texture.loaded=!1,this._texture._image=this._labelCanvas,this._texture.handleLoadedTexture(!0)},o._getGradientArgs=function(){this._gradientArgument={},this._gradientArgument.left=0,this._gradientArgument.top=0;var s=this._node._contentSize;switch(this._node.getFillColorGradientDirection()){case 0:this._gradientArgument.right=s.width,this._gradientArgument.bottom=0;break;case 1:this._gradientArgument.right=0,this._gradientArgument.bottom=s.height;break;case 2:this._gradientArgument.right=s.width,this._gradientArgument.bottom=s.height}return this._gradientArgument},o._rebuildLabelSkin=function(){this._dirtyFlag&=~_ccsg.Node._dirtyFlags.textDirty,this._node._updateLabel()}})(),function(){_ccsg.Label.CanvasRenderCmd=function(s){this._rootCtor(s),this._needDraw=!0,this._texture=new cc.Texture2D,this._labelCanvas=document.createElement("canvas"),this._labelCanvas.width=1,this._labelCanvas.height=1,this._labelContext=this._labelCanvas.getContext("2d"),this._texture.initWithElement(this._labelCanvas),this._splitedStrings=null};var o=_ccsg.Label.CanvasRenderCmd.prototype=Object.create(_ccsg.Node.CanvasRenderCmd.prototype);cc.js.mixin(o,_ccsg.Label.TTFLabelBaker.prototype),o.constructor=_ccsg.Label.CanvasRenderCmd,o._doCulling=function(){var s=cc.visibleRect,n=this._currentRegion,t=n._minX,e=n._maxX,r=n._minY,a=n._maxY,c=s.left.x,h=s.right.x,u=s.top.y,d=s.bottom.y;this._needDraw=!(e<c||t>h||a<d||r>u)},o.rendering=function(s,n,t){var e=this._node;if(e._labelType===_ccsg.Label.Type.TTF||e._labelType===_ccsg.Label.Type.SystemFont){var r=this._displayedOpacity,a=r/255;if(r===0)return;var c=s||cc._renderContext,h=c.getContext();if(c.setTransform(this._worldTransform,n,t),c.setCompositeOperation(_ccsg.Node.CanvasRenderCmd._getCompositeOperationByBlendFunc(e._blendFunc)),c.setGlobalAlpha(a),this._texture){var u,d,f,m,v;f=-this._node._contentSize.height,m=this._node._contentSize.width,v=this._node._contentSize.height,u=this._texture.getPixelWidth(),d=this._texture.getPixelHeight();var _=this._texture._image;this._texture._pattern!==""?(c.setFillStyle(h.createPattern(_,this._texture._pattern)),h.fillRect(0,f,m,v)):u!==0&&d!==0&&m!==0&&v!==0&&h.drawImage(_,0,0,u,d,0,f,m,v)}cc.g_NumberOfDraws=cc.g_NumberOfDraws+1}}}()},{}],113:[function(T,N,z){var o;_ccsg.Label.WebGLRenderCmd=function(n){this._rootCtor(n),this._needDraw=!0,this._texture=new cc.Texture2D,o=o||document.createElement("canvas"),this._labelCanvas=o,this._texture.initWithElement(this._labelCanvas),this._labelContext=this._labelCanvas.getContext("2d"),this._labelCanvas.width=1,this._labelCanvas.height=1,this._splitedStrings=null,this._drawFontsize=0,this._vertices=[{x:0,y:0,u:0,v:0},{x:0,y:0,u:0,v:1},{x:0,y:0,u:1,v:0},{x:0,y:0,u:1,v:1}],this._color=new Uint32Array(1),this._dirty=!1,this._shaderProgram=cc.shaderCache.programForKey(cc.macro.SHADER_SPRITE_POSITION_TEXTURECOLOR)};var s=_ccsg.Label.WebGLRenderCmd.prototype=Object.create(_ccsg.Node.WebGLRenderCmd.prototype);cc.js.mixin(s,_ccsg.Label.TTFLabelBaker.prototype),s.constructor=_ccsg.Label.WebGLRenderCmd,s.updateTransform=function(n){this.originUpdateTransform(n),this._node;var t=this._node.width,e=this._node.height,r=this._worldTransform,a=this._vertices;a[0].x=0*r.a+e*r.c+r.tx,a[0].y=0*r.b+e*r.d+r.ty,a[1].x=0*r.a+0*r.c+r.tx,a[1].y=0*r.b+0*r.d+r.ty,a[2].x=t*r.a+e*r.c+r.tx,a[2].y=t*r.b+e*r.d+r.ty,a[3].x=t*r.a+0*r.c+r.tx,a[3].y=t*r.b+0*r.d+r.ty},s._doCulling=function(){var n=this._node;if(n._string&&(n._labelType===_ccsg.Label.Type.TTF||n._labelType===_ccsg.Label.Type.SystemFont)){var t=cc.visibleRect;this._cameraFlag>0&&(t=cc.Camera.main.visibleRect);var e=t.left.x,r=t.right.x,a=t.top.y,c=t.bottom.y,h=this._vertices;(h[0].x-e&h[1].x-e&h[2].x-e&h[3].x-e)>>31||(r-h[0].x&r-h[1].x&r-h[2].x&r-h[3].x)>>31||(h[0].y-c&h[1].y-c&h[2].y-c&h[3].y-c)>>31||(a-h[0].y&a-h[1].y&a-h[2].y&a-h[3].y)>>31?this._needDraw=!1:this._needDraw=!0}},s.uploadData=function(n,t,e){var r=this._node;if(!r._string||r._labelType!==_ccsg.Label.Type.TTF&&r._labelType!==_ccsg.Label.Type.SystemFont)return 0;var a=this._displayedOpacity;this._color[0]=~~a<<24>>>0|~~a<<16|~~a<<8|~~a;var c,h,u=r._vertexZ,d=this._vertices,f=d.length,m=e;for(c=0;c<f;++c)h=d[c],n[m]=h.x,n[m+1]=h.y,n[m+2]=u,t[m+3]=this._color[0],n[m+4]=h.u,n[m+5]=h.v,m+=6;return f}},{}],114:[function(T,N,z){var o=function(){this._status="unloaded",this._observers=[],this._isLoadWithCSS=!1};o.prototype.onLoaded=function(){this._status="loaded",this._observers.forEach(function(n){n()})},o.prototype.isLoaded=function(){return this._status==="loaded"},o.prototype.addHandler=function(n){this._observers.indexOf(n)===-1&&this._observers.push(n)};var s={_fontCache:{},_fontWidthCache:{},_canvasContext:null,_testString:"BESbswy",_allFontsLoaded:!1,_intervalId:0,loadTTF:function(n,t){var e=this._getFontFamily(n),r=cc.loader.md5Pipe;r&&(n=r.transformURL(n));var a=cc.sys.browserType!==cc.sys.BROWSER_TYPE_BAIDU&&cc.sys.browserType!==cc.sys.BROWSER_TYPE_BAIDU_APP&&cc.sys.browserType!==cc.sys.BROWSER_TYPE_MOBILE_QQ;window.FontFace&&a?this._loadWithFontFace(e,n,t):this._loadWithCSS(e,n,t),this._intervalId===0&&(this._intervalId=setInterval(this._checkFontLoaded.bind(this),100))},_checkFontLoaded:function(){this._allFontsLoaded=!0;for(var n in this._fontCache){var t=this._fontCache[n];if(!t.isLoaded()&&t._isLoadWithCSS){var e=this._fontWidthCache[n];this._canvasContext.font="40px "+n,e!==this._canvasContext.measureText(this._testString).width?t.onLoaded():this._allFontsLoaded=!1}}this._allFontsLoaded&&(clearInterval(this._intervalId),this._intervalId=0)},_loadWithFontFace:function(n,t,e){var r=this._fontCache[n];if(r)r.isLoaded()||r.addHandler(e);else{var a=new FontFace(n,"url('"+t+"')");document.fonts.add(a),(r=new o).addHandler(e),this._fontCache[n]=r,a.loaded.then(function(){r.onLoaded()})}},_loadWithCSS:function(n,t,e){var r=this._fontCache[n];if(r)r.isLoaded()||r.addHandler(e);else{var a=document,c=document.createElement("style");c.type="text/css",a.body.appendChild(c);var h="";isNaN(n-0)?h+="@font-face { font-family:"+n+"; src:":h+="@font-face { font-family:'"+n+"'; src:",h+="url('"+t+"');",c.textContent=h+"}";var u=document.createElement("div"),d=u.style;if(d.fontFamily=n,u.innerHTML=".",d.position="absolute",d.left="-100px",d.top="-100px",a.body.appendChild(u),(r=new o).addHandler(e),this._fontCache[n]=r,r._isLoadWithCSS=!0,!this._canvasContext){var f=document.createElement("canvas");f.width=100,f.height=100,this._canvasContext=f.getContext("2d")}var m="40px "+n;this._canvasContext.font=m;var v=this._canvasContext.measureText(this._testString).width;this._fontWidthCache[n]=v;var _=this;c.onload=function(){setTimeout(function(){_._allFontsLoaded||(cc.logID(4004),r.onLoaded(),cc.director.getScheduler().unschedule(this._checkFontLoaded,this))},2e4)}}},_getFontFamily:function(n){var t=n.lastIndexOf(".ttf");if(t===-1)return n;var e=n.lastIndexOf("/");return e===-1?n.substring(0,t)+"_LABEL":n.substring(e+1,t)+"_LABEL"}};cc.TextUtils=N.exports={label_wordRex:/([a-zA-Z0-9ÄÖÜäöüßéèçàùêâîôûа-яА-ЯЁё]+|\S)/,label_symbolRex:/^[!,.:;'}\]%\?>、‘“》？。，！]/,label_lastWordRex:/([a-zA-Z0-9ÄÖÜäöüßéèçàùêâîôûаíìÍÌïÁÀáàÉÈÒÓòóŐőÙÚŰúűñÑæÆœŒÃÂãÔõěščřžýáíéóúůťďňĚŠČŘŽÁÍÉÓÚŤżźśóńłęćąŻŹŚÓŃŁĘĆĄ-яА-ЯЁё]+|\S)$/,label_lastEnglish:/[a-zA-Z0-9ÄÖÜäöüßéèçàùêâîôûаíìÍÌïÁÀáàÉÈÒÓòóŐőÙÚŰúűñÑæÆœŒÃÂãÔõěščřžýáíéóúůťďňĚŠČŘŽÁÍÉÓÚŤżźśóńłęćąŻŹŚÓŃŁĘĆĄ-яА-ЯЁё]+$/,label_firstEnglish:/^[a-zA-Z0-9ÄÖÜäöüßéèçàùêâîôûаíìÍÌïÁÀáàÉÈÒÓòóŐőÙÚŰúűñÑæÆœŒÃÂãÔõěščřžýáíéóúůťďňĚŠČŘŽÁÍÉÓÚŤżźśóńłęćąŻŹŚÓŃŁĘĆĄ-яА-ЯЁё]/,label_wrapinspection:!0,isUnicodeCJK:function(n){return/^[\u4E00-\u9FFF\u3400-\u4DFF]+$/.test(n)||/[\u3000-\u303F]|[\u3040-\u309F]|[\u30A0-\u30FF]|[\uFF00-\uFFEF]|[\u4E00-\u9FAF]|[\u2605-\u2606]|[\u2190-\u2195]|\u203B/g.test(n)||/^[\u1100-\u11FF]|[\u3130-\u318F]|[\uA960-\uA97F]|[\uAC00-\uD7AF]|[\uD7B0-\uD7FF]+$/.test(n)},isUnicodeSpace:function(n){return(n=n.charCodeAt(0))>=9&&n<=13||n===32||n===133||n===160||n===5760||n>=8192&&n<=8202||n===8232||n===8233||n===8239||n===8287||n===12288},fragmentText:function(n,t,e,r){var a=[];if(n.length===0||e<0)return a.push(""),a;for(var c=n;t>e&&c.length>1;){for(var h=c.length*(e/t)|0,u=c.substr(h),d=t-r(u),f=u,m=0,v=0;d>e&&v++<10;)h*=e/d,h|=0,d=t-r(u=c.substr(h));for(v=0;d<=e&&v++<10;){if(u){var _=this.label_wordRex.exec(u);m=_?_[0].length:1,f=u}h+=m,d=t-r(u=c.substr(h))}(h-=m)==0&&(h=1,f=f.substr(1));var p,g=c.substr(0,h);this.label_wrapinspection&&this.label_symbolRex.test(f||u)&&((h-=(p=this.label_lastWordRex.exec(g))?p[0].length:0)==0&&(h=1),f=c.substr(h),g=c.substr(0,h)),this.label_firstEnglish.test(f)&&(p=this.label_lastEnglish.exec(g))&&g!==p[0]&&(h-=p[0].length,f=c.substr(h),g=c.substr(0,h)),(a.length===0||(g=g.trim()).length>0)&&a.push(g),t=r(c=f||u)}return(a.length===0||(c=c.trim()).length>0)&&a.push(c),a}},cc.CustomFontLoader=N.exports=s},{}],115:[function(T,N,z){function o(y){var C,S,I;if(typeof y=="object"){if(S=y,y.url)return S;C=y.uuid}else S={},C=y;return I=S.type?S.type==="uuid":cc.AssetLibrary._getAssetUrl(C),cc.AssetLibrary._getAssetInfoInRuntime(C,v),S.url=I?v.url:C,v.url&&S.type==="uuid"&&v.raw?(S.type=null,S.isRawAsset=!0):I||(S.isRawAsset=!0),S}function s(){var y=new r,C=new a,S=new c;t.call(this,[y,C,S]),this.assetLoader=y,this.downloader=C,this.loader=S,this.onProgress=null,this._autoReleaseSetting={}}var n=T("../platform/js"),t=T("./pipeline"),e=T("./loading-items"),r=T("./asset-loader"),a=T("./downloader"),c=T("./loader"),h=T("./asset-table"),u=T("../platform/utils").callInNextTick,d=T("./auto-release-utils"),f=new h,m=["mp3","ogg","wav","m4a"],v={url:null,raw:!1},_=[],p=[];n.extend(s,t);var g=s.prototype;g.init=function(y){},g.getXMLHttpRequest=function(){return window.XMLHttpRequest?new window.XMLHttpRequest:new ActiveXObject("MSXML2.XMLHTTP")},g.addDownloadHandlers=function(y){this.downloader.addHandlers(y)},g.addLoadHandlers=function(y){this.loader.addHandlers(y)},g.load=function(y,C,S){S===void 0&&(S=C,C=this.onProgress||null);var I=this,b=!1;y instanceof Array||(b=!0,y=y?[y]:[]),_.length=0;for(var A=0;A<y.length;++A){var E=y[A];E&&E.id&&(cc.warnID(4920,E.id),E.uuid||E.url||(E.url=E.id));var R=o(E);if(R.url||R.uuid){var O=this._cache[R.url];_.push(O||R)}}var P=e.create(this,C,function(x,w){u(function(){if(S){if(b){var L=R.url;S.call(I,w.getError(L),w.getContent(L))}else S.call(I,x,w);S=null}w.destroy()})});e.initQueueDeps(P),P.append(_),_.length=0},g.flowInDeps=function(y,C,S){p.length=0;for(var I=0;I<C.length;++I){var b=o(C[I]);if(b.url||b.uuid){var A=this._cache[b.url];A?p.push(A):p.push(b)}}var E=e.create(this,y?function(P,x,w){this._ownerQueue&&this._ownerQueue.onProgress&&this._ownerQueue._childOnProgress(w)}:null,function(P,x){S(P,x),y&&y.deps&&(y.deps.length=0),x.destroy()});if(y){var R=e.getQueue(y);E._ownerQueue=R._ownerQueue||R}var O=E.append(p,y);return p.length=0,O},g._resources=f,g._getResUuid=function(y,C,S){if(!y)return null;var I=y.indexOf("?");I!==-1&&(y=y.substr(0,I));var b=f.getUuid(y,C);if(!b){var A=cc.path.extname(y);A&&(y=y.slice(0,-A.length),(b=f.getUuid(y,C))&&!S&&cc.warnID(4901,y,A))}return b},g._getReferenceKey=function(y){var C;return typeof y=="object"?C=y._uuid||null:typeof y=="string"&&(C=this._getResUuid(y,null,!0)||y),C?(cc.AssetLibrary._getAssetInfoInRuntime(C,v),this._cache[v.url]?v.url:C):(cc.warnID(4800,y),C)},g._urlNotFound=function(y,C,S){u(function(){y=cc.url.normalize(y);var I=(C?n.getClassName(C):"Asset")+' in "resources/'+y+'" does not exist.';S&&S(new Error(I),[])})},g._parseLoadResArgs=function(y,C,S){if(S===void 0){var I=cc.isChildClassOf(y,cc.RawAsset);C?(S=C,I&&(C=this.onProgress||null)):C!==void 0||I||(S=y,C=this.onProgress||null,y=null),C===void 0||I||(C=y,y=null)}return{type:y,onProgress:C,onComplete:S}},g.loadRes=function(y,C,S,I){var b=this._parseLoadResArgs(C,S,I);C=b.type,S=b.onProgress,I=b.onComplete;var A=this,E=A._getResUuid(y,C);E?this.load({type:"uuid",uuid:E},S,function(R,O){O&&A.setAutoReleaseRecursively(E,!1),I&&I(R,O)}):A._urlNotFound(y,C,I)},g._loadResUuids=function(y,C,S,I){if(y.length>0){var b=this,A=y.map(function(E){return{type:"uuid",uuid:E}});this.load(A,C,function(E,R){if(S){for(var O=[],P=I&&[],x=0;x<A.length;++x){var w=A[x].uuid,L=this._getReferenceKey(w),D=R.getContent(L);D&&(b.setAutoReleaseRecursively(w,!1),O.push(D),P&&P.push(I[x]))}I?S(E,O,P):S(E,O)}})}else S&&u(function(){I?S(null,[],[]):S(null,[])})},g.loadResArray=function(y,C,S,I){var b=this._parseLoadResArgs(C,S,I);C=b.type,S=b.onProgress,I=b.onComplete;for(var A=[],E=0;E<y.length;E++){var R=y[E],O=this._getResUuid(R,C);if(!O)return void this._urlNotFound(R,C,I);A.push(O)}this._loadResUuids(A,S,I)},g.loadResDir=function(y,C,S,I){var b=this._parseLoadResArgs(C,S,I);C=b.type,S=b.onProgress,I=b.onComplete;var A=[],E=f.getUuidArray(y,C,A);this._loadResUuids(E,S,I,A)},g.getRes=function(y,C){var S=this._cache[y];if(!S){var I=this._getResUuid(y,C,!0);if(!I)return null;var b=this._getReferenceKey(I);S=this._cache[b]}return S&&S.alias&&(S=S.alias),S&&S.complete?S.content:null},g.getResCount=function(){return Object.keys(this._cache).length},g.getDependsRecursively=function(y){if(y){var C=this._getReferenceKey(y),S=d.getDependsRecursively(C);return S.push(C),S}return[]},g.release=function(y){if(Array.isArray(y))for(var C=0;C<y.length;C++){var S=y[C];this.release(S)}else if(y){var I=this._getReferenceKey(y),b=this.getItem(I);if(b)if(this.removeItem(I),(y=b.content)instanceof cc.Asset)for(var A=y.rawUrls,E=0;E<A.length;E++)this.release(A[E]);else y instanceof cc.Texture2D?cc.textureCache.removeTextureForKey(b.rawUrl||b.url):m.indexOf(b.type)!==-1&&cc.audioEngine.uncache(b.rawUrl||b.url)}},g.releaseAsset=function(y){var C=y._uuid;C&&this.release(C)},g.releaseRes=function(y,C){var S=this._getResUuid(y,C);S?this.release(S):cc.errorID(4914,y)},g.releaseResDir=function(y,C){for(var S=f.getUuidArray(y,C),I=0;I<S.length;I++){var b=S[I];this.release(b)}},g.releaseAll=function(){for(var y in this._cache)this.release(y)},g.removeItem=function(y){var C=t.prototype.removeItem.call(this,y);return delete this._autoReleaseSetting[y],C},g.setAutoRelease=function(y,C){var S=this._getReferenceKey(y);S&&(this._autoReleaseSetting[S]=!!C)},g.setAutoReleaseRecursively=function(y,C){C=!!C;var S=this._getReferenceKey(y);if(S){this._autoReleaseSetting[S]=C;for(var I=d.getDependsRecursively(S),b=0;b<I.length;b++){var A=I[b];this._autoReleaseSetting[A]=C}}},g.isAutoRelease=function(y){var C=this._getReferenceKey(y);return!!C&&!!this._autoReleaseSetting[C]},cc.loader=new s,N.exports=cc.loader},{"../platform/js":156,"../platform/utils":160,"./asset-loader":116,"./asset-table":117,"./auto-release-utils":119,"./downloader":120,"./loader":123,"./loading-items":124,"./pipeline":127,"./released-asset-checker":128}],116:[function(T,N,z){var o=T("../utils/CCPath"),s=T("./pipeline"),n=T("./loading-items"),t=function(r){this.id="AssetLoader",this.async=!0,this.pipeline=null};t.ID="AssetLoader";var e=[];t.prototype.handle=function(r,a){var c=r.uuid;if(!c)return r.content?r.content:null;cc.AssetLibrary.queryAssetInfo(c,function(h,u,d){if(h)a(h);else if(r.url=r.rawUrl=u,r.isRawAsset=d,d){var f=o.extname(u).toLowerCase();if(!f)return void a(new Error("Download Uuid: can not find type of raw asset["+c+"]: "+u));f=f.substr(1);var m=n.getQueue(r);e[0]={queueId:r.queueId,id:u,url:u,type:f,error:null,alias:r,complete:!0},m.append(e),r.type=f,a(null,r.content)}else r.type="uuid",a(null,r.content)})},s.AssetLoader=N.exports=t},{"../utils/CCPath":178,"./loading-items":124,"./pipeline":127}],117:[function(T,N,z){function o(){this._pathToUuid={}}function s(e,r){if(e.length>r.length){var a=e.charCodeAt(r.length);return a===46||a===47}return!0}var n=T("../utils/misc").pushToMap,t=o.prototype;t.getUuid=function(e,r){e=cc.url.normalize(e);var a=this._pathToUuid[e];if(a){if(Array.isArray(a)){if(!r)return a[0].uuid;for(var c=0;c<a.length;c++){var h=a[c];if(cc.isChildClassOf(h.type,r))return h.uuid}}else if(!r||cc.isChildClassOf(a.type,r))return a.uuid}return""},t.getUuidArray=function(e,r,a){(e=cc.url.normalize(e))[e.length-1]==="/"&&(e=e.slice(0,-1));var c=this._pathToUuid,h=[],u=cc.isChildClassOf;for(var d in c)if(d.startsWith(e)&&s(d,e)||!e){var f=c[d];if(Array.isArray(f))for(var m=0;m<f.length;m++){var v=f[m];r&&!u(v.type,r)||(h.push(v.uuid),a&&a.push(d))}else r&&!u(f.type,r)||(h.push(f.uuid),a&&a.push(d))}return h},t.add=function(e,r,a,c){e=e.substring(0,e.length-cc.path.extname(e).length);var h=new function(u,d){this.uuid=u,this.type=d}(r,a);n(this._pathToUuid,e,h,c)},t._getInfo_DEBUG=!1,t.reset=function(){this._pathToUuid={}},N.exports=o},{"../utils/misc":185}],118:[function(T,N,z){T("../utils/CCPath");var o=T("../platform/CCSys"),s=(T("./pipeline"),T("../../audio/CCAudioEngine"),o.__audioSupport),n=s.format,t=s.context;N.exports=function(e,r){if(n.length===0)return new Error("Audio Downloader: audio not supported on this browser!");e.content=e.url,!s.WEB_AUDIO||e.urlParam&&e.urlParam.useDom?function(a,c){var h=document.createElement("audio");if(h.src=a.url,o.platform===o.WECHAT_GAME)return a.element=h,void c(null,a.id);var u=function(){clearTimeout(d),h.removeEventListener("canplaythrough",f,!1),h.removeEventListener("error",m,!1),s.USE_LOADER_EVENT&&h.removeEventListener(s.USE_LOADER_EVENT,f,!1)},d=setTimeout(function(){h.readyState===0?m():f()},8e3),f=function(){u(),a.element=h,c(null,a.url)},m=function(){u();var v="load audio failure - "+a.url;cc.log(v),c(v,a.url)};h.addEventListener("canplaythrough",f,!1),h.addEventListener("error",m,!1),s.USE_LOADER_EVENT&&h.addEventListener(s.USE_LOADER_EVENT,f,!1)}(e,r):function(a,c){t||c(new Error("Audio Downloader: no web audio context."));var h=cc.loader.getXMLHttpRequest();h.open("GET",a.url,!0),h.responseType="arraybuffer",h.onload=function(){t.decodeAudioData(h.response,function(u){a.buffer=u,c(null,a.id)},function(){c("decode error - "+a.id,null)})},h.onerror=function(){c("request error - "+a.id,null)},h.send()}(e,r)}},{"../../audio/CCAudioEngine":23,"../platform/CCSys":144,"../utils/CCPath":178,"./pipeline":127}],119:[function(T,N,z){function o(r,a){var c=cc.loader.getItem(r);if(c){var h=c.dependKeys;if(h)for(var u=0;u<h.length;u++){var d=h[u];a[d]||(a[d]=!0,o(d,a))}}}function s(r,a){var c=cc.loader._getReferenceKey(r);a[c]||(a[c]=!0,o(c,a))}function n(r,a){for(var c=Object.getOwnPropertyNames(r),h=0;h<c.length;h++){var u=r[c[h]];if(typeof u=="object"&&u)if(Array.isArray(u))for(var d=0;d<u.length;d++){var f=u[d];f instanceof cc.RawAsset&&s(f,a)}else if(u.constructor&&u.constructor!==Object)u instanceof cc.RawAsset&&s(u,a);else for(var m=Object.getOwnPropertyNames(u),v=0;v<m.length;v++){var _=u[m[v]];_ instanceof cc.RawAsset&&s(_,a)}}}function t(r,a){for(var c=0;c<r._components.length;c++)n(r._components[c],a);for(var h=0;h<r._children.length;h++)t(r._children[h],a)}var e=T("../platform/js");N.exports={autoRelease:function(r,a,c){var h=cc.loader._autoReleaseSetting,u=e.createMap();if(a)for(var d=0;d<a.length;d++)u[a[d]]=!0;for(var f=0;f<c.length;f++)t(c[f],u);if(r)for(var m=0;m<r.length;m++){var v=r[m];h[v]===!1||u[v]||cc.loader.release(v)}for(var _=Object.keys(h),p=0;p<_.length;p++){var g=_[p];h[g]!==!0||u[g]||cc.loader.release(g)}},getDependsRecursively:function(r){var a={};return o(r,a),Object.keys(a)}}},{"../platform/js":156}],120:[function(T,N,z){function o(p,g,y,C){y===void 0&&(y=!0);var S=f(p.url);if(C=C||c.imagePool.get(),y&&window.location.protocol!=="file:"?C.crossOrigin="anonymous":C.crossOrigin=null,C.complete&&C.naturalWidth>0&&C.src===S)return C;(function(){function I(){C.removeEventListener("load",I),C.removeEventListener("error",b),g(null,C)}function b(){C.removeEventListener("load",I),C.removeEventListener("error",b),window.location.protocol!=="https:"&&C.crossOrigin&&C.crossOrigin.toLowerCase()==="anonymous"?o(p,g,!1,C):g(new Error("Load image ("+S+") failed"))}C.addEventListener("load",I),C.addEventListener("error",b),C.src=S})()}function s(p,g,y){var C=document,S=document.createElement("style");S.type="text/css",C.body.appendChild(S);var I="";if(isNaN(p-0)?I+="@font-face { font-family:"+p+"; src:":I+="@font-face { font-family:'"+p+"'; src:",g instanceof Array)for(var b=0,A=g.length;b<A;b++){var E=g[b];y=a.extname(E).toLowerCase(),I+="url('"+g[b]+"') format('"+m[y]+"')",I+=b===A-1?";":","}else y=y.toLowerCase(),I+="url('"+g+"') format('"+m[y]+"');";S.textContent+=I+"}";var R=document.createElement("div"),O=R.style;O.fontFamily=p,R.innerHTML=".",O.position="absolute",O.left="-100px",O.top="-100px",C.body.appendChild(R)}function n(p,g){var y=p.url,C=p.type,S=p.name,I=p.srcs;if(S&&I?(I.indexOf(y)===-1&&I.push(y),s(S,I)):(C=a.extname(y),s(S=a.basename(y,C),y,C)),!document.fonts)return null;document.fonts.load("1em "+S).then(function(){g(null,null)},function(b){g(b)})}var t,e=T("../platform/js"),r=T("../platform/CCSys"),a=T("../utils/CCPath"),c=T("../utils/misc"),h=T("./pipeline"),u=T("./pack-downloader"),d=T("./text-downloader"),f=T("./utils").urlAppendTimestamp,m={".eot":"embedded-opentype",".ttf":"truetype",".ttc":"truetype",".woff":"woff",".svg":"svg"},v={js:function(p,g,y){function C(){A.parentNode.removeChild(A),A.removeEventListener("load",C,!1),A.removeEventListener("error",S,!1),g(null,I)}function S(){A.parentNode.removeChild(A),A.removeEventListener("load",C,!1),A.removeEventListener("error",S,!1),g(new Error("Load "+I+" failed!"),I)}if(r.platform===r.WECHAT_GAME)return T(p.url),void g(null,p.url);var I=p.url,b=document,A=document.createElement("script");A.async=y,A.src=f(I),A.addEventListener("load",C,!1),A.addEventListener("error",S,!1),b.body.appendChild(A)},png:o,jpg:o,bmp:o,jpeg:o,gif:o,ico:o,tiff:o,webp:function(p,g,y,C){return cc.sys.capabilities.webp?o(p,g,y,C):new Error("Load Webp ( "+p.url+" ) failed")},image:o,mp3:t=T("./audio-downloader"),ogg:t,wav:t,m4a:t,txt:d,xml:d,vsh:d,fsh:d,atlas:d,tmx:d,tsx:d,json:d,ExportJson:d,plist:d,fnt:d,font:n,eot:n,ttf:n,woff:n,svg:n,ttc:n,uuid:function(p,g){var y=u.load(p,g);return y===void 0?this.extMap.json(p,g):y||void 0},default:d},_=function(p){this.id="Downloader",this.async=!0,this.pipeline=null,this._curConcurrent=0,this._loadQueue=[],this.extMap=e.mixin(p,v)};_.ID="Downloader",_.PackDownloader=u,_.prototype.addHandlers=function(p){e.mixin(this.extMap,p)},_.prototype._handleLoadQueue=function(){for(;this._curConcurrent<cc.macro.DOWNLOAD_MAX_CONCURRENT;){var p=this._loadQueue.shift();if(!p)break;var g=this.handle(p.item,p.callback);g!==void 0&&(g instanceof Error?p.callback(g):p.callback(null,g))}},_.prototype.handle=function(p,g){var y=this,C=this.extMap[p.type]||this.extMap.default,S=void 0;if(this._curConcurrent<cc.macro.DOWNLOAD_MAX_CONCURRENT){if(this._curConcurrent++,(S=C.call(this,p,function(I,b){y._curConcurrent=Math.max(0,y._curConcurrent-1),y._handleLoadQueue(),g&&g(I,b)}))!==void 0)return this._curConcurrent=Math.max(0,this._curConcurrent-1),this._handleLoadQueue(),S}else if(p.ignoreMaxConcurrency){if((S=C.call(this,p,g))!==void 0)return S}else this._loadQueue.push({item:p,callback:g})},h.Downloader=N.exports=_},{"../platform/CCSys":144,"../platform/js":156,"../utils/CCPath":178,"../utils/misc":185,"./audio-downloader":118,"./pack-downloader":126,"./pipeline":127,"./text-downloader":129,"./utils":130}],121:[function(T,N,z){T("./downloader"),T("./loader"),T("./json-unpacker"),T("./loading-items"),T("./pipeline"),T("./CCLoader")},{"./CCLoader":115,"./downloader":120,"./json-unpacker":122,"./loader":123,"./loading-items":124,"./pipeline":127}],122:[function(T,N,z){function o(){this.jsons={},this.state=-1}o.prototype.read=function(s,n){var t=typeof n=="string"?JSON.parse(n):n;t.length!==s.length&&cc.errorID(4915);for(var e=0;e<s.length;e++){var r=s[e],a=t[e];this.jsons[r]=a}},o.prototype.retrieve=function(s){return this.jsons[s]||null},N.exports=o},{}],123:[function(T,N,z){function o(u,d){if(typeof u.content!="string")return new Error("JSON Loader: Input item doesn't contain string content");try{return JSON.parse(u.content)}catch(f){return new Error("JSON Loader: Parse json ["+u.id+"] failed : "+f)}}function s(u,d){if(t.platform!==t.WECHAT_GAME&&t.platform!==t.QQ_PLAY&&!(u.content instanceof Image))return new Error("Image Loader: Input item doesn't contain Image content");var f=u.rawUrl,m=cc.textureCache.getTextureForKey(f)||new r;return m.url=f,m.initWithElement(u.content),m.handleLoadedTexture(),cc.textureCache.cacheImage(f,m),m}var n=T("../platform/js"),t=T("../platform/CCSys"),e=T("./pipeline"),r=T("../textures/CCTexture2D"),a=T("./uuid-loader"),c=(T("../utils/misc"),{png:s,jpg:s,bmp:s,jpeg:s,gif:s,ico:s,tiff:s,webp:s,image:s,json:o,ExportJson:o,plist:function(u,d){if(typeof u.content!="string")return new Error("Plist Loader: Input item doesn't contain string content");var f=cc.plistParser.parse(u.content);return f||new Error("Plist Loader: Parse ["+u.id+"] failed")},uuid:a,prefab:a,fire:a,scene:a,default:function(u,d){return null}}),h=function(u){this.id="Loader",this.async=!0,this.pipeline=null,this.extMap=n.mixin(u,c)};h.ID="Loader",h.prototype.addHandlers=function(u){this.extMap=n.mixin(this.extMap,u)},h.prototype.handle=function(u,d){return(this.extMap[u.type]||this.extMap.default).call(this,u,d)},e.Loader=N.exports=h},{"../platform/CCSys":144,"../platform/js":156,"../textures/CCTexture2D":175,"../utils/misc":185,"./pipeline":127,"./uuid-loader":131}],124:[function(T,N,z){function o(_){return typeof(_.url||_)=="string"}function s(_,p){var g=typeof _=="object"?_.url:_,y={queueId:p,id:g,url:g,rawUrl:void 0,urlParam:function(I){if(I){var b=I.split("?");if(b&&b[0]&&b[1]){var A={};return b[1].split("&").forEach(function(E){var R=E.split("=");A[R[0]]=R[1]}),A}}}(g),type:"",error:null,content:null,complete:!1,states:{},deps:null};if(typeof _=="object"&&(r.mixin(y,_),_.skips))for(var C=0;C<_.skips.length;C++){var S=_.skips[C];y.states[S]=u.COMPLETE}return y.rawUrl=y.url,g&&!y.type&&(y.type=e.extname(g).toLowerCase().substr(1)),y}function n(_,p,g){if(!_||!p)return!1;var y=!1;if(f.push(p.id),p.deps){var C,S,I=p.deps;for(C=0;C<I.length;C++){if((S=I[C]).id===_.id){y=!0;break}if(!(f.indexOf(S.id)>=0)&&S.deps&&n(_,S,!0)){y=!0;break}}}return g||(f.length=0),y}var t=T("../platform/callbacks-invoker"),e=T("../utils/CCPath"),r=T("../platform/js"),a=0|998*Math.random(),c={},h=[],u={WORKING:1,COMPLETE:2,ERROR:3},d={},f=[],m=function(_,p,g,y){t.call(this),this._id=++a,c[this._id]=this,this._pipeline=_,this._errorUrls=[],this._appending=!1,this._ownerQueue=null,this.onProgress=g,this.onComplete=y,this.map={},this.completed={},this.totalCount=0,this.completedCount=0,this._pipeline?this.active=!0:this.active=!1,p&&(p.length>0?this.append(p):this.allComplete())};m.ItemState=new cc.Enum(u),m.create=function(_,p,g,y){g===void 0?typeof p=="function"&&(y=p,p=g=null):y===void 0&&(typeof p=="function"?(y=g,g=p,p=null):(y=g,g=null));var C=h.pop();return C?(C._pipeline=_,C.onProgress=g,C.onComplete=y,c[C._id]=C,C._pipeline&&(C.active=!0),p&&C.append(p)):C=new m(_,p,g,y),C},m.getQueue=function(_){return _.queueId?c[_.queueId]:null},m.itemComplete=function(_){var p=c[_.queueId];p&&p.itemComplete(_.id)},m.initQueueDeps=function(_){var p=d[_._id];p?(p.completed.length=0,p.deps.length=0):p=d[_._id]={completed:[],deps:[]}},m.registerQueueDep=function(_,p){var g=_.queueId||_;if(!g)return!1;var y=d[g];if(y)y.deps.indexOf(p)===-1&&y.deps.push(p);else if(_.id)for(var C in d){var S=d[C];S.deps.indexOf(_.id)!==-1&&S.deps.indexOf(p)===-1&&S.deps.push(p)}},m.finishDep=function(_){for(var p in d){var g=d[p];g.deps.indexOf(_)!==-1&&g.completed.indexOf(_)===-1&&g.completed.push(_)}};var v=m.prototype;r.mixin(v,t.prototype),v.append=function(_,p){if(!this.active)return[];p&&!p.deps&&(p.deps=[]),this._appending=!0;var g,y,C,S=[];for(g=0;g<_.length;++g)if(!(y=_[g]).queueId||this.map[y.id]){if(o(y)){var I=(C=s(y,this._id)).id;this.map[I]||(this.map[I]=C,this.totalCount++,p&&p.deps.push(C),m.registerQueueDep(p||this._id,I),S.push(C))}}else{if(this.map[y.id]=y,p&&p.deps.push(y),y.complete||n(p,y)){this.totalCount++,this.itemComplete(y.id);continue}var b=this,A=c[y.queueId];A&&(this.totalCount++,m.registerQueueDep(p||this._id,y.id),A.addListener(y.id,function(E){b.itemComplete(E.id)}))}return this._appending=!1,this.completedCount===this.totalCount?this.allComplete():this._pipeline.flowIn(S),S},v._childOnProgress=function(_){if(this.onProgress){var p=d[this._id];this.onProgress(p?p.completed.length:this.completedCount,p?p.deps.length:this.totalCount,_)}},v.allComplete=function(){var _=this._errorUrls.length===0?null:this._errorUrls;this.onComplete&&this.onComplete(_,this)},v.isCompleted=function(){return this.completedCount>=this.totalCount},v.isItemCompleted=function(_){return!!this.completed[_]},v.exists=function(_){return!!this.map[_]},v.getContent=function(_){var p=this.map[_],g=null;return p&&(p.content?g=p.content:p.alias&&(g=p.alias.content)),g},v.getError=function(_){var p=this.map[_],g=null;return p&&(p.error?g=p.error:p.alias&&(g=p.alias.error)),g},v.addListener=t.prototype.add,v.hasListener=t.prototype.has,v.removeListener=t.prototype.remove,v.removeAllListeners=t.prototype.removeAll,v.removeItem=function(_){var p=this.map[_];p&&this.completed[p.alias||_]&&(delete this.completed[_],delete this.map[_],p.alias&&(delete this.completed[p.alias.id],delete this.map[p.alias.id]),this.completedCount--,this.totalCount--)},v.itemComplete=function(_){var p=this.map[_];if(p){var g=this._errorUrls.indexOf(_);if(p.error&&g===-1?this._errorUrls.push(_):p.error||g===-1||this._errorUrls.splice(g,1),this.completed[_]=p,this.completedCount++,m.finishDep(p.id),this.onProgress){var y=d[this._id];this.onProgress(y?y.completed.length:this.completedCount,y?y.deps.length:this.totalCount,p)}this.invoke(_,p),this.removeAll(_),!this._appending&&this.completedCount>=this.totalCount&&this.allComplete()}},v.destroy=function(){this.active=!1,this._appending=!1,this._pipeline=null,this._ownerQueue=null,this._errorUrls.length=0,this.onProgress=null,this.onComplete=null,this.map={},this.completed={},this.totalCount=0,this.completedCount=0,t.call(this),c[this._id]=null,d[this._id]&&(d[this._id].completed.length=0,d[this._id].deps.length=0),h.indexOf(this)===-1&&h.length<10&&h.push(this)},cc.LoadingItems=N.exports=m},{"../platform/callbacks-invoker":149,"../platform/js":156,"../utils/CCPath":178}],125:[function(T,N,z){var o=T("./pipeline"),s=/(\.[^.\n\\/]*)$/,n=function(t,e,r){this.id="MD5Pipe",this.async=!1,this.pipeline=null,this.md5AssetsMap=t,this.libraryBase=e,this.rawAssetsBase=r};n.ID="MD5Pipe",n.prototype.handle=function(t){return t.url=this.transformURL(t.url),t},n.prototype.transformURL=function(t){var e=t.indexOf("?"),r=t;if(e!==-1&&(r=t.substr(0,e)),r.startsWith(this.libraryBase))r=r.slice(this.libraryBase.length);else{if(!r.startsWith(this.rawAssetsBase))return t;r=r.slice(this.rawAssetsBase.length)}var a=this.md5AssetsMap[r];if(a){var c=!1;t=t.replace(s,function(h,u){return c=!0,"."+a+u}),c||(t=t+"."+a)}return t},o.MD5Pipe=N.exports=n},{"./pipeline":127}],126:[function(T,N,z){function o(u,d){return new Error("Can not retrieve "+u+" from packer "+d)}var s=T("./json-unpacker"),n=T("../utils/misc").pushToMap,t={},e={},r={},a=0,c=2,h=3;N.exports={initPacks:function(u){e=u;for(var d in u)for(var f=u[d],m=0;m<f.length;m++){var v=f[m],_=f.length===1;n(t,v,d,_)}},_loadNewPack:function(u,d,f){var m=this,v=cc.AssetLibrary.getLibUrlNoExt(d)+".json";cc.loader.load({url:v,ignoreMaxConcurrency:!0},function(_,p){if(_)return cc.errorID(4916,u),f(_);var g=m._doLoadNewPack(u,d,p);g?f(null,g):f(o(u,d))})},_doPreload:function(u,d){var f=r[u];f||(f=r[u]=new s),f.state!==h&&(f.read(e[u],d),f.state=h)},_doLoadNewPack:function(u,d,f){var m=r[d];return m.state!==h&&(m.read(e[d],f),m.state=h),m.retrieve(u)},_selectLoadedPack:function(u){for(var d=a,f="",m=0;m<u.length;m++){var v=u[m],_=r[v];if(_){var p=_.state;if(p===h)return v;p>d&&(d=p,f=v)}}return d!==a?f:u[0]},load:function(u,d){var f=u.uuid,m=t[f];if(m){Array.isArray(m)&&(m=this._selectLoadedPack(m));var v=r[m];if(v&&v.state===h){var _=v.retrieve(f);return _||o(f,m)}return v||(console.log("Create unpacker %s for %s",m,f),(v=r[m]=new s).state=c),this._loadNewPack(f,m,d),null}}}},{"../utils/misc":185,"./json-unpacker":122}],127:[function(T,N,z){function o(r,a){var c=r.id,h=a.states[c],u=r.next,d=r.pipeline;if(!a.error&&h!==n.WORKING&&h!==n.ERROR)if(h===n.COMPLETE)u?o(u,a):d.flowOut(a);else{a.states[c]=n.WORKING;var f=r.handle(a,function(m,v){m?(a.error=m,a.states[c]=n.ERROR,d.flowOut(a)):(v&&(a.content=v),a.states[c]=n.COMPLETE,u?o(u,a):d.flowOut(a))});f instanceof Error?(a.error=f,a.states[c]=n.ERROR,d.flowOut(a)):f!==void 0&&(f!==null&&(a.content=f),a.states[c]=n.COMPLETE,u?o(u,a):d.flowOut(a))}}T("../platform/js");var s=T("./loading-items"),n=s.ItemState,t=function(r){this._pipes=r,this._cache={};for(var a=0;a<r.length;++a){var c=r[a];c.handle&&c.id&&(c.pipeline=this,c.next=a<r.length-1?r[a+1]:null)}};t.ItemState=n;var e=t.prototype;e.insertPipe=function(r,a){if(!r.handle||!r.id||a>this._pipes.length)cc.warnID(4921);else if(this._pipes.indexOf(r)>0)cc.warnID(4922);else{r.pipeline=this;var c=null;a<this._pipes.length&&(c=this._pipes[a]);var h=null;a>0&&(h=this._pipes[a-1]),h&&(h.next=r),r.next=c,this._pipes.splice(a,0,r)}},e.insertPipeAfter=function(r,a){var c=this._pipes.indexOf(r);c<0||this.insertPipe(a,c+1)},e.appendPipe=function(r){r.handle&&r.id&&(r.pipeline=this,r.next=null,this._pipes.length>0&&(this._pipes[this._pipes.length-1].next=r),this._pipes.push(r))},e.flowIn=function(r){var a,c,h=this._pipes[0];if(h){for(a=0;a<r.length;a++)c=r[a],this._cache[c.id]=c;for(a=0;a<r.length;a++)o(h,c=r[a])}else for(a=0;a<r.length;a++)this.flowOut(r[a])},e.flowInDeps=function(r,a,c){return s.create(this,function(h,u){c(h,u),u.destroy()}).append(a,r)},e.flowOut=function(r){r.error?delete this._cache[r.id]:this._cache[r.id]||(this._cache[r.id]=r),r.complete=!0,s.itemComplete(r)},e.copyItemStates=function(r,a){if(a instanceof Array)for(var c=0;c<a.length;++c)a[c].states=r.states;else a.states=r.states},e.isFlowing=function(){return!0},e.getItems=function(){return null},e.getItem=function(r){var a=this._cache[r];return a&&(a.alias&&(a=a.alias),a)},e.removeItem=function(r){var a=this._cache[r];return a&&a.complete&&delete this._cache[r],a},e.clear=function(){for(var r in this._cache){var a=this._cache[r];delete this._cache[r],a.complete||(a.error=new Error("Canceled manually"),this.flowOut(a))}},cc.Pipeline=N.exports=t},{"../platform/js":156,"./loading-items":124}],128:[function(T,N,z){},{"../platform/js":156}],129:[function(T,N,z){T("../platform/CCSys");var o=T("./utils").urlAppendTimestamp;N.exports=function(s,n){var t=s.url;t=o(t);var e=cc.loader.getXMLHttpRequest(),r="Load "+t+" failed!",a=window.navigator;e.open("GET",t,!0),/msie/i.test(a.userAgent)&&!/opera/i.test(a.userAgent)?(e.setRequestHeader("Accept-Charset","utf-8"),e.onreadystatechange=function(){e.readyState===4&&(e.status===200||e.status===0?n(null,e.responseText):n({status:e.status,errorMessage:r}))}):(e.overrideMimeType&&e.overrideMimeType("text/plain; charset=utf-8"),e.onload=function(){e.readyState===4&&(e.status===200||e.status===0?n(null,e.responseText):n({status:e.status,errorMessage:r}))},e.onerror=function(){n({status:e.status,errorMessage:r})}),e.send(null)}},{"../platform/CCSys":144,"./utils":130}],130:[function(T,N,z){var o=/\?/;N.exports={urlAppendTimestamp:function(s){return cc.game.config.noCache&&typeof s=="string"&&(o.test(s)?s+="&_t="+(new Date-0):s+="?_t="+(new Date-0)),s}}},{}],131:[function(T,N,z){function o(e){return e&&(e[0]&&e[0].__type__==="cc.Scene"||e[1]&&e[1].__type__==="cc.Scene"||e[0]&&e[0].__type__==="cc.Prefab")}function s(e,r){var a;if(typeof e.content=="string")try{a=JSON.parse(e.content)}catch(v){return new Error("Uuid Loader: Parse asset ["+e.id+"] failed : "+v.stack)}else{if(typeof e.content!="object")return new Error("JSON Loader: Input item doesn't contain string content");a=e.content}var c,h=o(a);c=h?cc._MissingScript.safeFindClass:function(v){var _=n._getClassById(v);return _||(cc.warnID(4903,v),Object)};var u,d=cc.deserialize.Details.pool.get();try{u=cc.deserialize(a,d,{classFinder:c,target:e.existingAsset,customEnv:e})}catch(v){cc.deserialize.Details.pool.put(d);var f=v.stack;return new Error("Uuid Loader: Deserialize asset ["+e.id+"] failed : "+f)}u._uuid=e.uuid;var m=function(v,_,p){var g=_.deferredLoadRaw;return g?v instanceof cc.Asset&&v.constructor.preventDeferredLoadDependents&&(g=!1):p&&(v instanceof cc.SceneAsset||v instanceof cc.Prefab)&&(g=v.asyncLoadAssets),g}(u,e,h);(function(v,_,p,g,y,C){var S,I,b,A,E,R=g.uuidList,O=_.dependKeys=[];if(y)for(S=[],I=[],b=[],A=0;A<R.length;A++){E=R[A];var P=g.uuidObjList[A],x=g.uuidPropList[A],w=cc.AssetLibrary._getAssetInfoInRuntime(E);if(w.raw){var L=w.url;P[x]=L,O.push(L)}else S.push(P),I.push(x),b.push({type:"uuid",uuid:E,deferredLoadRaw:!0})}else for(S=g.uuidObjList,I=g.uuidPropList,b=new Array(R.length),A=0;A<R.length;A++)E=R[A],b[A]={type:"uuid",uuid:E};if(g.rawProp&&(S.push(p),I.push(g.rawProp),b.push(_.url)),p._preloadRawFiles){var D=C;C=function(){p._preloadRawFiles(function(F){D(F||null,p)})}}if(b.length===0)return cc.deserialize.Details.pool.put(g),C(null,p);_.content=p,v.flowInDeps(_,b,function(F,M){var B;for(var W in M.map)(B=M.map[W]).uuid&&B.content&&(B.content._uuid=B.uuid);for(var V=0;V<b.length;V++){var U=b[V].uuid,k=b[V].url,X=S[V],Y=I[V];if(B=M.map[k]){var Z=function(rt){var it=rt.isRawAsset?rt.rawUrl:rt.content;this.obj[this.prop]=it,rt.uuid!==p._uuid&&O.indexOf(rt.id)<0&&O.push(rt.id)},et=Z,$={obj:X,prop:Y};if(B.complete||B.content)B.error?cc._throw(B.error):Z.call($,B);else{var nt=t.getQueue(B),at=nt._callbackTable[U];at?at.unshift(Z,$):nt.addListener(U,Z,$)}}}cc.deserialize.Details.pool.put(g),C(null,p)})})(this.pipeline,e,u,d,m,r)}var n=T("../platform/js");T("../platform/deserialize");var t=T("./loading-items");N.exports=s,s.isSceneObj=o},{"../platform/deserialize":151,"../platform/js":156,"./loading-items":124}],132:[function(T,N,z){function o(p,g,y){g?p._removeComponent(g):e.array.removeAt(p._components,y)}function s(){this._activatingStack=[]}var n=T("./component-scheduler"),t=T("./platform/CCObject").Flags,e=T("./platform/js"),r=t.IsPreloadStarted,a=t.IsOnLoadStarted,c=t.IsOnLoadCalled,h=t.Deactivating,u="c.onLoad();c._objFlags|="+c,d=cc.Class({extends:n.LifeCycleInvoker,add:function(p){this._zero.array.push(p)},remove:function(p){this._zero.fastRemove(p)},cancelInactive:function(p){n.LifeCycleInvoker.stableRemoveInactive(this._zero,p)},invoke:function(){this._invoke(this._zero),this._zero.array.length=0}}),f=n.createInvokeImpl("c.__preload();"),m=n.createInvokeImpl(u),v=new e.Pool(4);v.get=function(){var p=this._get()||{preload:new d(f),onLoad:new n.OneOffInvoker(m),onEnable:new n.OneOffInvoker(n.invokeOnEnable)};p.preload._zero.i=-1;var g=p.onLoad;return g._zero.i=-1,g._neg.i=-1,g._pos.i=-1,g=p.onEnable,g._zero.i=-1,g._neg.i=-1,g._pos.i=-1,p};var _=cc.Class({ctor:s,reset:s,_activateNodeRecursively:function(p,g,y,C){if(p._objFlags&h)cc.errorID(3816,p.name);else{p._activeInHierarchy=!0;for(var S=p._components.length,I=0;I<S;++I){var b=p._components[I];b instanceof cc.Component?this.activateComp(b,g,y,C):(o(p,b,I),--I,--S)}for(var A=0,E=p._children.length;A<E;++A){var R=p._children[A];R._active&&this._activateNodeRecursively(R,g,y,C)}p._onPostActivated(!0)}},_deactivateNodeRecursively:function(p){p._objFlags|=h,p._activeInHierarchy=!1;for(var g=p._components.length,y=0;y<g;++y){var C=p._components[y];if(C._enabled&&(cc.director._compScheduler.disableComp(C),p._activeInHierarchy))return void(p._objFlags&=~h)}for(var S=0,I=p._children.length;S<I;++S){var b=p._children[S];if(b._activeInHierarchy&&(this._deactivateNodeRecursively(b),p._activeInHierarchy))return void(p._objFlags&=~h)}p._onPostActivated(!1),p._objFlags&=~h},activateNode:function(p,g){if(g){var y=v.get();this._activatingStack.push(y),this._activateNodeRecursively(p,y.preload,y.onLoad,y.onEnable),y.preload.invoke(),y.onLoad.invoke(),y.onEnable.invoke(),this._activatingStack.pop(),v.put(y)}else{this._deactivateNodeRecursively(p);for(var C=this._activatingStack,S=0;S<C.length;S++){var I=C[S];I.preload.cancelInactive(r),I.onLoad.cancelInactive(a),I.onEnable.cancelInactive()}}p.emit("active-in-hierarchy-changed",p)},activateComp:function(p,g,y,C){if(p._objFlags&r||(p._objFlags|=r,typeof p.__preload=="function"&&(g?g.add(p):p.__preload())),p._objFlags&a||(p._objFlags|=a,p.onLoad?y?y.add(p):(p.onLoad(),p._objFlags|=c):p._objFlags|=c),p._enabled){if(!p.node._activeInHierarchy)return;cc.director._compScheduler.enableComp(p,C)}},destroyComp:function(p){cc.director._compScheduler.disableComp(p),p.onDestroy&&p._objFlags&c&&p.onDestroy()},resetComp:!1});N.exports=_},{"./component-scheduler":60,"./platform/CCObject":141,"./platform/js":156,"./utils/misc":185}],133:[function(T,N,z){},{"../event-manager":95,"../platform/js":156,"./CCMacro":140,"./CCSys":144}],134:[function(T,N,z){function o(v){return v&&(v.constructor===cc.SceneAsset||v instanceof cc.Scene)}function s(v,_){this.url=v,this.type=_}var n=T("../assets/CCAsset"),t=T("./utils").callInNextTick,e=T("../load-pipeline/CCLoader"),r=T("../load-pipeline/pack-downloader"),a=T("../load-pipeline/auto-release-utils"),c=T("../utils/decode-uuid"),h=T("../load-pipeline/md5-pipe"),u="",d="",f={},m={loadAsset:function(v,_,p){if(typeof v!="string")return t(_,new Error("[AssetLibrary] uuid must be string"),null);var g={uuid:v,type:"uuid"};p&&p.existingAsset&&(g.existingAsset=p.existingAsset),e.load(g,function(y,C){if(y||!C)y=new Error("[AssetLibrary] loading JSON or dependencies failed: "+(y?y.message:"Unknown error"));else{if(C.constructor===cc.SceneAsset){var S=cc.loader._getReferenceKey(v);C.scene.dependAssets=a.getDependsRecursively(S)}if(o(C)){var I=cc.loader._getReferenceKey(v);e.removeItem(I)}}_&&_(y,C)})},getLibUrlNoExt:function(v){return v=c(v),u+v.slice(0,2)+"/"+v},_queryAssetInfoInEditor:function(v,_){},_getAssetInfoInRuntime:function(v,_){_=_||{url:null,raw:!1};var p=f[v];return p&&!cc.isChildClassOf(p.type,cc.Asset)?(_.url=d+p.url,_.raw=!0):(_.url=this.getLibUrlNoExt(v)+".json",_.raw=!1),_},_getAssetUrl:function(v){var _=f[v];return _?d+_.url:null},queryAssetInfo:function(v,_){var p=this._getAssetInfoInRuntime(v);_(null,p.url,p.raw)},parseUuidInEditor:function(v){},loadJson:function(v,_){var p=""+(new Date().getTime()+Math.random()),g={uuid:p,type:"uuid",content:v,skips:[e.assetLoader.id,e.downloader.id]};e.load(g,function(y,C){if(y)y=new Error("[AssetLibrary] loading JSON or dependencies failed: "+y.message);else{if(C.constructor===cc.SceneAsset){var S=cc.loader._getReferenceKey(p);C.scene.dependAssets=a.getDependsRecursively(S)}if(o(C)){var I=cc.loader._getReferenceKey(p);e.removeItem(I)}}C._uuid="",_&&_(y,C)})},getAssetByUuid:function(v){return m._uuidToAsset[v]||null},init:function(v){var _=v.libraryPath;_=_.replace(/\\/g,"/"),u=cc.path.stripSep(_)+"/",d=v.rawAssetsBase;var p=v.md5AssetsMap;if(p){var g=new h(p,u,d);cc.loader.insertPipeAfter(cc.loader.assetLoader,g),cc.loader.md5Pipe=g}var y=e._resources;y.reset();var C=v.rawAssets;if(C)for(var S in C){var I=C[S];for(var b in I){var A=I[b],E=A[0],R=A[1],O=cc.js._getClassById(R);if(O){if(f[b]=new s(S+"/"+E,O),S==="assets"&&E.startsWith("resources/")){if(cc.isChildClassOf(O,n)){var P=cc.path.extname(E);E=P?E.slice(10,-P.length):E.slice(10)}else E=E.slice(10);var x=A[2]===1;y.add(E,b,O,!x)}}else cc.error("Cannot get",R)}}v.packedAssets&&r.initPacks(v.packedAssets);var w=v.mountPaths;w||(w={assets:d+"assets",internal:d+"internal"}),cc.url._init(w)}};m._uuidToAsset={},N.exports=cc.AssetLibrary=m},{"../assets/CCAsset":43,"../load-pipeline/CCLoader":115,"../load-pipeline/auto-release-utils":119,"../load-pipeline/md5-pipe":125,"../load-pipeline/pack-downloader":126,"../utils/decode-uuid":182,"./utils":160}],135:[function(T,N,z){function o(L,D){L.indexOf(D)<0&&L.push(D)}function s(L,D){o(L.__props__,D)}function n(L,D,F,M,B){var W=M.default;y.setClassAttr(L,F,"default",W),s(L,F);var V=v(L,M,D,F,!1);if(V){for(var U=E,k=0;k<V.length;k++){var X=V[k];y.attr(L,F,X),X._onAfterProp&&U.push(X._onAfterProp)}for(var Y=0;Y<U.length;Y++)U[Y](L,F);E.length=0,V.length=0}}function t(L,D,F,M,B){var W=M.get,V=M.set,U=L.prototype,k=Object.getOwnPropertyDescriptor(U,F),X=!k;if(W){for(var Y=v(L,M,D,F,!0),Z=0;Z<Y.length;Z++)y.attr(L,F,Y[Z]);Y.length=0,y.setClassAttr(L,F,"serializable",!1),B||_.get(U,F,W,X,X)}V&&(B||_.set(U,F,V,X,X))}function e(L){return typeof L=="function"?L():L}function r(L,D,F){for(var M in D)L.hasOwnProperty(M)||F&&!F(M)||Object.defineProperty(L,M,_.getPropertyDescriptor(D,M))}function a(L,D,F,M){var B,W,V=M.__ctor__,U=M.ctor,k=M.__ES6__;k?(B=[U],W=U):(B=V?[V]:function(et,$,nt){function at(Rt){return m._isCCClass(Rt)?Rt.__ctors__||[]:[Rt]}for(var rt=[],it=[et].concat($),ot=0;ot<it.length;ot++){var _t=it[ot];if(_t)for(var ut=at(_t),vt=0;vt<ut.length;vt++)o(rt,ut[vt])}var Tt=nt.ctor;return Tt&&rt.push(Tt),rt}(D,F,M),W=O(B,D,L,M),_.value(W,"extend",function(et){return et.extends=this,m(et)},!0)),_.value(W,"__ctors__",B.length>0?B:null,!0);var X=W.prototype;if(D&&(k||(_.extend(W,D),X=W.prototype),_.value(W,"$super",D)),F){for(var Y=F.length-1;Y>=0;Y--){var Z=F[Y];r(X,Z.prototype),r(W,Z,function(et){return Z.hasOwnProperty(et)&&!0}),m._isCCClass(Z)&&r(y.getClassAttrs(W).constructor.prototype,y.getClassAttrs(Z).constructor.prototype)}X.constructor=W}return k||(X.__initProps__=u),_.setClassName(L,W),W}function c(L){for(var D=_.getClassName(L),F=L.constructor,M="new "+D+"(",B=0;B<F.__props__.length;B++){var W=L[F.__props__[B]];if(typeof W=="object")return cc.errorID(3641,D),"new "+D+"()";M+=W,B<F.__props__.length-1&&(M+=",")}return M+")"}function h(L){return JSON.stringify(L).replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")}function u(L){var D=y.getClassAttrs(L),F=L.__props__;F===null&&(A.init(),F=L.__props__);var M=function(B,W){for(var V=[],U="",k=0;k<W.length;k++){var X=W[k],Y=X+C+"default";if(Y in B){var Z;Z=R.test(X)?"this."+X+"=":"this["+h(X)+"]=";var et,$=B[Y];if(typeof $=="object"&&$)et=$ instanceof cc.ValueType?c($):Array.isArray($)?"[]":"{}";else if(typeof $=="function"){var nt=V.length;V.push($),et="F["+nt+"]()"}else et=typeof $=="string"?h($):$;U+=Z=Z+et+`;
`}}return V.length===0?Function(U):Function("F",`return (function(){
`+U+"})")(V)}(D,F);L.prototype.__initProps__=M,M.call(this)}function d(L,D,F){var M=!1;for(var B in D)if(!(b.indexOf(B)>=0)){var W=D[B];if(typeof W=="function"){var V=_.getPropertyDescriptor(L.prototype,B);if(V){var U=V.value;if(typeof U=="function"){P.test(W)&&(M=!0,D[B]=function(k,X){return function(){var Y=this._super;this._super=k;var Z=X.apply(this,arguments);return this._super=Y,Z}}(U,W));continue}}}}return M}function f(L,D,F,M,B,W){if(L.__props__=[],M&&M.__props__&&(L.__props__=M.__props__.slice()),B)for(var V=0;V<B.length;++V){var U=B[V];U.__props__&&(L.__props__=L.__props__.concat(U.__props__.filter(function(Y){return L.__props__.indexOf(Y)<0})))}if(F){I.preprocessAttrs(F,D,L,W);for(var k in F){var X=F[k];"default"in X?n(L,D,k,X):t(L,D,k,X,W)}}}function m(L){var D=(L=L||{}).name,F=L.extends,M=L.mixins,B=function(Z,et,$,nt){var at=cc.Component,rt=cc._RF.peek();if(rt&&cc.isChildClassOf(et,at)){if(cc.isChildClassOf(rt.cls,at))return cc.errorID(3615),null;Z=Z||rt.script}var it=a(Z,et,$,nt);if(rt)if(cc.isChildClassOf(et,at)){var ot=rt.uuid;ot&&_._setClassId(ot,it),rt.cls=it}else cc.isChildClassOf(rt.cls,at)||(rt.cls=it);return it}(D,F,M,L);D||(D=cc.js.getClassName(B)),B._sealed=!0,F&&(F._sealed=!1);var W=L.properties;typeof W=="function"||F&&F.__props__===null||M&&M.some(function(Z){return Z.__props__===null})?(A.push({cls:B,props:W,mixins:M}),B.__props__=null):f(B,D,W,F,L.mixins,L.__ES6__);var V=L.statics;if(V){var U;for(U in V)B[U]=V[U]}for(var k in L)if(!(b.indexOf(k)>=0)){var X=L[k];I.validateMethodWithProps(X,k,D,B,F)&&_.value(B.prototype,k,X,!0,!0)}var Y=L.editor;return Y&&cc.isChildClassOf(F,cc.Component)&&cc.Component._registerEditorProps(B,Y),B}function v(L,D,F,M,B){function W(){return k=M+C,U=y.getClassAttrsProto(L)}function V(nt,at){if(nt in D){var rt=D[nt];typeof rt===at&&((U||W())[k+nt]=rt)}}var U=null,k="";w.length=0;var X=w,Y=D.type;if(Y){var Z=x[Y];if(Z)X.push({type:Y,_onAfterProp:S(Z,"cc."+Y)});else if(Y!=="Object")if(Y===y.ScriptUuid){var et=y.ObjectType(cc.ScriptAsset);et.type="Script",X.push(et)}else typeof Y=="object"?p.isEnum(Y)&&X.push({type:"Enum",enumList:p.getList(Y)}):typeof Y=="function"&&(D.url?X.push({type:"Object",ctor:Y,_onAfterProp:S("String","cc.String")}):X.push(D._short?{type:"Object",ctor:Y}:y.ObjectType(Y)))}D.editorOnly&&((U||W())[k+"editorOnly"]=!0),D.url&&((U||W())[k+"saveUrlAsAsset"]=!0),D.serializable===!1&&((U||W())[k+"serializable"]=!1),V("formerlySerializedAs","string");var $=D.range;return $&&Array.isArray($)&&$.length>=2&&((U||W())[k+"min"]=$[0],U[k+"max"]=$[1],$.length>2&&(U[k+"step"]=$[2])),V("min","number"),V("max","number"),V("step","number"),X}var _=T("./js"),p=T("./CCEnum"),g=T("./utils"),y=(g.isPlainEmptyObj_DEV,g.cloneable_DEV,T("./attribute")),C=y.DELIMETER,S=y.getTypeChecker,I=T("./preprocess-class");T("./requiring-frame");var b=["name","extends","mixins","ctor","__ctor__","properties","statics","editor","__ES6__"],A={datas:null,push:function(L){if(this.datas)this.datas.push(L);else{this.datas=[L];var D=this;setTimeout(function(){D.init()},0)}},init:function(){var L=this.datas;if(L){for(var D=0;D<L.length;++D){var F=L[D],M=F.cls,B=F.props;typeof B=="function"&&(B=B());var W=_.getClassName(M);B?f(M,W,B,M.$super,F.mixins):cc.errorID(3633,W)}this.datas=null}}},E=[],R=/^[$A-Za-z_][0-9A-Za-z_$]*$/,O=function(L,D,F,M){var B=`return function CCClass(){
`;D&&d(D,M)&&(B+=`this._super=null;
`),B+=`this.__initProps__(CCClass);
`;var W=L.length;if(W>0){var V=!(F&&F.startsWith("cc."));V&&(B+=`try{
`);var U=`].apply(this,arguments);
`;if(W===1)B+="CCClass.__ctors__[0"+U;else{B+=`var cs=CCClass.__ctors__;
`;for(var k=0;k<W;k++)B+="cs["+k+U}V&&(B+=`}catch(e){
cc._throw(e);
}
`)}return B+="}",Function(B)()},P=/xyz/.test(function(){xyz})?/\b\._super\b/:/.*/;/xyz/.test(function(){xyz}),m._isCCClass=function(L){return L&&L.hasOwnProperty("__ctors__")},m._fastDefine=function(L,D,F){_.setClassName(L,D);for(var M=D.__props__=Object.keys(F),B=y.getClassAttrsProto(D),W=0;W<M.length;W++){var V=M[W];B[V+C+"visible"]=!1,B[V+C+"default"]=F[V]}},m.Attr=y,m.attr=y.attr,cc.isChildClassOf=function(L,D){if(L&&D){if(typeof L!="function"||typeof D!="function")return!1;if(L===D)return!0;for(;;){if(!(L=_.getSuper(L)))return!1;if(L===D)return!0}}return!1},m.getInheritanceChain=function(L){for(var D=[];L=_.getSuper(L);)L!==Object&&D.push(L);return D};var x={Integer:"Number",Float:"Number",Boolean:"Boolean",String:"String"},w=[];cc.Class=m,N.exports={isArray:function(L){return L=e(L),Array.isArray(L)},fastDefine:m._fastDefine,getNewValueTypeCode:c,IDENTIFIER_RE:R,escapeForJS:h,getDefault:e}},{"./CCEnum":137,"./attribute":148,"./js":156,"./preprocess-class":157,"./requiring-frame":158,"./utils":160}],136:[function(T,N,z){function o(R){return R}function s(R,O){return R[O]||(R[O]={})}function n(R){return function(O){return typeof O=="function"?R(O):function(P){return R(P,O)}}}function t(R,O,P){return function(x){return function(w){return O(w,x)}}}function e(R){return t.bind(null,!1)}function r(R,O){return s(R,d)}function a(R,O,P){return R(function(x,w){var L=r(x);if(L){var D=P!==void 0?P:w;s(s(L,"proto"),"editor")[O]=D}},O)}function c(R){return R(o)}T("./CCClass");var h=T("./preprocess-class"),u=T("./js"),d="__ccclassCache__",f=t.bind(null,!1),m=e(),v=e(),_=n(function(R,O){var P=u.getSuper(R);P===Object&&(P=null);var x={name:O,extends:P,ctor:R,__ES6__:!0},w=R[d];if(w){var L=w.proto;L&&u.mixin(x,L),R[d]=void 0}return cc.Class(x)}),p=c(n),g=a(f,"requireComponent"),y=c(m),C=a(v,"executionOrder"),S=c(n),I=c(n),b=c(m),A=c(m),E=c(m);cc._decorator=N.exports={ccclass:_,property:function(R,O,P){function x(L,D,F){var M=r(L.constructor);if(M){var B=s(s(M,"proto"),"properties");(function(W,V,U,k,X,Y){var Z=k&&(h.getFullFormOfProperty(k)||k),et=V[U],$=u.mixin(et||{},Z||{});if(X&&(X.get||X.set))X.get&&($.get=X.get),X.set&&($.set=X.set);else{var nt=void 0;if(X)X.initializer&&(nt=function(rt){var it;try{it=rt()}catch(ot){return rt}return typeof it!="object"||it===null?it:rt}(X.initializer));else{var at=Y.default||(Y.default=function(rt){var it;try{it=new rt}catch(ot){return{}}return it}(W));at.hasOwnProperty(U)&&(nt=at[U])}$.default=nt}V[U]=$})(L.constructor,B,D,w,F,M)}}var w=null;if(O===void 0)return w=R,x;x(R,O,P)},executeInEditMode:p,requireComponent:g,menu:y,executionOrder:C,disallowMultiple:S,playOnFocus:I,inspector:b,icon:A,help:E,mixins:function(){for(var R=[],O=0;O<arguments.length;O++)R[O]=arguments[O];return function(P){var x=r(P);x&&(s(x,"proto").mixins=R)}}}},{"./CCClass":135,"./js":156,"./preprocess-class":157,"./utils":160}],137:[function(T,N,z){function o(n){if("__enums__"in n)return n;s.value(n,"__enums__",null,!0);for(var t=-1,e=Object.keys(n),r=0;r<e.length;r++){var a=e[r],c=n[a];if(c===-1)c=++t,n[a]=c;else if(typeof c=="number")t=c;else if(typeof c=="string"&&Number.isInteger(parseFloat(a)))continue;var h=""+c;a!==h&&s.value(n,h,a)}return n}var s=T("./js");o.isEnum=function(n){return n&&n.hasOwnProperty("__enums__")},o.getList=function(n){if(n.__enums__)return n.__enums__;var t=n.__enums__=[];for(var e in n){var r=n[e];Number.isInteger(r)&&t.push({name:e,value:r})}return t.sort(function(a,c){return a.value-c.value}),t},N.exports=cc.Enum=o},{"./js":156}],138:[function(T,N,z){cc.ClassManager||T("./_CCClass");var o=T("../event-manager"),s=T("./CCInputManager");s.__instanceId=cc.ClassManager.getNewInstanceId();var n;s.setAccelerometerEnabled=function(t){if(this._accelEnabled!==t){this._accelEnabled=t;var e=cc.director.getScheduler();this._accelEnabled,this._accelCurTime=0,e.scheduleUpdate(this)}},s.setAccelerometerInterval=function(t){this._accelInterval!==t&&(this._accelInterval=t)},s._registerKeyboardEvent=function(){cc.game.canvas.addEventListener("keydown",function(t){o.dispatchEvent(new cc.Event.EventKeyboard(t.keyCode,!0)),t.stopPropagation(),t.preventDefault()},!1),cc.game.canvas.addEventListener("keyup",function(t){o.dispatchEvent(new cc.Event.EventKeyboard(t.keyCode,!1)),t.stopPropagation(),t.preventDefault()},!1)},s._registerAccelerometerEvent=function(){var t=window;this._acceleration=new cc.Acceleration,this._accelDeviceEvent=t.DeviceMotionEvent||t.DeviceOrientationEvent,cc.sys.browserType===cc.sys.BROWSER_TYPE_MOBILE_QQ&&(this._accelDeviceEvent=window.DeviceOrientationEvent);var e=this._accelDeviceEvent===t.DeviceMotionEvent?"devicemotion":"deviceorientation",r=navigator.userAgent;(/Android/.test(r)||/Adr/.test(r)&&cc.sys.browserType===cc.BROWSER_TYPE_UC)&&(this._minus=-1),n=this.didAccelerate.bind(this),t.addEventListener(e,n,!1)},s._unregisterAccelerometerEvent=function(){var t=window,e=this._accelDeviceEvent===t.DeviceMotionEvent?"devicemotion":"deviceorientation";n&&t.removeEventListener(e,n,!1)},s.didAccelerate=function(t){var e=window;if(this._accelEnabled){var r,a,c,h=this._acceleration;if(this._accelDeviceEvent===window.DeviceMotionEvent){var u=t.accelerationIncludingGravity;r=this._accelMinus*u.x*.1,a=this._accelMinus*u.y*.1,c=.1*u.z}else r=t.gamma/90*.981,a=-t.beta/90*.981,c=t.alpha/90*.981;h.x=r,h.y=a,h.z=c,h.timestamp=t.timeStamp||Date.now();var d=h.x;e.orientation===cc.macro.WEB_ORIENTATION_LANDSCAPE_RIGHT?(h.x=-h.y,h.y=d):e.orientation===cc.macro.WEB_ORIENTATION_LANDSCAPE_LEFT?(h.x=h.y,h.y=-d):e.orientation===cc.macro.WEB_ORIENTATION_PORTRAIT_UPSIDE_DOWN&&(h.x=-h.x,h.y=-h.y),cc.sys.os===cc.sys.OS_ANDROID&&cc.sys.browserType!==cc.sys.BROWSER_TYPE_MOBILE_QQ&&(h.x=-h.x,h.y=-h.y)}}},{"../event-manager":95,"./CCInputManager":139,"./_CCClass":147}],139:[function(T,N,z){var o=T("../platform/js"),s=T("./CCMacro"),n=T("./CCSys"),t=T("../event-manager"),e=s.TOUCH_TIMEOUT,r={_mousePressed:!1,_isRegisterEvent:!1,_preTouchPoint:cc.p(0,0),_prevMousePoint:cc.p(0,0),_preTouchPool:[],_preTouchPoolPointer:0,_touches:[],_touchesIntegerDict:{},_indexBitsUsed:0,_maxTouches:5,_accelEnabled:!1,_accelInterval:1/30,_accelMinus:1,_accelCurTime:0,_acceleration:null,_accelDeviceEvent:null,_getUnUsedIndex:function(){for(var a=this._indexBitsUsed,c=cc.sys.now(),h=0;h<this._maxTouches;h++){if(!(1&a))return this._indexBitsUsed|=1<<h,h;var u=this._touches[h];if(c-u._lastModified>e)return this._removeUsedIndexBit(h),delete this._touchesIntegerDict[u.getID()],h;a>>=1}return-1},_removeUsedIndexBit:function(a){if(!(a<0||a>=this._maxTouches)){var c=1<<a;c=~c,this._indexBitsUsed&=c}},_glView:null,handleTouchesBegin:function(a){for(var c,h,u,d=[],f=this._touchesIntegerDict,m=n.now(),v=0,_=a.length;v<_;v++)if(c=a[v],u=c.getID(),f[u]==null){var p=this._getUnUsedIndex();if(p===-1){cc.logID(2300,p);continue}(h=this._touches[p]=new cc.Touch(c._point.x,c._point.y,c.getID()))._lastModified=m,h._setPrevPoint(c._prevPoint),f[u]=p,d.push(h)}if(d.length>0){this._glView._convertTouchesWithScale(d);var g=new cc.Event.EventTouch(d);g._eventCode=cc.Event.EventTouch.BEGAN,t.dispatchEvent(g)}},handleTouchesMove:function(a){for(var c,h,u,d=[],f=this._touches,m=n.now(),v=0,_=a.length;v<_;v++)u=(c=a[v]).getID(),(h=this._touchesIntegerDict[u])!=null&&f[h]&&(f[h]._setPoint(c._point),f[h]._setPrevPoint(c._prevPoint),f[h]._lastModified=m,d.push(f[h]));if(d.length>0){this._glView._convertTouchesWithScale(d);var p=new cc.Event.EventTouch(d);p._eventCode=cc.Event.EventTouch.MOVED,t.dispatchEvent(p)}},handleTouchesEnd:function(a){var c=this.getSetOfTouchesEndOrCancel(a);if(c.length>0){this._glView._convertTouchesWithScale(c);var h=new cc.Event.EventTouch(c);h._eventCode=cc.Event.EventTouch.ENDED,t.dispatchEvent(h)}},handleTouchesCancel:function(a){var c=this.getSetOfTouchesEndOrCancel(a);if(c.length>0){this._glView._convertTouchesWithScale(c);var h=new cc.Event.EventTouch(c);h._eventCode=cc.Event.EventTouch.CANCELLED,t.dispatchEvent(h)}},getSetOfTouchesEndOrCancel:function(a){for(var c,h,u,d=[],f=this._touches,m=this._touchesIntegerDict,v=0,_=a.length;v<_;v++)(h=m[u=(c=a[v]).getID()])!=null&&f[h]&&(f[h]._setPoint(c._point),f[h]._setPrevPoint(c._prevPoint),d.push(f[h]),this._removeUsedIndexBit(h),delete m[u]);return d},getHTMLElementPosition:function(a){if(n.platform===n.WECHAT_GAME)return{left:0,top:0,width:window.innerWidth,height:window.innerHeight};var c=document.documentElement,h=window.pageXOffset-c.clientLeft,u=window.pageYOffset-c.clientTop;if(typeof a.getBoundingClientRect=="function"){var d=a.getBoundingClientRect();return{left:d.left+h,top:d.top+u,width:d.width,height:d.height}}return a instanceof HTMLCanvasElement?{left:h,top:u,width:a.width,height:a.height}:{left:h,top:u,width:parseInt(a.style.width),height:parseInt(a.style.height)}},getPreTouch:function(a){for(var c=null,h=this._preTouchPool,u=a.getID(),d=h.length-1;d>=0;d--)if(h[d].getID()===u){c=h[d];break}return c||(c=a),c},setPreTouch:function(a){for(var c=!1,h=this._preTouchPool,u=a.getID(),d=h.length-1;d>=0;d--)if(h[d].getID()===u){h[d]=a,c=!0;break}c||(h.length<=50?h.push(a):(h[this._preTouchPoolPointer]=a,this._preTouchPoolPointer=(this._preTouchPoolPointer+1)%50))},getTouchByXY:function(a,c,h){var u=this._preTouchPoint,d=this._glView.convertToLocationInView(a,c,h),f=new cc.Touch(d.x,d.y);return f._setPrevPoint(u.x,u.y),u.x=d.x,u.y=d.y,f},getMouseEvent:function(a,c,h){var u=this._prevMousePoint,d=new cc.Event.EventMouse(h);return d._setPrevCursor(u.x,u.y),u.x=a.x,u.y=a.y,this._glView._convertMouseToLocationInView(u,c),d.setLocation(u.x,u.y),d},getPointByEvent:function(a,c){return a.pageX!=null?{x:a.pageX,y:a.pageY}:(n.platform===n.WECHAT_GAME?(c.left=0,c.top=0):(c.left-=document.body.scrollLeft,c.top-=document.body.scrollTop),{x:a.clientX,y:a.clientY})},getTouchesByEvent:function(a,c){for(var h,u,d,f=[],m=this._glView,v=this._preTouchPoint,_=a.changedTouches.length,p=0;p<_;p++)if(h=a.changedTouches[p]){var g;g=n.BROWSER_TYPE_FIREFOX===n.browserType?m.convertToLocationInView(h.pageX,h.pageY,c):m.convertToLocationInView(h.clientX,h.clientY,c),h.identifier!=null?(u=new cc.Touch(g.x,g.y,h.identifier),d=this.getPreTouch(u).getLocation(),u._setPrevPoint(d.x,d.y),this.setPreTouch(u)):(u=new cc.Touch(g.x,g.y))._setPrevPoint(v.x,v.y),v.x=g.x,v.y=g.y,f.push(u)}return f},registerSystemEvent:function(a){if(!this._isRegisterEvent){this._glView=cc.view;var c=this,h=n.isMobile,u="mouse"in n.capabilities,d="touches"in n.capabilities;if(n.platform===n.WECHAT_GAME&&(h=!1,d=!0,u=!1),u){h||(window.addEventListener("mousedown",function(){c._mousePressed=!0},!1),window.addEventListener("mouseup",function(b){if(c._mousePressed){c._mousePressed=!1;var A=c.getHTMLElementPosition(a),E=c.getPointByEvent(b,A);if(!cc.rectContainsPoint(new cc.Rect(A.left,A.top,A.width,A.height),E)){c.handleTouchesEnd([c.getTouchByXY(E.x,E.y,A)]);var R=c.getMouseEvent(E,A,cc.Event.EventMouse.UP);R.setButton(b.button),t.dispatchEvent(R)}}},!1));for(var f=cc.Event.EventMouse,m=[!h&&["mousedown",f.DOWN,function(b,A,E,R){c._mousePressed=!0,c.handleTouchesBegin([c.getTouchByXY(E.x,E.y,R)]),a.focus()}],!h&&["mouseup",f.UP,function(b,A,E,R){c._mousePressed=!1,c.handleTouchesEnd([c.getTouchByXY(E.x,E.y,R)])}],!h&&["mousemove",f.MOVE,function(b,A,E,R){c.handleTouchesMove([c.getTouchByXY(E.x,E.y,R)]),c._mousePressed||A.setButton(null)}],["mousewheel",f.SCROLL,function(b,A){A.setScrollData(0,b.wheelDelta)}],["DOMMouseScroll",f.SCROLL,function(b,A){A.setScrollData(0,-120*b.detail)}]],v=0;v<m.length;++v){var _=m[v];_&&function(){var b=_[0],A=_[1],E=_[2];a.addEventListener(b,function(R){var O=c.getHTMLElementPosition(a),P=c.getPointByEvent(R,O),x=c.getMouseEvent(P,O,A);x.setButton(R.button),E(R,x,P,O),t.dispatchEvent(x),R.stopPropagation(),R.preventDefault()},!1)}()}}if(window.navigator.msPointerEnabled){var p={MSPointerDown:c.handleTouchesBegin,MSPointerMove:c.handleTouchesMove,MSPointerUp:c.handleTouchesEnd,MSPointerCancel:c.handleTouchesCancel},g=function(b){var A=p[b];a.addEventListener(b,function(E){var R=c.getHTMLElementPosition(a);R.left-=document.documentElement.scrollLeft,R.top-=document.documentElement.scrollTop,A.call(c,[c.getTouchByXY(E.clientX,E.clientY,R)]),E.stopPropagation()},!1)};for(var y in p)g(y)}if(d){var C,S={touchstart:function(b){c.handleTouchesBegin(b),n.platform!==n.WECHAT_GAME&&a.focus()},touchmove:function(b){c.handleTouchesMove(b)},touchend:function(b){c.handleTouchesEnd(b)},touchcancel:function(b){c.handleTouchesCancel(b)}};cc.sys.browserType===cc.sys.BROWSER_TYPE_WECHAT_GAME_SUB?(S={onTouchStart:S.touchstart,onTouchMove:S.touchmove,onTouchEnd:S.touchend,onTouchCancel:S.touchcancel},C=function(b){var A=S[b];wx[b](function(E){if(E.changedTouches){var R=c.getHTMLElementPosition(a),O=document.body;R.left-=O.scrollLeft||0,R.top-=O.scrollTop||0,A(c.getTouchesByEvent(E,R))}})}):C=function(b){var A=S[b];a.addEventListener(b,function(E){if(!cc.sys.skipTouch&&E.changedTouches){var R=c.getHTMLElementPosition(a),O=document.body;R.left-=O.scrollLeft||0,R.top-=O.scrollTop||0,A(c.getTouchesByEvent(E,R)),E.stopPropagation(),E.preventDefault()}},!1)};for(var I in S)C(I)}cc.sys.browserType!==cc.sys.BROWSER_TYPE_WECHAT_GAME_SUB&&(this._registerKeyboardEvent(),this._registerAccelerometerEvent()),this._isRegisterEvent=!0}},_registerKeyboardEvent:function(){},_registerAccelerometerEvent:function(){},update:function(a){this._accelCurTime>this._accelInterval&&(this._accelCurTime-=this._accelInterval,t.dispatchEvent(new cc.Event.EventAcceleration(this._acceleration))),this._accelCurTime+=a}};o.get(cc,"inputManager",function(){return cc.warnID(1405,"cc.inputManager","cc.systemEvent"),r}),N.exports=_cc.inputManager=r},{"../event-manager":95,"../platform/js":156,"./CCMacro":140,"./CCSys":144}],140:[function(T,N,z){T("./_CCClass"),cc.KEY={none:0,back:6,menu:18,backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,pause:19,capslock:20,escape:27,space:32,pageup:33,pagedown:34,end:35,home:36,left:37,up:38,right:39,down:40,select:41,insert:45,Delete:46,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,num0:96,num1:97,num2:98,num3:99,num4:100,num5:101,num6:102,num7:103,num8:104,num9:105,"*":106,"+":107,"-":109,numdel:110,"/":111,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123,numlock:144,scrolllock:145,";":186,semicolon:186,equal:187,"=":187,",":188,comma:188,dash:189,".":190,period:190,forwardslash:191,grave:192,"[":219,openbracket:219,backslash:220,"]":221,closebracket:221,quote:222,dpadLeft:1e3,dpadRight:1001,dpadUp:1003,dpadDown:1004,dpadCenter:1005},cc.ImageFormat=cc.Enum({JPG:0,PNG:1,TIFF:2,WEBP:3,PVR:4,ETC:5,S3TC:6,ATITC:7,TGA:8,RAWDATA:9,UNKNOWN:10}),cc.getImageFormatByData=function(s){return s.length>8&&s[0]===137&&s[1]===80&&s[2]===78&&s[3]===71&&s[4]===13&&s[5]===10&&s[6]===26&&s[7]===10?cc.ImageFormat.PNG:s.length>2&&(s[0]===73&&s[1]===73||s[0]===77&&s[1]===77||s[0]===255&&s[1]===216)?cc.ImageFormat.TIFF:cc.ImageFormat.UNKNOWN},cc.macro={INVALID_INDEX:-1,NODE_TAG_INVALID:-1,PI:Math.PI,PI2:2*Math.PI,FLT_MAX:parseFloat("3.402823466e+38F"),FLT_MIN:parseFloat("1.175494351e-38F"),RAD:Math.PI/180,DEG:180/Math.PI,UINT_MAX:4294967295,REPEAT_FOREVER:Number.MAX_VALUE-1,FLT_EPSILON:1192092896e-16,ONE:1,ZERO:0,SRC_ALPHA:770,SRC_ALPHA_SATURATE:776,SRC_COLOR:768,DST_ALPHA:772,DST_COLOR:774,ONE_MINUS_SRC_ALPHA:771,ONE_MINUS_SRC_COLOR:769,ONE_MINUS_DST_ALPHA:773,ONE_MINUS_DST_COLOR:775,ONE_MINUS_CONSTANT_ALPHA:32772,ONE_MINUS_CONSTANT_COLOR:32770,LINEAR:9729,BLEND_DST:771,WEB_ORIENTATION_PORTRAIT:0,WEB_ORIENTATION_LANDSCAPE_LEFT:-90,WEB_ORIENTATION_PORTRAIT_UPSIDE_DOWN:180,WEB_ORIENTATION_LANDSCAPE_RIGHT:90,ORIENTATION_PORTRAIT:1,ORIENTATION_LANDSCAPE:2,ORIENTATION_AUTO:3,DENSITYDPI_DEVICE:"device-dpi",DENSITYDPI_HIGH:"high-dpi",DENSITYDPI_MEDIUM:"medium-dpi",DENSITYDPI_LOW:"low-dpi",VERTEX_ATTRIB_FLAG_NONE:0,VERTEX_ATTRIB_FLAG_POSITION:1,VERTEX_ATTRIB_FLAG_COLOR:2,VERTEX_ATTRIB_FLAG_TEX_COORDS:4,VERTEX_ATTRIB_FLAG_POS_COLOR_TEX:7,GL_ALL:0,VERTEX_ATTRIB_POSITION:0,VERTEX_ATTRIB_COLOR:1,VERTEX_ATTRIB_TEX_COORDS:2,VERTEX_ATTRIB_MAX:3,UNIFORM_PMATRIX:0,UNIFORM_MVMATRIX:1,UNIFORM_MVPMATRIX:2,UNIFORM_TIME:3,UNIFORM_SINTIME:4,UNIFORM_COSTIME:5,UNIFORM_RANDOM01:6,UNIFORM_SAMPLER:7,UNIFORM_MAX:8,SHADER_POSITION_TEXTURECOLOR:"ShaderPositionTextureColor",SHADER_SPRITE_POSITION_TEXTURECOLOR:"ShaderSpritePositionTextureColor",SHADER_POSITION_TEXTURECOLORALPHATEST:"ShaderPositionTextureColorAlphaTest",SHADER_SPRITE_POSITION_TEXTURECOLORALPHATEST:"ShaderSpritePositionTextureColorAlphaTest",SHADER_POSITION_COLOR:"ShaderPositionColor",SHADER_SPRITE_POSITION_COLOR:"ShaderSpritePositionColor",SHADER_POSITION_TEXTURE:"ShaderPositionTexture",SHADER_POSITION_TEXTURE_UCOLOR:"ShaderPositionTexture_uColor",SHADER_POSITION_TEXTUREA8COLOR:"ShaderPositionTextureA8Color",SHADER_POSITION_UCOLOR:"ShaderPosition_uColor",SHADER_POSITION_LENGTHTEXTURECOLOR:"ShaderPositionLengthTextureColor",UNIFORM_PMATRIX_S:"CC_PMatrix",UNIFORM_MVMATRIX_S:"CC_MVMatrix",UNIFORM_MVPMATRIX_S:"CC_MVPMatrix",UNIFORM_TIME_S:"CC_Time",UNIFORM_SINTIME_S:"CC_SinTime",UNIFORM_COSTIME_S:"CC_CosTime",UNIFORM_RANDOM01_S:"CC_Random01",UNIFORM_SAMPLER_S:"CC_Texture0",UNIFORM_ALPHA_TEST_VALUE_S:"CC_alpha_value",ATTRIBUTE_NAME_COLOR:"a_color",ATTRIBUTE_NAME_POSITION:"a_position",ATTRIBUTE_NAME_TEX_COORD:"a_texCoord",ITEM_SIZE:32,CURRENT_ITEM:3233828865,ZOOM_ACTION_TAG:3233828866,NORMAL_TAG:8801,SELECTED_TAG:8802,DISABLE_TAG:8803,FIX_ARTIFACTS_BY_STRECHING_TEXEL:0,FIX_ARTIFACTS_BY_STRECHING_TEXEL_TMX:1,DIRECTOR_STATS_POSITION:cc.p(0,0),DIRECTOR_FPS_INTERVAL:.5,COCOSNODE_RENDER_SUBPIXEL:1,SPRITEBATCHNODE_RENDER_SUBPIXEL:1,AUTO_PREMULTIPLIED_ALPHA_FOR_PNG:0,OPTIMIZE_BLEND_FUNC_FOR_PREMULTIPLIED_ALPHA:0,TEXTURE_NPOT_SUPPORT:0,USE_LA88_LABELS:1,SPRITE_DEBUG_DRAW:0,LABELBMFONT_DEBUG_DRAW:0,LABELATLAS_DEBUG_DRAW:0,ENABLE_STACKABLE_ACTIONS:1,ENABLE_GL_STATE_CACHE:1,TOUCH_TIMEOUT:5e3,BATCH_VERTEX_COUNT:2e4,ENABLE_GC_FOR_NATIVE_OBJECTS:!0,ENABLE_TILEDMAP_CULLING:!0,DOWNLOAD_MAX_CONCURRENT:64,ENABLE_TRANSPARENT_CANVAS:!1,ENABLE_WEBGL_ANTIALIAS:!1};var o=!0;cc.defineGetterSetter(cc.macro,"ENABLE_CULLING",function(){return o},function(s){o=s;var n=cc.director.getScene();n&&(n._sgNode._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.cullingDirty),cc.renderer.childrenOrderDirty=!0)}),cc.defineGetterSetter(cc.macro,"BLEND_SRC",function(){return cc._renderType===cc.game.RENDER_TYPE_WEBGL&&cc.macro.OPTIMIZE_BLEND_FUNC_FOR_PREMULTIPLIED_ALPHA?cc.macro.ONE:cc.macro.SRC_ALPHA}),cc.lerp=function(s,n,t){return s+(n-s)*t},cc.rand=function(){return 16777215*Math.random()},cc.randomMinus1To1=function(){return 2*(Math.random()-.5)},cc.random0To1=Math.random,cc.degreesToRadians=function(s){return s*cc.macro.RAD},cc.radiansToDegrees=function(s){return s*cc.macro.DEG},cc.nodeDrawSetup=function(s){s._shaderProgram&&(s._shaderProgram.use(),s._shaderProgram.setUniformForModelViewAndProjectionMatrixWithMat4())},cc.incrementGLDraws=function(s){cc.g_NumberOfDraws+=s},cc.checkGLErrorDebug=function(){if(cc._renderType===cc.game.RENDER_TYPE_WEBGL){var s=cc._renderContext.getError();s&&cc.logID(2400,s)}},N.exports=cc.macro},{"./_CCClass":147}],141:[function(T,N,z){function o(){this._name="",this._objFlags=0}function s(){for(var c=r.length,h=0;h<c;++h){var u=r[h];u._objFlags&e||u._destroyImmediate()}c===r.length?r.length=0:r.splice(0,c)}var n=T("./js"),t=T("./CCClass"),e=1;t.fastDefine("cc.Object",o,{_name:"",_objFlags:0}),n.value(o,"Flags",{Destroyed:e,DontSave:8,EditorOnly:16,Dirty:32,DontDestroy:64,PersistentMask:-4192741,Destroying:128,Deactivating:256,IsPreloadStarted:8192,IsOnLoadStarted:32768,IsOnLoadCalled:16384,IsOnEnableCalled:2048,IsStartCalled:65536,IsEditorOnEnableCalled:4096,IsPositionLocked:1<<21,IsRotationLocked:1<<17,IsScaleLocked:1<<18,IsAnchorLocked:1<<19,IsSizeLocked:1<<20});var r=[];n.value(o,"_deferredDestroy",s);var a=o.prototype;n.getset(a,"name",function(){return this._name},function(c){this._name=c}),n.get(a,"isValid",function(){return!(this._objFlags&e)}),a.destroy=function(){return this._objFlags&e?(cc.warnID(5e3),!1):!(4&this._objFlags)&&(this._objFlags|=4,r.push(this),!0)},a._destruct=function(){var c=this.constructor,h=c.__destruct__;h||(h=function(u,d){var f,m={};for(f in u)if(u.hasOwnProperty(f))switch(typeof u[f]){case"string":m[f]="";break;case"object":case"function":m[f]=null}if(cc.Class._isCCClass(d))for(var v=cc.Class.Attr.getClassAttrs(d),_=d.__props__,p=0;p<_.length;p++){var g=(f=_[p])+cc.Class.Attr.DELIMETER+"default";if(g in v)switch(typeof v[g]){case"string":m[f]="";break;case"object":case"function":m[f]=null;break;case"undefined":m[f]=void 0}}var y=u instanceof cc._BaseNode||u instanceof cc.Component,C="";for(f in m)if(!y||f!=="_id"){var S;S=t.IDENTIFIER_RE.test(f)?"o."+f+"=":"o["+t.escapeForJS(f)+"]=";var I=m[f];I===""&&(I='""'),C+=S+I+`;
`}return Function("o",C)}(this,c),n.value(c,"__destruct__",h,!0)),h(this)},a._onPreDestroy=null,a._destroyImmediate=function(){this._objFlags&e?cc.errorID(5e3):(this._onPreDestroy&&this._onPreDestroy(),this._destruct(),this._objFlags|=e)},a._deserialize=null,cc.isValid=function(c,h){return typeof c=="object"?!(!c||c._objFlags&(h?4|e:e)):c!==void 0},cc.Object=N.exports=o},{"./CCClass":135,"./js":156}],142:[function(T,N,z){cc.SAXParser=cc._Class.extend({ctor:function(){window.DOMParser?(this._isSupportDOMParser=!0,this._parser=new DOMParser):(this._isSupportDOMParser=!1,this._parser=null)},parse:function(o){return this._parseXML(o)},_parseXML:function(o){var s;return this._isSupportDOMParser?s=this._parser.parseFromString(o,"text/xml"):((s=new ActiveXObject("Microsoft.XMLDOM")).async="false",s.loadXML(o)),s}}),cc.PlistParser=cc.SAXParser.extend({parse:function(o){var s=this._parseXML(o),n=s.documentElement;if(n.tagName!=="plist")return cc.warnID(5100),{};for(var t=null,e=0,r=n.childNodes.length;e<r&&(t=n.childNodes[e]).nodeType!==1;e++);return s=null,this._parseNode(t)},_parseNode:function(o){var s=null,n=o.tagName;if(n==="dict")s=this._parseDict(o);else if(n==="array")s=this._parseArray(o);else if(n==="string")if(o.childNodes.length===1)s=o.firstChild.nodeValue;else{s="";for(var t=0;t<o.childNodes.length;t++)s+=o.childNodes[t].nodeValue}else n==="false"?s=!1:n==="true"?s=!0:n==="real"?s=parseFloat(o.firstChild.nodeValue):n==="integer"&&(s=parseInt(o.firstChild.nodeValue,10));return s},_parseArray:function(o){for(var s=[],n=0,t=o.childNodes.length;n<t;n++){var e=o.childNodes[n];e.nodeType===1&&s.push(this._parseNode(e))}return s},_parseDict:function(o){for(var s={},n=null,t=0,e=o.childNodes.length;t<e;t++){var r=o.childNodes[t];r.nodeType===1&&(r.tagName==="key"?n=r.firstChild.nodeValue:s[n]=this._parseNode(r))}return s}}),cc.saxParser=new cc.SAXParser,cc.plistParser=new cc.PlistParser},{}],143:[function(T,N,z){cc.screen={_supportsFullScreen:!1,_preOnFullScreenChange:null,_touchEvent:"",_fn:null,_fnMap:[["requestFullscreen","exitFullscreen","fullscreenchange","fullscreenEnabled","fullscreenElement"],["requestFullScreen","exitFullScreen","fullScreenchange","fullScreenEnabled","fullScreenElement"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitfullscreenchange","webkitIsFullScreen","webkitCurrentFullScreenElement"],["mozRequestFullScreen","mozCancelFullScreen","mozfullscreenchange","mozFullScreen","mozFullScreenElement"],["msRequestFullscreen","msExitFullscreen","MSFullscreenChange","msFullscreenEnabled","msFullscreenElement"]],init:function(){this._fn={};var o,s,n,t,e=this._fnMap;for(o=0,s=e.length;o<s;o++)if((n=e[o])&&document[n[1]]!==void 0){for(o=0,t=n.length;o<t;o++)this._fn[e[0][o]]=n[o];break}this._supportsFullScreen=this._fn.requestFullscreen!==void 0,this._touchEvent="ontouchstart"in window?"touchstart":"mousedown"},fullScreen:function(){return!!this._supportsFullScreen&&document[this._fn.fullscreenElement]!==void 0&&document[this._fn.fullscreenElement]!==null},requestFullScreen:function(o,s){if(this._supportsFullScreen){if(o=o||document.documentElement,s){var n=this._fn.fullscreenchange;this._preOnFullScreenChange&&document.removeEventListener(n,this._preOnFullScreenChange),this._preOnFullScreenChange=s,document.addEventListener(n,s,!1)}return o[this._fn.requestFullscreen]()}},exitFullScreen:function(){return!this._supportsFullScreen||document[this._fn.exitFullscreen]()},autoFullScreen:function(o,s){function n(){t.removeEventListener(e._touchEvent,n),e.requestFullScreen(o,s)}o=o||document.body;var t=cc.game.canvas||o,e=this;this.requestFullScreen(o,s),t.addEventListener(this._touchEvent,n)}},cc.screen.init()},{}],144:[function(T,N,z){if(!cc.sys){cc.sys={};var o=cc.sys;o.skipTouch=!1,o.skipRender=!1,o.LANGUAGE_ENGLISH="en",o.LANGUAGE_CHINESE="zh",o.LANGUAGE_FRENCH="fr",o.LANGUAGE_ITALIAN="it",o.LANGUAGE_GERMAN="de",o.LANGUAGE_SPANISH="es",o.LANGUAGE_DUTCH="du",o.LANGUAGE_RUSSIAN="ru",o.LANGUAGE_KOREAN="ko",o.LANGUAGE_JAPANESE="ja",o.LANGUAGE_HUNGARIAN="hu",o.LANGUAGE_PORTUGUESE="pt",o.LANGUAGE_ARABIC="ar",o.LANGUAGE_NORWEGIAN="no",o.LANGUAGE_POLISH="pl",o.LANGUAGE_TURKISH="tr",o.LANGUAGE_UKRAINIAN="uk",o.LANGUAGE_ROMANIAN="ro",o.LANGUAGE_BULGARIAN="bg",o.LANGUAGE_UNKNOWN="unknown",o.OS_IOS="iOS",o.OS_ANDROID="Android",o.OS_WINDOWS="Windows",o.OS_MARMALADE="Marmalade",o.OS_LINUX="Linux",o.OS_BADA="Bada",o.OS_BLACKBERRY="Blackberry",o.OS_OSX="OS X",o.OS_WP8="WP8",o.OS_WINRT="WINRT",o.OS_UNKNOWN="Unknown",o.UNKNOWN=-1,o.WIN32=0,o.LINUX=1,o.MACOS=2,o.ANDROID=3,o.IPHONE=4,o.IPAD=5,o.BLACKBERRY=6,o.NACL=7,o.EMSCRIPTEN=8,o.TIZEN=9,o.WINRT=10,o.WP8=11,o.MOBILE_BROWSER=100,o.DESKTOP_BROWSER=101,o.EDITOR_PAGE=102,o.EDITOR_CORE=103,o.WECHAT_GAME=104,o.QQ_PLAY=105,o.BROWSER_TYPE_WECHAT="wechat",o.BROWSER_TYPE_WECHAT_GAME="wechatgame",o.BROWSER_TYPE_WECHAT_GAME_SUB="wechatgamesub",o.BROWSER_TYPE_QQ_PLAY="qqplay",o.BROWSER_TYPE_ANDROID="androidbrowser",o.BROWSER_TYPE_IE="ie",o.BROWSER_TYPE_QQ="qqbrowser",o.BROWSER_TYPE_MOBILE_QQ="mqqbrowser",o.BROWSER_TYPE_UC="ucbrowser",o.BROWSER_TYPE_360="360browser",o.BROWSER_TYPE_BAIDU_APP="baiduboxapp",o.BROWSER_TYPE_BAIDU="baidubrowser",o.BROWSER_TYPE_MAXTHON="maxthon",o.BROWSER_TYPE_OPERA="opera",o.BROWSER_TYPE_OUPENG="oupeng",o.BROWSER_TYPE_MIUI="miuibrowser",o.BROWSER_TYPE_FIREFOX="firefox",o.BROWSER_TYPE_SAFARI="safari",o.BROWSER_TYPE_CHROME="chrome",o.BROWSER_TYPE_LIEBAO="liebao",o.BROWSER_TYPE_QZONE="qzone",o.BROWSER_TYPE_SOUGOU="sogou",o.BROWSER_TYPE_UNKNOWN="unknown",o.isNative=!1,o.isBrowser=typeof window=="object"&&typeof document=="object"&&!0,cc.create3DContext=function(x,w,L){if(!L)return cc.create3DContext(x,w,"webgl")||cc.create3DContext(x,w,"experimental-webgl")||cc.create3DContext(x,w,"webkit-3d")||cc.create3DContext(x,w,"moz-webgl")||null;try{return x.getContext(L,w)}catch(D){return null}};var s=window,n=s.navigator,t=document,e=t.documentElement,r=n.userAgent.toLowerCase();o.isMobile=/mobile|android|iphone|ipad/.test(r),o.platform=o.isMobile?o.MOBILE_BROWSER:o.DESKTOP_BROWSER;var a=n.language;a=(a=a||n.browserLanguage)?a.split("-")[0]:o.LANGUAGE_ENGLISH,o.language=a;var c=!1,h=!1,u="",d=0,f=/android (\d+(?:\.\d+)+)/i.exec(r)||/android (\d+(?:\.\d+)+)/i.exec(n.platform);f&&(c=!0,u=f[1]||"",d=parseInt(u)||0),(f=/(iPad|iPhone|iPod).*OS ((\d+_?){2,3})/i.exec(r))?(h=!0,u=f[2]||"",d=parseInt(u)||0):/(iPhone|iPad|iPod)/.exec(n.platform)&&(h=!0,u="",d=0);var m=o.OS_UNKNOWN;n.appVersion.indexOf("Win")!==-1?m=o.OS_WINDOWS:h?m=o.OS_IOS:n.appVersion.indexOf("Mac")!==-1?m=o.OS_OSX:n.appVersion.indexOf("X11")!==-1&&n.appVersion.indexOf("Linux")===-1?m=o.OS_UNIX:c?m=o.OS_ANDROID:n.appVersion.indexOf("Linux")===-1&&r.indexOf("ubuntu")===-1||(m=o.OS_LINUX),o.os=m,o.osVersion=u,o.osMainVersion=d,o.browserType=o.BROWSER_TYPE_UNKNOWN,function(){var x=/mqqbrowser|micromessenger|qq|sogou|qzone|liebao|maxthon|ucbrowser|360 aphone|360browser|baiduboxapp|baidubrowser|maxthon|mxbrowser|miuibrowser/i.exec(r);x||(x=/qqbrowser|chrome|safari|firefox|trident|opera|opr\/|oupeng/i.exec(r));var w=x?x[0].toLowerCase():o.BROWSER_TYPE_UNKNOWN;w==="micromessenger"?w=o.BROWSER_TYPE_WECHAT:w==="safari"&&c||w==="qq"&&r.match(/android.*applewebkit/i)?w=o.BROWSER_TYPE_ANDROID:w==="trident"?w=o.BROWSER_TYPE_IE:w==="360 aphone"?w=o.BROWSER_TYPE_360:w==="mxbrowser"?w=o.BROWSER_TYPE_MAXTHON:w==="opr/"&&(w=o.BROWSER_TYPE_OPERA),o.browserType=w}(),o.browserVersion="",function(){var x=r.match(/(mqqbrowser|micromessenger|qq|sogou|qzone|liebao|maxthon|uc|360 aphone|360|baiduboxapp|baidu|maxthon|mxbrowser|miui)(mobile)?(browser)?\/?([\d.]+)/i);x||(x=r.match(/(qqbrowser|chrome|safari|firefox|trident|opera|opr\/|oupeng)(mobile)?(browser)?\/?([\d.]+)/i)),o.browserVersion=x?x[4]:""}();var v=window.innerWidth||document.documentElement.clientWidth,_=window.innerHeight||document.documentElement.clientHeight,p=window.devicePixelRatio||1;o.windowPixelResolution={width:p*v,height:p*_},o._checkWebGLRenderMode=function(){if(cc._renderType!==cc.game.RENDER_TYPE_WEBGL)throw new Error("This feature supports WebGL render mode only.")};var g=document.createElement("canvas"),y=document.createElement("canvas");if(o._supportCanvasNewBlendModes=function(){var x=g;x.width=1,x.height=1;var w=x.getContext("2d");w.fillStyle="#000",w.fillRect(0,0,1,1),w.globalCompositeOperation="multiply";var L=y;L.width=1,L.height=1;var D=L.getContext("2d");return D.fillStyle="#fff",D.fillRect(0,0,1,1),w.drawImage(L,0,0,1,1),w.getImageData(0,0,1,1).data[0]===0}(),cc.sys.isMobile){var C=document.createElement("style");C.type="text/css",document.body.appendChild(C),C.textContent="body,canvas,div{ -moz-user-select: none;-webkit-user-select: none;-ms-user-select: none;-khtml-user-select: none;-webkit-tap-highlight-color:rgba(0,0,0,0);}"}try{var S=o.localStorage=s.localStorage;S.setItem("storage",""),S.removeItem("storage"),S=null}catch(x){var I=function(){cc.warnID(5200)};o.localStorage={getItem:I,setItem:I,removeItem:I,clear:I}}var b=g.toDataURL("image/webp").startsWith("data:image/webp"),A=!!g.getContext("2d"),E=!1;if(s.WebGLRenderingContext&&(cc.create3DContext(document.createElement("CANVAS"))&&(E=!0),E&&o.os===o.OS_ANDROID)){var R=parseFloat(o.browserVersion);switch(o.browserType){case o.BROWSER_TYPE_MOBILE_QQ:case o.BROWSER_TYPE_BAIDU:case o.BROWSER_TYPE_BAIDU_APP:E=R>=6.2;break;case o.BROWSER_TYPE_ANDROID:o.osMainVersion&&o.osMainVersion>=5&&(E=!0);break;case o.BROWSER_TYPE_CHROME:E=R>=30;break;case o.BROWSER_TYPE_UC:E=R>11;case o.BROWSER_TYPE_360:E=!1}}var O=o.capabilities={canvas:A,opengl:E,webp:b};(e.ontouchstart!==void 0||t.ontouchstart!==void 0||n.msPointerEnabled)&&(O.touches=!0),e.onmouseup!==void 0&&(O.mouse=!0),e.onkeyup!==void 0&&(O.keyboard=!0),(s.DeviceMotionEvent||s.DeviceOrientationEvent)&&(O.accelerometer=!0);var P;(function(){o.browserVersion;var x=!!(window.AudioContext||window.webkitAudioContext||window.mozAudioContext);P={ONLY_ONE:!1,WEB_AUDIO:x,DELAY_CREATE_CTX:!1},o.os===o.OS_IOS&&(P.USE_LOADER_EVENT="loadedmetadata"),o.browserType===o.BROWSER_TYPE_FIREFOX&&(P.DELAY_CREATE_CTX=!0,P.USE_LOADER_EVENT="canplay"),o.os===o.OS_ANDROID&&o.browserType===o.BROWSER_TYPE_UC&&(P.ONE_SOURCE=!0)})();try{P.WEB_AUDIO&&(P.context=new(window.AudioContext||window.webkitAudioContext||window.mozAudioContext),P.DELAY_CREATE_CTX&&setTimeout(function(){P.context=new(window.AudioContext||window.webkitAudioContext||window.mozAudioContext)},0))}catch(x){P.WEB_AUDIO=!1,cc.logID(5201)}P.format=function(){var x=[],w=document.createElement("audio");return w.canPlayType&&(w.canPlayType('audio/ogg; codecs="vorbis"')&&x.push(".ogg"),w.canPlayType("audio/mpeg")&&x.push(".mp3"),w.canPlayType('audio/wav; codecs="1"')&&x.push(".wav"),w.canPlayType("audio/mp4")&&x.push(".mp4"),w.canPlayType("audio/x-m4a")&&x.push(".m4a")),x}(),o.__audioSupport=P,o.garbageCollect=function(){},o.dumpRoot=function(){},o.restartVM=function(){},o.cleanScript=function(x){},o.isObjectValid=function(x){return!!x},o.dump=function(){var x="";x+="isMobile : "+this.isMobile+`\r
`,x+="language : "+this.language+`\r
`,x+="browserType : "+this.browserType+`\r
`,x+="browserVersion : "+this.browserVersion+`\r
`,x+="capabilities : "+JSON.stringify(this.capabilities)+`\r
`,x+="os : "+this.os+`\r
`,x+="osVersion : "+this.osVersion+`\r
`,x+="platform : "+this.platform+`\r
`,x+="Using "+(cc._renderType===cc.game.RENDER_TYPE_WEBGL?"WEBGL":"CANVAS")+` renderer.\r
`,cc.log(x)},o.openURL=function(x){window.open(x)},o.now=function(){return Date.now?Date.now():+new Date},N.exports=o}},{}],145:[function(T,N,z){var o=T("../event-manager"),s={init:function(){this.html=document.getElementsByTagName("html")[0]},availWidth:function(r){return r&&r!==this.html?r.clientWidth:window.innerWidth},availHeight:function(r){return r&&r!==this.html?r.clientHeight:window.innerHeight},meta:{width:"device-width"},adaptationType:cc.sys.browserType};switch(cc.sys.os===cc.sys.OS_IOS&&(s.adaptationType=cc.sys.BROWSER_TYPE_SAFARI),s.adaptationType){case cc.sys.BROWSER_TYPE_SAFARI:s.meta["minimal-ui"]="true",s.availWidth=function(r){return r.clientWidth},s.availHeight=function(r){return r.clientHeight};break;case cc.sys.BROWSER_TYPE_CHROME:s.__defineGetter__("target-densitydpi",function(){return cc.view._targetDensityDPI});break;case cc.sys.BROWSER_TYPE_SOUGOU:case cc.sys.BROWSER_TYPE_UC:s.availWidth=function(r){return r.clientWidth},s.availHeight=function(r){return r.clientHeight};break;case cc.sys.BROWSER_TYPE_MIUI:s.init=function(r){if(!r.__resizeWithBrowserSize){var a=function(){r.setDesignResolutionSize(r._designResolutionSize.width,r._designResolutionSize.height,r._resolutionPolicy),window.removeEventListener("resize",a,!1)};window.addEventListener("resize",a,!1)}};break;case cc.sys.BROWSER_TYPE_WECHAT_GAME:s.availWidth=function(){return window.innerWidth},s.availHeight=function(){return window.innerHeight};break;case cc.sys.BROWSER_TYPE_WECHAT_GAME_SUB:var n=wx.getSharedCanvas();s.availWidth=function(){return n.width},s.availHeight=function(){return n.height}}var t=null,e=cc._Class.extend({ctor:function(){var r=cc.ContainerStrategy,a=cc.ContentStrategy;s.init(this),this._frameSize=cc.size(0,0),this._initFrameSize();var c=cc.game.canvas.width,h=cc.game.canvas.height;this._designResolutionSize=cc.size(c,h),this._originalDesignResolutionSize=cc.size(c,h),this._viewPortRect=cc.rect(0,0,c,h),this._visibleRect=cc.rect(0,0,c,h),this._contentTranslateLeftTop={left:0,top:0},this._autoFullScreen=!1,this._devicePixelRatio=1,this._viewName="Cocos2dHTML5",this._resizeCallback=null,this._orientationChanging=!0,this._resizing=!1,this._scaleX=1,this._originalScaleX=1,this._scaleY=1,this._originalScaleY=1,this._isRotated=!1,this._orientation=3;var u=cc.sys;this.enableRetina(u.os===u.OS_IOS||u.os===u.OS_OSX),cc.visibleRect&&cc.visibleRect.init(this._visibleRect),this._resolutionPolicy=null,this._rpExactFit=new cc.ResolutionPolicy(r.EQUAL_TO_FRAME,a.EXACT_FIT),this._rpShowAll=new cc.ResolutionPolicy(r.PROPORTION_TO_FRAME,a.SHOW_ALL),this._rpNoBorder=new cc.ResolutionPolicy(r.EQUAL_TO_FRAME,a.NO_BORDER),this._rpFixedHeight=new cc.ResolutionPolicy(r.EQUAL_TO_FRAME,a.FIXED_HEIGHT),this._rpFixedWidth=new cc.ResolutionPolicy(r.EQUAL_TO_FRAME,a.FIXED_WIDTH),this._initialized=!1,this._contentTranslateLeftTop=null,this._frameZoomFactor=1,this.__resizeWithBrowserSize=!1,this._isAdjustViewPort=!0,this._targetDensityDPI=cc.macro.DENSITYDPI_HIGH,this.enableAntiAlias(!0)},_resizeEvent:function(){var r,a=(r=this.setDesignResolutionSize?this:cc.view)._frameSize.width,c=r._frameSize.height,h=r._isRotated;if(cc.sys.isMobile){var u=cc.game.container.style,d=u.margin;u.margin="0",u.display="none",r._initFrameSize(),u.margin=d,u.display="block",window.CMPlayScreen&&(u.display="")}else r._initFrameSize();if(r._isRotated!==h||r._frameSize.width!==a||r._frameSize.height!==c){var f=r._originalDesignResolutionSize.width,m=r._originalDesignResolutionSize.height;r._resizing=!0,f>0&&r.setDesignResolutionSize(f,m,r._resolutionPolicy),r._resizing=!1,o.dispatchCustomEvent("canvas-resize"),r._resizeCallback&&r._resizeCallback.call()}},_orientationChange:function(){cc.view._orientationChanging=!0,cc.view._resizeEvent()},setTargetDensityDPI:function(r){this._targetDensityDPI=r,this._adjustViewportMeta()},getTargetDensityDPI:function(){return this._targetDensityDPI},resizeWithBrowserSize:function(r){r?this.__resizeWithBrowserSize||(this.__resizeWithBrowserSize=!0,window.addEventListener("resize",this._resizeEvent),window.addEventListener("orientationchange",this._orientationChange)):this.__resizeWithBrowserSize&&(this.__resizeWithBrowserSize=!1,window.removeEventListener("resize",this._resizeEvent),window.removeEventListener("orientationchange",this._orientationChange))},setResizeCallback:function(r){typeof r!="function"&&r!=null||(this._resizeCallback=r)},setOrientation:function(r){if((r&=cc.macro.ORIENTATION_AUTO)&&this._orientation!==r){this._orientation=r;var a=this._originalDesignResolutionSize.width,c=this._originalDesignResolutionSize.height;this.setDesignResolutionSize(a,c,this._resolutionPolicy)}},_initFrameSize:function(){var r=this._frameSize,a=s.availWidth(cc.game.frame),c=s.availHeight(cc.game.frame),h=a>=c;!cc.sys.isMobile||h&&this._orientation&cc.macro.ORIENTATION_LANDSCAPE||!h&&this._orientation&cc.macro.ORIENTATION_PORTRAIT?(r.width=a,r.height=c,window.CMPlayScreen&&(window.CMPlayScreen.resize(a,c),r.width=window.CMPlayScreen.canvasWidth,r.height=window.CMPlayScreen.canvasHeight),cc.container.style["-webkit-transform"]="rotate(0deg)",cc.container.style.transform="rotate(0deg)",this._isRotated=!1):(r.width=c,r.height=a,cc.container.style["-webkit-transform"]="rotate(90deg)",cc.container.style.transform="rotate(90deg)",cc.container.style["-webkit-transform-origin"]="0px 0px 0px",cc.container.style.transformOrigin="0px 0px 0px",this._isRotated=!0),this._orientationChanging&&setTimeout(function(){cc.view._orientationChanging=!1},1e3)},_adjustSizeKeepCanvasSize:function(){var r=this._originalDesignResolutionSize.width,a=this._originalDesignResolutionSize.height;r>0&&this.setDesignResolutionSize(r,a,this._resolutionPolicy)},_setViewportMeta:function(r,a){var c=document.getElementById("cocosMetaElement");c&&a&&document.head.removeChild(c);var h,u,d,f=document.getElementsByName("viewport"),m=f?f[0]:null;h=m?m.content:"",(c=c||document.createElement("meta")).id="cocosMetaElement",c.name="viewport",c.content="";for(u in r)h.indexOf(u)==-1?h+=","+u+"="+r[u]:a&&(d=new RegExp(u+"s*=s*[^,]+"),h.replace(d,u+"="+r[u]));/^,/.test(h)&&(h=h.substr(1)),c.content=h,m&&(m.content=h),document.head.appendChild(c)},_adjustViewportMeta:function(){this._isAdjustViewPort&&(this._setViewportMeta(s.meta,!1),this._isAdjustViewPort=!1)},_resetScale:function(){this._scaleX=this._originalScaleX,this._scaleY=this._originalScaleY},_adjustSizeToBrowser:function(){},initialize:function(){this._initialized=!0},adjustViewPort:function(r){this._isAdjustViewPort=r},enableRetina:function(r){this._retinaEnabled=!!r},isRetinaEnabled:function(){return this._retinaEnabled},enableAntiAlias:function(r){if(this._antiAliasEnabled!==r){if(this._antiAliasEnabled=r,cc._renderType===cc.game.RENDER_TYPE_WEBGL){var a=cc.loader._cache;for(var c in a){var h=a[c],u=h&&h.content instanceof cc.Texture2D?h.content:null;u&&(r?u.setAntiAliasTexParameters():u.setAliasTexParameters())}}else if(cc._renderType===cc.game.RENDER_TYPE_CANVAS){var d=cc._canvas.getContext("2d");d.imageSmoothingEnabled=r,d.mozImageSmoothingEnabled=r;var f=cc.rendererCanvas._dirtyRegion;if(f){var m=new cc.Region;m.setTo(0,0,cc.visibleRect.width,cc.visibleRect.height),f.addRegion(m)}}}},isAntiAliasEnabled:function(){return this._antiAliasEnabled},enableAutoFullScreen:function(r){r&&r!==this._autoFullScreen&&cc.sys.isMobile&&cc.sys.browserType!==cc.sys.BROWSER_TYPE_WECHAT?(this._autoFullScreen=!0,cc.screen.autoFullScreen(cc.game.frame)):this._autoFullScreen=!1},isAutoFullScreenEnabled:function(){return this._autoFullScreen},isViewReady:function(){return cc.game.canvas&&cc._renderContext},setFrameZoomFactor:function(r){this._frameZoomFactor=r,cc.director.setProjection(cc.director.getProjection())},setContentTranslateLeftTop:function(r,a){this._contentTranslateLeftTop={left:r,top:a}},getContentTranslateLeftTop:function(){return this._contentTranslateLeftTop},setCanvasSize:function(r,a){var c=cc.game.canvas,h=cc.game.container;if(window.CMPlayScreen)return r=window.CMPlayScreen.canvasWidth,a=window.CMPlayScreen.canvasHeight,c.width=r*this._devicePixelRatio,c.height=a*this._devicePixelRatio,c.style.width=r+"px",c.style.height=a+"px",h.style.width=window.CMPlayScreen.containerWidth+"px",h.style.height=window.CMPlayScreen.containerHeight+"px",void this._resizeEvent();c.width=r*this._devicePixelRatio,c.height=a*this._devicePixelRatio,c.style.width=r+"px",c.style.height=a+"px",h.style.width=r+"px",h.style.height=a+"px",this._resizeEvent()},getCanvasSize:function(){return cc.size(cc.game.canvas.width,cc.game.canvas.height)},getFrameSize:function(){return cc.size(this._frameSize.width,this._frameSize.height)},setFrameSize:function(r,a){this._frameSize.width=r,this._frameSize.height=a,cc.game.frame.style.width=r+"px",cc.game.frame.style.height=a+"px",this._resizeEvent(),cc.director.setProjection(cc.director.getProjection())},getVisibleSize:function(){return cc.size(this._visibleRect.width,this._visibleRect.height)},getVisibleSizeInPixel:function(){return cc.size(this._visibleRect.width*this._scaleX,this._visibleRect.height*this._scaleY)},getVisibleOrigin:function(){return cc.p(this._visibleRect.x,this._visibleRect.y)},getVisibleOriginInPixel:function(){return cc.p(this._visibleRect.x*this._scaleX,this._visibleRect.y*this._scaleY)},canSetContentScaleFactor:function(){return!0},getResolutionPolicy:function(){return this._resolutionPolicy},setResolutionPolicy:function(r){if(r instanceof cc.ResolutionPolicy)this._resolutionPolicy=r;else{var a=cc.ResolutionPolicy;r===a.EXACT_FIT&&(this._resolutionPolicy=this._rpExactFit),r===a.SHOW_ALL&&(this._resolutionPolicy=this._rpShowAll),r===a.NO_BORDER&&(this._resolutionPolicy=this._rpNoBorder),r===a.FIXED_HEIGHT&&(this._resolutionPolicy=this._rpFixedHeight),r===a.FIXED_WIDTH&&(this._resolutionPolicy=this._rpFixedWidth)}},setDesignResolutionSize:function(r,a,c){if(r>0||a>0){this.setResolutionPolicy(c);var h=this._resolutionPolicy;if(h&&h.preApply(this),cc.sys.isMobile&&this._adjustViewportMeta(),this._orientationChanging=!0,this._resizing||this._initFrameSize(),h){this._originalDesignResolutionSize.width=this._designResolutionSize.width=r,this._originalDesignResolutionSize.height=this._designResolutionSize.height=a;var u=h.apply(this,this._designResolutionSize);if(u.scale&&u.scale.length===2&&(this._scaleX=u.scale[0],this._scaleY=u.scale[1]),u.viewport){var d=this._viewPortRect,f=this._visibleRect,m=u.viewport;d.x=m.x,d.y=m.y,d.width=m.width,d.height=m.height,f.x=-d.x/this._scaleX,f.y=-d.y/this._scaleY,f.width=cc.game.canvas.width/this._scaleX,f.height=cc.game.canvas.height/this._scaleY,cc._renderContext.setOffset&&cc._renderContext.setOffset(d.x,-d.y)}var v=cc.director;v._winSizeInPoints.width=this._designResolutionSize.width,v._winSizeInPoints.height=this._designResolutionSize.height,h.postApply(this),cc.winSize.width=v._winSizeInPoints.width,cc.winSize.height=v._winSizeInPoints.height,cc._renderType===cc.game.RENDER_TYPE_WEBGL?v.setGLDefaultValues():cc._renderType===cc.game.RENDER_TYPE_CANVAS&&(cc.renderer._allNeedDraw=!0),this._originalScaleX=this._scaleX,this._originalScaleY=this._scaleY,cc.visibleRect&&cc.visibleRect.init(this._visibleRect)}else cc.logID(2201)}else cc.logID(2200)},getDesignResolutionSize:function(){return cc.size(this._designResolutionSize.width,this._designResolutionSize.height)},setRealPixelResolution:function(r,a,c){this._setViewportMeta({width:r},!0),document.documentElement.style.width=r+"px",document.body.style.width=r+"px",document.body.style.left="0px",document.body.style.top="0px",this.setDesignResolutionSize(r,a,c)},setViewPortInPoints:function(r,a,c,h){var u=this._frameZoomFactor,d=this._scaleX,f=this._scaleY;cc._renderContext.viewport(r*d*u+this._viewPortRect.x*u,a*f*u+this._viewPortRect.y*u,c*d*u,h*f*u)},setScissorInPoints:function(r,a,c,h){var u=this._frameZoomFactor,d=this._scaleX,f=this._scaleY,m=Math.ceil(r*d*u+this._viewPortRect.x*u),v=Math.ceil(a*f*u+this._viewPortRect.y*u),_=Math.ceil(c*d*u),p=Math.ceil(h*f*u);if(!t){var g=gl.getParameter(gl.SCISSOR_BOX);t=cc.rect(g[0],g[1],g[2],g[3])}t.x===m&&t.y===v&&t.width===_&&t.height===p||(t.x=m,t.y=v,t.width=_,t.height=p,cc._renderContext.scissor(m,v,_,p))},isScissorEnabled:function(){return cc._renderContext.isEnabled(gl.SCISSOR_TEST)},getScissorRect:function(){if(!t){var r=gl.getParameter(gl.SCISSOR_BOX);t=cc.rect(r[0],r[1],r[2],r[3])}var a=1/this._scaleX,c=1/this._scaleY;return cc.rect((t.x-this._viewPortRect.x)*a,(t.y-this._viewPortRect.y)*c,t.width*a,t.height*c)},setViewName:function(r){r!=null&&r.length>0&&(this._viewName=r)},getViewName:function(){return this._viewName},getViewPortRect:function(){return this._viewPortRect},getScaleX:function(){return this._scaleX},getScaleY:function(){return this._scaleY},getDevicePixelRatio:function(){return this._devicePixelRatio},convertToLocationInView:function(r,a,c){var h=this._devicePixelRatio*(r-c.left),u=this._devicePixelRatio*(c.top+c.height-a);return this._isRotated?{x:this._viewPortRect.width-u,y:h}:{x:h,y:u}},_convertMouseToLocationInView:function(r,a){var c=this._viewPortRect;r.x=(this._devicePixelRatio*(r.x-a.left)-c.x)/this._scaleX,r.y=(this._devicePixelRatio*(a.top+a.height-r.y)-c.y)/this._scaleY},_convertPointWithScale:function(r){var a=this._viewPortRect;r.x=(r.x-a.x)/this._scaleX,r.y=(r.y-a.y)/this._scaleY},_convertTouchesWithScale:function(r){for(var a,c,h,u=this._viewPortRect,d=this._scaleX,f=this._scaleY,m=0;m<r.length;m++)c=(a=r[m])._point,h=a._prevPoint,c.x=(c.x-u.x)/d,c.y=(c.y-u.y)/f,h.x=(h.x-u.x)/d,h.y=(h.y-u.y)/f}});e._getInstance=function(){return this._instance||(this._instance=this._instance||new e,this._instance.initialize()),this._instance},cc.ContainerStrategy=cc._Class.extend({preApply:function(r){},apply:function(r,a){},postApply:function(r){},_setupContainer:function(r,a,c){var h=cc.game.canvas,u=cc.game.container;cc.sys.platform!==cc.sys.WECHAT_GAME&&(cc.sys.os===cc.sys.OS_ANDROID&&(document.body.style.width=(r._isRotated?c:a)+"px",document.body.style.height=(r._isRotated?a:c)+"px"),window.CMPlayScreen?(u.style.width=window.CMPlayScreen.containerWidth+"px",u.style.height=window.CMPlayScreen.containerHeight+"px",h.style.width=window.CMPlayScreen.canvasWidth+"px",h.style.height=window.CMPlayScreen.canvasHeight+"px"):(u.style.width=h.style.width=a+"px",u.style.height=h.style.height=c+"px"));var d=r._devicePixelRatio=1;if(r.isRetinaEnabled()&&(d=r._devicePixelRatio=Math.min(2,window.devicePixelRatio||1)),h.width=a*d,h.height=c*d,window.CMPlayScreen&&(h.width=window.CMPlayScreen.canvasWidth,h.height=window.CMPlayScreen.canvasHeight),cc.sys.browserType===cc.sys.BROWSER_TYPE_WECHAT_GAME&&wx&&wx.getOpenDataContext){var f=wx.getOpenDataContext().canvas;f&&(f.width=h.width,f.height=h.height)}cc._renderContext.resetCache&&cc._renderContext.resetCache()},_fixContainer:function(){document.body.insertBefore(cc.container,document.body.firstChild);var r=document.body.style;r.width=window.innerWidth+"px",r.height=window.innerHeight+"px",r.overflow="hidden";var a=cc.container.style;a.position="fixed",a.left=a.top="0px",document.body.scrollTop=0}}),cc.ContentStrategy=cc._Class.extend({_result:{scale:[1,1],viewport:null},_buildResult:function(r,a,c,h,u,d){Math.abs(r-c)<2&&(c=r),Math.abs(a-h)<2&&(h=a);var f=cc.rect(Math.round((r-c)/2),Math.round((a-h)/2),c,h);return cc._renderType,cc.game.RENDER_TYPE_CANVAS,this._result.scale=[u,d],this._result.viewport=f,this._result},preApply:function(r){},apply:function(r,a){return{scale:[1,1]}},postApply:function(r){}}),function(){var r=cc.ContainerStrategy.extend({apply:function(v){var _=v._frameSize.height,p=cc.container.style;window.CMPlayScreen&&(_=0),this._setupContainer(v,v._frameSize.width,v._frameSize.height),v._isRotated?p.margin="0 0 0 "+_+"px":p.margin="0px",p.padding="0px"}}),a=cc.ContainerStrategy.extend({apply:function(v,_){var p,g,y=v._frameSize.width,C=v._frameSize.height,S=cc.container.style,I=_.width,b=_.height,A=y/I,E=C/b;A<E?(p=y,g=b*A):(p=I*E,g=C);var R=Math.round((y-p)/2),O=Math.round((C-g)/2);p=y-2*R,g=C-2*O,this._setupContainer(v,p,g),v._isRotated?S.margin="0 0 0 "+C+"px":S.margin="0px",S.paddingLeft=R+"px",S.paddingRight=R+"px",S.paddingTop=O+"px",S.paddingBottom=O+"px"}}),c=(r.extend({preApply:function(v){this._super(v),cc.game.frame=document.documentElement},apply:function(v){this._super(v),this._fixContainer()}}),a.extend({preApply:function(v){this._super(v),cc.game.frame=document.documentElement},apply:function(v,_){this._super(v,_),this._fixContainer()}}),cc.ContainerStrategy.extend({apply:function(v){this._setupContainer(v,cc.game.canvas.width,cc.game.canvas.height)}}));cc.ContainerStrategy.EQUAL_TO_FRAME=new r,cc.ContainerStrategy.PROPORTION_TO_FRAME=new a,cc.ContainerStrategy.ORIGINAL_CONTAINER=new c;var h=cc.ContentStrategy.extend({apply:function(v,_){var p=cc.game.canvas.width,g=cc.game.canvas.height,y=p/_.width,C=g/_.height;return this._buildResult(p,g,p,g,y,C)}}),u=cc.ContentStrategy.extend({apply:function(v,_){var p,g,y=cc.game.canvas.width,C=cc.game.canvas.height,S=_.width,I=_.height,b=y/S,A=C/I,E=0;return b<A?(E=b,p=y,g=I*E):(E=A,p=S*E,g=C),this._buildResult(y,C,p,g,E,E)}}),d=cc.ContentStrategy.extend({apply:function(v,_){var p,g,y,C=cc.game.canvas.width,S=cc.game.canvas.height,I=_.width,b=_.height,A=C/I,E=S/b;return A<E?(p=E,g=I*p,y=S):(p=A,g=C,y=b*p),this._buildResult(C,S,g,y,p,p)}}),f=cc.ContentStrategy.extend({apply:function(v,_){var p=cc.game.canvas.width,g=cc.game.canvas.height,y=g/_.height,C=p,S=g;return this._buildResult(p,g,C,S,y,y)},postApply:function(v){cc.director._winSizeInPoints=v.getVisibleSize()}}),m=cc.ContentStrategy.extend({apply:function(v,_){var p=cc.game.canvas.width,g=cc.game.canvas.height,y=p/_.width,C=p,S=g;return this._buildResult(p,g,C,S,y,y)},postApply:function(v){cc.director._winSizeInPoints=v.getVisibleSize()}});cc.ContentStrategy.EXACT_FIT=new h,cc.ContentStrategy.SHOW_ALL=new u,cc.ContentStrategy.NO_BORDER=new d,cc.ContentStrategy.FIXED_HEIGHT=new f,cc.ContentStrategy.FIXED_WIDTH=new m}(),cc.ResolutionPolicy=cc._Class.extend({_containerStrategy:null,_contentStrategy:null,ctor:function(r,a){this.setContainerStrategy(r),this.setContentStrategy(a)},preApply:function(r){this._containerStrategy.preApply(r),this._contentStrategy.preApply(r)},apply:function(r,a){return this._containerStrategy.apply(r,a),this._contentStrategy.apply(r,a)},postApply:function(r){this._containerStrategy.postApply(r),this._contentStrategy.postApply(r)},setContainerStrategy:function(r){r instanceof cc.ContainerStrategy&&(this._containerStrategy=r)},setContentStrategy:function(r){r instanceof cc.ContentStrategy&&(this._contentStrategy=r)}}),cc.js.get(cc.ResolutionPolicy.prototype,"canvasSize",function(){return cc.v2(cc.game.canvas.width,cc.game.canvas.height)}),cc.ResolutionPolicy.EXACT_FIT=0,cc.ResolutionPolicy.NO_BORDER=1,cc.ResolutionPolicy.SHOW_ALL=2,cc.ResolutionPolicy.FIXED_HEIGHT=3,cc.ResolutionPolicy.FIXED_WIDTH=4,cc.ResolutionPolicy.UNKNOWN=5,N.exports=e},{"../event-manager":95}],146:[function(T,N,z){cc.visibleRect={topLeft:cc.p(0,0),topRight:cc.p(0,0),top:cc.p(0,0),bottomLeft:cc.p(0,0),bottomRight:cc.p(0,0),bottom:cc.p(0,0),center:cc.p(0,0),left:cc.p(0,0),right:cc.p(0,0),width:0,height:0,init:function(o){var s=this.width=o.width,n=this.height=o.height,t=o.x,e=o.y,r=e+n,a=t+s;this.topLeft.x=t,this.topLeft.y=r,this.topRight.x=a,this.topRight.y=r,this.top.x=t+s/2,this.top.y=r,this.bottomLeft.x=t,this.bottomLeft.y=e,this.bottomRight.x=a,this.bottomRight.y=e,this.bottom.x=t+s/2,this.bottom.y=e,this.center.x=t+s/2,this.center.y=e+n/2,this.left.x=t,this.left.y=e+n/2,this.right.x=a,this.right.y=e+n/2}}},{}],147:[function(T,N,z){var o=cc.ClassManager={instanceId:0|998*Math.random(),getNewInstanceId:function(){return this.instanceId++}},s=/\b_super\b/,n=function(){};n.extend=function(t){var e,r=this.prototype,a=Object.create(r),c={writable:!0,enumerable:!1,configurable:!0};if(cc.game&&cc.game.config&&cc.game.config[cc.game.CONFIG_KEY.exposeClassName]){var h="return (function "+(t._className||"Class")+`(arg0,arg1,arg2,arg3,arg4) {
this.__instanceId = cc.ClassManager.getNewInstanceId();
if (this.ctor) {
switch (arguments.length) {
case 0: this.ctor(); break;
case 1: this.ctor(arg0); break;
case 2: this.ctor(arg0,arg1); break;
case 3: this.ctor(arg0,arg1,arg2); break;
case 4: this.ctor(arg0,arg1,arg2,arg3); break;
case 5: this.ctor(arg0,arg1,arg2,arg3,arg4); break;
default: this.ctor.apply(this, arguments);
}
}
});`;e=Function(h)()}else e=function(f,m,v,_,p){if(this.__instanceId=o.getNewInstanceId(),this.ctor)switch(arguments.length){case 0:this.ctor();break;case 1:this.ctor(f);break;case 2:this.ctor(f,m);break;case 3:this.ctor(f,m,v);break;case 4:this.ctor(f,m,v,_);break;case 5:this.ctor(f,m,v,_,p);break;default:this.ctor.apply(this,arguments)}};e.prototype=a,c.value=e,Object.defineProperty(a,"constructor",c);for(var u in t){var d=typeof t[u]=="function";d&&typeof r[u]=="function"&&s.test(t[u])?(c.value=function(f,m){return function(){var v=this._super;this._super=r[f];var _=m.apply(this,arguments);return this._super=v,_}}(u,t[u]),Object.defineProperty(a,u,c)):d?(c.value=t[u],Object.defineProperty(a,u,c)):a[u]=t[u]}return e.extend=n.extend,e.implement=function(f){for(var m in f)a[m]=f[m]},e},cc.defineGetterSetter=function(t,e,r,a,c,h){if(t.__defineGetter__)r&&t.__defineGetter__(e,r),a&&t.__defineSetter__(e,a);else{if(!Object.defineProperty)throw new Error("browser does not support getters");var u={configurable:!0};r&&(u.get=r),a&&(u.set=a),Object.defineProperty(t,e,u)}},cc.clone=function(t){var e=t.constructor?new t.constructor:{};for(var r in t){var a=t[r];typeof a!="object"||!a||a instanceof _ccsg.Node||a instanceof HTMLElement?e[r]=a:e[r]=cc.clone(a)}return e},cc._Class=N.exports=n},{}],148:[function(T,N,z){function o(c,h,u){var d;d=function(){},u&&r.extend(d,u.constructor);var f=new d;return r.value(c,"__attrs__",f),f}function s(c,h,u){var d,f,m;if(typeof c=="function")f=(d=n(c)).constructor.prototype;else{var v=c;(d=v.__attrs__)||(d=o(v,0,n(c=v.constructor))),f=d}if(u===void 0){var _=h+a,p={};for(m in d)m.startsWith(_)&&(p[m.slice(_.length)]=d[m]);return p}if(typeof u=="object")for(m in u)m.charCodeAt(0)!==95&&(f[h+a+m]=u[m])}function n(c){return c.hasOwnProperty("__attrs__")&&c.__attrs__||function(h){for(var u,d=cc.Class.getInheritanceChain(h),f=d.length-1;f>=0;f--){var m=d[f];m.hasOwnProperty("__attrs__")&&m.__attrs__||o(m,0,(u=d[f+1])&&u.__attrs__)}return u=d[0],o(h,0,u&&u.__attrs__),h.__attrs__}(c)}function t(c){return n(c).constructor.prototype}function e(c,h){}var r=T("./js"),a=(T("./utils").isPlainEmptyObj_DEV,"$_$");cc.Integer="Integer",cc.Float="Float",cc.Boolean="Boolean",cc.String="String",N.exports={attr:s,getClassAttrs:n,getClassAttrsProto:t,setClassAttr:function(c,h,u,d){t(c)[h+a+u]=d},DELIMETER:a,getTypeChecker:e,ObjectType:function(c){return{type:"Object",ctor:c,_onAfterProp:!1}},ScriptUuid:{}}},{"./CCClass":135,"./js":156,"./utils":160}],149:[function(T,N,z){function o(){this.callbacks=[],this.targets=[],this.isInvoking=!1,this.containCanceled=!1}function s(){this._callbackTable=n.createMap(!0)}var n=T("./js"),t=n.array.fastRemoveAt,e=o.prototype;e.removeBy=function(c,h){for(var u=this.callbacks,d=this.targets,f=0;f<c.length;++f)c[f]===h&&(t(u,f),t(d,f),--f)},e.cancel=function(c){this.callbacks[c]=this.targets[c]=null,this.containCanceled=!0},e.cancelAll=function(){for(var c=this.callbacks,h=this.targets,u=0;u<c.length;u++)c[u]=h[u]=null;this.containCanceled=!0},e.purgeCanceled=function(){this.removeBy(this.callbacks,null),this.containCanceled=!1};var r=new n.Pool(function(c){c.callbacks.length=0,c.targets.length=0,c.isInvoking=!1,c.containCanceled=!1},16);r.get=function(){return this._get()||new o},(e=s.prototype).add=function(c,h,u){var d=this._callbackTable[c];d||(d=this._callbackTable[c]=r.get()),d.callbacks.push(h),d.targets.push(u||null)},e.has=function(c,h,u){var d=this._callbackTable[c];if(!d)return!1;var f=d.callbacks;if(!h){for(var m=0;m<f.length;m++)if(f[m])return!0;return!1}u=u||null;for(var v=d.targets,_=0;_<f.length;++_)if(f[_]===h&&v[_]===u)return!0;return!1},e.removeAll=function(c){if(typeof c=="string"){var h=this._callbackTable[c];h&&(h.isInvoking?h.cancelAll():(r.put(h),delete this._callbackTable[c]))}else if(c)for(var u in this._callbackTable){var d=this._callbackTable[u];if(d.isInvoking)for(var f=d.targets,m=0;m<f.length;++m)f[m]===c&&d.cancel(m);else d.removeBy(d.targets,c)}},e.remove=function(c,h,u){var d=this._callbackTable[c];if(d){u=u||null;for(var f=d.callbacks,m=d.targets,v=0;v<f.length;++v)if(f[v]===h&&m[v]===u){d.isInvoking?d.cancel(v):(t(f,v),t(m,v));break}}};var a=function(){s.call(this)};n.extend(a,s),a.prototype.invoke=function(c,h,u,d,f,m){var v=this._callbackTable[c];if(v){var _=!v.isInvoking;v.isInvoking=!0;for(var p=v.callbacks,g=v.targets,y=0,C=p.length;y<C;++y){var S=p[y];if(S){var I=g[y];I?S.call(I,h,u,d,f,m):S(h,u,d,f,m)}}_&&(v.isInvoking=!1,v.containCanceled&&v.purgeCanceled())}},a.CallbacksHandler=s,N.exports=a},{"./js":156}],150:[function(T,N,z){function o(s,n){for(var t=0;t<n.length;t++){var e=n[t];Array.isArray(e)?o(s,e):s.push(e)}}N.exports={flattenCodeArray:function(s){var n=[];return o(n,s),n.join("")}}},{}],151:[function(T,N,z){var o=T("./js"),s=(T("./CCObject"),T("./attribute")),n=T("./CCClass"),t=T("../utils/misc"),e=function(){this.uuidList=[],this.uuidObjList=[],this.uuidPropList=[],this.rawProp=""};e.prototype.reset=function(){this.uuidList.length=0,this.uuidObjList.length=0,this.uuidPropList.length=0,this.rawProp=""},e.prototype.getUuidOf=function(a,c){for(var h=0;h<this.uuidObjList.length;h++)if(this.uuidObjList[h]===a&&this.uuidPropList[h]===c)return this.uuidList[h];return""},e.prototype.push=function(a,c,h){this.uuidList.push(h),this.uuidObjList.push(a),this.uuidPropList.push(c)},(e.pool=new o.Pool(function(a){a.reset()},10)).get=function(){return this._get()||new e};var r=function(){function a(f,m,v,_,p){this.result=f,this.customEnv=_,this.deserializedList=[],this.deserializedData=null,this._classFinder=v,this._idList=[],this._idObjList=[],this._idPropList=[]}function c(f,m,v,_,p){var g;_.hasOwnProperty("__deserialize__")?g=_.__deserialize__:(g=d(f,_),o.value(_,"__deserialize__",g,!0)),g(f,m,v,_,p)}var h=a.prototype;h.deserialize=function(f){if(Array.isArray(f)){var m=f,v=m.length;this.deserializedList.length=v;for(var _=0;_<v;_++)m[_]&&(this.deserializedList[_]=this._deserializeObject(m[_]));this.deserializedData=v>0?this.deserializedList[0]:[]}else this.deserializedList.length=1,this.deserializedData=f?this._deserializeObject(f):null,this.deserializedList[0]=this.deserializedData;return function(p){var g,y,C,S=p.deserializedList,I=p._idPropList,b=p._idList,A=p._idObjList;for(p._classFinder&&p._classFinder.onDereferenced,g=0;g<b.length;g++)y=I[g],C=b[g],A[g][y]=S[C]}(this),this.deserializedData},h._deserializeObject=function(f,m,v,_){var p,g=null,y=null,C=f.__type__;if(C){if(!(y=this._classFinder(C,f,v,_)))return this._classFinder===o._getClassById&&cc.deserialize.reportMissingClass(C),null;if((g=new y)._deserialize)return g._deserialize(f.content,this),g;cc.Class._isCCClass(y)?c(this,g,f,y,m):this._deserializeTypedObject(g,f,y)}else if(Array.isArray(f)){g=new Array(f.length);for(var S=0;S<f.length;S++)typeof(p=f[S])=="object"&&p?this._deserializeObjField(g,p,""+S):g[S]=p}else g={},this._deserializePrimitiveObject(g,f);return g},h._deserializeObjField=function(f,m,v,_){var p=m.__id__;if(p===void 0){var g=m.__uuid__;g?(this.result.uuidList.push(g),this.result.uuidObjList.push(f),this.result.uuidPropList.push(v)):f[v]=this._deserializeObject(m)}else{var y=this.deserializedList[p];y?f[v]=y:(this._idList.push(p),this._idObjList.push(f),this._idPropList.push(v))}},h._deserializePrimitiveObject=function(f,m){for(var v in m)if(m.hasOwnProperty(v)){var _=m[v];typeof _!="object"?v!=="__type__"&&(f[v]=_):_?this._deserializeObjField(f,_,v):f[v]=null}},h._deserializeTypedObject=function(f,m,v){if(v===cc.Vec2)return f.x=m.x||0,void(f.y=m.y||0);if(v!==cc.Color){if(v===cc.Size)return f.width=m.width||0,void(f.height=m.height||0);var _=v.__props__;_||(_=Object.keys(f));for(var p=0;p<_.length;p++){var g=_[p],y=m[g];y!==void 0&&m.hasOwnProperty(g)&&(typeof y!="object"?f[g]=y:y?this._deserializeObjField(f,y,g):f[g]=null)}}else{f.r=m.r||0,f.g=m.g||0,f.b=m.b||0;var C=m.a;f.a=C===void 0?255:C}};var u=function(f,m,v,_,p){if(m instanceof cc.ValueType){p||f.push("if(prop){");var g=o.getClassName(m);f.push("s._deserializeTypedObject(o"+v+",prop,"+g+");"),p||f.push("}else o"+v+"=null;")}else f.push("if(prop){"),f.push("s._deserializeObjField(o,prop,"+_+");"),f.push("}else o"+v+"=null;")},d=function(f,m){for(var v=s.DELIMETER+"type",_=s.DELIMETER+"rawType",p=(s.DELIMETER,s.DELIMETER+"serializable"),g=s.DELIMETER+"default",y=s.DELIMETER+"saveUrlAsAsset",C=s.DELIMETER+"formerlySerializedAs",S=s.getClassAttrs(m),I=m.__props__,b=["var prop;"],A=t.BUILTIN_CLASSID_RE.test(o._getClassId(m)),E=0;E<I.length;E++){var R,O=I[E];if(S[O+_])R=n.IDENTIFIER_RE.test(O)?'"'+O+'"':n.escapeForJS(O),b.push(`if(s.result.rawProp)
cc.error("not support multi raw object in a file");`),b.push("s.result.rawProp="+R+";");else{if(S[O+p]===!1)continue;var P;n.IDENTIFIER_RE.test(O)?(R='"'+O+'"',P="."+O):P="["+(R=n.escapeForJS(O))+"]";var x=P;if(S[O+C]){var w=S[O+C];x=n.IDENTIFIER_RE.test(w)?"."+w:"["+n.escapeForJS(w)+"]"}b.push("prop=d"+x+";"),b.push('if(typeof prop!=="undefined"){');var L=n.getDefault(S[O+g]);if(A){var D,F=S[O+v];if(L===void 0&&F)D=F===cc.String||F===cc.Integer||F===cc.Float||F===cc.Boolean;else{var M=typeof L;D=M==="string"&&!S[O+y]||M==="number"||M==="boolean"}D?b.push("o"+P+"=prop;"):u(b,L,P,R,!0)}else b.push('if(typeof prop!=="object"){o'+P+"=prop;}else{"),u(b,L,P,R,!1),b.push("}");b.push("}")}}return I[I.length-1]==="_$erialized"&&(b.push("o._$erialized=JSON.parse(JSON.stringify(d));"),b.push("s._deserializePrimitiveObject(o._$erialized,d);")),Function("s","o","d","k","t",b.join(""))};return a.pool=new o.Pool(function(f){f.result=null,f.customEnv=null,f.deserializedList.length=0,f.deserializedData=null,f._classFinder=null,f._idList.length=0,f._idObjList.length=0,f._idPropList.length=0},1),a.pool.get=function(f,m,v,_,p){var g=this._get();return g?(g.result=f,g.customEnv=_,g._classFinder=v,g):new a(f,m,v,_,p)},a}();cc.deserialize=function(a,c,h){var u=(h=h||{}).classFinder||o._getClassById,d=h.createAssetRefs||cc.sys.platform===cc.sys.EDITOR_CORE,f=h.customEnv,m=h.ignoreEditorOnly;typeof a=="string"&&(a=JSON.parse(a));var v=!c;c=c||e.pool.get();var _=r.pool.get(c,!1,u,f,m);cc.game._isCloning=!0;var p=_.deserialize(a);return cc.game._isCloning=!1,r.pool.put(_),d&&c.assignAssetsBy(Editor.serialize.asAsset),v&&e.pool.put(c),p},cc.deserialize.Details=e,cc.deserialize.reportMissingClass=function(a){cc.warnID(5302,a)}},{"../utils/misc":185,"./CCClass":135,"./CCObject":141,"./attribute":148,"./js":156}],152:[function(T,N,z){function o(n){this.id=0|998*Math.random(),this.prefix=n?n+s:""}var s=".";o.prototype.getNewId=function(){return this.prefix+ ++this.id},o.global=new o("global"),N.exports=o},{}],153:[function(T,N,z){T("./js"),T("./CCClass"),T("./CCClassDecorator"),T("./CCEnum"),T("./CCObject"),T("./callbacks-invoker"),T("./url"),T("./deserialize"),T("./instantiate"),T("./instantiate-jit"),T("./requiring-frame"),T("./CCSys"),T("./CCMacro"),T("./CCAssetLibrary"),T("./CCVisibleRect")},{"./CCAssetLibrary":134,"./CCClass":135,"./CCClassDecorator":136,"./CCEnum":137,"./CCMacro":140,"./CCObject":141,"./CCSys":144,"./CCVisibleRect":146,"./callbacks-invoker":149,"./deserialize":151,"./instantiate":155,"./instantiate-jit":154,"./js":156,"./requiring-frame":158,"./url":159}],154:[function(T,N,z){function o(E,R){this.varName=E,this.expression=R}function s(E,R){return R instanceof o?new o(R.varName,E+R.expression):E+R}function n(E,R,O){Array.isArray(O)?(O[0]=s(R,O[0]),E.push(O)):E.push(s(R,O)+";")}function t(E){this._exps=[],this._targetExp=E}function e(E,R){if(typeof E=="function")try{E=E()}catch(O){return!1}if(E===R)return!0;if(E&&R){if(E instanceof cc.ValueType&&E.equals(R))return!0;if(Array.isArray(E)&&Array.isArray(R)||E.constructor===Object&&R.constructor===Object)try{return JSON.stringify(E)===JSON.stringify(R)}catch(O){}}return!1}function r(E){return g.test(E)?"."+E:"["+y(E)+"]"}function a(E,R){this.parent=R,this.objsToClear_iN$t=[],this.codeArray=[],this.objs=[],this.funcs=[],this.funcModuleCache=f.createMap(),f.mixin(this.funcModuleCache,b),this.globalVariables=[],this.globalVariableId=0,this.localVariableId=0,this.codeArray.push(C+S+","+I+";","if(R){",S+"=R;","}else{",S+"=R=new "+this.getFuncModule(E.constructor,!0)+"();","}"),E._iN$t={globalVar:"R"},this.objsToClear_iN$t.push(E),this.enumerateObject(this.codeArray,E);var O;this.globalVariables.length>0&&(O=C+this.globalVariables.join(",")+";");var P=v.flattenCodeArray(["return (function(R){",O||[],this.codeArray,"return o;","})"]);this.result=Function("O","F",P)(this.objs,this.funcs);for(var x=0,w=this.objsToClear_iN$t.length;x<w;++x)this.objsToClear_iN$t[x]._iN$t=null;this.objsToClear_iN$t.length=0}var c=T("./CCObject"),h=c.Flags.Destroyed,u=c.Flags.PersistentMask,d=T("./attribute"),f=T("./js"),m=T("./CCClass"),v=T("./compiler"),_=d.DELIMETER+"serializable",p=d.DELIMETER+"default",g=m.IDENTIFIER_RE,y=m.escapeForJS,C="var ",S="o",I="t",b={"cc.Node":"cc.Node","cc.Sprite":"cc.Sprite","cc.Label":"cc.Label","cc.Button":"cc.Button","cc.Widget":"cc.Widget","cc.Animation":"cc.Animation","cc.ClickEvent":!1,"cc.PrefabInfo":!1};o.prototype.toString=function(){return C+this.varName+"="+this.expression+";"},t.prototype.append=function(E,R){this._exps.push([E,R])},t.prototype.writeCode=function(E){var R;if(this._exps.length>1)E.push(I+"="+this._targetExp+";"),R=I;else{if(this._exps.length!==1)return;R=this._targetExp}for(var O=0;O<this._exps.length;O++){var P=this._exps[O];n(E,R+r(P[0])+"=",P[1])}},(t.pool=new f.Pool(function(E){E._exps.length=0,E._targetExp=null},1)).get=function(E){var R=this._get()||new t;return R._targetExp=E,R};var A=a.prototype;A.getFuncModule=function(E,R){var O=f.getClassName(E);if(O){var P=this.funcModuleCache[O];if(P)return P;if(P===void 0){var x=O.indexOf(".")!==-1;if(x)try{if(x=E===Function("return "+O)())return this.funcModuleCache[O]=O,O}catch(D){}}}var w=this.funcs.indexOf(E);w<0&&(w=this.funcs.length,this.funcs.push(E));var L="F["+w+"]";return R&&(L="("+L+")"),this.funcModuleCache[O]=L,L},A.getObjRef=function(E){var R=this.objs.indexOf(E);return R<0&&(R=this.objs.length,this.objs.push(E)),"O["+R+"]"},A.setValueType=function(E,R,O,P){var x=t.pool.get(P),w=R.constructor.__props__;w||(w=Object.keys(R));for(var L=0;L<w.length;L++){var D=w[L],F=O[D];if(R[D]!==F){var M=this.enumerateField(O,D,F);x.append(D,M)}}x.writeCode(E),t.pool.put(x)},A.enumerateCCClass=function(E,R,O){for(var P=O.__props__,x=d.getClassAttrs(O),w=0;w<P.length;w++){var L=P[w];if(x[L+_]!==!1){var D=R[L];if(e(F=x[L+p],D))continue;if(typeof D=="object"&&D instanceof cc.ValueType){var F;if(((F=m.getDefault(F))&&F.constructor)===D.constructor){var M=S+r(L);this.setValueType(E,F,D,M);continue}}this.setObjProp(E,R,L,D)}}},A.instantiateArray=function(E){if(E.length===0)return"[]";var R="a"+ ++this.localVariableId,O=[new o(R,"new Array("+E.length+")")];E._iN$t={globalVar:"",source:O},this.objsToClear_iN$t.push(E);for(var P=0;P<E.length;++P)n(O,R+"["+P+"]=",this.enumerateField(E,P,E[P]));return O},A.enumerateField=function(E,R,O){if(typeof O=="object"&&O){var P=O._iN$t;if(P){var x=P.globalVar;if(!x){x=P.globalVar="v"+ ++this.globalVariableId,this.globalVariables.push(x);var w=P.source[0];P.source[0]=s(x+"=",w)}return x}return Array.isArray(O)?this.instantiateArray(O):this.instantiateObj(O)}return typeof O=="function"?this.getFuncModule(O):typeof O=="string"?y(O):(R==="_objFlags"&&E instanceof c&&(O&=u),O)},A.setObjProp=function(E,R,O,P){n(E,S+r(O)+"=",this.enumerateField(R,O,P))},A.enumerateObject=function(E,R){var O=R.constructor;if(cc.Class._isCCClass(O))this.enumerateCCClass(E,R,O);else for(var P in R)if(R.hasOwnProperty(P)&&(P.charCodeAt(0)!==95||P.charCodeAt(1)!==95||P==="__type__")){var x=R[P];typeof x=="object"&&x&&x===R._iN$t||this.setObjProp(E,R,P,x)}},A.instantiateObj=function(E){if(E instanceof cc.ValueType)return m.getNewValueTypeCode(E);if(E instanceof cc.Asset)return this.getObjRef(E);if(E._objFlags&h)return null;var R,O=E.constructor;if(cc.Class._isCCClass(O)){if(this.parent){if(this.parent instanceof cc.Component){if(E instanceof cc._BaseNode||E instanceof cc.Component)return this.getObjRef(E)}else if(this.parent instanceof cc._BaseNode){if(E instanceof cc._BaseNode){if(!E.isChildOf(this.parent))return this.getObjRef(E)}else if(E instanceof cc.Component&&!E.node.isChildOf(this.parent))return this.getObjRef(E)}}R=new o(S,"new "+this.getFuncModule(O,!0)+"()")}else if(O===Object)R=new o(S,"{}");else{if(O)return this.getObjRef(E);R=new o(S,"Object.create(null)")}var P=[R];return E._iN$t={globalVar:"",source:P},this.objsToClear_iN$t.push(E),this.enumerateObject(P,E),["(function(){",P,"return o;})();"]},N.exports={compile:function(E){return new a(E,E instanceof cc._BaseNode&&E).result},equalsToDefault:e}},{"./CCClass":135,"./CCObject":141,"./attribute":148,"./compiler":150,"./js":156}],155:[function(T,N,z){function o(f,m){if(!m&&(typeof f!="object"||Array.isArray(f)||!f||!cc.isValid(f)))return null;var v;if(f instanceof e){if(f._instantiate)return cc.game._isCloning=!0,v=f._instantiate(),cc.game._isCloning=!1,v;if(f instanceof cc.Asset)return null}return cc.game._isCloning=!0,v=s(f),cc.game._isCloning=!1,v}function s(f,m){if(Array.isArray(f)||h&&h(f))return null;var v;f._iN$t?v=f._iN$t:f.constructor?v=new f.constructor:v=Object.create(null),n(f,v,m);for(var _=0,p=u.length;_<p;++_)u[_]._iN$t=null;return u.length=0,v}function n(f,m,v){f._iN$t=m,u.push(f);var _=f.constructor;if(cc.Class._isCCClass(_))(function(y,C,S,I){for(var b=y.__props__,A=c.getClassAttrs(y),E=0;E<b.length;E++){var R=b[E];if(A[R+d]!==!1){var O=C[R];S[R]=typeof O=="object"&&O?O._iN$t||t(O,I):O}}})(_,f,m,v);else for(var p in f)if(f.hasOwnProperty(p)&&(p.charCodeAt(0)!==95||p.charCodeAt(1)!==95||p==="__type__")){var g=f[p];if(typeof g=="object"&&g){if(g===m)continue;m[p]=g._iN$t||t(g,v)}else m[p]=g}f instanceof e&&(m._objFlags&=a)}function t(f,m){if(f instanceof cc.ValueType)return f.clone();if(f instanceof cc.Asset)return f;var v;if(Array.isArray(f)){var _=f.length;v=new Array(_),f._iN$t=v;for(var p=0;p<_;++p){var g=f[p];v[p]=typeof g=="object"&&g?g._iN$t||t(g,m):g}return u.push(f),v}if(f._objFlags&r)return null;var y=f.constructor;if(cc.Class._isCCClass(y)){if(m){if(m instanceof cc.Component){if(f instanceof cc._BaseNode||f instanceof cc.Component)return f}else if(m instanceof cc._BaseNode){if(f instanceof cc._BaseNode){if(!f.isChildOf(m))return f}else if(f instanceof cc.Component&&!f.node.isChildOf(m))return f}}v=new y}else if(y===Object)v={};else{if(y)return f;v=Object.create(null)}return n(f,v,m),v}var e=T("./CCObject"),r=e.Flags.Destroyed,a=e.Flags.PersistentMask,c=T("./attribute"),h=T("./utils").isDomNode,u=[],d=c.DELIMETER+"serializable";o._clone=s,cc.instantiate=o,N.exports=o},{"./CCObject":141,"./attribute":148,"./utils":160}],156:[function(T,N,z){function o(_,p){for(;_;){var g=Object.getOwnPropertyDescriptor(_,p);if(g)return g;_=Object.getPrototypeOf(_)}return null}function s(_,p,g){var y=o(p,_);Object.defineProperty(g,_,y)}function n(_,p){_.splice(p,1)}function t(_,p){var g=_.indexOf(p);return g>=0&&(n(_,g),!0)}function e(_,p){typeof _=="number"&&(p=_,_=null),this.get=null,this.count=0,this._pool=new Array(p),this._cleanup=_}var r=new(T("./id-generater"))("TmpCId."),a={isNumber:function(_){return typeof _=="number"||_ instanceof Number},isString:function(_){return typeof _=="string"||_ instanceof String},addon:function(_){"use strict";_=_||{};for(var p=1,g=arguments.length;p<g;p++){var y=arguments[p];if(y){if(typeof y!="object"){cc.errorID(5402,y);continue}for(var C in y)C in _||s(C,y,_)}}return _},mixin:function(_){"use strict";_=_||{};for(var p=1,g=arguments.length;p<g;p++){var y=arguments[p];if(y){if(typeof y!="object"){cc.errorID(5403,y);continue}for(var C in y)s(C,y,_)}}return _},extend:function(_,p){for(var g in p)p.hasOwnProperty(g)&&(_[g]=p[g]);return _.prototype=Object.create(p.prototype,{constructor:{value:_,writable:!0,configurable:!0}}),_},getSuper:function(_){var p=_.prototype,g=p&&Object.getPrototypeOf(p);return g&&g.constructor},clear:function(_){for(var p=Object.keys(_),g=0;g<p.length;g++)delete _[p[g]]},getPropertyDescriptor:o},c={value:void 0,enumerable:!1,writable:!1,configurable:!0};a.value=function(_,p,g,y,C){c.value=g,c.writable=y,c.enumerable=C,Object.defineProperty(_,p,c),c.value=void 0};var h={get:null,set:null,enumerable:!1};a.getset=function(_,p,g,y,C){typeof y!="function"&&(C=y,y=void 0),h.get=g,h.set=y,h.enumerable=C,Object.defineProperty(_,p,h),h.get=null,h.set=null};var u={get:null,enumerable:!1,configurable:!1};a.get=function(_,p,g,y,C){u.get=g,u.enumerable=y,u.configurable=C,Object.defineProperty(_,p,u),u.get=null};var d={set:null,enumerable:!1,configurable:!1};a.set=function(_,p,g,y,C){d.set=g,d.enumerable=y,d.configurable=C,Object.defineProperty(_,p,d),d.set=null},a.getClassName=function(_){if(typeof _=="function"){var p=_.prototype;if(p&&p.hasOwnProperty("__classname__")&&p.__classname__)return p.__classname__;var g="";if(_.name&&(g=_.name),_.toString){var y,C=_.toString();(y=C.charAt(0)==="["?C.match(/\[\w+\s*(\w+)\]/):C.match(/function\s*(\w+)/))&&y.length===2&&(g=y[1])}return g!=="Object"?g:""}return _&&_.constructor?a.getClassName(_.constructor):""},function(){function _(C,S){return function(I,b){if(b.prototype.hasOwnProperty(C)&&delete S[b.prototype[C]],a.value(b.prototype,C,I),I){var A=S[I];if(A&&A!==b){var E="A Class already exists with the same "+C+' : "'+I+'".';cc.error(E)}else S[I]=b}}}var p={},g={};a._setClassId=_("__cid__",p);var y=_("__classname__",g);a.setClassName=function(C,S){if(y(C,S),!S.prototype.hasOwnProperty("__cid__")){var I=C||r.getNewId();I&&a._setClassId(I,S)}},a.unregisterClass=function(){for(var C=0;C<arguments.length;C++){var S=arguments[C].prototype,I=S.__cid__;I&&delete p[I];var b=S.__classname__;b&&delete g[b]}},a._getClassById=function(C){return p[C]},a.getClassByName=function(C){return g[C]},a._getClassId=function(C,S){if(S=S===void 0||S,typeof C=="function"&&C.prototype.hasOwnProperty("__cid__"))return C.prototype.__cid__;if(C&&C.constructor){var I=C.constructor.prototype;if(I&&I.hasOwnProperty("__cid__"))return C.__cid__}return""}}(),a.obsolete=function(_,p,g,y){function C(){return this[g]}var S=/([^.]+)$/.exec(p)[0];y?a.getset(_,S,C,function(I){this[g]=I}):a.get(_,S,C)},a.obsoletes=function(_,p,g,y){for(var C in g){var S=g[C];a.obsolete(_,p+"."+C,S,y)}};var f=/(%d)|(%s)/,m=/%s/;a.formatStr=function(){var _=arguments.length;if(_===0)return"";var p=arguments[0];if(_===1)return""+p;if(typeof p=="string"&&f.test(p))for(var g=1;g<_;++g){var y=arguments[g],C=typeof y=="number"?f:m;C.test(p)?p=p.replace(C,y):p+=" "+y}else for(var S=1;S<_;++S)p+=" "+arguments[S];return p},a.shiftArguments=function(){for(var _=arguments.length-1,p=new Array(_),g=0;g<_;++g)p[g]=arguments[g+1];return p},a.createMap=function(_){var p=Object.create(null);return _&&(p["."]=!0,p["/"]=!0,delete p["."],delete p["/"]),p};var v=Array.prototype.indexOf;a.array={remove:t,fastRemove:function(_,p){var g=_.indexOf(p);g>=0&&(_[g]=_[_.length-1],--_.length)},removeAt:n,fastRemoveAt:function(_,p){var g=_.length;p<0||p>=g||(_[p]=_[g-1],_.length=g-1)},contains:function(_,p){return _.indexOf(p)>=0},verifyType:function(_,p){if(_&&_.length>0){for(var g=0;g<_.length;g++)if(!(_[g]instanceof p))return cc.logID(1300),!1}return!0},removeArray:function(_,p){for(var g=0,y=p.length;g<y;g++)t(_,p[g])},appendObjectsAt:function(_,p,g){return _.splice.apply(_,[g,0].concat(p)),_},copy:function(_){var p,g=_.length,y=new Array(g);for(p=0;p<g;p+=1)y[p]=_[p];return y},indexOf:v,MutableForwardIterator:T("../utils/mutable-forward-iterator")},e.prototype._get=function(){if(this.count>0){--this.count;var _=this._pool[this.count];return this._pool[this.count]=null,_}return null},e.prototype.put=function(_){var p=this._pool;if(this.count<p.length){if(this._cleanup&&this._cleanup(_)===!1)return;p[this.count]=_,++this.count}},e.prototype.resize=function(_){_>=0&&(this._pool.length=_,this.count>_&&(this.count=_))},a.Pool=e,cc.js=a,N.exports=a},{"../utils/mutable-forward-iterator":186,"./id-generater":152}],157:[function(T,N,z){function o(r,a,c,h){if(!r.get&&!r.set&&r.hasOwnProperty("default")){var u="_N$"+a;r.get=function(){return this[u]},r.set=function(v){var _=this[u];this[u]=v,c.call(this,_)};var d={};h[u]=d;for(var f in e){var m=e[f];r.hasOwnProperty(f)&&(d[f]=r[f],m.canUsedInGet||delete r[f])}}}function s(r,a,c,h){Array.isArray(h)&&h.length>0&&(h=h[0]),r.type=h}function n(r,a,c,h){if(Array.isArray(a)){if(!(a.length>0))return cc.errorID(5508,c,h);if(cc.RawAsset.isRawAssetType(a[0]))return r.url=a[0],void delete r.type;r.type=a=a[0]}}function t(r,a,c,h){}var e={url:{canUsedInGet:!0},default:{},serializable:{},editorOnly:{},rawType:{},formerlySerializedAs:{}};z.getFullFormOfProperty=function(r){if(!(r&&r.constructor===Object)){if(Array.isArray(r)&&r.length>0)return{default:[],type:r,_short:!0};if(typeof r=="function"){var a=r;return cc.RawAsset.isRawAssetType(a)?{default:"",url:a,_short:!0}:{default:cc.isChildClassOf(a,cc.ValueType)?new a:null,type:a,_short:!0}}return{default:r,_short:!0}}return null},z.preprocessAttrs=function(r,a,c,h){for(var u in r){var d=r[u],f=z.getFullFormOfProperty(d);if(f&&(d=r[u]=f),d){var m=d.notify;m&&o(d,u,m,r),"type"in d&&n(d,d.type,a,u),"url"in d&&s(d,0,0,d.url),"type"in d&&d.type}}},z.validateMethodWithProps=function(r,a,c,h,u){return!(typeof r!="function"&&r!==null)}},{"./CCClass":135}],158:[function(T,N,z){var o=[];cc._RF={push:function(s,n,t){t===void 0&&(t=n,n=""),o.push({uuid:n,script:t,module:s,exports:s.exports,beh:null})},pop:function(){var s=o.pop(),n=s.module,t=n.exports;if(t===s.exports){for(var e in t)return;n.exports=t=s.cls}},peek:function(){return o[o.length-1]}}},{}],159:[function(T,N,z){var o={};cc.url={_rawAssets:"",_builtinRawAssets:"",normalize:function(s){return s.charCodeAt(0)===46&&s.charCodeAt(1)===47?s=s.slice(2):s.charCodeAt(0)===47&&(s=s.slice(1)),s},raw:function(s){return(s=this.normalize(s)).startsWith("resources/")||cc.errorID(7002,s),this._rawAssets+s},builtinRaw:!1,_init:function(s){for(var n in s){var t=s[n];t=cc.path.stripSep(t)+"/",o[n]=t}this._rawAssets=o.assets,this._builtinRawAssets=o.internal}},N.exports=cc.url},{}],160:[function(T,N,z){N.exports={contains:function(o,s){if(typeof o.contains=="function")return o.contains(s);if(typeof o.compareDocumentPosition=="function")return!!(16&o.compareDocumentPosition(s));var n=s.parentNode;if(n)do{if(n===o)return!0;n=n.parentNode}while(n!==null);return!1},isDomNode:typeof window=="object"&&(typeof Node=="function"?function(o){return o instanceof Node}:function(o){return o&&typeof o=="object"&&typeof o.nodeType=="number"&&typeof o.nodeName=="string"}),callInNextTick:function(o,s,n){o&&setTimeout(function(){o(s,n)},0)}}},{}],161:[function(T,N,z){T("./platform/js"),T("./value-types"),T("./utils"),T("./platform/CCInputManager"),T("./platform/CCInputExtension"),T("./event"),T("./platform/CCSys"),T("./platform/CCMacro"),T("./load-pipeline"),T("./textures"),T("./CCDirector"),T("./CCDirectorWebGL"),T("./CCDirectorCanvas"),T("./platform/CCSAXParser"),T("./platform/CCView"),T("./platform/CCScreen"),T("./CCScheduler"),T("./event-manager"),T("./renderer")},{"./CCDirector":33,"./CCDirectorCanvas":34,"./CCDirectorWebGL":35,"./CCScheduler":42,"./event":99,"./event-manager":95,"./load-pipeline":121,"./platform/CCInputExtension":138,"./platform/CCInputManager":139,"./platform/CCMacro":140,"./platform/CCSAXParser":142,"./platform/CCScreen":143,"./platform/CCSys":144,"./platform/CCView":145,"./platform/js":156,"./renderer":165,"./textures":177,"./utils":184,"./value-types":198}],162:[function(T,N,z){function o(){var h=r.pop();return h||(h=new t),h}function s(h){r.push(h)}function n(h,u){var d=h._minX<u._minX?h._minX:u._minX,f=h._minY<u._minY?h._minY:u._minY;return((h._maxX>u._maxX?h._maxX:u._maxX)-d)*((h._maxY>u._maxY?h._maxY:u._maxY)-f)}var t=function(){this._minX=0,this._minY=0,this._maxX=0,this._maxY=0,this._width=0,this._height=0,this._area=0},e=t.prototype,r=[];e.setTo=function(h,u,d,f){return this._minX=h,this._minY=u,this._maxX=d,this._maxY=f,this.updateArea(),this},e.intValues=function(){this._minX=Math.floor(this._minX),this._minY=Math.floor(this._minY),this._maxX=Math.ceil(this._maxX),this._maxY=Math.ceil(this._maxY),this.updateArea()},e.updateArea=function(){this._width=this._maxX-this._minX,this._height=this._maxY-this._minY,this._area=this._width*this._height},e.union=function(h){this.isEmpty()?this.setTo(h._minX,h._minY,h._maxX,h._maxY):(this._minX>h._minX&&(this._minX=h._minX),this._minY>h._minY&&(this._minY=h._minY),this._maxX<h._maxX&&(this._maxX=h._maxX),this._maxY<h._maxY&&(this._maxY=h._maxY),this.updateArea())},e.setEmpty=function(){this._minX=0,this._minY=0,this._maxX=0,this._maxY=0,this._width=0,this._height=0,this._area=0},e.isEmpty=function(){return this._width<=0||this._height<=0},e.intersects=function(h){if(this.isEmpty()||h.isEmpty())return!1;var u=this._minX>h._minX?this._minX:h._minX,d=this._maxX<h._maxX?this._maxX:h._maxX;return!(u>d)&&(u=this._minY>h._minY?this._minY:h._minY,d=this._maxY<h._maxY?this._maxY:h._maxY,u<=d)},e.updateRegion=function(h,u){if(h.width!==0&&h.height!==0){var d,f,m,v,_=u,p=_.a,g=_.b,y=_.c,C=_.d,S=_.tx,I=_.ty,b=h.x,A=h.y,E=b+h.width,R=A+h.height;if(p===1&&g===0&&y===0&&C===1)d=b+S-1,f=A+I-1,m=E+S+1,v=R+I+1;else{var O=p*b+y*A+S,P=g*b+C*A+I,x=p*E+y*A+S,w=g*E+C*A+I,L=p*E+y*R+S,D=g*E+C*R+I,F=p*b+y*R+S,M=g*b+C*R+I,B=0;O>x&&(B=O,O=x,x=B),L>F&&(B=L,L=F,F=B),d=(O<L?O:L)-1,m=(x>F?x:F)+1,P>w&&(B=P,P=w,w=B),D>M&&(B=D,D=M,M=B),f=(P<D?P:D)-1,v=(w>M?w:M)+1}this._minX=d,this._minY=f,this._maxX=m,this._maxY=v,this._width=m-d,this._height=v-f,this._area=this._width*this._height}else this.setEmpty()};var a=function(){this.dirtyList=[],this.hasClipRect=!1,this.clipWidth=0,this.clipHeight=0,this.clipArea=0,this.clipRectChanged=!1},c=a.prototype;c.setClipRect=function(h,u){this.hasClipRect=!0,this.clipRectChanged=!0,this.clipWidth=Math.ceil(h),this.clipHeight=Math.ceil(u),this.clipArea=this.clipWidth*this.clipHeight},c.addRegion=function(h){var u=h._minX,d=h._minY,f=h._maxX,m=h._maxY;if(this.hasClipRect&&(u<0&&(u=0),d<0&&(d=0),f>this.clipWidth&&(f=this.clipWidth),m>this.clipHeight&&(m=this.clipHeight)),u>=f||d>=m)return!1;if(this.clipRectChanged)return!0;var v=this.dirtyList,_=o();return v.push(_.setTo(u,d,f,m)),this.mergeDirtyList(v),!0},c.clear=function(){for(var h=this.dirtyList,u=h.length,d=0;d<u;d++)s(h[d]);h.length=0},c.getDirtyRegions=function(){var h=this.dirtyList;if(this.clipRectChanged){this.clipRectChanged=!1,this.clear();var u=o();h.push(u.setTo(0,0,this.clipWidth,this.clipHeight))}else for(;this.mergeDirtyList(h););var d=this.dirtyList.length;if(d>0)for(var f=0;f<d;f++)this.dirtyList[f].intValues();return this.dirtyList},c.mergeDirtyList=function(h){var u=h.length;if(u<2)return!1;for(var d=this.hasClipRect,f=u>3?Number.POSITIVE_INFINITY:0,m=0,v=0,_=0,p=0;p<u-1;p++){var g=h[p];d&&(_+=g.area);for(var y=p+1;y<u;y++){var C=h[y],S=n(g,C)-g.area-C.area;f>S&&(m=p,v=y,f=S)}}if(d&&_/this.clipArea>.95&&(this.clipRectChanged=!0),m!==v){var I=h[v];return h[m].union(I),s(I),h.splice(v,1),!0}return!1},cc.Region=t,cc.DirtyRegion=a},{}],163:[function(T,N,z){cc.rendererCanvas={childrenOrderDirty:!0,assignedZ:0,assignedZStep:1e-4,_transformNodePool:[],_renderCmds:[],_isCacheToCanvasOn:!1,_cacheToCanvasCmds:{},_cacheInstanceIds:[],_currentID:0,_clearColor:cc.color(),_clearFillStyle:"rgb(0, 0, 0)",_dirtyRegion:null,_allNeedDraw:!0,_enableDirtyRegion:!1,_debugDirtyRegion:!1,_dirtyRegionCountThreshold:10,init:function(){cc.sys.browserType!==cc.sys.BROWSER_TYPE_IE&&cc.sys.browserType!==cc.sys.BROWSER_TYPE_UC||this.enableDirtyRegion(!1)},getRenderCmd:function(o){return o._createRenderCmd()},enableDirtyRegion:function(o){this._enableDirtyRegion=o},isDirtyRegionEnabled:function(){return this._enableDirtyRegion},setDirtyRegionCountThreshold:function(o){this._dirtyRegionCountThreshold=o},_collectDirtyRegion:function(){var o,s,n=this._renderCmds,t=this._dirtyRegion,e=_ccsg.Node.CanvasRenderCmd.RegionStatus,r=0,a=!0;for(o=0,s=n.length;o<s;o++){var c=n[o],h=c._regionFlag,u=c._oldRegion,d=c._currentRegion;h>e.NotDirty&&(++r>this._dirtyRegionCountThreshold&&(a=!1),a&&(!d.isEmpty()&&t.addRegion(d),c._regionFlag>e.Dirty&&!u.isEmpty()&&t.addRegion(u)),c._regionFlag=e.NotDirty)}return a},_beginDrawDirtyRegion:function(o){var s=o.getContext(),n=this._dirtyRegion.getDirtyRegions();s.save(),o.setTransform({a:1,b:0,c:0,d:1,tx:0,ty:0},1,1),s.beginPath();for(var t=0,e=0,r=0,a=0,c=o._scaleX,h=o._scaleY,u=0,d=n.length;u<d;++u){var f=n[u];t=(f._minX*c|0)-1,e=(-f._maxY*c|0)-1,r=2+(f._width*c|0),a=2+(f._height*h|0),s.rect(t,e,r,a)}s.clip()},_endDrawDirtyRegion:function(o){o.restore()},_debugDrawDirtyRegion:function(o){if(this._debugDirtyRegion){var s=o.getContext(),n=this._dirtyRegion.getDirtyRegions();o.setTransform({a:1,b:0,c:0,d:1,tx:0,ty:0},1,1),s.beginPath();for(var t=0,e=0,r=0,a=0,c=o._scaleX,h=o._scaleY,u=0,d=n.length;u<d;++u){var f=n[u];t=(f._minX*c|0)-1,e=(-f._maxY*c|0)-1,r=2+(f._width*c|0),a=2+(f._height*h|0),s.rect(t,e,r,a)}var m=s.fillStyle;s.fillStyle="green",s.fill(),s.fillStyle=m}},rendering:function(o){var s=this._dirtyRegion=this._dirtyRegion||new cc.DirtyRegion,n=cc._canvas,t=o||cc._renderContext,e=t.getContext(),r=cc.view.getScaleX(),a=cc.view.getScaleY();t.setViewScale(r,a),t.computeRealOffsetY();var c,h,u=this._dirtyRegion.getDirtyRegions(),d=this._renderCmds,f=this._allNeedDraw||!this._enableDirtyRegion;for(f||(f=f||!this._collectDirtyRegion()),f||this._beginDrawDirtyRegion(t),e.setTransform(1,0,0,1,0,0),e.clearRect(0,0,n.width,n.height),this._clearColor.r===0&&this._clearColor.g===0&&this._clearColor.b===0||(t.setFillStyle(this._clearFillStyle),t.setGlobalAlpha(this._clearColor.a),e.fillRect(0,0,n.width,n.height)),c=0,h=d.length;c<h;c++){var m=d[c];if(m._needDraw){var v=!1,_=m._currentRegion;if(!_||f)v=!0;else for(var p=0,g=u.length;p<g;++p)if(u[p].intersects(_)){v=!0;break}v&&m.rendering(t,r,a)}}f||(this._debugDrawDirtyRegion(t),this._endDrawDirtyRegion(e)),s.clear(),this._allNeedDraw=!1},_renderingToCacheCanvas:function(o,s,n,t){o||cc.logID(7600),n=n===void 0?1:n,t=t===void 0?1:t,s=s||this._currentID;var e,r,a=this._cacheToCanvasCmds[s];for(o.computeRealOffsetY(),e=0,r=a.length;e<r;e++)a[e].rendering(o,n,t);this._removeCache(s);var c=this._cacheInstanceIds;c.length===0?this._isCacheToCanvasOn=!1:this._currentID=c[c.length-1]},_turnToCacheMode:function(o){this._isCacheToCanvasOn=!0,o=o||0,this._cacheToCanvasCmds[o]=[],this._cacheInstanceIds.indexOf(o)===-1&&this._cacheInstanceIds.push(o),this._currentID=o},_turnToNormalMode:function(){this._isCacheToCanvasOn=!1},_removeCache:function(o){o=o||this._currentID;var s=this._cacheToCanvasCmds[o];s&&(s.length=0,delete this._cacheToCanvasCmds[o]);var n=this._cacheInstanceIds;cc.js.array.remove(n,o)},resetFlag:function(){this.childrenOrderDirty=!1,this._transformNodePool.length=0},transform:function(){var o=this._transformNodePool;o.sort(this._sortNodeByLevelAsc);for(var s=0,n=o.length;s<n;s++)o[s].updateStatus();o.length=0},transformDirty:function(){return this._transformNodePool.length>0},_sortNodeByLevelAsc:function(o,s){return o._curLevel-s._curLevel},pushDirtyNode:function(o){this._transformNodePool.push(o)},clear:function(){},clearRenderCommands:function(){this._renderCmds.length=0,this._cacheInstanceIds.length=0,this._isCacheToCanvasOn=!1,this._allNeedDraw=!0},pushRenderCommand:function(o){if(o.rendering)if(this._isCacheToCanvasOn){var s=this._currentID,n=this._cacheToCanvasCmds[s];n.indexOf(o)===-1&&n.push(o)}else this._renderCmds.indexOf(o)===-1&&this._renderCmds.push(o)}},function(){cc.CanvasContextWrapper=function(s){this._context=s,this._saveCount=0,this._currentAlpha=s.globalAlpha,this._currentCompositeOperation=s.globalCompositeOperation,this._currentFillStyle=s.fillStyle,this._currentStrokeStyle=s.strokeStyle,this._offsetX=0,this._offsetY=0,this._realOffsetY=this.height,this._armatureMode=0};var o=cc.CanvasContextWrapper.prototype;o.resetCache=function(){var s=this._context;this._currentAlpha=s.globalAlpha,this._currentCompositeOperation=s.globalCompositeOperation,this._currentFillStyle=s.fillStyle,this._currentStrokeStyle=s.strokeStyle,this._realOffsetY=this._context.canvas.height+this._offsetY},o.setOffset=function(s,n){this._offsetX=s,this._offsetY=n,this._realOffsetY=this._context.canvas.height+this._offsetY},o.computeRealOffsetY=function(){this._realOffsetY=this._context.canvas.height+this._offsetY},o.setViewScale=function(s,n){this._scaleX=s,this._scaleY=n},o.getContext=function(){return this._context},o.save=function(){this._context.save(),this._saveCount++},o.restore=function(){this._context.restore(),this._currentAlpha=this._context.globalAlpha,this._saveCount--},o.setGlobalAlpha=function(s){this._saveCount>0?this._context.globalAlpha=s:this._currentAlpha!==s&&(this._currentAlpha=s,this._context.globalAlpha=s)},o.setCompositeOperation=function(s){this._saveCount>0?this._context.globalCompositeOperation=s:this._currentCompositeOperation!==s&&(this._currentCompositeOperation=s,this._context.globalCompositeOperation=s)},o.setFillStyle=function(s){this._context.fillStyle=s},o.setStrokeStyle=function(s){this._saveCount>0?this._context.strokeStyle=s:this._currentStrokeStyle!==s&&(this._currentStrokeStyle=s,this._context.strokeStyle=s)},o.setTransform=function(s,n,t){this._armatureMode>0?(this.restore(),this.save(),this._context.transform(s.a,-s.b,-s.c,s.d,s.tx*n,-s.ty*t)):this._context.setTransform(s.a*n,-s.b*t,-s.c*n,s.d*t,this._offsetX+s.tx*n,this._realOffsetY-s.ty*t)},o._switchToArmatureMode=function(s,n,t,e){s?(this._armatureMode++,this._context.setTransform(n.a,n.c,n.b,n.d,this._offsetX+n.tx*t,this._realOffsetY-n.ty*e),this.save()):(this._armatureMode--,this.restore())}}()},{}],164:[function(T,N,z){function o(g){var y=cc._renderContext;t===null&&(e=y.createBuffer(),t=y.createBuffer()),function(C){var S=cc._renderContext;if(t){var I=6*Math.ceil(C/4);S.bindBuffer(S.ELEMENT_ARRAY_BUFFER,t),m=new Uint16Array(I);for(var b=0,A=0,E=I;A<E;A+=6)m[A]=b+0,m[A+1]=b+1,m[A+2]=b+2,m[A+3]=b+1,m[A+4]=b+2,m[A+5]=b+3,b+=4;S.bufferData(S.ELEMENT_ARRAY_BUFFER,m,S.DYNAMIC_DRAW)}if(e){var R=4*(C*h);u=new ArrayBuffer(R),d=new Float32Array(u),f=new Uint32Array(u),S.bindBuffer(S.ARRAY_BUFFER,e),S.bufferData(S.ARRAY_BUFFER,d,S.DYNAMIC_DRAW)}r=C-200}(g)}var s={texture:null,blendSrc:null,blendDst:null,shader:null},n=!1,t=null,e=null,r=0,a=0,c=0,h=6,u=null,d=null,f=null,m=null,v=0,_=!0,p=cc.Enum({QUAD:0,TRIANGLE:1,CUSTOM:2});cc.rendererWebGL={mat4Identity:null,childrenOrderDirty:!0,assignedZ:0,assignedZStep:.01,VertexType:p,_transformNodePool:[],_renderCmds:[],_isCacheToBufferOn:!1,_cacheToBufferCmds:{},_cacheInstanceIds:[],_currentID:0,_clearColor:{r:1,g:1,b:1,a:1},init:function(){var g=cc._renderContext;g.disable(g.CULL_FACE),g.disable(g.DEPTH_TEST),this._initExtensions(["OES_element_index_uint"]),this.mat4Identity=new cc.math.Matrix4,this.mat4Identity.identity(),o(cc.macro.BATCH_VERTEX_COUNT),cc.sys.os,cc.sys.OS_IOS},_initExtensions:function(g){this._extensions=this._extensions||{};for(var y=0;y<g.length;++y){var C=g[y];try{var S=gl.getExtension(C);S&&(this._extensions[C]=S)}catch(I){cc.error(I)}}},getVertexSize:function(){return r},getRenderCmd:function(g){return g._createRenderCmd()},_turnToCacheMode:function(g){this._isCacheToBufferOn=!0,g=g||0,this._cacheToBufferCmds[g]?this._cacheToBufferCmds[g].length=0:this._cacheToBufferCmds[g]=[],this._cacheInstanceIds.indexOf(g)===-1&&this._cacheInstanceIds.push(g),this._currentID=g},_turnToNormalMode:function(){this._isCacheToBufferOn=!1},_removeCache:function(g){g=g||this._currentID;var y=this._cacheToBufferCmds[g];y&&(y.length=0,delete this._cacheToBufferCmds[g]);var C=this._cacheInstanceIds;cc.js.array.remove(C,g)},_renderingToBuffer:function(g){g=g||this._currentID;var y=this._cacheToBufferCmds[g],C=cc._renderContext;this.rendering(C,y),this._removeCache(g);var S=this._cacheInstanceIds;S.length===0?this._isCacheToBufferOn=!1:this._currentID=S[S.length-1]},resetFlag:function(){this.childrenOrderDirty&&(this.childrenOrderDirty=!1),this._transformNodePool.length=0},transform:function(){var g=this._transformNodePool;g.sort(this._sortNodeByLevelAsc);var y,C;for(y=0,C=g.length;y<C;y++)g[y].updateStatus();g.length=0},transformDirty:function(){return this._transformNodePool.length>0},_sortNodeByLevelAsc:function(g,y){return g._curLevel-y._curLevel},pushDirtyNode:function(g){this._transformNodePool.push(g)},clearRenderCommands:function(){this._renderCmds.length=0},clear:function(){var g=cc._renderContext;g.clearColor(this._clearColor.r,this._clearColor.g,this._clearColor.b,this._clearColor.a),g.clear(g.COLOR_BUFFER_BIT|g.DEPTH_BUFFER_BIT)},setDepthTest:function(g){var y=cc._renderContext;g?(y.clearDepth(1),y.enable(y.DEPTH_TEST),y.depthFunc(y.LEQUAL)):y.disable(y.DEPTH_TEST)},pushRenderCommand:function(g){if(g.rendering||g.uploadData)if(this._isCacheToBufferOn){var y=this._currentID,C=this._cacheToBufferCmds[y];C.indexOf(g)===-1&&C.push(g)}else this._renderCmds.push(g)},_increaseBatchingSize:function(g,y,C){var S,I;switch(y=y||p.QUAD){case p.QUAD:for(S=0;S<g;S+=4)I=a+S,m[c++]=I+0,m[c++]=I+1,m[c++]=I+2,m[c++]=I+1,m[c++]=I+2,m[c++]=I+3;break;case p.TRIANGLE:for(_=!1,S=0;S<g;S+=3)I=a+S,m[c++]=I+0,m[c++]=I+1,m[c++]=I+2;break;case p.CUSTOM:_=!1;var b=C.length;for(S=0;S<b;S++)m[c++]=a+C[S];break;default:return}a+=g},_updateBatchedInfo:function(g,y,C){return(g!==s.texture||y.src!==s.blendSrc||y.dst!==s.blendDst||C!==s.shader)&&(this._batchRendering(),s.texture=g,s.blendSrc=y.src,s.blendDst=y.dst,s.shader=C,!0)},_breakBatch:function(){n=!0},_uploadBufferData:function(g){a>=r&&this._batchRendering();var y=g._node,C=g._texture||y._texture||y._spriteFrame&&y._spriteFrame._texture,S=y._blendFunc.src,I=y._blendFunc.dst,b=g._shaderProgram;(n||s.texture!==C||s.blendSrc!==S||s.blendDst!==I||s.shader!==b)&&(this._batchRendering(),s.texture=C,s.blendSrc=S,s.blendDst=I,s.shader=b,n=!1);var A=g.uploadData(d,f,a*h);if(A>0){var E,R;switch(g.vertexType||p.QUAD){case p.QUAD:for(E=0;E<A;E+=4)R=a+E,m[c++]=R+0,m[c++]=R+1,m[c++]=R+2,m[c++]=R+1,m[c++]=R+2,m[c++]=R+3;break;case p.TRIANGLE:for(_=!1,E=0;E<A;E+=3)R=a+E,m[c++]=R+0,m[c++]=R+1,m[c++]=R+2;break;case p.CUSTOM:_=!1,g.uploadIndexData&&(c+=g.uploadIndexData(m,c,a));break;default:return}a+=A}},_batchRendering:function(){if(a!==0&&s.texture){var g=cc._renderContext,y=s.texture,C=s.shader,S=a>.5*r;if(C&&(C.use(),C._updateProjectionUniform()),cc.gl.blendFunc(s.blendSrc,s.blendDst),cc.gl.bindTexture2DN(0,y),g.bindBuffer(g.ARRAY_BUFFER,e),S)g.bufferData(g.ARRAY_BUFFER,d,g.DYNAMIC_DRAW);else{var I=d.subarray(0,a*h);g.bufferData(g.ARRAY_BUFFER,I,g.DYNAMIC_DRAW)}g.enableVertexAttribArray(cc.macro.VERTEX_ATTRIB_POSITION),g.enableVertexAttribArray(cc.macro.VERTEX_ATTRIB_COLOR),g.enableVertexAttribArray(cc.macro.VERTEX_ATTRIB_TEX_COORDS),g.vertexAttribPointer(cc.macro.VERTEX_ATTRIB_POSITION,3,g.FLOAT,!1,24,0),g.vertexAttribPointer(cc.macro.VERTEX_ATTRIB_COLOR,4,g.UNSIGNED_BYTE,!0,24,12),g.vertexAttribPointer(cc.macro.VERTEX_ATTRIB_TEX_COORDS,2,g.FLOAT,!1,24,16),g.bindBuffer(g.ELEMENT_ARRAY_BUFFER,t),(!v||!_||c>v)&&(S?g.bufferData(g.ELEMENT_ARRAY_BUFFER,m,g.DYNAMIC_DRAW):g.bufferData(g.ELEMENT_ARRAY_BUFFER,m.subarray(0,c),g.DYNAMIC_DRAW)),g.drawElements(g.TRIANGLES,c,g.UNSIGNED_SHORT,0),cc.g_NumberOfDraws++,_?v=c:(v=0,_=!0),a=0,c=0}},rendering:function(g,y){var C,S,I,b=y||this._renderCmds,A=g||cc._renderContext;for(A.bindBuffer(A.ARRAY_BUFFER,null),cc.gl.bindTexture2DN(0,null),C=0,S=b.length;C<S;++C)(I=b[C])._needDraw&&(I.uploadData?this._uploadBufferData(I):(a>0&&this._batchRendering(),I.rendering(A)));this._batchRendering(),s.texture=null}}},{}],165:[function(T,N,z){T("./RendererCanvas"),T("./RendererWebGL"),T("./DirtyRegion")},{"./DirtyRegion":162,"./RendererCanvas":163,"./RendererWebGL":164}],166:[function(T,N,z){_ccsg.Scene=_ccsg.Node.extend({_className:"Scene",ctor:function(){_ccsg.Node.prototype.ctor.call(this),this._ignoreAnchorPointForPosition=!0,this.setAnchorPoint(.5,.5),this.setContentSize(cc.director.getWinSize())}})},{}],167:[function(T,N,z){var o=T("../event/event-target"),s=T("../utils/misc");_ccsg.Sprite=_ccsg.Node.extend({dirty:!1,_recursiveDirty:null,_shouldBeHidden:!1,_transformToBatch:null,_blendFunc:null,_texture:null,_rect:null,_rectRotated:!1,_offsetPosition:null,_unflippedOffsetPositionFromCenter:null,_opacityModifyRGB:!1,_flippedX:!1,_flippedY:!1,_textureLoaded:!1,_className:"Sprite",ctor:function(n,t,e){_ccsg.Node.prototype.ctor.call(this),o.call(this),this._shouldBeHidden=!1,this._offsetPosition=cc.p(0,0),this._unflippedOffsetPositionFromCenter=cc.p(0,0),this._blendFunc={src:cc.macro.BLEND_SRC,dst:cc.macro.BLEND_DST},this._rect=cc.rect(0,0,0,0),this._softInit(n,t,e)},textureLoaded:function(){return this._textureLoaded},addLoadedEventListener:function(n,t){this.once("load",n,t)},isDirty:function(){return this.dirty},setDirty:function(n){this.dirty=n},isTextureRectRotated:function(){return this._rectRotated},getTextureRect:function(){return cc.rect(this._rect)},getOffsetPosition:function(){return cc.p(this._offsetPosition)},_getOffsetX:function(){return this._offsetPosition.x},_getOffsetY:function(){return this._offsetPosition.y},getBlendFunc:function(){return this._blendFunc},initWithSpriteFrame:function(n){cc.assertID(n,2606),n.textureLoaded()||(this._textureLoaded=!1,n.once("load",this._renderCmd._spriteFrameLoadedCallback,this._renderCmd));var t=cc._renderType!==cc.game.RENDER_TYPE_CANVAS&&n._rotated,e=this.initWithTexture(n.getTexture(),n.getRect(),t);return this.setSpriteFrame(n),e},initWithSpriteFrameName:function(){cc.warnID(2608)},setVertexRect:function(n){var t=this._rect;t.x=n.x,t.y=n.y,t.width=n.width,t.height=n.height},setFlippedX:function(n){this._flippedX!==n&&(this._flippedX=n,this.setTextureRect(this._rect,this._rectRotated,this._contentSize),this.setNodeDirty(!0))},setFlippedY:function(n){this._flippedY!==n&&(this._flippedY=n,this.setTextureRect(this._rect,this._rectRotated,this._contentSize),this.setNodeDirty(!0))},isFlippedX:function(){return this._flippedX},isFlippedY:function(){return this._flippedY},setOpacityModifyRGB:function(n){this._opacityModifyRGB!==n&&(this._opacityModifyRGB=n,this._renderCmd._setColorDirty())},isOpacityModifyRGB:function(){return this._opacityModifyRGB},setDisplayFrameWithAnimationName:function(n,t){cc.assertID(n,2610);var e=cc.spriteFrameAnimationCache.getAnimation(n);if(e){var r=e.getFrames()[t];r?this.setSpriteFrame(r.getSpriteFrame()):cc.logID(2603)}else cc.logID(2602)},getTexture:function(){return this._texture},_softInit:function(n,t,e){if(n===void 0)_ccsg.Sprite.prototype.init.call(this);else if(cc.js.isString(n))n[0]==="#"?cc.logID(2728,n):_ccsg.Sprite.prototype.init.call(this,n,t);else if(typeof n=="object"){if(n instanceof cc.Texture2D)this.initWithTexture(n,t,e);else if(n instanceof cc.SpriteFrame)this.initWithSpriteFrame(n);else if(n instanceof HTMLImageElement||n instanceof HTMLCanvasElement){var r=new cc.Texture2D;r.initWithElement(n),r.handleLoadedTexture(),this.initWithTexture(r)}}},getQuad:function(){return null},setBlendFunc:function(n,t){var e=this._blendFunc;t===void 0?(e.src=n.src,e.dst=n.dst):(e.src=n,e.dst=t),this._renderCmd.updateBlendFunc(e)},init:function(){return arguments.length>0?this.initWithFile(arguments[0],arguments[1]):(this.dirty=this._recursiveDirty=!1,this._blendFunc.src=cc.macro.BLEND_SRC,this._blendFunc.dst=cc.macro.BLEND_DST,this.texture=null,this._flippedX=this._flippedY=!1,this.anchorX=.5,this.anchorY=.5,this._offsetPosition.x=0,this._offsetPosition.y=0,this.setTextureRect(cc.rect(0,0,0,0),!1,cc.size(0,0)),!0)},initWithFile:function(n,t){cc.assertID(n,2609);var e=cc.textureCache.getTextureForKey(n);if(e){if(!t){var r=e.getContentSize();t=cc.rect(0,0,r.width,r.height)}return this.initWithTexture(e,t)}return e=cc.textureCache.addImage(n),this.initWithTexture(e,t||cc.rect(0,0,e.width,e.height))},initWithTexture:function(n,t,e,r){cc.assertID(arguments.length!==0,2710),e=e||!1,n=this._renderCmd._handleTextureForRotatedTexture(n,t,e,r),this._recursiveDirty=!1,this.dirty=!1,this._opacityModifyRGB=!0,this._blendFunc.src=cc.macro.BLEND_SRC,this._blendFunc.dst=cc.macro.BLEND_DST,this._flippedX=this._flippedY=!1,this.setAnchorPoint(.5,.5),this._offsetPosition.x=0,this._offsetPosition.y=0;var a=n.loaded;return this._textureLoaded=a,a?(t||(t=cc.rect(0,0,n.width,n.height)),this._renderCmd._checkTextureBoundary(n,t,e),this.setTexture(n),this.setTextureRect(t,e),this.emit("load"),!0):(this._rectRotated=e,t&&(this._rect.x=t.x,this._rect.y=t.y,this._rect.width=t.width,this._rect.height=t.height),this.texture&&this.texture.off("load",this._renderCmd._textureLoadedCallback,this._renderCmd),n.once("load",this._renderCmd._textureLoadedCallback,this._renderCmd),this.setTexture(n),!0)},setTextureRect:function(n,t,e,r){this._rectRotated=t||!1,this.setContentSize(e||n),this.setVertexRect(n),this._renderCmd._setTextureCoords(n,r);var a=this._unflippedOffsetPositionFromCenter.x,c=this._unflippedOffsetPositionFromCenter.y;this._flippedX&&(a=-a),this._flippedY&&(c=-c);var h=this._rect;this._offsetPosition.x=a+(this._contentSize.width-h.width)/2,this._offsetPosition.y=c+(this._contentSize.height-h.height)/2},setSpriteFrame:function(n){var t=this;cc.assertID(n,2712),this.setNodeDirty(!0);var e=n.getOffset();t._unflippedOffsetPositionFromCenter.x=e.x,t._unflippedOffsetPositionFromCenter.y=e.y;var r=n.getTexture();n.textureLoaded()?(t._textureLoaded=!0,r!==t._texture&&(t._setTexture(r),t.setColor(t._realColor)),t.setTextureRect(n.getRect(),n.isRotated(),n.getOriginalSize())):(t._textureLoaded=!1,n.once("load",function(a){var c=a.currentTarget;t._textureLoaded=!0;var h=c.getTexture();h!==t._texture&&t._setTexture(h),t.setTextureRect(c.getRect(),c.isRotated(),c.getOriginalSize()),t.emit("load"),t.setColor(t._realColor)},t)),this._renderCmd._updateForSetSpriteFrame(r)},setDisplayFrame:function(n){cc.logID(2604),this.setSpriteFrame(n)},isFrameDisplayed:function(n){return this._renderCmd.isFrameDisplayed(n)},displayFrame:function(){return this.getSpriteFrame()},getSpriteFrame:function(){return new cc.SpriteFrame(this._texture,this._rect,this._rectRotated,this._unflippedOffsetPositionFromCenter,this._contentSize)},setTexture:function(n){if(!n)return this._renderCmd._setTexture(null);var t=cc.js.isString(n);t&&(n=cc.textureCache.addImage(n)),n.loaded?(this._setTexture(n,t),this.setColor(this._realColor),this._textureLoaded=!0,this.emit("load")):(this._renderCmd._setTexture(n),n.once("load",function(e){this._setTexture(n,t),this.setColor(this._realColor),this._textureLoaded=!0,this.emit("load")},this))},_setTexture:function(n,t){this._renderCmd._setTexture(n),t&&this._changeRectWithTexture(n)},_changeRectWithTexture:function(n){var t=cc.rect(0,0,n.width,n.height);this.setTextureRect(t)},_createRenderCmd:function(){return cc._renderType===cc.game.RENDER_TYPE_CANVAS?new _ccsg.Sprite.CanvasRenderCmd(this):new _ccsg.Sprite.WebGLRenderCmd(this)}}),cc.js.addon(_ccsg.Sprite.prototype,o.prototype),s.propertyDefine(_ccsg.Sprite,["opacity","color","texture","quad"],{opacityModifyRGB:["isOpacityModifyRGB","setOpacityModifyRGB"],flippedX:["isFlippedX","setFlippedX"],flippedY:["isFlippedY","setFlippedY"],offsetX:["_getOffsetX"],offsetY:["_getOffsetY"],textureRectRotated:["isTextureRectRotated"]})},{"../event/event-target":97,"../utils/misc":185}],168:[function(T,N,z){_ccsg.Sprite.CanvasRenderCmd=function(s){this._rootCtor(s),this._needDraw=!0,this._textureCoord={renderX:0,renderY:0,x:0,y:0,width:0,height:0,validRect:!1},this._blendFuncStr="source-over",this._colorized=!1,this._textureToRender=null};var o=_ccsg.Sprite.CanvasRenderCmd.prototype=Object.create(_ccsg.Node.CanvasRenderCmd.prototype);o.constructor=_ccsg.Sprite.CanvasRenderCmd,o.setDirtyRecursively=function(s){},o._setTexture=function(s){var n=this._node;if(n._texture!==s){n._textureLoaded=!!s&&s.loaded,n._texture=s;var t=cc.rect(0,0,s.width,s.height);n.setTextureRect(t),this._updateColor()}},o._setColorDirty=function(){this.setDirtyFlag(_ccsg.Node._dirtyFlags.colorDirty|_ccsg.Node._dirtyFlags.opacityDirty)},o.isFrameDisplayed=function(s){var n=this._node;return s.getTexture()===n._texture&&cc.rectEqualToRect(s.getRect(),n._rect)},o.updateBlendFunc=function(s){this._blendFuncStr=_ccsg.Node.CanvasRenderCmd._getCompositeOperationByBlendFunc(s)},o._handleTextureForRotatedTexture=function(s,n,t,e){if(t&&s.isLoaded()){var r=s.getHtmlElementObj();r=_ccsg.Sprite.CanvasRenderCmd._cutRotateImageToCanvas(r,n,e);var a=new cc.Texture2D;a.initWithElement(r),a.handleLoadedTexture(),s=a,n.x=n.y=0,this._node._rect=cc.rect(0,0,n.width,n.height)}return s},o._checkTextureBoundary=function(s,n,t){if(s&&s.url){var e=n.x+n.width,r=n.y+n.height;e>s.width&&cc.errorID(3300,s.url),r>s.height&&cc.errorID(3400,s.url)}},o.rendering=function(s,n,t){var e=this._node,r=this._textureCoord,a=this._displayedOpacity/255,c=this._textureToRender||e._texture;if((!c||r.width!==0&&r.height!==0&&c.loaded)&&a!==0){var h,u=s||cc._renderContext,d=u.getContext(),f=e._offsetPosition.x,m=e._rect.height,v=e._rect.width,_=-e._offsetPosition.y-m;u.setTransform(this._worldTransform,n,t),u.setCompositeOperation(this._blendFuncStr),u.setGlobalAlpha(a),(e._flippedX||e._flippedY)&&u.save(),e._flippedX&&(f=-f-v,d.scale(-1,1)),e._flippedY&&(_=e._offsetPosition.y,d.scale(1,-1));var p,g,y,C,S,I,b,A;if(this._colorized?(p=0,g=0):(p=r.renderX,g=r.renderY),y=r.width,C=r.height,S=f,I=_,b=v,A=m,c&&c._image)h=c._image,c._pattern!==""?(u.setFillStyle(d.createPattern(h,c._pattern)),d.fillRect(S,I,b,A)):d.drawImage(h,p,g,y,C,S,I,b,A);else{var E=e._contentSize;if(r.validRect){var R=this._displayedColor;u.setFillStyle("rgba("+R.r+","+R.g+","+R.b+",1)"),d.fillRect(S,I,E.width,E.height)}}(e._flippedX||e._flippedY)&&u.restore(),cc.g_NumberOfDraws++}},o._updateColor=function(){var s=this._node._texture,n=this._textureCoord,t=this._displayedColor;s&&(t.r!==255||t.g!==255||t.b!==255?(this._textureToRender=s._generateColorTexture(t.r,t.g,t.b,n),this._colorized=!0):s&&(this._textureToRender=s,this._colorized=!1))},o._updateForSetSpriteFrame=function(s,n){if(this._colorized=!1,this._textureCoord.renderX=this._textureCoord.x,this._textureCoord.renderY=this._textureCoord.y,n=n||s.loaded){var t=this._node.getColor();t.r===255&&t.g===255&&t.b===255||this._updateColor()}},o._spriteFrameLoadedCallback=function(s){var n=this._node,t=s.currentTarget;n.setTextureRect(t.getRect(),t.isRotated(),t.getOriginalSize()),this._updateColor(),n.emit("load")},o._textureLoadedCallback=function(s){var n=this._node,t=s.currentTarget;if(!n._textureLoaded){n._textureLoaded=!0;var e=n._rect;e?cc._rectEqualToZero(e)&&(e.width=t.width,e.height=t.height):e=cc.rect(0,0,t.width,t.height),n.texture=t,n.setTextureRect(e,n._rectRotated);var r=this._displayedColor;r.r===255&&r.g===255&&r.b===255||this._updateColor(),n.emit("load")}},o._setTextureCoords=function(s){var n=this._textureCoord;n.renderX=n.x=0|s.x,n.renderY=n.y=0|s.y,n.width=0|s.width,n.height=0|s.height,n.validRect=!(n.width===0||n.height===0||n.x<0||n.y<0)},_ccsg.Sprite.CanvasRenderCmd._cutRotateImageToCanvas=function(s,n,t){if(!s)return null;if(!n)return s;t=t==null||t;var e=document.createElement("canvas");e.width=n.width,e.height=n.height;var r=e.getContext("2d");return r.translate(e.width/2,e.height/2),t?r.rotate(-1.5707963267948966):r.rotate(1.5707963267948966),r.drawImage(s,n.x,n.y,n.height,n.width,-n.height/2,-n.width/2,n.height,n.width),e}},{}],169:[function(T,N,z){var o=cc.macro;_ccsg.Sprite.WebGLRenderCmd=function(n){this._rootCtor(n),this._needDraw=!0,this._vertices=[{x:0,y:0,u:0,v:0},{x:0,y:0,u:0,v:0},{x:0,y:0,u:0,v:0},{x:0,y:0,u:0,v:0}],this._dirty=!1,this._recursiveDirty=!1,this._shaderProgram=cc.shaderCache.programForKey(o.SHADER_SPRITE_POSITION_TEXTURECOLOR)};var s=_ccsg.Sprite.WebGLRenderCmd.prototype=Object.create(_ccsg.Node.WebGLRenderCmd.prototype);s.constructor=_ccsg.Sprite.WebGLRenderCmd,s.updateBlendFunc=function(n){},s.setDirtyFlag=function(n){_ccsg.Node.WebGLRenderCmd.prototype.setDirtyFlag.call(this,n),this._dirty=!0},s.setDirtyRecursively=function(n){this._recursiveDirty=n,this._dirty=n;for(var t,e=this._node._children,r=e?e.length:0,a=0;a<r;a++)(t=e[a])instanceof _ccsg.Sprite&&t._renderCmd.setDirtyRecursively(n)},s._handleTextureForRotatedTexture=function(n){return n},s.isFrameDisplayed=function(n){var t=this._node;return cc.rectEqualToRect(n.getRect(),t._rect)&&n.getTexture().url===t._texture.url&&cc.pointEqualToPoint(n.getOffset(),t._unflippedOffsetPositionFromCenter)},s._updateForSetSpriteFrame=function(){},s._spriteFrameLoadedCallback=function(n){var t=n.currentTarget;this._node.setTextureRect(t.getRect(),t.isRotated(),t.getOriginalSize()),this._node.emit("load")},s._textureLoadedCallback=function(n){var t=this._node,e=n.currentTarget;if(!t._textureLoaded){t._textureLoaded=!0;var r=t._rect;r?cc._rectEqualToZero(r)&&(r.width=e.width,r.height=e.height):r=cc.rect(0,0,e.width,e.height),t.texture=e,t.setTextureRect(r,t._rectRotated),t.emit("load"),cc.renderer.childrenOrderDirty=!0}},s._setTextureCoords=function(n){var t=this._node,e=t._texture,r=this._vertices;if(e){var a,c,h,u,d,f=e.pixelWidth,m=e.pixelHeight;t._rectRotated?(o.FIX_ARTIFACTS_BY_STRECHING_TEXEL?(c=(a=(2*n.x+1)/(2*f))+(2*n.height-2)/(2*f),u=(h=(2*n.y+1)/(2*m))+(2*n.width-2)/(2*m)):(a=n.x/f,c=(n.x+n.height)/f,h=n.y/m,u=(n.y+n.width)/m),t._flippedX&&(d=h,h=u,u=d),t._flippedY&&(d=a,a=c,c=d),r[0].u=c,r[0].v=h,r[1].u=a,r[1].v=h,r[2].u=c,r[2].v=u,r[3].u=a,r[3].v=u):(o.FIX_ARTIFACTS_BY_STRECHING_TEXEL?(c=(a=(2*n.x+1)/(2*f))+(2*n.width-2)/(2*f),u=(h=(2*n.y+1)/(2*m))+(2*n.height-2)/(2*m)):(a=n.x/f,c=(n.x+n.width)/f,h=n.y/m,u=(n.y+n.height)/m),t._flippedX&&(d=a,a=c,c=d),t._flippedY&&(d=h,h=u,u=d),r[0].u=a,r[0].v=h,r[1].u=a,r[1].v=u,r[2].u=c,r[2].v=h,r[3].u=c,r[3].v=u)}},s._setColorDirty=function(){},s._updateBlendFunc=function(){var n=this._node;n._texture&&n._texture.hasPremultipliedAlpha()?(n._blendFunc.src=o.BLEND_SRC,n._blendFunc.dst=o.BLEND_DST,n.opacityModifyRGB=!0):(n._blendFunc.src=o.SRC_ALPHA,n._blendFunc.dst=o.ONE_MINUS_SRC_ALPHA,n.opacityModifyRGB=!1)},s._setTexture=function(n){var t=this._node;t._texture!==n&&(t._textureLoaded=!!n&&n.loaded,t._texture=n,this._updateBlendFunc(),t._textureLoaded&&(cc.renderer.childrenOrderDirty=!0))},s._checkTextureBoundary=function(n,t,e){if(n&&n.url){var r,a;e?(r=t.x+t.height,a=t.y+t.width):(r=t.x+t.width,a=t.y+t.height),r>n.width&&cc.errorID(3300,n.url),a>n.height&&cc.errorID(3400,n.url)}},s.transform=function(n,t){this.originTransform(n,t);var e=this._node,r=e._offsetPosition.x,a=r+e._rect.width,c=e._offsetPosition.y,h=c+e._rect.height,u=this._worldTransform,d=this._vertices;d[0].x=r*u.a+h*u.c+u.tx,d[0].y=r*u.b+h*u.d+u.ty,d[1].x=r*u.a+c*u.c+u.tx,d[1].y=r*u.b+c*u.d+u.ty,d[2].x=a*u.a+h*u.c+u.tx,d[2].y=a*u.b+h*u.d+u.ty,d[3].x=a*u.a+c*u.c+u.tx,d[3].y=a*u.b+c*u.d+u.ty},s.needDraw=function(){var n=this._node._texture;return this._needDraw&&n},s.uploadData=function(n,t,e){var r=this._node,a=r._texture;if(!(a&&a.loaded&&r._rect.width&&r._rect.height&&this._displayedOpacity))return 0;var c,h=this._displayedOpacity,u=this._displayedColor._val;if(r._opacityModifyRGB){var d=h/255,f=this._displayedColor.r*d,m=this._displayedColor.g*d;c=(h<<24>>>0)+(this._displayedColor.b*d<<16)+(m<<8)+f}else c=(h<<24>>>0)+((65280&u)<<8)+((16711680&u)>>8)+(u>>>24);var v,_,p=r._vertexZ,g=this._vertices,y=g.length,C=e;for(v=0;v<y;++v)_=g[v],n[C]=_.x,n[C+1]=_.y,n[C+2]=p,t[C+3]=c,n[C+4]=_.u,n[C+5]=_.v,C+=6;return y}},{}],170:[function(T,N,z){function o(_,p){return _-p}var s,n=T("../event/event-target"),t={_pool:{},_lengths:[],put:function(_){var p=_.length;this._pool[p]?this._pool[p].push(_):(this._pool[p]=[_],this._lengths.push(p),this._lengths.sort(o))},get:function(_){for(var p,g=0;g<this._lengths.length;g++)if(this._lengths[g]>=_){p=this._lengths[g];break}return p?this._pool[p].pop():void 0}},e=cc.macro,r={_rebuildQuads_base:function(_){var p,g,y,C,S=_._spriteFrame,I=_._contentSize,b=_._isTrimmedContentSize,A=_._vertices,E=_._corner;if(b)p=0,g=0,y=I.width,C=I.height;else{var R=S._originalSize,O=S._rect,P=S._offset,x=I.width,w=I.height,L=R.width,D=R.height,F=O.width,M=O.height,B=x/L,W=w/D,V=P.x+(L-F)/2,U=P.x-(L-F)/2;p=V*B,g=(P.y+(D-M)/2)*W,y=x+U*B,C=w+(P.y-(D-M)/2)*W}if(A.length<8&&(t.put(A),A=t.get(8)||new Float32Array(8),_._vertices=A),s){var k=_._renderCmd._worldTransform,X=k.a,Y=k.b,Z=k.c,et=k.d,$=k.tx,nt=k.ty,at=p*X,rt=p*Y,it=y*X,ot=y*Y,_t=C*Z+$,ut=C*et+nt,vt=g*Z+$,Tt=g*et+nt;A[0]=at+vt,A[1]=rt+Tt,A[2]=it+vt,A[3]=ot+Tt,A[4]=at+_t,A[5]=rt+ut,A[6]=it+_t,A[7]=ot+ut}else A[0]=p,A[1]=g,A[2]=y,A[3]=g,A[4]=p,A[5]=C,A[6]=y,A[7]=C;E[0]=0,E[1]=2,E[2]=4,E[3]=6,_._uvsDirty&&this._calculateUVs(_,S),_._vertCount=4},_calculateUVs:function(_,p){var g=_._uvs,y=p._texture.width,C=p._texture.height,S=p._rect;g.length<8&&(t.put(g),g=t.get(8)||new Float32Array(8),_._uvs=g);var I,b,A,E,R=e.FIX_ARTIFACTS_BY_STRECHING_TEXEL?.5:0;p._rotated?(I=(S.x+R)/y,b=(S.y+S.width-R)/C,A=(S.x+S.height-R)/y,E=(S.y+R)/C,g[0]=I,g[1]=E,g[2]=I,g[3]=b,g[4]=A,g[5]=E,g[6]=A,g[7]=b):(I=(S.x+R)/y,b=(S.y+S.height-R)/C,A=(S.x+S.width-R)/y,E=(S.y+R)/C,g[0]=I,g[1]=b,g[2]=A,g[3]=b,g[4]=I,g[5]=E,g[6]=A,g[7]=E)}},a={x:new Array(4),y:new Array(4),_rebuildQuads_base:function(_){var p,g,y,C,S=_._spriteFrame,I=_._contentSize,b=_._insetLeft,A=_._insetRight,E=_._insetTop,R=_._insetBottom,O=_._vertices,P=_._renderCmd._worldTransform,x=S._rect,w=_._corner;p=b,g=A,x.width,y=E,C=R,x.height;var L=I,D=L.width-p-g,F=L.height-y-C,M=L.width/(p+g),B=L.height/(y+C);M=Number.isNaN(M)||M>1?1:M,B=Number.isNaN(B)||B>1?1:B,D=D<0?0:D,F=F<0?0:F;var W=this.x,V=this.y;W[0]=0,W[1]=p*M,W[2]=W[1]+D,W[3]=L.width,V[0]=0,V[1]=C*B,V[2]=V[1]+F,V[3]=L.height,O.length<32&&(t.put(O),O=t.get(32)||new Float32Array(32),_._vertices=O);var U,k,X=0;if(s)for(U=0;U<4;U++)for(k=0;k<4;k++)O[X]=W[k]*P.a+V[U]*P.c+P.tx,O[X+1]=W[k]*P.b+V[U]*P.d+P.ty,X+=2;else for(U=0;U<4;U++)for(k=0;k<4;k++)O[X]=W[k],O[X+1]=V[U],X+=2;w[0]=0,w[1]=6,w[2]=24,w[3]=30,_._uvsDirty&&this._calculateUVs(_,S,b,A,E,R)},_calculateUVs:function(_,p,g,y,C,S){var I,b,A,E,R,O,P=_._uvs,x=p._rect,w=p._texture.width,L=p._texture.height,D=p._rect;I=g,A=y,b=x.width-I-A,E=C,O=S,R=x.height-E-O,P.length<32&&(t.put(P),P=t.get(32)||new Float32Array(32),_._uvs=P);var F,M,B=this.x,W=this.y,V=e.FIX_ARTIFACTS_BY_STRECHING_TEXEL?.5:0,U=0;if(p._rotated)for(B[0]=(D.x+V)/w,B[1]=(O+D.x)/w,B[2]=(O+R+D.x)/w,B[3]=(D.x+D.height-V)/w,W[3]=(D.y+V)/L,W[2]=(I+D.y)/L,W[1]=(I+b+D.y)/L,W[0]=(D.y+D.width-V)/L,F=0;F<4;F++)for(M=0;M<4;M++)P[U]=B[F],P[U+1]=W[3-M],U+=2;else for(B[0]=(D.x+V)/w,B[1]=(I+D.x)/w,B[2]=(I+b+D.x)/w,B[3]=(D.x+D.width-V)/w,W[3]=(D.y+V)/L,W[2]=(E+D.y)/L,W[1]=(E+R+D.y)/L,W[0]=(D.y+D.height-V)/L,F=0;F<4;F++)for(M=0;M<4;M++)P[U]=B[M],P[U+1]=W[F],U+=2}},c={_rebuildQuads_base:function(_,p,g){p=_._spriteFrame,g=_._contentSize;var y,C,S,I,b=_._vertices,A=_._corner,E=_._renderCmd._worldTransform,R=_._uvs,O=p._texture.width,P=p._texture.height,x=p._rect,w=e.FIX_ARTIFACTS_BY_STRECHING_TEXEL?.5:0;p._rotated?(y=(x.x+w)/O,S=(x.x+x.height-w)/O,C=(x.y+x.width-w)/P,I=(x.y+w)/P):(y=(x.x+w)/O,S=(x.x+x.width-w)/O,C=(x.y+x.height-w)/P,I=(x.y+w)/P);var L=x.width,D=x.height,F=g.width/L,M=g.height/D,B=Math.ceil(M),W=Math.ceil(F);B*W>16384&&cc.errorID(2625);var V=B*W*4*2;b.length<V&&(t.put(b),b=t.get(V)||new Float32Array(V),_._vertices=b),R.length<V&&(t.put(R),R=t.get(V)||new Float32Array(V),_._uvs=R);var U,k,X,Y,Z=0;_._vertCount=0;for(var et=0;et<B;++et)for(var $=0;$<W;++$){if(U=L*$,k=D*et,X=L*Math.min($+1,F),Y=D*Math.min(et+1,M),s){var nt=U*E.a,at=U*E.b,rt=X*E.a,it=X*E.b,ot=Y*E.c+E.tx,_t=Y*E.d+E.ty,ut=k*E.c+E.tx,vt=k*E.d+E.ty;b[Z]=nt+ut,b[Z+1]=at+vt,b[Z+2]=rt+ut,b[Z+3]=it+vt,b[Z+4]=nt+ot,b[Z+5]=at+_t,b[Z+6]=rt+ot,b[Z+7]=it+_t}else b[Z]=U,b[Z+1]=k,b[Z+2]=X,b[Z+3]=k,b[Z+4]=U,b[Z+5]=Y,b[Z+6]=X,b[Z+7]=Y;if(p._rotated?(R[Z]=y,R[Z+1]=I,R[Z+2]=y,R[Z+3]=Y=I+(C-I)*Math.min(1,F-$),R[Z+4]=X=y+(S-y)*Math.min(1,M-et),R[Z+5]=I,R[Z+6]=X,R[Z+7]=Y):(R[Z]=y,R[Z+1]=C,R[Z+2]=X=y+(S-y)*Math.min(1,F-$),R[Z+3]=C,R[Z+4]=y,R[Z+5]=Y=C+(I-C)*Math.min(1,M-et),R[Z+6]=X,R[Z+7]=Y),Z+=8,_._vertCount+=4,Z>V)return}A[0]=0,A[1]=8*(W-1)+2,A[2]=(B-1)*W*8+4,A[3]=V-2}},h={_rebuildQuads_base:function(_){var p=_._spriteFrame,g=_._contentSize,y=_._fillStart,C=_._fillRange;C<0&&(y+=C,C=-C),C=y+C,y=(y=y>1?1:y)<0?0:y,C=(C=C>1?1:C)<0?0:C,C-=y;var S,I,b,A,E,R=_._fillType,O=_._vertices,P=_._corner,x=_._renderCmd._worldTransform,w=_._uvs,L=0,D=0,F=g.width,M=g.height,B=p._texture.width,W=p._texture.height,V=p._rect,U=e.FIX_ARTIFACTS_BY_STRECHING_TEXEL?.5:0;p._rotated?(I=(V.x+U)/B,b=(V.y+V.width-U)/W,A=(V.x+V.height-U)/B,E=(V.y+U)/W):(I=(V.x+U)/B,b=(V.y+V.height-U)/W,A=(V.x+V.width-U)/B,E=(V.y+U)/W),O.length<8&&(t.put(O),O=t.get(8)||new Float32Array(8),_._vertices=O),w.length<8&&(t.put(w),w=t.get(8)||new Float32Array(8),_._uvs=w);var k=new Array(8);p._rotated?(k[0]=k[2]=I,k[4]=k[6]=A,k[3]=k[7]=b,k[1]=k[5]=E):(k[0]=k[4]=I,k[2]=k[6]=A,k[1]=k[3]=b,k[5]=k[7]=E),S=(S=(y=(y=y>1?1:y)<0?0:y)+(C=C<0?0:C))>1?1:S;var X;switch(R){case v.HORIZONTAL:X=L+(F-L)*S,L=L+(F-L)*y,F=X,w[0]=k[0]+(k[2]-k[0])*y,w[1]=k[1],w[2]=k[0]+(k[2]-k[0])*S,w[3]=k[3],w[4]=k[4]+(k[6]-k[4])*y,w[5]=k[5],w[6]=k[4]+(k[6]-k[4])*S,w[7]=k[7];break;case v.VERTICAL:X=D+(M-D)*S,D=D+(M-D)*y,M=X,w[0]=k[0],w[1]=k[1]+(k[5]-k[1])*y,w[2]=k[2],w[3]=k[3]+(k[7]-k[3])*y,w[4]=k[4],w[5]=k[1]+(k[5]-k[1])*S,w[6]=k[6],w[7]=k[3]+(k[7]-k[3])*S;break;default:cc.errorID(2626)}if(s){var Y=L*x.a,Z=L*x.b,et=F*x.a,$=F*x.b,nt=M*x.c+x.tx,at=M*x.d+x.ty,rt=D*x.c+x.tx,it=D*x.d+x.ty;O[0]=Y+rt,O[1]=Z+it,O[2]=et+rt,O[3]=$+it,O[4]=Y+nt,O[5]=Z+at,O[6]=et+nt,O[7]=$+at}else O[0]=L,O[1]=D,O[2]=F,O[3]=D,O[4]=L,O[5]=M,O[6]=F,O[7]=M;_._vertCount=4,P[0]=0,P[1]=2,P[2]=4,P[3]=6}},u={_vertPos:[cc.v2(0,0),cc.v2(0,0),cc.v2(0,0),cc.v2(0,0)],_vertices:[cc.v2(0,0),cc.v2(0,0)],_uvs:[cc.v2(0,0),cc.v2(0,0)],_intersectPoint_1:[cc.v2(0,0),cc.v2(0,0),cc.v2(0,0),cc.v2(0,0)],_intersectPoint_2:[cc.v2(0,0),cc.v2(0,0),cc.v2(0,0),cc.v2(0,0)],outVerts:null,outUvs:null,rawVerts:null,rawUvs:null,_rebuildQuads_base:function(_){var p=_._spriteFrame,g=_._contentSize,y=_._fillStart,C=_._fillRange;C<0&&(y+=C,C=-C),_._isTriangle=!0,_._rawVerts||(_._rawVerts=t.get(8)||new Float32Array(8),_._rawUvs=t.get(8)||new Float32Array(8));for(var S=_._fillCenter,I=_._vertices,b=_._corner,A=_._uvs,E=_._rawVerts,R=_._rawUvs,O=_._renderCmd._worldTransform;y>=1;)y-=1;for(;y<0;)y+=1;var P=S.x*g.width,x=S.y*g.height,w=cc.v2(P,x),L=(y*=2*Math.PI)+(C*=2*Math.PI);this.outVerts=I,this.outUvs=A,this.rawVerts=E,this.rawUvs=R,this._calculateVertices(O,p,g),this._calculateUVs(p);var D=this._vertPos,F=this._vertices;D[0].x=D[3].x=F[0].x,D[1].x=D[2].x=F[1].x,D[0].y=D[1].y=F[0].y,D[2].y=D[3].y=F[1].y,w.x>F[1].x&&(w.x=F[1].x),w.x<F[0].x&&(w.x=F[0].x),w.y<F[0].y&&(w.y=F[0].y),w.y>F[1].y&&(w.y=F[1].y),E[0]=E[4]=this._vertices[0].x,E[2]=E[6]=this._vertices[1].x,E[1]=E[3]=this._vertices[0].y,E[5]=E[7]=this._vertices[1].y,p._rotated?(R[0]=R[2]=this._uvs[0].x,R[4]=R[6]=this._uvs[1].x,R[3]=R[7]=this._uvs[0].y,R[1]=R[5]=this._uvs[1].y):(R[0]=R[4]=this._uvs[0].x,R[2]=R[6]=this._uvs[1].x,R[1]=R[3]=this._uvs[0].y,R[5]=R[7]=this._uvs[1].y);var M=[null,null,null,null];w.x!==this._vertices[0].x&&(M[0]=[3,0]),w.x!==this._vertices[1].x&&(M[2]=[1,2]),w.y!==this._vertices[0].y&&(M[1]=[0,1]),w.y!==this._vertices[1].y&&(M[3]=[2,3]),this._getInsectedPoints(this._vertices[0].x,this._vertices[1].x,this._vertices[0].y,this._vertices[1].y,w,y,this._intersectPoint_1),this._getInsectedPoints(this._vertices[0].x,this._vertices[1].x,this._vertices[0].y,this._vertices[1].y,w,y+C,this._intersectPoint_2),I.length<30&&(t.put(I),I=t.get(30)||new Float32Array(30),this.outVerts=_._vertices=I),A.length<30&&(t.put(A),A=t.get(30)||new Float32Array(30),this.outUvs=_._uvs=A);for(var B=0,W=0,V=0;V<4;++V){var U=M[V];if(U!==null)if(C>=2*Math.PI)this._generateTriangle(O,B,w,this._vertPos[U[0]],this._vertPos[U[1]]),B+=6,W+=3;else{var k=this._getVertAngle(w,this._vertPos[U[0]]),X=this._getVertAngle(w,this._vertPos[U[1]]);X<k&&(X+=2*Math.PI),k-=2*Math.PI,X-=2*Math.PI;for(var Y=0;Y<3;++Y)k>=L||(k>=y?(X>=L?this._generateTriangle(O,B,w,this._vertPos[U[0]],this._intersectPoint_2[V]):this._generateTriangle(O,B,w,this._vertPos[U[0]],this._vertPos[U[1]]),B+=6,W+=3):X<=y||(X<=L?(this._generateTriangle(O,B,w,this._intersectPoint_1[V],this._vertPos[U[1]]),B+=6,W+=3):(this._generateTriangle(O,B,w,this._intersectPoint_1[V],this._intersectPoint_2[V]),B+=6,W+=3))),k+=2*Math.PI,X+=2*Math.PI}}_._vertCount=W;for(var Z,et,$=1/0,nt=1/0,at=-1/0,rt=-1/0,it=0,ot=B;it<ot;it+=2)Z=I[it],et=I[it+1],Z<=$?($=Z,b[0]=it):Z>=at&&(at=Z,b[1]=it),et<=nt?(nt=et,b[2]=it):et>=rt&&(rt=et,b[3]=it)},_generateTriangle:function(_,p,g,y,C){var S,I,b=this.rawVerts,A=this.rawUvs,E=this.outVerts,R=b[0],O=b[1],P=b[6],x=b[7];s?(E[p]=g.x*_.a+g.y*_.c+_.tx,E[p+1]=g.x*_.b+g.y*_.d+_.ty,E[p+2]=y.x*_.a+y.y*_.c+_.tx,E[p+3]=y.x*_.b+y.y*_.d+_.ty,E[p+4]=C.x*_.a+C.y*_.c+_.tx,E[p+5]=C.x*_.b+C.y*_.d+_.ty):(E[p]=g.x,E[p+1]=g.y,E[p+2]=y.x,E[p+3]=y.y,E[p+4]=C.x,E[p+5]=C.y),S=(g.x-R)/(P-R),I=(g.y-O)/(x-O),this._generateUV(S,I,A,p),S=(y.x-R)/(P-R),I=(y.y-O)/(x-O),this._generateUV(S,I,A,p+2),S=(C.x-R)/(P-R),I=(C.y-O)/(x-O),this._generateUV(S,I,A,p+4)},_generateUV:function(_,p,g,y){var C=this.outUvs,S=g[0]+(g[2]-g[0])*_,I=g[4]+(g[6]-g[4])*_,b=g[1]+(g[3]-g[1])*_,A=g[5]+(g[7]-g[5])*_;C[y]=S+(I-S)*p,C[y+1]=b+(A-b)*p},_isAngleIn:function(_,p,g){for(var y=2*Math.PI;_<p||_>=p+y;)_<p&&(_+=y),_>=p+y&&(_-=y);return _<=p+g},_getVertAngle:function(_,p){var g,y;if(g=p.x-_.x,y=p.y-_.y,g!==0||y!==0){if(g===0)return y>0?.5*Math.PI:1.5*Math.PI;var C=Math.atan(y/g);return g<0&&(C+=Math.PI),C}},_getInsectedPoints:function(_,p,g,y,C,S,I){var b,A,E=Math.sin(S),R=Math.cos(S);if(Math.cos(S)!==0){if(b=E/R,(_-C.x)*R>0){var O=C.y+b*(_-C.x);I[0].x=_,I[0].y=O}if((p-C.x)*R>0){var P=C.y+b*(p-C.x);I[2].x=p,I[2].y=P}}if(Math.sin(S)!==0){if(A=R/E,(y-C.y)*E>0){var x=C.x+A*(y-C.y);I[3].x=x,I[3].y=y}if((g-C.y)*E>0){var w=C.x+A*(g-C.y);I[1].x=w,I[1].y=g}}return[null,null,null,null]},_calculateVertices:function(_,p,g){var y,C;y=g.width,C=g.height,this._vertices[0].x=0,this._vertices[0].y=0,this._vertices[1].x=y,this._vertices[1].y=C},_calculateUVs:function(_){var p,g,y,C,S=_._texture.width,I=_._texture.height,b=_._rect,A=e.FIX_ARTIFACTS_BY_STRECHING_TEXEL?.5:0;_._rotated?(p=(b.x+A)/S,g=(b.x+b.height-A)/S,y=(b.y+A)/I,C=(b.y+b.width-A)/I):(p=(b.x+A)/S,g=(b.x+b.width-A)/S,y=(b.y+A)/I,C=(b.y+b.height-A)/I),this._uvs[0].x=p,this._uvs[0].y=C,this._uvs[1].x=g,this._uvs[1].y=y}},d={_rebuildQuads_base:function(_,p,g){if(cc._renderType!==cc.game.RENDER_TYPE_CANVAS&&(_._spriteFrame,g=_._meshPolygonInfo)){var y=_._renderCmd._worldTransform,C=g.triangles.verts,S=_._vertices,I=_._uvs,b=C.length,A=_._corner,E=2*b;S.length<E&&(t.put(S),S=t.get(E)||new Float32Array(E),_._vertices=S),I.length<E&&(t.put(I),I=t.get(E)||new Float32Array(E),_._uvs=I);for(var R=1/0,O=1/0,P=-1/0,x=-1/0,w=0;w<b;w++){var L=C[w].x*y.a+C[w].y*y.c+y.tx,D=C[w].x*y.b+C[w].y*y.d+y.ty;S[2*w]=L,S[2*w+1]=D,I[2*w]=C[w].u,I[2*w+1]=C[w].v,L<R&&(R=L,A[0]=2*w),L>P&&(P=L,A[1]=2*w),D<O&&(O=D,A[2]=2*w),D>x&&(x=D,A[3]=2*w)}_._vertCount=b}}};cc.Scale9Sprite=_ccsg.Node.extend({_spriteFrame:null,_insetLeft:0,_insetRight:0,_insetTop:0,_insetBottom:0,_blendFunc:null,_renderingType:1,_brightState:0,_rawVerts:null,_rawUvs:null,_vertices:null,_uvs:null,_vertCount:0,_quadsDirty:!0,_uvsDirty:!0,_isTriangle:!1,_isTrimmedContentSize:!0,_fillType:0,_fillCenter:null,_fillStart:0,_fillRange:2*Math.PI,_distortionOffset:null,_distortionTiling:null,_meshPolygonInfo:null,ctor:function(_){_ccsg.Node.prototype.ctor.call(this),this._renderCmd.setState(this._brightState),this._blendFunc=cc.BlendFunc._alphaNonPremultiplied(),this._fillCenter=cc.v2(0,0),this.setAnchorPoint(cc.p(.5,.5)),this._rawVerts=null,this._rawUvs=null,this._vertices=t.get(8)||new Float32Array(8),this._uvs=t.get(8)||new Float32Array(8),typeof _=="string"||_ instanceof cc.Texture2D?this.initWithTexture(_):_ instanceof cc.SpriteFrame&&this.initWithSpriteFrame(_),s===void 0&&(s=cc._renderType===cc.game.RENDER_TYPE_WEBGL),this._corner=[]},loaded:function(){return this._spriteFrame!==null&&this._spriteFrame.textureLoaded()},initWithTexture:function(_){this.setTexture(_)},initWithSpriteFrame:function(_){this.setSpriteFrame(_)},setTexture:function(_){var p=new cc.SpriteFrame(_);this.setSpriteFrame(p)},setSpriteFrame:function(_){if(_){this._spriteFrame=_,this._quadsDirty=!0,this._uvsDirty=!0,this._renderCmd._needDraw=!1;var p=this,g=function(){p._spriteFrame&&cc.sizeEqualToSize(p._contentSize,cc.size(0,0))&&p.setContentSize(p._spriteFrame._rect),p._renderCmd._needDraw=!0,p._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.contentDirty)};_.textureLoaded()?g():_.once("load",g,this)}},setBlendFunc:function(_,p){p===void 0?(this._blendFunc.src=_.src,this._blendFunc.dst=_.dst):(this._blendFunc.src=_,this._blendFunc.dst=p),this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.contentDirty)},getBlendFunc:function(){return new cc.BlendFunc(this._blendFunc.src,this._blendFunc.dst)},setContentSize:function(_,p){p===void 0&&(p=_.height,_=_.width),_===this._contentSize.width&&p===this._contentSize.height||(_ccsg.Node.prototype.setContentSize.call(this,_,p),this._quadsDirty=!0)},enableTrimmedContentSize:function(_){this._isTrimmedContentSize!==_&&(this._isTrimmedContentSize=_,this._quadsDirty=!0,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.contentDirty))},isTrimmedContentSizeEnabled:function(){return this._isTrimmedContentSize},setState:function(_){this._brightState=_,this._renderCmd.setState(_),this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.contentDirty)},getState:function(){return this._brightState},setRenderingType:function(_){this._renderingType!==_&&(this._renderingType=_,this._quadsDirty=!0,this._uvsDirty=!0,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.contentDirty))},getRenderingType:function(){return this._renderingType},setInsetLeft:function(_){this._insetLeft=_,this._quadsDirty=!0,this._uvsDirty=!0,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.contentDirty)},getInsetLeft:function(){return this._insetLeft},setInsetTop:function(_){this._insetTop=_,this._quadsDirty=!0,this._uvsDirty=!0,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.contentDirty)},getInsetTop:function(){return this._insetTop},setInsetRight:function(_){this._insetRight=_,this._quadsDirty=!0,this._uvsDirty=!0,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.contentDirty)},getInsetRight:function(){return this._insetRight},setInsetBottom:function(_){this._insetBottom=_,this._quadsDirty=!0,this._uvsDirty=!0,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.contentDirty)},getInsetBottom:function(){return this._insetBottom},setFillType:function(_){this._fillType!==_&&(this._fillType=_,this._renderingType===m.FILLED&&(this._quadsDirty=!0,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.contentDirty)))},getFillType:function(){return this._fillType},setFillCenter:function(_,p){this._fillCenter=cc.v2(_,p),this._renderingType===m.FILLED&&this._fillType===v.RADIAL&&(this._quadsDirty=!0,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.contentDirty))},setDistortionTiling:function(_,p){p===void 0&&(p=_.y,_=_.x),this._distortionTiling=this._distortionTiling||cc.v2(0,0),this._distortionTiling.x=_,this._distortionTiling.y=p},setDistortionOffset:function(_,p){p===void 0&&(p=_.y,_=_.x),this._distortionOffset=this._distortionOffset||cc.v2(0,0),this._distortionOffset.x=_,this._distortionOffset.y=p},getFillCenter:function(){return cc.v2(this._fillCenter)},setFillStart:function(_){this._fillStart!==_&&(this._fillStart=_,this._renderingType===m.FILLED&&(this._quadsDirty=!0,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.contentDirty)))},getFillStart:function(){return this._fillStart},setFillRange:function(_){this._fillRange!==_&&(this._fillRange=_,this._renderingType===m.FILLED&&(this._quadsDirty=!0,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.contentDirty)))},getFillRange:function(){return this._fillRange},_rebuildQuads:function(){if(this._spriteFrame&&this._spriteFrame._textureLoaded){this._isTriangle=!1;var _;switch(this._renderingType){case m.SIMPLE:_=r;break;case m.SLICED:_=a;break;case m.TILED:_=c;break;case m.FILLED:_=this._fillType===v.RADIAL?u:h;break;case m.MESH:_=d}_?_._rebuildQuads_base(this):(this._quadsDirty=!1,this._uvsDirty=!1,this._renderCmd._needDraw=!1,cc.errorID(2627)),this._quadsDirty=!1,this._uvsDirty=!1}else this._renderCmd._needDraw=!1},_createRenderCmd:function(){return cc._renderType===cc.game.RENDER_TYPE_CANVAS?new cc.Scale9Sprite.CanvasRenderCmd(this):new cc.Scale9Sprite.WebGLRenderCmd(this)},setMeshPolygonInfo:function(_){this.setRenderingType(m.MESH),this._meshPolygonInfo=_,this._quadsDirty=!0,this._uvsDirty=!0},getMeshPolygonInfo:function(){return this._meshPolygonInfo}});var f=cc.Scale9Sprite.prototype;cc.js.addon(f,n.prototype),cc.defineGetterSetter(f,"insetLeft",f.getInsetLeft,f.setInsetLeft),cc.defineGetterSetter(f,"insetTop",f.getInsetTop,f.setInsetTop),cc.defineGetterSetter(f,"insetRight",f.getInsetRight,f.setInsetRight),cc.defineGetterSetter(f,"insetBottom",f.getInsetBottom,f.setInsetBottom),cc.Scale9Sprite.state={NORMAL:0,GRAY:1,DISTORTION:2};var m=cc.Scale9Sprite.RenderingType=cc.Enum({SIMPLE:0,SLICED:1,TILED:2,FILLED:3,MESH:4}),v=cc.Scale9Sprite.FillType=cc.Enum({HORIZONTAL:0,VERTICAL:1,RADIAL:2})},{"../event/event-target":97}],171:[function(T,N,z){cc.Scale9Sprite.CanvasRenderCmd=function(s){this._rootCtor(s),this._node.loaded()?this._needDraw=!0:this._needDraw=!1,this._state=cc.Scale9Sprite.state.NORMAL,this._originalTexture=this._textureToRender=null};var o=cc.Scale9Sprite.CanvasRenderCmd.prototype=Object.create(_ccsg.Node.CanvasRenderCmd.prototype);o.constructor=cc.Scale9Sprite.CanvasRenderCmd,o.updateTransform=function(s){this.originUpdateTransform(s),this._node._rebuildQuads()},o._doCulling=function(){var s=cc.visibleRect,n=this._currentRegion,t=n._minX,e=n._maxX,r=n._minY,a=n._maxY,c=s.left.x,h=s.right.x,u=s.top.y,d=s.bottom.y;this._needDraw=!(e<c||t>h||a<d||r>u)},o._updateDisplayColor=function(s){_ccsg.Node.WebGLRenderCmd.prototype._updateDisplayColor.call(this,s),this._originalTexture=this._textureToRender=null},o._syncDisplayColor=function(s){_ccsg.Node.WebGLRenderCmd.prototype._syncDisplayColor.call(this,s),this._originalTexture=this._textureToRender=null},o.setState=function(s){this._state!==s&&(this._state=s,this._originalTexture=this._textureToRender=null)},o.rendering=function(s,n,t){var e=this._node,r=this._displayedOpacity,a=r/255,c=null;if(e._spriteFrame&&(c=e._spriteFrame._texture),e.loaded()&&r!==0){if((this._textureToRender===null||this._originalTexture!==c)&&(this._textureToRender=this._originalTexture=c,cc.Scale9Sprite.state.GRAY===this._state&&(this._textureToRender=this._textureToRender._generateGrayTexture()),cc.sys.browserType!==cc.sys.BROWSER_TYPE_WECHAT_GAME_SUB)){var h=e.getDisplayedColor();!c||h.r===255&&h.g===255&&h.b===255||(this._textureToRender=this._textureToRender._generateColorTexture(h.r,h.g,h.b))}var u=s||cc._renderContext,d=u.getContext();if(u.setTransform(this._worldTransform,n,t),u.setCompositeOperation(_ccsg.Node.CanvasRenderCmd._getCompositeOperationByBlendFunc(e._blendFunc)),u.setGlobalAlpha(a),this._textureToRender){e._quadsDirty&&e._rebuildQuads();var f,m,v,_,p,g,y,C,S=this._textureToRender.width,I=this._textureToRender.height,b=this._textureToRender._image,A=e._vertices,E=e._uvs,R=0,O=0;if(e._isTriangle){var P=e._rawVerts,x=e._rawUvs;p=P[0],g=P[1],y=P[6]-p,g=-g-(C=P[7]-g),f=x[4]*S,m=x[5]*I,v=(x[6]-x[0])*S,_=(x[1]-x[7])*I,u.save(),d.beginPath();var w=Math.floor(e._vertCount/3);for(R=0,O=0;R<w;R++)d.moveTo(A[O++],-A[O++]),d.lineTo(A[O++],-A[O++]),d.lineTo(A[O++],-A[O++]);d.clip(),this._textureToRender._pattern!==""?(u.setFillStyle(d.createPattern(b,this._textureToRender._pattern)),d.fillRect(p,g,y,C)):v>0&&_>0&&y>0&&C>0&&d.drawImage(b,f,m,v,_,p,g,y,C),u.restore(),cc.g_NumberOfDraws+=w}else if(e._renderingType===cc.Scale9Sprite.RenderingType.SLICED){for(var L=0;L<3;++L)for(var D=0;D<3;++D)p=A[O=8*L+2*D],g=A[O+1],y=A[O+10]-p,g=-g-(C=A[O+11]-g),f=E[O]*S,m=E[O+11]*I,v=(E[O+10]-E[O])*S,_=(E[O+1]-E[O+11])*I,v>0&&_>0&&y>0&&C>0&&d.drawImage(b,f,m,v,_,p,g,y,C);cc.g_NumberOfDraws+=9}else{var F=Math.floor(e._vertCount/4);for(R=0,O=0;R<F;R++)p=A[O],g=A[O+1],y=A[O+6]-p,g=-g-(C=A[O+7]-g),f=E[O]*S,m=E[O+7]*I,v=(E[O+6]-E[O])*S,_=(E[O+1]-E[O+7])*I,this._textureToRender._pattern!==""?(u.setFillStyle(d.createPattern(b,this._textureToRender._pattern)),d.fillRect(p,g,y,C)):v>0&&_>0&&y>0&&C>0&&d.drawImage(b,f,m,v,_,p,g,y,C),O+=8;cc.g_NumberOfDraws+=F}}}}},{}],172:[function(T,N,z){cc.gl,cc.Scale9Sprite.WebGLRenderCmd=function(t){this._rootCtor(t),this._node.loaded()?this._needDraw=!0:this._needDraw=!1,this.vertexType=cc.renderer.VertexType.QUAD,this._dirty=!1,this._shaderProgram=cc.shaderCache.programForKey(cc.macro.SHADER_SPRITE_POSITION_TEXTURECOLOR)};var o=cc.Scale9Sprite,s=o.WebGLRenderCmd.prototype=Object.create(_ccsg.Node.WebGLRenderCmd.prototype);s.constructor=o.WebGLRenderCmd,s._uploadSliced=function(t,e,r,a,c,h,u){for(var d,f=0;f<3;++f)for(var m=0;m<3;++m)d=8*f+2*m,c[u]=t[d],c[u+1]=t[d+1],c[u+2]=a,h[u+3]=r,c[u+4]=e[d],c[u+5]=e[d+1],c[u+=6]=t[d+2],c[u+1]=t[d+3],c[u+2]=a,h[u+3]=r,c[u+4]=e[d+2],c[u+5]=e[d+3],c[u+=6]=t[d+8],c[u+1]=t[d+9],c[u+2]=a,h[u+3]=r,c[u+4]=e[d+8],c[u+5]=e[d+9],c[u+=6]=t[d+10],c[u+1]=t[d+11],c[u+2]=a,h[u+3]=r,c[u+4]=e[d+10],c[u+5]=e[d+11],u+=6;return 36},s.updateTransform=function(t){this.originUpdateTransform(t),this._node._rebuildQuads()},s._doCulling=function(){var t=this._node,e=cc.visibleRect;this._cameraFlag>0&&(e=cc.Camera.main.visibleRect);var r=e.left.x,a=e.right.x,c=e.top.y,h=e.bottom.y,u=t._vertices,d=t._corner,f=d[0],m=d[1],v=d[2],_=d[3],p=u[f],g=u[m],y=u[v],C=u[_],S=u[f+1],I=u[m+1],b=u[v+1],A=u[_+1];this._needDraw=!((p-r&g-r&y-r&C-r)>>31||(a-p&a-g&a-y&a-C)>>31||(S-h&I-h&b-h&A-h)>>31||(c-S&c-I&c-b&c-A)>>31)},s.uploadData=function(t,e,r){var a=this._node;if(this._displayedOpacity===0)return 0;a._quadsDirty&&a._rebuildQuads(),a._distortionOffset&&this._shaderProgram===o.WebGLRenderCmd._distortionProgram&&(this._shaderProgram.use(),this._shaderProgram.setUniformLocationWith2f(o.WebGLRenderCmd._distortionOffset,a._distortionOffset.x,a._distortionOffset.y),this._shaderProgram.setUniformLocationWith2f(o.WebGLRenderCmd._distortionTiling,a._distortionTiling.x,a._distortionTiling.y),cc.renderer._breakBatch());var c,h=this._displayedOpacity,u=this._displayedColor._val;if(a._opacityModifyRGB){var d=h/255,f=this._displayedColor.r*d,m=this._displayedColor.g*d;c=(h<<24>>>0)+(this._displayedColor.b*d<<16)+(m<<8)+f}else c=(h<<24>>>0)+((65280&u)<<8)+((16711680&u)>>8)+(u>>>24);var v=a._vertexZ,_=a._vertices,p=a._uvs,g=o.RenderingType,y=r,C=0;switch(a._renderingType){case g.SIMPLE:case g.TILED:case g.FILLED:case g.MESH:C=this._node._vertCount;for(var S=0,I=0;S<C;S++,I+=2)t[y]=_[I],t[y+1]=_[I+1],t[y+2]=v,e[y+3]=c,t[y+4]=p[I],t[y+5]=p[I+1],y+=6;break;case g.SLICED:C=this._uploadSliced(_,p,c,v,t,e,y)}return a._renderingType===g.MESH?this.vertexType=cc.renderer.VertexType.CUSTOM:a._renderingType===g.FILLED&&a._fillType===o.FillType.RADIAL?this.vertexType=cc.renderer.VertexType.TRIANGLE:this.vertexType=cc.renderer.VertexType.QUAD,C},s.uploadIndexData=function(t,e,r){var a=this._node._meshPolygonInfo;if(!a)return 0;for(var c=a.triangles.indices,h=c.length,u=0;u<h;u++)t[e+u]=r+c[u];return h},s.setState=function(t){t===o.state.NORMAL?this._shaderProgram=cc.shaderCache.programForKey(cc.macro.SHADER_SPRITE_POSITION_TEXTURECOLOR):t===o.state.GRAY?this._shaderProgram=cc.Scale9Sprite.WebGLRenderCmd._getGrayShaderProgram():t===o.state.DISTORTION&&(this._shaderProgram=cc.Scale9Sprite.WebGLRenderCmd._getDistortionProgram())},o.WebGLRenderCmd._grayShaderProgram=null,o.WebGLRenderCmd._getGrayShaderProgram=function(){var t=o.WebGLRenderCmd._grayShaderProgram;return t||((t=new cc.GLProgram).initWithVertexShaderByteArray(cc.PresetShaders.SPRITE_POSITION_TEXTURE_COLOR_VERT,cc.Scale9Sprite.WebGLRenderCmd._grayShaderFragment),t.addAttribute(cc.macro.ATTRIBUTE_NAME_POSITION,cc.macro.VERTEX_ATTRIB_POSITION),t.addAttribute(cc.macro.ATTRIBUTE_NAME_COLOR,cc.macro.VERTEX_ATTRIB_COLOR),t.addAttribute(cc.macro.ATTRIBUTE_NAME_TEX_COORD,cc.macro.VERTEX_ATTRIB_TEX_COORDS),t.link(),t.updateUniforms(),o.WebGLRenderCmd._grayShaderProgram=t,t)},o.WebGLRenderCmd._grayShaderFragment=`precision lowp float;
varying vec4 v_fragmentColor;
varying vec2 v_texCoord;
void main()
{
vec4 c = v_fragmentColor * texture2D(CC_Texture0, v_texCoord);
float gray = 0.2126*c.r + 0.7152*c.g + 0.0722*c.b;
gl_FragColor = vec4(gray, gray, gray, c.a);
}`,o.WebGLRenderCmd._distortionProgram=null,o.WebGLRenderCmd._getDistortionProgram=function(){var t=o.WebGLRenderCmd._distortionProgram;return t||((t=new cc.GLProgram).initWithVertexShaderByteArray(cc.PresetShaders.SPRITE_POSITION_TEXTURE_COLOR_VERT,n.fShader),t.addAttribute(cc.macro.ATTRIBUTE_NAME_POSITION,cc.macro.VERTEX_ATTRIB_POSITION),t.addAttribute(cc.macro.ATTRIBUTE_NAME_COLOR,cc.macro.VERTEX_ATTRIB_COLOR),t.addAttribute(cc.macro.ATTRIBUTE_NAME_TEX_COORD,cc.macro.VERTEX_ATTRIB_TEX_COORDS),t.link(),t.updateUniforms(),o.WebGLRenderCmd._distortionProgram=t,o.WebGLRenderCmd._distortionOffset=t.getUniformLocationForName("u_offset"),o.WebGLRenderCmd._distortionTiling=t.getUniformLocationForName("u_offset_tiling"),t)};var n={shaderKey:"cc.Sprite.Shader.Distortion",fShader:`precision lowp float;
varying vec4 v_fragmentColor;
varying vec2 v_texCoord;
uniform vec2 u_offset;
uniform vec2 u_offset_tiling;
const float PI = 3.14159265359;
void main()
{
float halfPI = 0.5 * PI;
float maxFactor = sin(halfPI);
vec2 uv = v_texCoord;
vec2 xy = 2.0 * uv.xy - 1.0;
float d = length(xy);
if (d < (2.0-maxFactor)) {
d = length(xy * maxFactor);
float z = sqrt(1.0 - d * d);
float r = atan(d, z) / PI;
float phi = atan(xy.y, xy.x);
uv.x = r * cos(phi) + 0.5;
uv.y = r * sin(phi) + 0.5;
} else {
discard;
}
uv = uv * u_offset_tiling + u_offset;
uv = fract(uv);
gl_FragColor = v_fragmentColor * texture2D(CC_Texture0, uv);
}`}},{}],173:[function(T,N,z){cc.SpriteBatchNode=_ccsg.Node.extend({_blendFunc:null,_texture:null,_className:"SpriteBatchNode",ctor:function(s){_ccsg.Node.prototype.ctor.call(this),this._blendFunc=new cc.BlendFunc(cc.macro.BLEND_SRC,cc.macro.BLEND_DST);var n;cc.js.isString(s)?(n=cc.textureCache.getTextureForKey(s))||(n=cc.textureCache.addImage(s)):s instanceof cc.Texture2D&&(n=s),n&&this.initWithTexture(n)},initWithFile:function(s){var n=cc.textureCache.getTextureForKey(s)||cc.textureCache.addImage(s);return this.initWithTexture(n)},removeChildAtIndex:function(s,n){this.removeChild(this._children[s],n)},setBlendFunc:function(s,n){this._blendFunc=n===void 0?s:{src:s,dst:n}},getBlendFunc:function(){return new cc.BlendFunc(this._blendFunc.src,this._blendFunc.dst)},updateQuadFromSprite:function(s,n){cc.assertID(s,2623),s instanceof _ccsg.Sprite?(s.dirty=!0,s._renderCmd.transform(this._renderCmd,!0)):cc.log(2616)},appendChild:function(s){this.sortAllChildren(),this._children[this._children.length-1]._localZOrder,this.addChild(s.lastLocalZOrder+1)},initWithTexture:function(s){return this.setTexture(s),!0},getTexture:function(){return this._texture},setTexture:function(s){if(this._texture=s,s.loaded){var n,t=this._children,e=t.length;for(n=0;n<e;++n)t[n].setTexture(s)}else s.addEventListener("load",function(){var r,a=this._children,c=a.length;for(r=0;r<c;++r)a[r].setTexture(s)},this)},setShaderProgram:function(s){this._renderCmd.setShaderProgram(s);var n,t=this._children,e=t.length;for(n=0;n<e;++n)t[n].setShaderProgram(s)},addChild:function(s,n,t){cc.assertID(s!==void 0,2614),this._isValidChild(s)&&(n=n===void 0?s.zIndex:n,t=t===void 0?s.tag:t,_ccsg.Node.prototype.addChild.call(this,s,n,t),this._renderCmd._shaderProgram&&(s.shaderProgram=this._renderCmd._shaderProgram))},_isValidChild:function(s){return s instanceof _ccsg.Sprite?s.texture===this._texture||(cc.logID(2619),!1):(cc.logID(2618),!1)}});var o=cc.SpriteBatchNode.prototype;cc.defineGetterSetter(o,"texture",o.getTexture,o.setTexture),cc.defineGetterSetter(o,"shaderProgram",o.getShaderProgram,o.setShaderProgram)},{}],174:[function(T,N,z){var o=T("../event/event-target");cc.SpriteFrame=cc.Class({name:"cc.SpriteFrame",extends:T("../assets/CCAsset"),mixins:[o],properties:{_textureFilenameSetter:{set:function(n){this._textureFilename=n,n&&this._loadTexture()}}},ctor:function(){var n=arguments[0],t=arguments[1],e=arguments[2],r=arguments[3],a=arguments[4];this._rect=null,this._offset=null,this._originalSize=null,this._rotated=!1,this.insetTop=0,this.insetBottom=0,this.insetLeft=0,this.insetRight=0,this._texture=null,this._textureFilename="",this._textureLoaded=!1,n!==void 0&&this.initWithTexture(n,t,e,r,a)},textureLoaded:function(){return this._textureLoaded},addLoadedEventListener:function(n,t){this.once("load",n,t)},isRotated:function(){return this._rotated},setRotated:function(n){this._rotated=n},getRect:function(){return cc.rect(this._rect)},setRect:function(n){this._rect=n},getOriginalSize:function(){return cc.size(this._originalSize)},setOriginalSize:function(n){this._originalSize?(this._originalSize.width=n.width,this._originalSize.height=n.height):this._originalSize=cc.size(n)},getTexture:function(){return this._texture},_refreshTexture:function(n){var t=this;if(t._texture!==n){var e=function(){if(t._texture){t._textureLoaded=!0;var c=n.width,h=n.height;if(t._rotated&&cc._renderType===cc.game.RENDER_TYPE_CANVAS){var u=n.getHtmlElementObj();u=_ccsg.Sprite.CanvasRenderCmd._cutRotateImageToCanvas(u,t.getRect());var d=new cc.Texture2D;d.initWithElement(u),d.handleLoadedTexture(),t._texture=d,t._rotated=!1,c=t._texture.width,h=t._texture.height,t.setRect(cc.rect(0,0,c,h))}t._rect?t._checkRect(t._texture):t.setRect(cc.rect(0,0,c,h)),t._originalSize||t.setOriginalSize(cc.size(c,h)),t._offset||t.setOffset(cc.v2(0,0)),t.emit("load")}},r=e,a=n.loaded;this._textureLoaded=a,this._texture=n,a?e():n.once("load",e)}},getOffset:function(){return cc.v2(this._offset)},setOffset:function(n){this._offset=cc.v2(n)},clone:function(){return new cc.SpriteFrame(this._texture||this._textureFilename,this._rect,this._rotated,this._offset,this._originalSize)},setTexture:function(n,t,e,r,a){t?this.setRect(t):this._rect=null,r?this.setOffset(r):this._offset=null,a?this.setOriginalSize(a):this._originalSize=null,this._rotated=e||!1;var c=n;return cc.js.isString(c)?(this._textureFilename=c,this._loadTexture()):c instanceof cc.Texture2D&&this._refreshTexture(c),!0},_loadTexture:function(){if(this._textureFilename){var n=cc.textureCache.addImage(this._textureFilename);this._refreshTexture(n)}},ensureLoadTexture:function(){this._texture||this._loadTexture()},clearTexture:function(){this._textureLoaded=!1,this._texture=null},_checkRect:function(n){var t=this._rect,e=t.x,r=t.y;this._rotated?(e+=t.height,r+=t.width):(e+=t.width,r+=t.height),e>n.getPixelWidth()&&cc.errorID(3300,n.url+"/"+this.name),r>n.getPixelHeight()&&cc.errorID(3400,n.url+"/"+this.name)},_serialize:!1,_deserialize:function(n,t){var e=n.rect;e&&this.setRect(new cc.Rect(e[0],e[1],e[2],e[3])),n.offset&&this.setOffset(new cc.Vec2(n.offset[0],n.offset[1])),n.originalSize&&this.setOriginalSize(new cc.Size(n.originalSize[0],n.originalSize[1])),this._rotated=n.rotated===1,this._name=n.name;var r=n.capInsets;r&&(this.insetLeft=r[0],this.insetTop=r[1],this.insetRight=r[2],this.insetBottom=r[3]);var a=n.texture;if(a){var c=t.customEnv&&t.customEnv.deferredLoadRaw?"_textureFilename":"_textureFilenameSetter";t.result.push(this,c,a)}}});var s=cc.SpriteFrame.prototype;s.copyWithZone=s.clone,s.copy=s.clone,s.initWithTexture=s.setTexture},{"../assets/CCAsset":43,"../event/event-target":97}],175:[function(T,N,z){var o=T("../event/event-target"),s=T("../platform/CCSys"),n=(T("../platform/js"),T("../utils/misc"),T("../CCGame"));T("../platform/_CCClass"),T("../platform/CCClass");var t=[{format:6407,internalFormat:6407,pixelType:33635},{format:6408,internalFormat:6408,pixelType:32820},{format:6408,internalFormat:6408,pixelType:32819},{format:6407,internalFormat:6407,pixelType:5121},{format:6408,internalFormat:6408,pixelType:5121},{format:6406,internalFormat:6406,pixelType:5121},{format:6409,internalFormat:6409,pixelType:5121},{format:6410,internalFormat:6410,pixelType:5121}],e=cc.Enum({RGB565:0,RGB5A1:1,RGBA4444:2,RGB888:3,RGBA8888:4,A8:5,I8:6,AI8:7}),r=cc.Enum({REPEAT:10497,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648}),a=cc.Enum({LINEAR:9729,NEAREST:9728}),c=cc.Class({name:"cc.Texture2D",extends:T("../assets/CCRawAsset"),mixins:[o],properties:{_hasMipmap:!1,_format:e.RGBA8888,_compressed:!1,_premultiplyAlpha:!1,_minFilter:a.LINEAR,_magFilter:a.LINEAR,_wrapS:r.CLAMP_TO_EDGE,_wrapT:r.CLAMP_TO_EDGE},statics:{PixelFormat:e,WrapMode:r,Filter:a},ctor:function(u){this.url=null,this.loaded=!1,this.width=0,this.height=0,this._image=null,cc._renderType===n.RENDER_TYPE_CANVAS?(this._pattern="",this._grayElementObj=null,this._backupElement=null,this._isGray=!1):cc._renderType===n.RENDER_TYPE_WEBGL&&(this._gl=u||cc._renderContext,this._glID=null)},update:function(u){},getPixelWidth:function(){return this.width},getPixelHeight:function(){return this.height},getContentSize:function(){return cc.size(this.width,this.height)},getContentSizeInPixels:function(){return this.getContentSize()},initWithElement:function(u){u&&(this._image=u,this.width=u.width,this.height=u.height,this.loaded=!0)},initWithData:function(u,d,f,m,v){return!1},initWithImage:function(u){return!1},getHtmlElementObj:function(){return this._image},isLoaded:function(){return this.loaded},handleLoadedTexture:function(){if(this._image&&this._image.width&&this._image.height){var u=this._image;this.width=u.width,this.height=u.height,this.loaded=!0,this.emit("load")}},description:function(){return"<cc.Texture2D | Name = "+this.url+" | Dimensions = "+this.width+" x "+this.height+">"},releaseTexture:function(){this._gl&&this._glID!==null&&(this._gl.deleteTexture(this._glID),this._glID=null)},getPixelFormat:function(){return this._format},hasPremultipliedAlpha:function(){return this._premultiplyAlpha||!1},hasMipmaps:function(){return this._hasMipmap||!1},setTexParameters:function(u,d,f,m){d!==void 0&&(u={minFilter:u,magFilter:d,wrapS:f,wrapT:m}),u.wrapS!==r.REPEAT||u.wrapT!==r.REPEAT?u.wrapS!==r.REPEAT?u.wrapT!==r.REPEAT?this._pattern="":this._pattern="repeat-y":this._pattern="repeat-x":this._pattern="repeat"},setAntiAliasTexParameters:function(){},setAliasTexParameters:function(){}}),h=c.prototype;h.pixelFormat,cc.defineGetterSetter(h,"pixelFormat",h.getPixelFormat),h.pixelWidth,cc.defineGetterSetter(h,"pixelWidth",h.getPixelWidth),h.pixelHeight,cc.defineGetterSetter(h,"pixelHeight",h.getPixelHeight),n.once(n.EVENT_RENDERER_INITED,function(){if(cc._renderType===n.RENDER_TYPE_CANVAS){var u=function(f,m,v){if(f===null)return null;v=v||document.createElement("canvas"),m=m||cc.rect(0,0,f.width,f.height),v.width=m.width,v.height=m.height;var _=v.getContext("2d");_.drawImage(f,m.x,m.y,m.width,m.height,0,0,m.width,m.height);for(var p=_.getImageData(0,0,m.width,m.height),g=p.data,y=0,C=g.length;y<C;y+=4)g[y]=g[y+1]=g[y+2]=.34*g[y]+.5*g[y+1]+.16*g[y+2];return _.putImageData(p,0,0),v};h._generateTextureCacheForColor=function(){if(this.channelCache)return this.channelCache;var f=[document.createElement("canvas"),document.createElement("canvas"),document.createElement("canvas"),document.createElement("canvas")];return function(m,v){var _=m.width,p=m.height;v[0].width=_,v[0].height=p,v[1].width=_,v[1].height=p,v[2].width=_,v[2].height=p,v[3].width=_,v[3].height=p;var g=v[3].getContext("2d");g.drawImage(m,0,0);for(var y,C=g.getImageData(0,0,_,p).data,S=0;S<4;S++){for(var I=(y=v[S].getContext("2d")).getImageData(0,0,_,p),b=I.data,A=0;A<C.length;A+=4)b[A]=S===0?C[A]:0,b[A+1]=S===1?C[A+1]:0,b[A+2]=S===2?C[A+2]:0,b[A+3]=C[A+3];y.putImageData(I,0,0)}m.onload=null}(this._image,f),this.channelCache=f},h._switchToGray=function(f){this.loaded&&this._isGray!==f&&(this._isGray=f,this._isGray?(this._backupElement=this._image,this._grayElementObj||(this._grayElementObj=u(this._image)),this._image=this._grayElementObj):this._backupElement!==null&&(this._image=this._backupElement))},h._generateGrayTexture=function(){if(!this.loaded)return null;var f=u(this._image),m=new c;return m.initWithElement(f),m.handleLoadedTexture(),m},h._generateColorTexture=s._supportCanvasNewBlendModes?function(f,m,v,_,p){var g=!1;p?g=!0:p=document.createElement("canvas");var y=this._image;if(_||(_=cc.rect(0,0,y.width,y.height)),p.width=_.width,p.height=_.height,_.width&&_.height){var C=p.getContext("2d");C.globalCompositeOperation="source-over",C.fillStyle="rgb("+(0|f)+","+(0|m)+","+(0|v)+")",C.fillRect(0,0,_.width,_.height),C.globalCompositeOperation="multiply",C.drawImage(y,_.x,_.y,_.width,_.height,0,0,_.width,_.height),C.globalCompositeOperation="destination-atop",C.drawImage(y,_.x,_.y,_.width,_.height,0,0,_.width,_.height)}if(g)return p;var S=new c;return S.initWithElement(p),S.handleLoadedTexture(),S}:function(f,m,v,_,p){var g=!1;p?g=!0:p=document.createElement("canvas");var y=this._image;if(_||(_=cc.rect(0,0,y.width,y.height)),p.width=_.width,p.height=_.height,_.width&&_.height){var C=p.getContext("2d");C.drawImage(y,_.x,_.y,_.width,_.height,0,0,_.width,_.height);var S=C.getImageData(0,0,p.width,p.height),I=S.data;f/=255,m/=255,v/=255;for(var b=0;b<I.length;b+=4)I[b]=I[b]*f,I[b+1]=I[b+1]*m,I[b+2]=I[b+2]*v;C.putImageData(S,0,0)}if(g)return p;var A=new c;return A.initWithElement(p),A.handleLoadedTexture(),A}}else if(cc._renderType===n.RENDER_TYPE_WEBGL){var d;(function(){function f(v){return!(v&v-1||!v)}function m(){for(var v in d)d[v]=void 0;return d}d={width:void 0,height:void 0,minFilter:void 0,magFilter:void 0,wrapS:void 0,wrapT:void 0,format:void 0,mipmap:void 0,image:void 0,premultiplyAlpha:void 0},h.update=function(v){var _=this._hasMipmap,p=this._gl,g=!1;v&&(v.width!==void 0&&(this.width=v.width),v.height!==void 0&&(this.height=v.height),v.minFilter!==void 0&&(this._minFilter=v.minFilter),v.magFilter!==void 0&&(this._magFilter=v.magFilter),v.wrapS!==void 0&&(this._wrapS=v.wrapS),v.wrapT!==void 0&&(this._wrapT=v.wrapT),v.format!==void 0&&(this._format=v.format,g=!0),v.premultiplyAlpha!==void 0&&(this._premultiplyAlpha=v.premultiplyAlpha,g=!0),v.image!==void 0&&(this._image=v.image,g=!0),v.mipmap!==void 0&&(_=this._hasMipmap=v.mipmap)),this._image&&(g?(this.releaseTexture(),this._glID=p.createTexture(),p.activeTexture(p.TEXTURE0),p.bindTexture(p.TEXTURE_2D,this._glID),this._setImage(this._image,this.width,this.height,function(y){var C=t[y];return cc.assertID(C,3113),C}(this._format),this._premultiplyAlpha)):(p.activeTexture(p.TEXTURE0),p.bindTexture(p.TEXTURE_2D,this._glID)),this._setTexInfo(),_&&(cc.assertID(f(this.width)&&f(this.height),3117),p.hint(p.GENERATE_MIPMAP_HINT,p.NICEST),p.generateMipmap(p.TEXTURE_2D)),p.bindTexture(p.TEXTURE_2D,null))},h._setImage=function(v,_,p,g,y){var C=this._gl;if(C.pixelStorei(C.UNPACK_PREMULTIPLY_ALPHA_WEBGL,y),s.platform===s.QQ_PLAY||v instanceof HTMLCanvasElement&&!(v instanceof Uint8Array)||v instanceof HTMLImageElement||v instanceof HTMLVideoElement){if(s.platform===s.QQ_PLAY&&v instanceof Uint8Array)return void C.texImage2D(C.TEXTURE_2D,0,g.internalFormat,_,p,0,g.format,g.pixelType,v);C.texImage2D(C.TEXTURE_2D,0,g.internalFormat,g.format,g.pixelType,v)}else C.texImage2D(C.TEXTURE_2D,0,g.internalFormat,_,p,0,g.format,g.pixelType,v)},h._setTexInfo=function(){var v=this._gl;f(this.width)&&f(this.height)||this._wrapS===r.CLAMP_TO_EDGE&&this._wrapT===r.CLAMP_TO_EDGE||(cc.warnID(3116),this._wrapS=r.CLAMP_TO_EDGE,this._wrapT=r.CLAMP_TO_EDGE),this._minFilter===a.LINEAR?v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MIN_FILTER,this._hasMipmap?v.LINEAR_MIPMAP_NEAREST:v.LINEAR):v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MIN_FILTER,this._hasMipmap?v.NEAREST_MIPMAP_NEAREST:v.NEAREST),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MAG_FILTER,this._magFilter),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_S,this._wrapS),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_T,this._wrapT)},h.initWithData=function(v,_,p,g,y){y&&cc.warnID(3118);var C=m();return C.image=v,C.format=_,C.width=p,C.height=g,this.update(C),this.width=p,this.height=g,this.loaded=!0,this.emit("load"),!0},h.initWithElement=function(v){if(v&&v.width!==0&&v.height!==0)return this._image=v,!0},h.handleLoadedTexture=function(v){if(this._image&&this._image.width&&this._image.height){var _=m();_.image=this._image,_.format=e.RGBA8888,_.width=this._image.width,_.height=this._image.height,_.premultiplyAlpha=!!v;var p=cc.view._antiAliasEnabled?a.LINEAR:a.NEAREST;_.minFilter=_.magFilter=p,this.update(_),this.loaded=!0,this.emit("load")}},h.setTexParameters=function(v,_,p,g){_!==void 0&&(v={minFilter:v,magFilter:_,wrapS:p,wrapT:g}),this.update(v)},h.setAntiAliasTexParameters=function(){var v=m();v.minFilter=a.LINEAR,v.magFilter=a.LINEAR,this.update(v)},h.setAliasTexParameters=function(){var v=m();v.minFilter=a.NEAREST,v.magFilter=a.NEAREST,this.update(v)}})()}}),cc.Texture2D=N.exports=c},{"../CCGame":39,"../assets/CCRawAsset":49,"../event/event-target":97,"../platform/CCClass":135,"../platform/CCSys":144,"../platform/_CCClass":147,"../platform/js":156,"../utils/misc":185}],176:[function(T,N,z){var o=T("../CCGame"),s=T("./CCTexture2D"),n={_textures:{},_textureColorsCache:{},_textureKeySeq:0|1e3*Math.random(),handleLoadedTexture:null,description:function(){return"<TextureCache | Number of textures = "+this._textures.length+">"},textureForKey:function(t){return cc.logID(3002),this.getTextureForKey(t)},getTextureForKey:function(t){return this._textures[t]},getKeyByTexture:function(t){for(var e in this._textures)if(this._textures[e]===t)return e;return null},_generalTextureKey:function(t){return"_textureKey_"+t},getTextureColors:function(t){var e=t._image,r=this.getKeyByTexture(e);return r||(r=e instanceof HTMLImageElement?e.src:this._generalTextureKey(t.__instanceId)),this._textureColorsCache[r]||(this._textureColorsCache[r]=t._generateTextureCacheForColor()),this._textureColorsCache[r]},getAllTextures:function(){var t=[];for(var e in this._textures){var r=this._textures[e];t.push(r)}return t},removeAllTextures:function(){var t=this._textures;for(var e in t)t[e]&&t[e].releaseTexture();this._textures={}},removeTexture:function(t){if(t){var e=this._textures;for(var r in e)e[r]===t&&(e[r].releaseTexture(),delete e[r])}},removeTextureForKey:function(t){if(typeof t=="string"){var e=this._textures;e[t]&&(e[t].releaseTexture(),delete e[t])}},addImage:null,addImageAsync:null,cacheImage:function(t,e){if(cc.assertID(t,3009),e instanceof s)this._textures[t]=e;else{var r=new s;r.initWithElement(e),r.handleLoadedTexture(),this._textures[t]=r}},dumpCachedTextureInfo:function(){var t=0,e=0,r=this._textures;for(var a in r){var c=r[a];t++,c.getHtmlElementObj()instanceof HTMLImageElement?cc.logID(3005,a,c.getHtmlElementObj().src,c.getPixelWidth(),c.getPixelHeight()):cc.logID(3006,a,c.getPixelWidth(),c.getPixelHeight()),e+=c.getPixelWidth()*c.getPixelHeight()*4}var h=this._textureColorsCache;for(a in h){var u=h[a];for(var d in u){var f=u[d];t++,cc.logID(3006,a,f.width,f.height),e+=f.width*f.height*4}}cc.logID(3007,t,e/1024,(e/1048576).toFixed(2))},_clear:function(){this._textures={},this._textureColorsCache={},this._textureKeySeq=0|1e3*Math.random()}};o.once(o.EVENT_RENDERER_INITED,function(){var t=n;cc._renderType===o.RENDER_TYPE_CANVAS?(t.handleLoadedTexture=function(e){var r=this._textures,a=r[e];a||(cc.assertID(e,3009),(a=r[e]=new s).url=e),a.handleLoadedTexture()},t.addImage=function(e,r,a){cc.assertID(e,3103);var c=this._textures,h=c[e];return h?h.isLoaded()?(r&&r.call(a,h),h):(h.once("load",function(){r&&r.call(a,h)},a),h):(h=c[e]=new s,h.url=e,cc.loader.load(e,function(u,d){if(u)return r&&r.call(a,u||new Error("Unknown error"));n.handleLoadedTexture(e),r&&r.call(a,h)}),h)},t.addImageAsync=t.addImage):cc._renderType===o.RENDER_TYPE_WEBGL&&(t.handleLoadedTexture=function(e){var r,a=this._textures;(r=a[e])||(cc.assertID(e,3009),(r=a[e]=new s).url=e),r.handleLoadedTexture()},t.addImage=function(e,r,a){cc.assertID(e,3112);var c=this._textures,h=c[e];return h?h.isLoaded()?(r&&r.call(a,h),h):(h.once("load",function(){r&&r.call(a,h)},a),h):(h=c[e]=new s,h.url=e,cc.loader.load(e,function(u,d){if(u)return r&&r.call(a,u||new Error("Unknown error"));n.handleLoadedTexture(e),r&&r.call(a,h)}),h)},t.addImageAsync=t.addImage)}),cc.textureCache=N.exports=n},{"../CCGame":39,"./CCTexture2D":175}],177:[function(T,N,z){T("./CCTexture2D"),T("./CCTextureCache")},{"./CCTexture2D":175,"./CCTextureCache":176}],178:[function(T,N,z){T("../platform/CCSys");var o=/(\.[^\.\/\?\\]*)(\?.*)?$/,s=/((.*)(\/|\\|\\\\))?(.*?\..*$)?/,n=/[^\.\/]+\/\.\.\//;cc.path={join:function(){for(var t=arguments.length,e="",r=0;r<t;r++)e=(e+(e===""?"":"/")+arguments[r]).replace(/(\/|\\\\)$/,"");return e},extname:function(t){var e=o.exec(t);return e?e[1]:""},mainFileName:function(t){if(t){var e=t.lastIndexOf(".");if(e!==-1)return t.substring(0,e)}return t},basename:function(t,e){var r=t.indexOf("?");r>0&&(t=t.substring(0,r));var a=/(\/|\\\\)([^(\/|\\\\)]+)$/g.exec(t.replace(/(\/|\\\\)$/,""));if(!a)return null;var c=a[2];return e&&t.substring(t.length-e.length).toLowerCase()===e.toLowerCase()?c.substring(0,c.length-e.length):c},dirname:function(t){var e=s.exec(t);return e?e[2]:""},changeExtname:function(t,e){e=e||"";var r=t.indexOf("?"),a="";return r>0&&(a=t.substring(r),t=t.substring(0,r)),(r=t.lastIndexOf("."))<0?t+e+a:t.substring(0,r)+e+a},changeBasename:function(t,e,r){if(e.indexOf(".")===0)return this.changeExtname(t,e);var a=t.indexOf("?"),c="",h=r?this.extname(t):"";return a>0&&(c=t.substring(a),t=t.substring(0,a)),a=t.lastIndexOf("/"),a=a<=0?0:a+1,t.substring(0,a)+e+h+c},_normalize:function(t){var e=t=String(t);do e=t,t=t.replace(n,"");while(e.length!==t.length);return t},sep:cc.sys.os===cc.sys.OS_WINDOWS?"\\":"/",stripSep:function(t){return t.replace(/[\/\\]$/,"")}},N.exports=cc.path},{"../platform/CCSys":144}],179:[function(T,N,z){function o(){a("frame").start(),a("logic").start()}function s(){cc.director.isPaused()?a("frame").start():a("logic").end(),a("render").start()}function n(){a("render").end(),a("draws").value=cc.g_NumberOfDraws,a("frame").end(),a("fps").frame(),a().tick()}var t=T("../../../external/pstats/pstats"),e=T("../platform/CCMacro"),r=document.createElement("div");r.id="fps";var a=null,c=!1;cc.profiler=N.exports={isShowingStats:function(){return c},hideStats:function(){c&&(r.parentElement===document.body&&document.body.removeChild(r),cc.director.off(cc.Director.EVENT_BEFORE_UPDATE,o),cc.director.off(cc.Director.EVENT_AFTER_VISIT,s),cc.director.off(cc.Director.EVENT_AFTER_DRAW,n),c=!1)},showStats:function(){c||(a||(a=t.new(r,{showGraph:!1,values:{frame:{desc:"Frame time (ms)",min:0,max:50,average:500},fps:{desc:"Framerate (FPS)",below:30,average:500},draws:{desc:"Draw call"},logic:{desc:"Game Logic (ms)",min:0,max:50,average:500,color:"#080"},render:{desc:"Renderer (ms)",min:0,max:50,average:500,color:"#f90"},mode:{desc:cc._renderType===cc.game.RENDER_TYPE_WEBGL?"WebGL":"Canvas",min:1}},css:".pstats {left: "+e.DIRECTOR_STATS_POSITION.x+"px; bottom: "+e.DIRECTOR_STATS_POSITION.y+"px;}"})),r.parentElement===null&&document.body.appendChild(r),cc.director.on(cc.Director.EVENT_BEFORE_UPDATE,o),cc.director.on(cc.Director.EVENT_AFTER_VISIT,s),cc.director.on(cc.Director.EVENT_AFTER_DRAW,n),c=!0)}}},{"../../../external/pstats/pstats":235,"../platform/CCMacro":140}],180:[function(T,N,z){function o(_){return _?typeof _=="string"?u.getClassByName(_):_:(cc.errorID(3804),null)}function s(_,p){if(p._sealed)for(var g=0;g<_._components.length;++g){var y=_._components[g];if(y.constructor===p)return y}else for(var C=0;C<_._components.length;++C){var S=_._components[C];if(S instanceof p)return S}return null}function n(_,p,g){if(p._sealed)for(var y=0;y<_._components.length;++y){var C=_._components[y];C.constructor===p&&g.push(C)}else for(var S=0;S<_._components.length;++S){var I=_._components[S];I instanceof p&&g.push(I)}}function t(_,p){for(var g=0;g<_.length;++g){var y=_[g],C=s(y,p);if(C||y._children.length>0&&(C=t(y._children,p)))return C}return null}function e(_,p,g){for(var y=0;y<_.length;++y){var C=_[y];n(C,p,g),C._children.length>0&&e(C._children,p,g)}}var r=T("../platform/CCObject").Flags,a=T("./misc"),c=T("../platform/id-generater"),h=T("../event-manager"),u=cc.js,d=r.Destroying,f=r.DontDestroy,m=new c("Node"),v=cc.Class({name:"cc._BaseNode",extends:cc.Object,mixins:[cc.EventTarget],properties:{_parent:null,_children:[],_tag:cc.macro.NODE_TAG_INVALID,_active:!0,_components:[],_prefab:null,_persistNode:{get:function(){return(this._objFlags&f)>0},set:function(_){_?this._objFlags|=f:this._objFlags&=~f}},name:{get:function(){return this._name},set:function(_){this._name=_}},_id:{default:"",editorOnly:!0},uuid:{get:function(){var _=this._id;return _||(_=this._id=m.getNewId()),_}},children:{get:function(){return this._children}},childrenCount:{get:function(){return this._children.length}},active:{get:function(){return this._active},set:function(_){if(_=!!_,this._active!==_){this._active=_;var p=this._parent;p&&p._activeInHierarchy&&cc.director._nodeActivator.activateNode(this,_)}}},activeInHierarchy:{get:function(){return this._activeInHierarchy}}},ctor:function(_){this._name=_!==void 0?_:"New Node",this._activeInHierarchy=!1,this.__instanceId=this._id||cc.ClassManager.getNewInstanceId(),this.__eventTargets=[]},getTag:function(){return this._tag},setTag:function(_){this._tag=_},getParent:function(){return this._parent},setParent:function(_){if(this._parent!==_){var p=this._parent;if(this._parent=_||null,this._onSetParent(_),_&&(h._setDirtyForNode(this),_._children.push(this),_.emit("child-added",this)),p){if(!(p._objFlags&d)){var g=p._children.indexOf(this);p._children.splice(g,1),p.emit("child-removed",this),this._onHierarchyChanged(p)}}else _&&this._onHierarchyChanged(null)}},init:function(){return!0},attr:function(_){u.mixin(this,_)},getChildByTag:function(_){var p=this._children;if(p!==null)for(var g=0;g<p.length;g++){var y=p[g];if(y&&y._tag===_)return y}return null},getChildByUuid:function(_){if(!_)return cc.log("Invalid uuid"),null;for(var p=this._children,g=0,y=p.length;g<y;g++)if(p[g]._id===_)return p[g];return null},getChildByName:function(_){if(!_)return cc.log("Invalid name"),null;for(var p=this._children,g=0,y=p.length;g<y;g++)if(p[g]._name===_)return p[g];return null},addChild:function(_){cc.assertID(_,1606),cc.assertID(_._parent===null,1605),_.setParent(this)},insertChild:function(_,p){_.parent=this,_.setSiblingIndex(p)},getSiblingIndex:function(){return this._parent?this._parent._children.indexOf(this):0},setSiblingIndex:function(_){if(this._parent){var p=this._parent._children;_=_!==-1?_:p.length-1;var g=p.indexOf(this);_!==g&&(p.splice(g,1),_<p.length?p.splice(_,0,this):p.push(this),this._onSiblingIndexChanged&&this._onSiblingIndexChanged(_))}},cleanup:function(){},removeFromParent:function(_){this._parent&&(_===void 0&&(_=!0),this._parent.removeChild(this,_))},removeChild:function(_,p){this._children.indexOf(_)>-1&&((p||p===void 0)&&_.cleanup(),_.parent=null)},removeChildByTag:function(_,p){_===cc.macro.NODE_TAG_INVALID&&cc.logID(1609);var g=this.getChildByTag(_);g?this.removeChild(g,p):cc.logID(1610,_)},removeAllChildren:function(_){var p=this._children;_===void 0&&(_=!0);for(var g=p.length-1;g>=0;g--){var y=p[g];y&&(_&&y.cleanup(),y.parent=null)}this._children.length=0},isChildOf:function(_){var p=this;do{if(p===_)return!0;p=p._parent}while(p);return!1},getComponent:function(_){var p=o(_);return p?s(this,p):null},getComponents:function(_){var p=o(_),g=[];return p&&n(this,p,g),g},getComponentInChildren:function(_){var p=o(_);return p?t(this._children,p):null},getComponentsInChildren:function(_){var p=o(_),g=[];return p&&(n(this,p,g),e(this._children,p,g)),g},_checkMultipleComp:!1,addComponent:function(_){var p;if(typeof _=="string"){if(!(p=u.getClassByName(_)))return cc.errorID(3807,_),cc._RFpeek()&&cc.errorID(3808,_),null}else{if(!_)return cc.errorID(3804),null;p=_}if(typeof p!="function")return cc.errorID(3809),null;if(!cc.isChildClassOf(p,cc.Component))return cc.errorID(3810),null;var g=p._requireComponent;if(g&&!this.getComponent(g)&&!this.addComponent(g))return null;var y=new p;return y.node=this,this._components.push(y),this._activeInHierarchy&&cc.director._nodeActivator.activateComp(y),y},_addComponentAt:!1,removeComponent:function(_){_?(_ instanceof cc.Component||(_=this.getComponent(_)),_&&_.destroy()):cc.errorID(3813)},_getDependComponent:!1,_removeComponent:function(_){if(_){if(!(this._objFlags&d)){var p=this._components.indexOf(_);p!==-1?this._components.splice(p,1):_.node!==this&&cc.errorID(3815)}}else cc.errorID(3814)},_disableChildComps:function(){var _,p=this._components.length;for(_=0;_<p;++_){var g=this._components[_];g._enabled&&cc.director._compScheduler.disableComp(g)}for(_=0,p=this._children.length;_<p;++_){var y=this._children[_];y._active&&y._disableChildComps()}},destroy:function(){cc.Object.prototype.destroy.call(this)&&this._activeInHierarchy&&this._disableChildComps()},destroyAllChildren:function(){for(var _=this._children,p=0;p<_.length;++p)_[p].destroy()},_onSetParent:function(_){},_onPostActivated:function(){},_onHierarchyChanged:function(_){var p=this._parent;!this._persistNode||p instanceof cc.Scene||cc.game.removePersistRootNode(this);var g=this._active&&!(!p||!p._activeInHierarchy);this._activeInHierarchy!==g&&cc.director._nodeActivator.activateNode(this,g)},_onBatchCreated:function(){var _=this._prefab;_&&_.sync&&!_._synced&&_.root===this&&PrefabHelper.syncWithPrefab(this);for(var p=this._children,g=0,y=p.length;g<y;g++)p[g]._onBatchCreated()},_instantiate:function(_){_||(_=cc.instantiate._clone(this,this));var p=this._prefab;return p&&this===p.root&&p.sync&&(_._prefab._synced=p._synced),_._parent=null,_._onBatchCreated(),_},_registerIfAttached:!1,_onPreDestroy:function(){var _,p;this._objFlags|=d;var g=this._parent,y=g&&g._objFlags&d,C=this._children;for(_=0,p=C.length;_<p;++_)C[_]._destroyImmediate();for(_=0,p=this._components.length;_<p;++_)this._components[_]._destroyImmediate();var S=this.__eventTargets;for(_=0,p=S.length;_<p;++_){var I=S[_];I&&I.targetOff(this)}if(S.length=0,this._persistNode&&cc.game.removePersistRootNode(this),!y&&g){var b=g._children.indexOf(this);g._children.splice(b,1),g.emit("child-removed",this)}return y},onRestore:!1});v.prototype._onPreDestroyBase=v.prototype._onPreDestroy,v.prototype._onHierarchyChangedBase=v.prototype._onHierarchyChanged,a.propertyDefine(v,["name","children","childrenCount"],{}),cc._BaseNode=N.exports=v},{"../event-manager":95,"../platform/CCObject":141,"../platform/id-generater":152,"./misc":185}],181:[function(T,N,z){var o=1e-6;N.exports={binarySearchEpsilon:function(s,n){for(var t=0,e=s.length-1,r=e>>>1;t<=e;r=t+e>>>1){var a=s[r];if(a>n+o)e=r-1;else{if(!(a<n-o))return r;t=r+1}}return~t}}},{}],182:[function(T,N,z){var o=T("./misc").BASE64_VALUES,s="0123456789abcdef".split(""),n=["","","",""],t=n.concat(n,"-",n,"-",n,"-",n,"-",n,n,n),e=t.map(function(r,a){return r==="-"?NaN:a}).filter(isFinite);N.exports=function(r){if(r.length!==22)return r;t[0]=r[0],t[1]=r[1];for(var a=2,c=2;a<22;a+=2){var h=o[r.charCodeAt(a)],u=o[r.charCodeAt(a+1)];t[e[c++]]=s[h>>2],t[e[c++]]=s[(3&h)<<2|u>>4],t[e[c++]]=s[15&u]}return t.join("")}},{"./misc":185}],183:[function(T,N,z){cc.find=N.exports=function(o,s){if(o==null)return cc.errorID(5600),null;if(!s){var n=cc.director.getScene();if(!n)return null;s=n}for(var t=s,e=o[0]!=="/"?0:1,r=o.split("/"),a=e;a<r.length;a++){var c=r[a],h=t._children;t=null;for(var u=0,d=h.length;u<d;++u){var f=h[u];if(f.name===c){t=f;break}}if(!t)return null}return t}},{}],184:[function(T,N,z){T("./CCPath"),T("./CCProfiler"),T("./find"),T("./mutable-forward-iterator")},{"./CCPath":178,"./CCProfiler":179,"./find":183,"./mutable-forward-iterator":186}],185:[function(T,N,z){var o=T("../platform/js"),s=T("../platform/CCSys"),n=z;n.propertyDefine=function(a,c,h){function u(p,g,y,C){var S=Object.getOwnPropertyDescriptor(p,g);if(S)S.get&&(p[y]=S.get),S.set&&C&&(p[C]=S.set);else{var I=p[y];cc.js.getset(p,g,I,p[C])}}for(var d,f=a.prototype,m=0;m<c.length;m++){var v=(d=c[m])[0].toUpperCase()+d.slice(1);u(f,d,"get"+v,"set"+v)}for(d in h){var _=h[d];u(f,d,_[0],_[1])}},n.NextPOT=function(a){return a-=1,a|=a>>1,a|=a>>2,a|=a>>4,a|=a>>8,(a|=a>>16)+1},n.imagePool=new o.Pool(function(a){return a instanceof HTMLImageElement&&(a.src=this._smallImg,!0)},10),n.imagePool.get=function(){return this._get()||new Image},n.imagePool._smallImg="data:image/gif;base64,R0lGODlhAQABAAAAACwAAAAAAQABAAA=",s.os!==s.OS_WINDOWS&&s.os!==s.OS_LINUX||s.browserType===s.BROWSER_TYPE_CHROME||n.imagePool.resize(0),n.BUILTIN_CLASSID_RE=/^(?:cc|dragonBones|sp|ccsg)\..+/;for(var t=new Array(123),e=0;e<123;++e)t[e]=64;for(var r=0;r<64;++r)t["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charCodeAt(r)]=r;n.BASE64_VALUES=t,n.pushToMap=function(a,c,h,u){var d=a[c];d?Array.isArray(d)?u?(d.push(d[0]),d[0]=h):d.push(h):a[c]=u?[h,d]:[d,h]:a[c]=h}},{"../platform/CCSys":144,"../platform/js":156}],186:[function(T,N,z){function o(n){this.i=0,this.array=n}var s=o.prototype;s.remove=function(n){var t=this.array.indexOf(n);t>=0&&this.removeAt(t)},s.removeAt=function(n){this.array.splice(n,1),n<=this.i&&--this.i},s.fastRemove=function(n){var t=this.array.indexOf(n);t>=0&&this.fastRemoveAt(t)},s.fastRemoveAt=function(n){var t=this.array;t[n]=t[t.length-1],--t.length,n<=this.i&&--this.i},s.push=function(n){this.array.push(n)},N.exports=o},{}],187:[function(T,N,z){cc._PrefabInfo=cc.Class({name:"cc.PrefabInfo",properties:{root:null,asset:null,fileId:"",sync:!1,_synced:{default:!1,serializable:!1}}}),N.exports={syncWithPrefab:function(o){var s=o._prefab;if(s._synced=!0,!s.asset)return cc.errorID(3701,o.name),void(o._prefab=null);var n=o._objFlags,t=o._parent,e=o._id,r=o._name,a=o._active,c=o._position.x,h=o._position.y,u=o._rotationX,d=o._rotationY,f=o._localZOrder,m=o._globalZOrder;cc.game._isCloning=!0,s.asset._doInstantiate(o),cc.game._isCloning=!1,o._objFlags=n,o._parent=t,o._id=e,o._prefab=s,o._name=r,o._active=a,o._position.x=c,o._position.y=h,o._rotationX=u,o._rotationY=d,o._localZOrder=f,o._globalZOrder=m}}},{}],188:[function(T,N,z){var o={removeSgNode:function(){var s=this._sgNode;if(s){var n=s._parent;n?n.removeChild(s):s.performRecursive(_ccsg.Node.performType.cleanup),s._entity&&(s._entity=null)}}};N.exports=o},{}],189:[function(T,N,z){cc.AffineTransform=function(o,s,n,t,e,r){this.a=o,this.b=s,this.c=n,this.d=t,this.tx=e,this.ty=r},cc.affineTransformMake=function(o,s,n,t,e,r){return{a:o,b:s,c:n,d:t,tx:e,ty:r}},cc.affineTransformClone=function(o){return{a:o.a,b:o.b,c:o.c,d:o.d,tx:o.tx,ty:o.ty}},cc.pointApplyAffineTransform=function(o,s,n){var t,e;return n===void 0?(n=s,t=o.x,e=o.y):(t=o,e=s),{x:n.a*t+n.c*e+n.tx,y:n.b*t+n.d*e+n.ty}},cc._pointApplyAffineTransformIn=function(o,s,n,t){var e,r,a;t===void 0?(a=s,e=o.x,r=o.y,t=n):(e=o,r=s,a=n),t.x=a.a*e+a.c*r+a.tx,t.y=a.b*e+a.d*r+a.ty},cc._pointApplyAffineTransform=function(o,s,n){return cc.pointApplyAffineTransform(o,s,n)},cc.sizeApplyAffineTransform=function(o,s){return{width:s.a*o.width+s.c*o.height,height:s.b*o.width+s.d*o.height}},cc.affineTransformMakeIdentity=function(){return{a:1,b:0,c:0,d:1,tx:0,ty:0}},cc.affineTransformIdentity=function(){return{a:1,b:0,c:0,d:1,tx:0,ty:0}},cc.rectApplyAffineTransform=function(o,s){var n=o.x,t=o.y,e=n+o.width,r=t+o.height,a=s.a*n+s.c*t+s.tx,c=s.b*n+s.d*t+s.ty,h=s.a*e+s.c*t+s.tx,u=s.b*e+s.d*t+s.ty,d=s.a*n+s.c*r+s.tx,f=s.b*n+s.d*r+s.ty,m=s.a*e+s.c*r+s.tx,v=s.b*e+s.d*r+s.ty,_=Math.min(a,h,d,m),p=Math.max(a,h,d,m),g=Math.min(c,u,f,v),y=Math.max(c,u,f,v);return cc.rect(_,g,p-_,y-g)},cc._rectApplyAffineTransformIn=function(o,s){var n=o.x,t=o.y,e=n+o.width,r=t+o.height,a=s.a*n+s.c*t+s.tx,c=s.b*n+s.d*t+s.ty,h=s.a*e+s.c*t+s.tx,u=s.b*e+s.d*t+s.ty,d=s.a*n+s.c*r+s.tx,f=s.b*n+s.d*r+s.ty,m=s.a*e+s.c*r+s.tx,v=s.b*e+s.d*r+s.ty,_=Math.min(a,h,d,m),p=Math.max(a,h,d,m),g=Math.min(c,u,f,v),y=Math.max(c,u,f,v);return o.x=_,o.y=g,o.width=p-_,o.height=y-g,o},cc.obbApplyAffineTransform=function(o,s,n,t,e,r){var a=o.x,c=o.y,h=o.width,u=o.height,d=s.a*a+s.c*c+s.tx,f=s.b*a+s.d*c+s.ty,m=s.a*h,v=s.b*h,_=s.c*u,p=s.d*u;t.x=d,t.y=f,e.x=m+d,e.y=v+f,n.x=_+d,n.y=p+f,r.x=m+_+d,r.y=v+p+f},cc.affineTransformTranslate=function(o,s,n){return{a:o.a,b:o.b,c:o.c,d:o.d,tx:o.tx+o.a*s+o.c*n,ty:o.ty+o.b*s+o.d*n}},cc.affineTransformScale=function(o,s,n){return{a:o.a*s,b:o.b*s,c:o.c*n,d:o.d*n,tx:o.tx,ty:o.ty}},cc.affineTransformRotate=function(o,s){var n=Math.sin(s),t=Math.cos(s);return{a:o.a*t+o.c*n,b:o.b*t+o.d*n,c:o.c*t-o.a*n,d:o.d*t-o.b*n,tx:o.tx,ty:o.ty}},cc.affineTransformConcat=function(o,s){return{a:o.a*s.a+o.b*s.c,b:o.a*s.b+o.b*s.d,c:o.c*s.a+o.d*s.c,d:o.c*s.b+o.d*s.d,tx:o.tx*s.a+o.ty*s.c+s.tx,ty:o.tx*s.b+o.ty*s.d+s.ty}},cc.affineTransformConcatIn=function(o,s){var n=o.a,t=o.b,e=o.c,r=o.d,a=o.tx,c=o.ty;return o.a=n*s.a+t*s.c,o.b=n*s.b+t*s.d,o.c=e*s.a+r*s.c,o.d=e*s.b+r*s.d,o.tx=a*s.a+c*s.c+s.tx,o.ty=a*s.b+c*s.d+s.ty,o},cc.affineTransformEqualToTransform=function(o,s){return o.a===s.a&&o.b===s.b&&o.c===s.c&&o.d===s.d&&o.tx===s.tx&&o.ty===s.ty},cc.affineTransformInvert=function(o){var s=1/(o.a*o.d-o.b*o.c);return{a:s*o.d,b:-s*o.b,c:-s*o.c,d:s*o.a,tx:s*(o.c*o.ty-o.d*o.tx),ty:s*(o.b*o.tx-o.a*o.ty)}},cc.affineTransformInvertIn=function(o){var s=o.a,n=o.b,t=o.c,e=o.d,r=1/(s*e-n*t),a=o.tx,c=o.ty;return o.a=r*e,o.b=-r*n,o.c=-r*t,o.d=r*s,o.tx=r*(t*c-e*a),o.ty=r*(n*a-s*c),o},cc.affineTransformInvertOut=function(o,s){var n=o.a,t=o.b,e=o.c,r=o.d,a=1/(n*r-t*e);s.a=a*r,s.b=-a*t,s.c=-a*e,s.d=a*n,s.tx=a*(e*o.ty-r*o.tx),s.ty=a*(t*o.tx-n*o.ty)}},{}],190:[function(T,N,z){var o=T("./CCValueType"),s=T("../platform/js"),n=function(){function t(c,h,u,d){typeof c=="object"&&(h=c.g,u=c.b,d=c.a,c=c.r),c=c||0,h=h||0,u=u||0,d=typeof d=="number"?d:255,this._val=(~~c<<24>>>0)+(~~h<<16)+(~~u<<8)+~~d}s.extend(t,o),T("../platform/CCClass").fastDefine("cc.Color",t,{r:0,g:0,b:0,a:255});var e={WHITE:[255,255,255,255],BLACK:[0,0,0,255],TRANSPARENT:[0,0,0,0],GRAY:[127.5,127.5,127.5],RED:[255,0,0],GREEN:[0,255,0],BLUE:[0,0,255],YELLOW:[255,235,4],ORANGE:[255,127,0],CYAN:[0,255,255],MAGENTA:[255,0,255]};for(var r in e)s.get(t,r,function(c){return function(){return new t(c[0],c[1],c[2],c[3])}}(e[r]));var a=t.prototype;return a.clone=function(){var c=new t;return c._val=this._val,c},a.equals=function(c){return c&&this._val===c._val},a.lerp=function(c,h,u){u=u||new t;var d=this.r,f=this.g,m=this.b,v=this.a;return u.r=d+(c.r-d)*h,u.g=f+(c.g-f)*h,u.b=m+(c.b-m)*h,u.a=v+(c.a-v)*h,u},a.toString=function(){return"rgba("+this.r.toFixed()+", "+this.g.toFixed()+", "+this.b.toFixed()+", "+this.a.toFixed()+")"},a.getR=function(){return(4278190080&this._val)>>>24},a.setR=function(c){return this._val=(16777215&this._val|~~c<<24>>>0)>>>0,this},a.getG=function(){return(16711680&this._val)>>16},a.setG=function(c){return this._val=(4278255615&this._val|~~c<<16)>>>0,this},a.getB=function(){return(65280&this._val)>>8},a.setB=function(c){return this._val=(4294902015&this._val|~~c<<8)>>>0,this},a.getA=function(){return 255&this._val},a.setA=function(c){return this._val=(4294967040&this._val|~~c)>>>0,this},s.getset(a,"r",a.getR,a.setR,!0),s.getset(a,"g",a.getG,a.setG,!0),s.getset(a,"b",a.getB,a.setB,!0),s.getset(a,"a",a.getA,a.setA,!0),a.toCSS=function(c){return c==="rgba"?"rgba("+(0|this.r)+","+(0|this.g)+","+(0|this.b)+","+(this.a/255).toFixed(2)+")":c==="rgb"?"rgb("+(0|this.r)+","+(0|this.g)+","+(0|this.b)+")":"#"+this.toHEX(c)},a.clamp=function(){},a.fromHEX=function(c){c.length<8&&(c+="FF");var h=parseInt(c.indexOf("#")>-1?c.substring(1):c,16);return this._val=(0&this._val|h)>>>0,this},a.toHEX=function(c){var h=[(0|this.r).toString(16),(0|this.g).toString(16),(0|this.b).toString(16)],u=-1;if(c==="#rgb")for(u=0;u<h.length;++u)h[u].length>1&&(h[u]=h[u][0]);else if(c==="#rrggbb")for(u=0;u<h.length;++u)h[u].length===1&&(h[u]="0"+h[u]);return h.join("")},a.toRGBValue=function(){return 16777215&this._val},a.fromHSV=function(c,h,u){var d=t.hsv2rgb(c,h,u);return this._val=(d.r<<24>>>0)+(d.g<<16)+(d.b<<8)+this.a,this},a.toHSV=function(){return t.rgb2hsv(this.r,this.g,this.b)},a.fromColor=function(c){c._val?this._val=c._val:(this.r=c.r,this.g=c.g,this.b=c.b,this.a=c.a)},t}();n.rgb2hsv=function(t,e,r){t/=255,e/=255,r/=255;var a={h:0,s:0,v:0},c=Math.max(t,e,r),h=Math.min(t,e,r),u=0;return a.v=c,a.s=c?(c-h)/c:0,a.s?(u=c-h,a.h=t===c?(e-r)/u:e===c?2+(r-t)/u:4+(t-e)/u,a.h/=6,a.h<0&&(a.h+=1)):a.h=0,a},n.hsv2rgb=function(t,e,r){var a={r:0,g:0,b:0};if(e===0)a.r=a.g=a.b=r;else if(r===0)a.r=a.g=a.b=0;else{t===1&&(t=0),t*=6,e=e,r=r;var c=Math.floor(t),h=t-c,u=r*(1-e),d=r*(1-e*h),f=r*(1-e*(1-h));switch(c){case 0:a.r=r,a.g=f,a.b=u;break;case 1:a.r=d,a.g=r,a.b=u;break;case 2:a.r=u,a.g=r,a.b=f;break;case 3:a.r=u,a.g=d,a.b=r;break;case 4:a.r=f,a.g=u,a.b=r;break;case 5:a.r=r,a.g=u,a.b=d}}return a.r*=255,a.g*=255,a.b*=255,a},cc.Color=n,cc.color=function(t,e,r,a){return typeof t=="string"?new cc.Color().fromHEX(t):typeof t=="object"?new cc.Color(t.r,t.g,t.b,t.a):new cc.Color(t,e,r,a)},cc.colorEqual=function(t,e){return t._val!==void 0&&e._val!==void 0?t._val===e._val:t.r===e.r&&t.g===e.g&&t.b===e.b},cc.hexToColor=function(t){t=t.replace(/^#?/,"0x");var e=parseInt(t),r=e>>16,a=(65280&e)>>8,c=255&e;return cc.color(r,a,c)},cc.colorToHex=function(t){var e=t.r.toString(16),r=t.g.toString(16),a=t.b.toString(16);return"#"+(t.r<16?"0"+e:e)+(t.g<16?"0"+r:r)+(t.b<16?"0"+a:a)},N.exports=cc.Color},{"../platform/CCClass":135,"../platform/js":156,"./CCValueType":196}],191:[function(T,N,z){var o=parseFloat("1.192092896e-07F");cc.pNeg=function(s){return cc.p(-s.x,-s.y)},cc.pAdd=function(s,n){return cc.p(s.x+n.x,s.y+n.y)},cc.pSub=function(s,n){return cc.p(s.x-n.x,s.y-n.y)},cc.pMult=function(s,n){return cc.p(s.x*n,s.y*n)},cc.pMidpoint=function(s,n){return cc.pMult(cc.pAdd(s,n),.5)},cc.pDot=function(s,n){return s.x*n.x+s.y*n.y},cc.pCross=function(s,n){return s.x*n.y-s.y*n.x},cc.pPerp=function(s){return cc.p(-s.y,s.x)},cc.pRPerp=function(s){return cc.p(s.y,-s.x)},cc.pProject=function(s,n){return cc.pMult(n,cc.pDot(s,n)/cc.pDot(n,n))},cc.pLengthSQ=function(s){return cc.pDot(s,s)},cc.pDistanceSQ=function(s,n){return cc.pLengthSQ(cc.pSub(s,n))},cc.pLength=function(s){return Math.sqrt(cc.pLengthSQ(s))},cc.pDistance=function(s,n){return cc.pLength(cc.pSub(s,n))},cc.pNormalize=function(s){var n=cc.pLength(s);return n===0?cc.p(s):cc.pMult(s,1/n)},cc.pForAngle=function(s){return cc.p(Math.cos(s),Math.sin(s))},cc.pToAngle=function(s){return Math.atan2(s.y,s.x)},cc.clampf=function(s,n,t){if(n>t){var e=n;n=t,t=e}return s<n?n:s<t?s:t},cc.clamp01=function(s){return s<0?0:s<1?s:1},cc.pClamp=function(s,n,t){return cc.p(cc.clampf(s.x,n.x,t.x),cc.clampf(s.y,n.y,t.y))},cc.pFromSize=function(s){return cc.p(s.width,s.height)},cc.pCompOp=function(s,n){return cc.p(n(s.x),n(s.y))},cc.pLerp=function(s,n,t){return cc.pAdd(cc.pMult(s,1-t),cc.pMult(n,t))},cc.pFuzzyEqual=function(s,n,t){return s.x-t<=n.x&&n.x<=s.x+t&&s.y-t<=n.y&&n.y<=s.y+t},cc.pCompMult=function(s,n){return cc.p(s.x*n.x,s.y*n.y)},cc.pAngleSigned=function(s,n){var t=cc.pNormalize(s),e=cc.pNormalize(n),r=Math.atan2(t.x*e.y-t.y*e.x,cc.pDot(t,e));return Math.abs(r)<o?0:r},cc.pAngle=function(s,n){var t=Math.acos(cc.pDot(cc.pNormalize(s),cc.pNormalize(n)));return Math.abs(t)<o?0:t},cc.pRotateByAngle=function(s,n,t){var e=cc.pSub(s,n),r=Math.cos(t),a=Math.sin(t),c=e.x;return e.x=c*r-e.y*a+n.x,e.y=c*a+e.y*r+n.y,e},cc.pLineIntersect=function(s,n,t,e,r){if(s.x===n.x&&s.y===n.y||t.x===e.x&&t.y===e.y)return!1;var a=n.x-s.x,c=n.y-s.y,h=e.x-t.x,u=e.y-t.y,d=s.x-t.x,f=s.y-t.y,m=u*a-h*c;return r.x=h*f-u*d,r.y=a*f-c*d,m===0?r.x===0||r.y===0:(r.x=r.x/m,r.y=r.y/m,!0)},cc.pSegmentIntersect=function(s,n,t,e){var r=cc.p(0,0);return!!(cc.pLineIntersect(s,n,t,e,r)&&r.x>=0&&r.x<=1&&r.y>=0&&r.y<=1)},cc.pIntersectPoint=function(s,n,t,e){var r=cc.p(0,0);if(cc.pLineIntersect(s,n,t,e,r)){var a=cc.p(0,0);return a.x=s.x+r.x*(n.x-s.x),a.y=s.y+r.x*(n.y-s.y),a}return cc.p(0,0)},cc.pSameAs=function(s,n){return s!=null&&n!=null&&s.x===n.x&&s.y===n.y},cc.pZeroIn=function(s){s.x=0,s.y=0},cc.pIn=function(s,n){s.x=n.x,s.y=n.y},cc.pMultIn=function(s,n){s.x*=n,s.y*=n},cc.pSubIn=function(s,n){s.x-=n.x,s.y-=n.y},cc.pAddIn=function(s,n){s.x+=n.x,s.y+=n.y},cc.pNormalizeIn=function(s){cc.pMultIn(s,1/Math.sqrt(s.x*s.x+s.y*s.y))}},{}],192:[function(T,N,z){function o(e,r,a,c){e&&typeof e=="object"&&(r=e.y,a=e.width,c=e.height,e=e.x),this.x=e||0,this.y=r||0,this.width=a||0,this.height=c||0}var s=T("./CCValueType"),n=T("../platform/js");n.extend(o,s),T("../platform/CCClass").fastDefine("cc.Rect",o,{x:0,y:0,width:0,height:0}),o.fromMinMax=function(e,r){var a=Math.min(e.x,r.x),c=Math.min(e.y,r.y);return new o(a,c,Math.max(e.x,r.x)-a,Math.max(e.y,r.y)-c)},o.contain=function(e,r){return e.x<r.x&&e.x+e.width>r.x+r.width&&e.y<r.y&&e.y+e.height>r.y+r.height?1:r.x<e.x&&r.x+r.width>e.x+e.width&&r.y<e.y&&r.y+r.height>e.y+e.height?-1:0};var t=o.prototype;t.clone=function(){return new o(this.x,this.y,this.width,this.height)},t.equals=function(e){return e&&this.x===e.x&&this.y===e.y&&this.width===e.width&&this.height===e.height},t.lerp=function(e,r,a){a=a||new o;var c=this.x,h=this.y,u=this.width,d=this.height;return a.x=c+(e.x-c)*r,a.y=h+(e.y-h)*r,a.width=u+(e.width-u)*r,a.height=d+(e.height-d)*r,a},t.toString=function(){return"("+this.x.toFixed(2)+", "+this.y.toFixed(2)+", "+this.width.toFixed(2)+", "+this.height.toFixed(2)+")"},n.getset(t,"xMin",function(){return this.x},function(e){this.width+=this.x-e,this.x=e}),n.getset(t,"yMin",function(){return this.y},function(e){this.height+=this.y-e,this.y=e}),n.getset(t,"xMax",function(){return this.x+this.width},function(e){this.width=e-this.x}),n.getset(t,"yMax",function(){return this.y+this.height},function(e){this.height=e-this.y}),n.getset(t,"center",function(){return new cc.Vec2(this.x+.5*this.width,this.y+.5*this.height)},function(e){this.x=e.x-.5*this.width,this.y=e.y-.5*this.height}),n.getset(t,"origin",function(){return new cc.Vec2(this.x,this.y)},function(e){this.x=e.x,this.y=e.y}),n.getset(t,"size",function(){return new cc.Size(this.width,this.height)},function(e){this.width=e.width,this.height=e.height}),t.intersects=function(e){return cc.rectIntersectsRect(this,e)},t.contains=function(e){return this.x<=e.x&&this.x+this.width>=e.x&&this.y<=e.y&&this.y+this.height>=e.y},t.containsRect=function(e){return this.x<=e.x&&this.x+this.width>=e.x+e.width&&this.y<=e.y&&this.y+this.height>=e.y+e.height},cc.Rect=o,cc.rect=function(e,r,a,c){return new o(e,r,a,c)},cc.rectEqualToRect=function(e,r){return e&&r&&e.x===r.x&&e.y===r.y&&e.width===r.width&&e.height===r.height},cc._rectEqualToZero=function(e){return e&&e.x===0&&e.y===0&&e.width===0&&e.height===0},cc.rectContainsRect=function(e,r){return!(!e||!r)&&!(e.x>=r.x||e.y>=r.y||e.x+e.width<=r.x+r.width||e.y+e.height<=r.y+r.height)},cc.rectGetMaxX=function(e){return e.x+e.width},cc.rectGetMidX=function(e){return e.x+e.width/2},cc.rectGetMinX=function(e){return e.x},cc.rectGetMaxY=function(e){return e.y+e.height},cc.rectGetMidY=function(e){return e.y+e.height/2},cc.rectGetMinY=function(e){return e.y},cc.rectContainsPoint=function(e,r){return r.x>=cc.rectGetMinX(e)&&r.x<=cc.rectGetMaxX(e)&&r.y>=cc.rectGetMinY(e)&&r.y<=cc.rectGetMaxY(e)},cc.rectIntersectsRect=function(e,r){var a=e.x+e.width,c=e.y+e.height,h=r.x+r.width,u=r.y+r.height;return!(a<r.x||h<e.x||c<r.y||u<e.y)},cc.rectOverlapsRect=function(e,r){return!(e.x+e.width<r.x||r.x+r.width<e.x||e.y+e.height<r.y||r.y+r.height<e.y)},cc.rectUnion=function(e,r){var a=cc.rect(0,0,0,0);return a.x=Math.min(e.x,r.x),a.y=Math.min(e.y,r.y),a.width=Math.max(e.x+e.width,r.x+r.width)-a.x,a.height=Math.max(e.y+e.height,r.y+r.height)-a.y,a},cc.rectIntersection=function(e,r){var a=cc.rect(Math.max(cc.rectGetMinX(e),cc.rectGetMinX(r)),Math.max(cc.rectGetMinY(e),cc.rectGetMinY(r)),0,0);return a.width=Math.min(cc.rectGetMaxX(e),cc.rectGetMaxX(r))-cc.rectGetMinX(a),a.height=Math.min(cc.rectGetMaxY(e),cc.rectGetMaxY(r))-cc.rectGetMinY(a),a},N.exports=cc.Rect},{"../platform/CCClass":135,"../platform/js":156,"./CCValueType":196}],193:[function(T,N,z){function o(e,r){e&&typeof e=="object"&&(r=e.height,e=e.width),this.width=e||0,this.height=r||0}var s=T("./CCValueType"),n=T("../platform/js");n.extend(o,s),T("../platform/CCClass").fastDefine("cc.Size",o,{width:0,height:0}),n.get(o,"ZERO",function(){return new o(0,0)});var t=o.prototype;t.clone=function(){return new o(this.width,this.height)},t.equals=function(e){return e&&this.width===e.width&&this.height===e.height},t.lerp=function(e,r,a){a=a||new o;var c=this.width,h=this.height;return a.width=c+(e.width-c)*r,a.height=h+(e.height-h)*r,a},t.toString=function(){return"("+this.width.toFixed(2)+", "+this.height.toFixed(2)+")"},cc.size=function(e,r){return new o(e,r)},cc.sizeEqualToSize=function(e,r){return e&&r&&e.width===r.width&&e.height===r.height},cc.Size=N.exports=o},{"../platform/CCClass":135,"../platform/js":156,"./CCValueType":196}],194:[function(T,N,z){cc.Acceleration=function(s,n,t,e){this.x=s||0,this.y=n||0,this.z=t||0,this.timestamp=e||0},cc.BlendFunc=function(s,n){this.src=s,this.dst=n};var o=cc.Enum({ONE:1,ZERO:0,SRC_ALPHA:770,SRC_COLOR:768,DST_ALPHA:772,DST_COLOR:774,ONE_MINUS_SRC_ALPHA:771,ONE_MINUS_SRC_COLOR:769,ONE_MINUS_DST_ALPHA:773,ONE_MINUS_DST_COLOR:775});cc.BlendFunc._disable=function(){return new cc.BlendFunc(o.ONE,o.ZERO)},cc.BlendFunc._alphaPremultiplied=function(){return new cc.BlendFunc(o.ONE,o.ONE_MINUS_SRC_ALPHA)},cc.BlendFunc._alphaNonPremultiplied=function(){return new cc.BlendFunc(o.SRC_ALPHA,o.ONE_MINUS_SRC_ALPHA)},cc.BlendFunc._additive=function(){return new cc.BlendFunc(o.SRC_ALPHA,o.ONE)},cc.BlendFunc.BlendFactor=o,cc.BlendFunc.DISABLE,cc.js.get(cc.BlendFunc,"DISABLE",cc.BlendFunc._disable),cc.BlendFunc.ALPHA_PREMULTIPLIED,cc.js.get(cc.BlendFunc,"ALPHA_PREMULTIPLIED",cc.BlendFunc._alphaPremultiplied),cc.BlendFunc.ALPHA_NON_PREMULTIPLIED,cc.js.get(cc.BlendFunc,"ALPHA_NON_PREMULTIPLIED",cc.BlendFunc._alphaNonPremultiplied),cc.BlendFunc.ADDITIVE,cc.js.get(cc.BlendFunc,"ADDITIVE",cc.BlendFunc._additive),cc.blendFuncDisable=cc.BlendFunc._disable,cc.TextAlignment=cc.Enum({LEFT:0,CENTER:1,RIGHT:2}),cc.VerticalTextAlignment=cc.Enum({TOP:0,CENTER:1,BOTTOM:2})},{}],195:[function(T,N,z){cc.WebGLColor=function(s,n,t,e,r,a){this._arrayBuffer=r||new ArrayBuffer(cc.WebGLColor.BYTES_PER_ELEMENT),this._offset=a||0;var c=this._arrayBuffer,h=this._offset;this._view=new Uint8Array(c,h,4),this._view[0]=s||0,this._view[1]=n||0,this._view[2]=t||0,typeof e=="number"?this._view[3]=e:(this._view[3]=255,this.a_undefined=!0)},cc.WebGLColor.BYTES_PER_ELEMENT=4,(o=cc.WebGLColor.prototype)._getR=function(){return this._view[0]},o._setR=function(s){this._view[0]=s<0?0:s},o._getG=function(){return this._view[1]},o._setG=function(s){this._view[1]=s<0?0:s},o._getB=function(){return this._view[2]},o._setB=function(s){this._view[2]=s<0?0:s},o._getA=function(){return this._view[3]},o._setA=function(s){this._view[3]=s<0?0:s},o.r,cc.js.getset(o,"r",o._getR,o._setR),o.g,cc.js.getset(o,"g",o._getG,o._setG),o.b,cc.js.getset(o,"b",o._getB,o._setB),o.a,cc.js.getset(o,"a",o._getA,o._setA),cc.Vertex2F=function(s,n,t,e){this._arrayBuffer=t||new ArrayBuffer(cc.Vertex2F.BYTES_PER_ELEMENT),this._offset=e||0,this._view=new Float32Array(this._arrayBuffer,this._offset,2),this._view[0]=s||0,this._view[1]=n||0},cc.Vertex2F.BYTES_PER_ELEMENT=8;var o;(o=cc.Vertex2F.prototype)._getX=function(){return this._view[0]},o._setX=function(s){this._view[0]=s},o._getY=function(){return this._view[1]},o._setY=function(s){this._view[1]=s},cc.js.getset(o,"x",o._getX,o._setX),cc.js.getset(o,"y",o._getY,o._setY),cc.Vertex3F=function(s,n,t,e,r){this._arrayBuffer=e||new ArrayBuffer(cc.Vertex3F.BYTES_PER_ELEMENT),this._offset=r||0;var a=this._arrayBuffer,c=this._offset;this._view=new Float32Array(a,c,3),this._view[0]=s||0,this._view[1]=n||0,this._view[2]=t||0},cc.Vertex3F.BYTES_PER_ELEMENT=12,(o=cc.Vertex3F.prototype)._getX=function(){return this._view[0]},o._setX=function(s){this._view[0]=s},o._getY=function(){return this._view[1]},o._setY=function(s){this._view[1]=s},o._getZ=function(){return this._view[2]},o._setZ=function(s){this._view[2]=s},cc.js.getset(o,"x",o._getX,o._setX),cc.js.getset(o,"y",o._getY,o._setY),cc.js.getset(o,"z",o._getZ,o._setZ),cc.Tex2F=function(s,n,t,e){this._arrayBuffer=t||new ArrayBuffer(cc.Tex2F.BYTES_PER_ELEMENT),this._offset=e||0,this._view=new Float32Array(this._arrayBuffer,this._offset,2),this._view[0]=s||0,this._view[1]=n||0},cc.Tex2F.BYTES_PER_ELEMENT=8,(o=cc.Tex2F.prototype)._getU=function(){return this._view[0]},o._setU=function(s){this._view[0]=s},o._getV=function(){return this._view[1]},o._setV=function(s){this._view[1]=s},cc.js.getset(o,"u",o._getU,o._setU),cc.js.getset(o,"v",o._getV,o._setV),cc.Quad2=function(s,n,t,e,r,a){this._arrayBuffer=r||new ArrayBuffer(cc.Quad2.BYTES_PER_ELEMENT),this._offset=a||0;var c=this._arrayBuffer,h=this._offset,u=cc.Vertex2F.BYTES_PER_ELEMENT;this._tl=s?new cc.Vertex2F(s.x,s.y,c,h):new cc.Vertex2F(0,0,c,h),h+=u,this._tr=n?new cc.Vertex2F(n.x,n.y,c,h):new cc.Vertex2F(0,0,c,h),h+=u,this._bl=t?new cc.Vertex2F(t.x,t.y,c,h):new cc.Vertex2F(0,0,c,h),h+=u,this._br=e?new cc.Vertex2F(e.x,e.y,c,h):new cc.Vertex2F(0,0,c,h)},cc.Quad2.BYTES_PER_ELEMENT=32,(o=cc.Quad2.prototype)._getTL=function(){return this._tl},o._setTL=function(s){this._tl._view[0]=s.x,this._tl._view[1]=s.y},o._getTR=function(){return this._tr},o._setTR=function(s){this._tr._view[0]=s.x,this._tr._view[1]=s.y},o._getBL=function(){return this._bl},o._setBL=function(s){this._bl._view[0]=s.x,this._bl._view[1]=s.y},o._getBR=function(){return this._br},o._setBR=function(s){this._br._view[0]=s.x,this._br._view[1]=s.y},cc.js.getset(o,"tl",o._getTL,o._setTL),cc.js.getset(o,"tr",o._getTR,o._setTR),cc.js.getset(o,"bl",o._getBL,o._setBL),cc.js.getset(o,"br",o._getBR,o._setBR),cc.Quad3=function(s,n,t,e,r,a){this._arrayBuffer=r||new ArrayBuffer(cc.Quad3.BYTES_PER_ELEMENT),this._offset=a||0;var c=this._arrayBuffer,h=this._offset,u=cc.Vertex3F.BYTES_PER_ELEMENT;this.bl=bl?new cc.Vertex3F(bl.x,bl.y,bl.z,c,h):new cc.Vertex3F(0,0,0,c,h),h+=u,this.br=br?new cc.Vertex3F(br.x,br.y,br.z,c,h):new cc.Vertex3F(0,0,0,c,h),h+=u,this.tl=tl?new cc.Vertex3F(tl.x,tl.y,tl.z,c,h):new cc.Vertex3F(0,0,0,c,h),h+=u,this.tr=tr?new cc.Vertex3F(tr.x,tr.y,tr.z,c,h):new cc.Vertex3F(0,0,0,c,h)},cc.Quad3.BYTES_PER_ELEMENT=48,cc.V3F_C4B_T2F=function(s,n,t,e,r){this._arrayBuffer=e||new ArrayBuffer(cc.V3F_C4B_T2F.BYTES_PER_ELEMENT),this._offset=r||0;var a=this._arrayBuffer,c=this._offset;this._vertices=s?new cc.Vertex3F(s.x,s.y,s.z,a,c):new cc.Vertex3F(0,0,0,a,c),c+=cc.Vertex3F.BYTES_PER_ELEMENT,this._colors=n?new cc.WebGLColor(n.r,n.g,n.b,n.a,a,c):new cc.WebGLColor(0,0,0,0,a,c),c+=cc.WebGLColor.BYTES_PER_ELEMENT,this._texCoords=t?new cc.Tex2F(t.u,t.v,a,c):new cc.Tex2F(0,0,a,c)},cc.V3F_C4B_T2F.BYTES_PER_ELEMENT=24,(o=cc.V3F_C4B_T2F.prototype)._getVertices=function(){return this._vertices},o._setVertices=function(s){var n=this._vertices;n._view[0]=s.x,n._view[1]=s.y,n._view[2]=s.z},o._getColor=function(){return this._colors},o._setColor=function(s){var n=this._colors;n._view[0]=s.r,n._view[1]=s.g,n._view[2]=s.b,n._view[3]=s.a},o._getTexCoords=function(){return this._texCoords},o._setTexCoords=function(s){this._texCoords._view[0]=s.u,this._texCoords._view[1]=s.v},cc.js.getset(o,"vertices",o._getVertices,o._setVertices),cc.js.getset(o,"colors",o._getColor,o._setColor),cc.js.getset(o,"texCoords",o._getTexCoords,o._setTexCoords),cc.V3F_C4B_T2F_Quad=function(s,n,t,e,r,a){this._arrayBuffer=r||new ArrayBuffer(cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT),this._offset=a||0;var c=this._arrayBuffer,h=this._offset,u=cc.V3F_C4B_T2F.BYTES_PER_ELEMENT;this._tl=s?new cc.V3F_C4B_T2F(s.vertices,s.colors,s.texCoords,c,h):new cc.V3F_C4B_T2F(null,null,null,c,h),h+=u,this._bl=n?new cc.V3F_C4B_T2F(n.vertices,n.colors,n.texCoords,c,h):new cc.V3F_C4B_T2F(null,null,null,c,h),h+=u,this._tr=t?new cc.V3F_C4B_T2F(t.vertices,t.colors,t.texCoords,c,h):new cc.V3F_C4B_T2F(null,null,null,c,h),h+=u,this._br=e?new cc.V3F_C4B_T2F(e.vertices,e.colors,e.texCoords,c,h):new cc.V3F_C4B_T2F(null,null,null,c,h)},cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT=96,(o=cc.V3F_C4B_T2F_Quad.prototype)._getTL=function(){return this._tl},o._setTL=function(s){var n=this._tl;n.vertices=s.vertices,n.colors=s.colors,n.texCoords=s.texCoords},o._getBL=function(){return this._bl},o._setBL=function(s){var n=this._bl;n.vertices=s.vertices,n.colors=s.colors,n.texCoords=s.texCoords},o._getTR=function(){return this._tr},o._setTR=function(s){var n=this._tr;n.vertices=s.vertices,n.colors=s.colors,n.texCoords=s.texCoords},o._getBR=function(){return this._br},o._setBR=function(s){var n=this._br;n.vertices=s.vertices,n.colors=s.colors,n.texCoords=s.texCoords},o._getArrayBuffer=function(){return this._arrayBuffer},cc.js.getset(o,"tl",o._getTL,o._setTL),cc.js.getset(o,"tr",o._getTR,o._setTR),cc.js.getset(o,"bl",o._getBL,o._setBL),cc.js.getset(o,"br",o._getBR,o._setBR),cc.js.get(o,"arrayBuffer",o._getArrayBuffer),cc.V3F_C4B_T2F_QuadZero=function(){return new cc.V3F_C4B_T2F_Quad},cc.V3F_C4B_T2F_QuadCopy=function(s){if(!s)return cc.V3F_C4B_T2F_QuadZero();var n=s.tl,t=s.bl,e=s.tr,r=s.br;return{tl:{vertices:{x:n.vertices.x,y:n.vertices.y,z:n.vertices.z},colors:{r:n.colors.r,g:n.colors.g,b:n.colors.b,a:n.colors.a},texCoords:{u:n.texCoords.u,v:n.texCoords.v}},bl:{vertices:{x:t.vertices.x,y:t.vertices.y,z:t.vertices.z},colors:{r:t.colors.r,g:t.colors.g,b:t.colors.b,a:t.colors.a},texCoords:{u:t.texCoords.u,v:t.texCoords.v}},tr:{vertices:{x:e.vertices.x,y:e.vertices.y,z:e.vertices.z},colors:{r:e.colors.r,g:e.colors.g,b:e.colors.b,a:e.colors.a},texCoords:{u:e.texCoords.u,v:e.texCoords.v}},br:{vertices:{x:r.vertices.x,y:r.vertices.y,z:r.vertices.z},colors:{r:r.colors.r,g:r.colors.g,b:r.colors.b,a:r.colors.a},texCoords:{u:r.texCoords.u,v:r.texCoords.v}}}},cc.V3F_C4B_T2F_QuadsCopy=function(s){if(!s)return[];for(var n=[],t=0;t<s.length;t++)n.push(cc.V3F_C4B_T2F_QuadCopy(s[t]));return n},cc.V2F_C4B_T2F=function(s,n,t,e,r){this._arrayBuffer=e||new ArrayBuffer(cc.V2F_C4B_T2F.BYTES_PER_ELEMENT),this._offset=r||0;var a=this._arrayBuffer,c=this._offset;this._vertices=s?new cc.Vertex2F(s.x,s.y,a,c):new cc.Vertex2F(0,0,a,c),c+=cc.Vertex2F.BYTES_PER_ELEMENT,this._colors=n?new cc.WebGLColor(n.r,n.g,n.b,n.a,a,c):new cc.WebGLColor(0,0,0,0,a,c),c+=cc.WebGLColor.BYTES_PER_ELEMENT,this._texCoords=t?new cc.Tex2F(t.u,t.v,a,c):new cc.Tex2F(0,0,a,c)},cc.V2F_C4B_T2F.BYTES_PER_ELEMENT=20,(o=cc.V2F_C4B_T2F.prototype)._getVertices=function(){return this._vertices},o._setVertices=function(s){this._vertices._view[0]=s.x,this._vertices._view[1]=s.y},o._getColor=function(){return this._colors},o._setColor=function(s){var n=this._colors;n._view[0]=s.r,n._view[1]=s.g,n._view[2]=s.b,n._view[3]=s.a},o._getTexCoords=function(){return this._texCoords},o._setTexCoords=function(s){this._texCoords._view[0]=s.u,this._texCoords._view[1]=s.v},cc.js.getset(o,"vertices",o._getVertices,o._setVertices),cc.js.getset(o,"colors",o._getColor,o._setColor),cc.js.getset(o,"texCoords",o._getTexCoords,o._setTexCoords),cc.V2F_C4B_T2F_Triangle=function(s,n,t,e,r){this._arrayBuffer=e||new ArrayBuffer(cc.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT),this._offset=r||0;var a=this._arrayBuffer,c=this._offset,h=cc.V2F_C4B_T2F.BYTES_PER_ELEMENT;this._a=s?new cc.V2F_C4B_T2F(s.vertices,s.colors,s.texCoords,a,c):new cc.V2F_C4B_T2F(null,null,null,a,c),c+=h,this._b=n?new cc.V2F_C4B_T2F(n.vertices,n.colors,n.texCoords,a,c):new cc.V2F_C4B_T2F(null,null,null,a,c),c+=h,this._c=t?new cc.V2F_C4B_T2F(t.vertices,t.colors,t.texCoords,a,c):new cc.V2F_C4B_T2F(null,null,null,a,c)},cc.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT=60,(o=cc.V2F_C4B_T2F_Triangle.prototype)._getA=function(){return this._a},o._setA=function(s){var n=this._a;n.vertices=s.vertices,n.colors=s.colors,n.texCoords=s.texCoords},o._getB=function(){return this._b},o._setB=function(s){var n=this._b;n.vertices=s.vertices,n.colors=s.colors,n.texCoords=s.texCoords},o._getC=function(){return this._c},o._setC=function(s){var n=this._c;n.vertices=s.vertices,n.colors=s.colors,n.texCoords=s.texCoords},cc.js.getset(o,"a",o._getA,o._setA),cc.js.getset(o,"b",o._getB,o._setB),cc.js.getset(o,"c",o._getC,o._setC)},{}],196:[function(T,N,z){function o(){}var s=T("../platform/js");s.setClassName("cc.ValueType",o);var n=o.prototype;n.toString=function(){return"[object Object]"},cc.ValueType=o,N.exports=o},{"../platform/js":156}],197:[function(T,N,z){function o(r,a){r&&typeof r=="object"&&(a=r.y,r=r.x),this.x=r||0,this.y=a||0}var s=T("./CCValueType"),n=T("../platform/js"),t=T("../platform/CCClass");n.extend(o,s),t.fastDefine("cc.Vec2",o,{x:0,y:0});var e=o.prototype;e.clone=function(){return new o(this.x,this.y)},e.set=function(r){return this.x=r.x,this.y=r.y,this},e.equals=function(r){return r&&this.x===r.x&&this.y===r.y},e.toString=function(){return"("+this.x.toFixed(2)+", "+this.y.toFixed(2)+")"},e.lerp=function(r,a,c){c=c||new o;var h=this.x,u=this.y;return c.x=h+(r.x-h)*a,c.y=u+(r.y-u)*a,c},e.addSelf=function(r){return this.x+=r.x,this.y+=r.y,this},e.add=function(r,a){return a=a||new o,a.x=this.x+r.x,a.y=this.y+r.y,a},e.subSelf=function(r){return this.x-=r.x,this.y-=r.y,this},e.sub=function(r,a){return a=a||new o,a.x=this.x-r.x,a.y=this.y-r.y,a},e.mulSelf=function(r){return this.x*=r,this.y*=r,this},e.mul=function(r,a){return a=a||new o,a.x=this.x*r,a.y=this.y*r,a},e.scaleSelf=function(r){return this.x*=r.x,this.y*=r.y,this},e.scale=function(r,a){return a=a||new o,a.x=this.x*r.x,a.y=this.y*r.y,a},e.divSelf=function(r){return this.x/=r,this.y/=r,this},e.div=function(r,a){return a=a||new o,a.x=this.x/r,a.y=this.y/r,a},e.negSelf=function(){return this.x=-this.x,this.y=-this.y,this},e.neg=function(r){return r=r||new o,r.x=-this.x,r.y=-this.y,r},e.dot=function(r){return this.x*r.x+this.y*r.y},e.cross=function(r){return this.y*r.x-this.x*r.y},e.mag=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},e.magSqr=function(){return this.x*this.x+this.y*this.y},e.normalizeSelf=function(){var r=this.x*this.x+this.y*this.y;if(r===1)return this;if(r===0)return console.warn("Can't normalize zero vector"),this;var a=1/Math.sqrt(r);return this.x*=a,this.y*=a,this},e.normalize=function(r){return r=r||new o,r.x=this.x,r.y=this.y,r.normalizeSelf(),r},e.angle=function(r){var a=this.magSqr(),c=r.magSqr();if(a===0||c===0)return console.warn("Can't get angle between zero vector"),0;var h=this.dot(r)/Math.sqrt(a*c);return h=cc.clampf(h,-1,1),Math.acos(h)},e.signAngle=function(r){return Math.atan2(this.y,this.x)-Math.atan2(r.y,r.x)},e.rotate=function(r,a){return a=a||new o,a.x=this.x,a.y=this.y,a.rotateSelf(r)},e.rotateSelf=function(r){var a=Math.sin(r),c=Math.cos(r),h=this.x;return this.x=c*h-a*this.y,this.y=a*h+c*this.y,this},n.get(o,"ONE",function(){return new o(1,1)}),n.get(o,"ZERO",function(){return new o(0,0)}),n.get(o,"UP",function(){return new o(0,1)}),n.get(o,"RIGHT",function(){return new o(1,0)}),cc.Vec2=o,cc.v2=function(r,a){return new o(r,a)},cc.p=cc.v2,cc.pointEqualToPoint=function(r,a){return r&&a&&r.x===a.x&&r.y===a.y},N.exports=cc.Vec2},{"../platform/CCClass":135,"../platform/js":156,"./CCValueType":196}],198:[function(T,N,z){T("./CCValueType"),T("./CCVec2"),T("./CCPointExtension"),T("./CCSize"),T("./CCRect"),T("./CCColor"),T("./CCTypes"),T("./CCAffineTransform"),T("./CCTypesWebGL")},{"./CCAffineTransform":189,"./CCColor":190,"./CCPointExtension":191,"./CCRect":192,"./CCSize":193,"./CCTypes":194,"./CCTypesWebGL":195,"./CCValueType":196,"./CCVec2":197}],199:[function(T,N,z){cc.js},{}],200:[function(T,N,z){T("./core/CCGame"),T("./actions"),T("./core/base-nodes/CCSGNode"),T("./core/base-nodes/CCSGNodeBaseRenderCmd"),T("./core/base-nodes/CCSGNodeCanvasRenderCmd"),T("./core/base-nodes/CCSGNodeWebGLRenderCmd"),T("./core/scenes/CCSGScene"),T("./core/CCConfiguration"),T("./core/sprites/CCSGSprite"),T("./core/sprites/CCSGSpriteCanvasRenderCmd"),T("./core/sprites/CCSGSpriteWebGLRenderCmd"),T("./core/sprites/CCScale9Sprite"),T("./core/sprites/CCScale9SpriteCanvasRenderCmd"),T("./core/sprites/CCScale9SpriteWebGLRenderCmd"),T("./core/sprites/CCSpriteBatchNode"),T("./render-texture/CCRenderTexture"),T("./render-texture/CCRenderTextureCanvasRenderCmd"),T("./render-texture/CCRenderTextureWebGLRenderCmd")},{"./actions":10,"./core/CCConfiguration":32,"./core/CCGame":39,"./core/base-nodes/CCSGNode":55,"./core/base-nodes/CCSGNodeBaseRenderCmd":56,"./core/base-nodes/CCSGNodeCanvasRenderCmd":57,"./core/base-nodes/CCSGNodeWebGLRenderCmd":58,"./core/scenes/CCSGScene":166,"./core/sprites/CCSGSprite":167,"./core/sprites/CCSGSpriteCanvasRenderCmd":168,"./core/sprites/CCSGSpriteWebGLRenderCmd":169,"./core/sprites/CCScale9Sprite":170,"./core/sprites/CCScale9SpriteCanvasRenderCmd":171,"./core/sprites/CCScale9SpriteWebGLRenderCmd":172,"./core/sprites/CCSpriteBatchNode":173,"./render-texture/CCRenderTexture":221,"./render-texture/CCRenderTextureCanvasRenderCmd":222,"./render-texture/CCRenderTextureWebGLRenderCmd":223}],201:[function(T,N,z){cc.math.AABB=function(o,s){this.min=o||new cc.math.Vec3,this.max=s||new cc.math.Vec3},cc.math.AABB.prototype.containsPoint=function(o){return o.x>=this.min.x&&o.x<=this.max.x&&o.y>=this.min.y&&o.y<=this.max.y&&o.z>=this.min.z&&o.z<=this.max.z},cc.math.AABB.containsPoint=function(o,s){return o.x>=s.min.x&&o.x<=s.max.x&&o.y>=s.min.y&&o.y<=s.max.y&&o.z>=s.min.z&&o.z<=s.max.z},cc.math.AABB.prototype.assignFrom=function(o){this.min.assignFrom(o.min),this.max.assignFrom(o.max)},cc.math.AABB.assign=function(o,s){return o.min.assignFrom(s.min),o.max.assignFrom(s.max),o}},{}],202:[function(T,N,z){cc.math.Matrix4Stack=function(s,n){this.top=s,this.stack=n||[],this.lastUpdated=0};var o=cc.math.Matrix4Stack.prototype;o.initialize=function(){this.stack.length=0,this.top=null},o.push=function(s){s=s||this.top,this.stack.push(this.top),this.top=new cc.math.Matrix4(s),this.update()},o.pop=function(){this.top=this.stack.pop(),this.update()},o.update=function(){this.lastUpdated++},o.release=function(){this.stack=null,this.top=null,this._matrixPool=null},o._getFromPool=function(s){var n=this._matrixPool;if(n.length===0)return new cc.math.Matrix4(s);var t=n.pop();return t.assignFrom(s),t},o._putInPool=function(s){this._matrixPool.push(s)}},{}],203:[function(T,N,z){var o=cc.math;o.KM_GL_MODELVIEW=5888,o.KM_GL_PROJECTION=5889,o.KM_GL_TEXTURE=5890,o.modelview_matrix_stack=new o.Matrix4Stack,o.projection_matrix_stack=new o.Matrix4Stack,o.texture_matrix_stack=new o.Matrix4Stack,cc.current_stack=null;var s=!1;(function(){if(!s){var e=new o.Matrix4;o.modelview_matrix_stack.initialize(),o.projection_matrix_stack.initialize(),o.texture_matrix_stack.initialize(),cc.current_stack=o.modelview_matrix_stack,s=!0,e.identity(),o.modelview_matrix_stack.push(e),o.projection_matrix_stack.push(e),o.texture_matrix_stack.push(e)}})(),o.glFreeAll=function(){o.modelview_matrix_stack.release(),o.modelview_matrix_stack=null,o.projection_matrix_stack.release(),o.projection_matrix_stack=null,o.texture_matrix_stack.release(),o.texture_matrix_stack=null,s=!1,cc.current_stack=null},o.glPushMatrix=function(){cc.current_stack.push(cc.current_stack.top),cc.current_stack.update()},o.glPushMatrixWitMat4=function(e){cc.current_stack.stack.push(cc.current_stack.top),e.assignFrom(cc.current_stack.top),cc.current_stack.top=e,cc.current_stack.update()},o.glPopMatrix=function(){cc.current_stack.top=cc.current_stack.stack.pop(),cc.current_stack.update()},o.glMatrixMode=function(e){switch(e){case o.KM_GL_MODELVIEW:cc.current_stack=o.modelview_matrix_stack;break;case o.KM_GL_PROJECTION:cc.current_stack=o.projection_matrix_stack;break;case o.KM_GL_TEXTURE:cc.current_stack=o.texture_matrix_stack;break;default:throw new Error("Invalid matrix mode specified")}},o.glLoadIdentity=function(){cc.current_stack.top.identity(),cc.current_stack.update()},o.glLoadMatrix=function(e){cc.current_stack.top.assignFrom(e),cc.current_stack.update()},o.glMultMatrix=function(e){cc.current_stack.top.multiply(e),cc.current_stack.update()};var n=new o.Matrix4;o.glTranslatef=function(e,r,a){var c=o.Matrix4.createByTranslation(e,r,a,n);cc.current_stack.top.multiply(c),cc.current_stack.update()};var t=new o.Vec3;o.glRotatef=function(e,r,a,c){t.fill(r,a,c);var h=o.Matrix4.createByAxisAndAngle(t,cc.degreesToRadians(e),n);cc.current_stack.top.multiply(h),cc.current_stack.update()},o.glScalef=function(e,r,a){var c=o.Matrix4.createByScale(e,r,a,n);cc.current_stack.top.multiply(c),cc.current_stack.update()},o.glGetMatrix=function(e,r){switch(e){case o.KM_GL_MODELVIEW:r.assignFrom(o.modelview_matrix_stack.top);break;case o.KM_GL_PROJECTION:r.assignFrom(o.projection_matrix_stack.top);break;case o.KM_GL_TEXTURE:r.assignFrom(o.texture_matrix_stack.top);break;default:throw new Error("Invalid matrix mode specified")}}},{}],204:[function(T,N,z){T("./utility"),T("./vec2"),T("./vec3"),T("./vec4"),T("./ray2"),T("./mat3"),T("./mat4"),T("./plane"),T("./quaternion"),T("./aabb"),T("./gl/mat4stack"),T("./gl/matrix")},{"./aabb":201,"./gl/mat4stack":202,"./gl/matrix":203,"./mat3":205,"./mat4":206,"./plane":207,"./quaternion":208,"./ray2":209,"./utility":210,"./vec2":211,"./vec3":212,"./vec4":213}],205:[function(T,N,z){window.Uint16Array=window.Uint16Array||window.Array,window.Float32Array=window.Float32Array||window.Array,cc.math.Matrix3=function(n){n&&n.mat?this.mat=new Float32Array(n.mat):this.mat=new Float32Array(9)};var o=cc.math.Matrix3.prototype;o.fill=function(n){var t=this.mat,e=n.mat;return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],this},o.adjugate=function(){var n=this.mat,t=n[0],e=n[1],r=n[2],a=n[3],c=n[4],h=n[5],u=n[6],d=n[7],f=n[8];return n[0]=c*f-h*d,n[1]=r*d-e*f,n[2]=e*h-r*c,n[3]=h*u-a*f,n[4]=t*f-r*u,n[5]=r*a-t*h,n[6]=a*d-c*u,n[8]=t*c-e*a,this},o.identity=function(){var n=this.mat;return n[1]=n[2]=n[3]=n[5]=n[6]=n[7]=0,n[0]=n[4]=n[8]=1,this};var s=new cc.math.Matrix3;o.inverse=function(n){if(n===0)return this;s.assignFrom(this);var t=1/n;return this.adjugate(),this.multiplyScalar(t),this},o.isIdentity=function(){var n=this.mat;return n[0]===1&&n[1]===0&&n[2]===0&&n[3]===0&&n[4]===1&&n[5]===0&&n[6]===0&&n[7]===0&&n[8]===1},o.transpose=function(){var n=this.mat,t=n[1],e=n[2],r=n[3],a=n[5],c=n[6],h=n[7];return n[1]=r,n[2]=c,n[3]=t,n[5]=h,n[6]=e,n[7]=a,this},o.determinant=function(){var n=this.mat,t=n[0]*n[4]*n[8]+n[1]*n[5]*n[6]+n[2]*n[3]*n[7];return t-=n[2]*n[4]*n[6]+n[0]*n[5]*n[7]+n[1]*n[3]*n[8]},o.multiply=function(n){var t=this.mat,e=n.mat,r=t[0],a=t[1],c=t[2],h=t[3],u=t[4],d=t[5],f=t[6],m=t[7],v=t[8],_=e[0],p=e[1],g=e[2],y=e[3],C=e[4],S=e[5],I=e[6],b=e[7],A=e[8];return t[0]=r*_+h*p+f*g,t[1]=a*_+u*p+m*g,t[2]=c*_+d*p+v*g,t[3]=c*_+d*p+v*g,t[4]=a*y+u*C+m*S,t[5]=c*y+d*C+v*S,t[6]=r*I+h*b+f*A,t[7]=a*I+u*b+m*A,t[8]=c*I+d*b+v*A,this},o.multiplyScalar=function(n){var t=this.mat;return t[0]*=n,t[1]*=n,t[2]*=n,t[3]*=n,t[4]*=n,t[5]*=n,t[6]*=n,t[7]*=n,t[8]*=n,this},cc.math.Matrix3.rotationAxisAngle=function(n,t){var e=Math.cos(t),r=Math.sin(t),a=new cc.math.Matrix3,c=a.mat;return c[0]=e+n.x*n.x*(1-e),c[1]=n.z*r+n.y*n.x*(1-e),c[2]=-n.y*r+n.z*n.x*(1-e),c[3]=-n.z*r+n.x*n.y*(1-e),c[4]=e+n.y*n.y*(1-e),c[5]=n.x*r+n.z*n.y*(1-e),c[6]=n.y*r+n.x*n.z*(1-e),c[7]=-n.x*r+n.y*n.z*(1-e),c[8]=e+n.z*n.z*(1-e),a},o.assignFrom=function(n){if(this===n)return cc.logID(7900),this;var t=this.mat,e=n.mat;return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],this},o.equals=function(n){if(this===n)return!0;for(var t=cc.math.EPSILON,e=this.mat,r=n.mat,a=0;a<9;++a)if(!(e[a]+t>r[a]&&e[a]-t<r[a]))return!1;return!0},cc.math.Matrix3.createByRotationX=function(n){var t=new cc.math.Matrix3,e=t.mat;return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=Math.cos(n),e[5]=Math.sin(n),e[6]=0,e[7]=-Math.sin(n),e[8]=Math.cos(n),t},cc.math.Matrix3.createByRotationY=function(n){var t=new cc.math.Matrix3,e=t.mat;return e[0]=Math.cos(n),e[1]=0,e[2]=-Math.sin(n),e[3]=0,e[4]=1,e[5]=0,e[6]=Math.sin(n),e[7]=0,e[8]=Math.cos(n),t},cc.math.Matrix3.createByRotationZ=function(n){var t=new cc.math.Matrix3,e=t.mat;return e[0]=Math.cos(n),e[1]=-Math.sin(n),e[2]=0,e[3]=Math.sin(n),e[4]=Math.cos(n),e[5]=0,e[6]=0,e[7]=0,e[8]=1,t},cc.math.Matrix3.createByRotation=function(n){var t=new cc.math.Matrix3,e=t.mat;return e[0]=Math.cos(n),e[1]=Math.sin(n),e[2]=0,e[3]=-Math.sin(n),e[4]=Math.cos(n),e[5]=0,e[6]=0,e[7]=0,e[8]=1,t},cc.math.Matrix3.createByScale=function(n,t){var e=new cc.math.Matrix3;return e.identity(),e.mat[0]=n,e.mat[4]=t,e},cc.math.Matrix3.createByTranslation=function(n,t){var e=new cc.math.Matrix3;return e.identity(),e.mat[6]=n,e.mat[7]=t,e},cc.math.Matrix3.createByQuaternion=function(n){if(!n)return null;var t=new cc.math.Matrix3,e=t.mat;return e[0]=1-2*(n.y*n.y+n.z*n.z),e[1]=2*(n.x*n.y-n.w*n.z),e[2]=2*(n.x*n.z+n.w*n.y),e[3]=2*(n.x*n.y+n.w*n.z),e[4]=1-2*(n.x*n.x+n.z*n.z),e[5]=2*(n.y*n.z-n.w*n.x),e[6]=2*(n.x*n.z-n.w*n.y),e[7]=2*(n.y*n.z+n.w*n.x),e[8]=1-2*(n.x*n.x+n.y*n.y),t},o.rotationToAxisAngle=function(){return cc.math.Quaternion.rotationMatrix(this).toAxisAndAngle()}},{}],206:[function(T,N,z){cc.math.Matrix4=function(t){t&&t.mat?this.mat=new Float32Array(t.mat):this.mat=new Float32Array(16)};var o=cc.math.Matrix4.prototype;o.fill=function(t){for(var e=this.mat,r=0;r<16;r++)e[r]=t[r];return this},cc.math.mat4Identity=function(t){var e=t.mat;return e[1]=e[2]=e[3]=e[4]=e[6]=e[7]=e[8]=e[9]=e[11]=e[12]=e[13]=e[14]=0,e[0]=e[5]=e[10]=e[15]=1,t},o.identity=function(){var t=this.mat;return t[1]=t[2]=t[3]=t[4]=t[6]=t[7]=t[8]=t[9]=t[11]=t[12]=t[13]=t[14]=0,t[0]=t[5]=t[10]=t[15]=1,this},o.get=function(t,e){return this.mat[t+4*e]},o.set=function(t,e,r){this.mat[t+4*e]=r},o.swap=function(t,e,r,a){var c=this.mat,h=c[t+4*e];c[t+4*e]=c[r+4*a],c[r+4*a]=h},cc.math.Matrix4._gaussj=function(t,e){var r,a,c,h,u,d,f,m,v,_=0,p=0,g=[0,0,0,0],y=[0,0,0,0],C=[0,0,0,0];for(r=0;r<4;r++){for(f=0,a=0;a<4;a++)if(C[a]!==1)for(c=0;c<4;c++)C[c]===0&&(d=Math.abs(t.get(a,c)))>=f&&(f=d,p=a,_=c);if(++C[_],p!==_){for(h=0;h<4;h++)t.swap(p,h,_,h);for(h=0;h<4;h++)e.swap(p,h,_,h)}if(y[r]=p,g[r]=_,t.get(_,_)===0)return!1;for(v=1/t.get(_,_),t.set(_,_,1),h=0;h<4;h++)t.set(_,h,t.get(_,h)*v);for(h=0;h<4;h++)e.set(_,h,e.get(_,h)*v);for(u=0;u<4;u++)if(u!==_){for(m=t.get(u,_),t.set(u,_,0),h=0;h<4;h++)t.set(u,h,t.get(u,h)-t.get(_,h)*m);for(h=0;h<4;h++)e.set(u,h,t.get(u,h)-e.get(_,h)*m)}}for(h=3;h>=0;h--)if(y[h]!==g[h])for(c=0;c<4;c++)t.swap(c,y[h],c,g[h]);return!0};var s=new cc.math.Matrix4().identity();cc.math.mat4Inverse=function(t,e){var r=new cc.math.Matrix4(e),a=new cc.math.Matrix4(s);return cc.math.Matrix4._gaussj(r,a)===!1?null:(t.assignFrom(r),t)},o.inverse=function(){var t=new cc.math.Matrix4(this),e=new cc.math.Matrix4(s);return cc.math.Matrix4._gaussj(t,e)===!1?null:t},o.isIdentity=function(){var t=this.mat;return t[0]===1&&t[1]===0&&t[2]===0&&t[3]===0&&t[4]===0&&t[5]===1&&t[6]===0&&t[7]===0&&t[8]===0&&t[9]===0&&t[10]===1&&t[11]===0&&t[12]===0&&t[13]===0&&t[14]===0&&t[15]===1},o.transpose=function(){var t=this.mat,e=t[1],r=t[2],a=t[3],c=t[4],h=t[6],u=t[7],d=t[8],f=t[9],m=t[11],v=t[12],_=t[13],p=t[14];return t[1]=c,t[2]=d,t[3]=v,t[4]=e,t[6]=f,t[7]=_,t[8]=r,t[9]=h,t[11]=p,t[12]=a,t[13]=u,t[14]=m,this},cc.math.mat4Multiply=function(t,e,r){var a=t.mat,c=e.mat,h=r.mat,u=c[0],d=c[1],f=c[2],m=c[3],v=c[4],_=c[5],p=c[6],g=c[7],y=c[8],C=c[9],S=c[10],I=c[11],b=c[12],A=c[13],E=c[14],R=c[15],O=h[0],P=h[1],x=h[2],w=h[3],L=h[4],D=h[5],F=h[6],M=h[7],B=h[8],W=h[9],V=h[10],U=h[11],k=h[12],X=h[13],Y=h[14],Z=h[15];return a[0]=O*u+P*v+x*y+w*b,a[1]=O*d+P*_+x*C+w*A,a[2]=O*f+P*p+x*S+w*E,a[3]=O*m+P*g+x*I+w*R,a[4]=L*u+D*v+F*y+M*b,a[5]=L*d+D*_+F*C+M*A,a[6]=L*f+D*p+F*S+M*E,a[7]=L*m+D*g+F*I+M*R,a[8]=B*u+W*v+V*y+U*b,a[9]=B*d+W*_+V*C+U*A,a[10]=B*f+W*p+V*S+U*E,a[11]=B*m+W*g+V*I+U*R,a[12]=k*u+X*v+Y*y+Z*b,a[13]=k*d+X*_+Y*C+Z*A,a[14]=k*f+X*p+Y*S+Z*E,a[15]=k*m+X*g+Y*I+Z*R,t},o.multiply=function(t){var e=this.mat,r=t.mat,a=e[0],c=e[1],h=e[2],u=e[3],d=e[4],f=e[5],m=e[6],v=e[7],_=e[8],p=e[9],g=e[10],y=e[11],C=e[12],S=e[13],I=e[14],b=e[15],A=r[0],E=r[1],R=r[2],O=r[3],P=r[4],x=r[5],w=r[6],L=r[7],D=r[8],F=r[9],M=r[10],B=r[11],W=r[12],V=r[13],U=r[14],k=r[15];return e[0]=A*a+E*d+R*_+O*C,e[1]=A*c+E*f+R*p+O*S,e[2]=A*h+E*m+R*g+O*I,e[3]=A*u+E*v+R*y+O*b,e[4]=P*a+x*d+w*_+L*C,e[5]=P*c+x*f+w*p+L*S,e[6]=P*h+x*m+w*g+L*I,e[7]=P*u+x*v+w*y+L*b,e[8]=D*a+F*d+M*_+B*C,e[9]=D*c+F*f+M*p+B*S,e[10]=D*h+F*m+M*g+B*I,e[11]=D*u+F*v+M*y+B*b,e[12]=W*a+V*d+U*_+k*C,e[13]=W*c+V*f+U*p+k*S,e[14]=W*h+V*m+U*g+k*I,e[15]=W*u+V*v+U*y+k*b,this},cc.math.getMat4MultiplyValue=function(t,e){var r=t.mat,a=e.mat,c=new Float32Array(16);return c[0]=r[0]*a[0]+r[4]*a[1]+r[8]*a[2]+r[12]*a[3],c[1]=r[1]*a[0]+r[5]*a[1]+r[9]*a[2]+r[13]*a[3],c[2]=r[2]*a[0]+r[6]*a[1]+r[10]*a[2]+r[14]*a[3],c[3]=r[3]*a[0]+r[7]*a[1]+r[11]*a[2]+r[15]*a[3],c[4]=r[0]*a[4]+r[4]*a[5]+r[8]*a[6]+r[12]*a[7],c[5]=r[1]*a[4]+r[5]*a[5]+r[9]*a[6]+r[13]*a[7],c[6]=r[2]*a[4]+r[6]*a[5]+r[10]*a[6]+r[14]*a[7],c[7]=r[3]*a[4]+r[7]*a[5]+r[11]*a[6]+r[15]*a[7],c[8]=r[0]*a[8]+r[4]*a[9]+r[8]*a[10]+r[12]*a[11],c[9]=r[1]*a[8]+r[5]*a[9]+r[9]*a[10]+r[13]*a[11],c[10]=r[2]*a[8]+r[6]*a[9]+r[10]*a[10]+r[14]*a[11],c[11]=r[3]*a[8]+r[7]*a[9]+r[11]*a[10]+r[15]*a[11],c[12]=r[0]*a[12]+r[4]*a[13]+r[8]*a[14]+r[12]*a[15],c[13]=r[1]*a[12]+r[5]*a[13]+r[9]*a[14]+r[13]*a[15],c[14]=r[2]*a[12]+r[6]*a[13]+r[10]*a[14]+r[14]*a[15],c[15]=r[3]*a[12]+r[7]*a[13]+r[11]*a[14]+r[15]*a[15],c},cc.math.mat4Assign=function(t,e){if(t===e)return cc.logID(7901),t;var r=t.mat,a=e.mat;return r[0]=a[0],r[1]=a[1],r[2]=a[2],r[3]=a[3],r[4]=a[4],r[5]=a[5],r[6]=a[6],r[7]=a[7],r[8]=a[8],r[9]=a[9],r[10]=a[10],r[11]=a[11],r[12]=a[12],r[13]=a[13],r[14]=a[14],r[15]=a[15],t},o.assignFrom=function(t){if(this===t)return cc.logID(7902),this;var e=this.mat,r=t.mat;return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[8]=r[8],e[9]=r[9],e[10]=r[10],e[11]=r[11],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15],this},o.equals=function(t){if(this===t)return cc.logID(7903),!0;for(var e=this.mat,r=t.mat,a=cc.math.EPSILON,c=0;c<16;c++)if(!(e[c]+a>r[c]&&e[c]-a<r[c]))return!1;return!0},cc.math.Matrix4.createByRotationX=function(t,e){var r=(e=e||new cc.math.Matrix4).mat;return r[0]=1,r[3]=r[2]=r[1]=0,r[4]=0,r[5]=Math.cos(t),r[6]=Math.sin(t),r[7]=0,r[8]=0,r[9]=-Math.sin(t),r[10]=Math.cos(t),r[11]=0,r[14]=r[13]=r[12]=0,r[15]=1,e},cc.math.Matrix4.createByRotationY=function(t,e){var r=(e=e||new cc.math.Matrix4).mat;return r[0]=Math.cos(t),r[1]=0,r[2]=-Math.sin(t),r[3]=0,r[7]=r[6]=r[4]=0,r[5]=1,r[8]=Math.sin(t),r[9]=0,r[10]=Math.cos(t),r[11]=0,r[14]=r[13]=r[12]=0,r[15]=1,e},cc.math.Matrix4.createByRotationZ=function(t,e){var r=(e=e||new cc.math.Matrix4).mat;return r[0]=Math.cos(t),r[1]=Math.sin(t),r[3]=r[2]=0,r[4]=-Math.sin(t),r[5]=Math.cos(t),r[7]=r[6]=0,r[11]=r[9]=r[8]=0,r[10]=1,r[14]=r[13]=r[12]=0,r[15]=1,e},cc.math.Matrix4.createByPitchYawRoll=function(t,e,r,a){a=a||new cc.math.Matrix4;var c=Math.cos(t),h=Math.sin(t),u=Math.cos(e),d=Math.sin(e),f=Math.cos(r),m=Math.sin(r),v=h*d,_=c*d,p=a.mat;return p[0]=u*f,p[4]=u*m,p[8]=-d,p[1]=v*f-c*m,p[5]=v*m+c*f,p[9]=h*u,p[2]=_*f+h*m,p[6]=_*m-h*f,p[10]=c*u,p[3]=p[7]=p[11]=0,p[15]=1,a},cc.math.Matrix4.createByQuaternion=function(t,e){var r=(e=e||new cc.math.Matrix4).mat;return r[0]=1-2*(t.y*t.y+t.z*t.z),r[1]=2*(t.x*t.y+t.z*t.w),r[2]=2*(t.x*t.z-t.y*t.w),r[3]=0,r[4]=2*(t.x*t.y-t.z*t.w),r[5]=1-2*(t.x*t.x+t.z*t.z),r[6]=2*(t.z*t.y+t.x*t.w),r[7]=0,r[8]=2*(t.x*t.z+t.y*t.w),r[9]=2*(t.y*t.z-t.x*t.w),r[10]=1-2*(t.x*t.x+t.y*t.y),r[11]=0,r[14]=r[13]=r[12]=0,r[15]=1,e},cc.math.Matrix4.createByRotationTranslation=function(t,e,r){var a=(r=r||new cc.math.Matrix4).mat,c=t.mat;return a[0]=c[0],a[1]=c[1],a[2]=c[2],a[3]=0,a[4]=c[3],a[5]=c[4],a[6]=c[5],a[7]=0,a[8]=c[6],a[9]=c[7],a[10]=c[8],a[11]=0,a[12]=e.x,a[13]=e.y,a[14]=e.z,a[15]=1,r},cc.math.Matrix4.createByScale=function(t,e,r,a){var c=(a=a||new cc.math.Matrix4).mat;return c[0]=t,c[5]=e,c[10]=r,c[15]=1,c[1]=c[2]=c[3]=c[4]=c[6]=c[7]=c[8]=c[9]=c[11]=c[12]=c[13]=c[14]=0,a},cc.math.mat4Translation=function(t,e,r,a){return t.mat[0]=t.mat[5]=t.mat[10]=t.mat[15]=1,t.mat[1]=t.mat[2]=t.mat[3]=t.mat[4]=t.mat[6]=t.mat[7]=t.mat[8]=t.mat[9]=t.mat[11]=0,t.mat[12]=e,t.mat[13]=r,t.mat[14]=a,t},cc.math.Matrix4.createByTranslation=function(t,e,r,a){return(a=a||new cc.math.Matrix4).identity(),a.mat[12]=t,a.mat[13]=e,a.mat[14]=r,a},o.getUpVec3=function(){var t=this.mat;return new cc.math.Vec3(t[4],t[5],t[6]).normalize()},o.getRightVec3=function(){var t=this.mat;return new cc.math.Vec3(t[0],t[1],t[2]).normalize()},o.getForwardVec3=function(){var t=this.mat;return new cc.math.Vec3(t[8],t[9],t[10]).normalize()},cc.math.mat4PerspectiveProjection=function(t,e,r,a,c){var h=cc.degreesToRadians(e/2),u=c-a,d=Math.sin(h);if(u===0||d===0||r===0)return null;var f=Math.cos(h)/d;return t.identity(),t.mat[0]=f/r,t.mat[5]=f,t.mat[10]=-(c+a)/u,t.mat[11]=-1,t.mat[14]=-2*a*c/u,t.mat[15]=0,t},cc.math.Matrix4.createPerspectiveProjection=function(t,e,r,a){var c=cc.degreesToRadians(t/2),h=a-r,u=Math.sin(c);if(h===0||u===0||e===0)return null;var d=Math.cos(c)/u,f=new cc.math.Matrix4,m=f.mat;return f.identity(),m[0]=d/e,m[5]=d,m[10]=-(a+r)/h,m[11]=-1,m[14]=-2*r*a/h,m[15]=0,f},cc.math.mat4OrthographicProjection=function(t,e,r,a,c,h,u){return t.identity(),t.mat[0]=2/(r-e),t.mat[5]=2/(c-a),t.mat[10]=-2/(u-h),t.mat[12]=-(r+e)/(r-e),t.mat[13]=-(c+a)/(c-a),t.mat[14]=-(u+h)/(u-h),t},cc.math.Matrix4.createOrthographicProjection=function(t,e,r,a,c,h){var u=new cc.math.Matrix4,d=u.mat;return u.identity(),d[0]=2/(e-t),d[5]=2/(a-r),d[10]=-2/(h-c),d[12]=-(e+t)/(e-t),d[13]=-(a+r)/(a-r),d[14]=-(h+c)/(h-c),u},cc.math.mat4LookAt=function(t,e,r,a){var c=new cc.math.Vec3(r),h=new cc.math.Vec3(a);c.subtract(e),c.normalize(),h.normalize();var u=new cc.math.Vec3(c);u.cross(h),u.normalize();var d=new cc.math.Vec3(u);d.cross(c),u.normalize(),t.identity(),t.mat[0]=u.x,t.mat[4]=u.y,t.mat[8]=u.z,t.mat[1]=d.x,t.mat[5]=d.y,t.mat[9]=d.z,t.mat[2]=-c.x,t.mat[6]=-c.y,t.mat[10]=-c.z;var f=cc.math.Matrix4.createByTranslation(-e.x,-e.y,-e.z);return t.multiply(f),t};var n=new cc.math.Matrix4;o.lookAt=function(t,e,r){var a=new cc.math.Vec3(e),c=new cc.math.Vec3(r),h=this.mat;a.subtract(t),a.normalize(),c.normalize();var u=new cc.math.Vec3(a);u.cross(c),u.normalize();var d=new cc.math.Vec3(u);return d.cross(a),u.normalize(),this.identity(),h[0]=u.x,h[4]=u.y,h[8]=u.z,h[1]=d.x,h[5]=d.y,h[9]=d.z,h[2]=-a.x,h[6]=-a.y,h[10]=-a.z,n=cc.math.Matrix4.createByTranslation(-t.x,-t.y,-t.z,n),this.multiply(n),this},cc.math.mat4RotationAxisAngle=function(t,e,r){var a=Math.cos(r),c=Math.sin(r),h=new cc.math.Vec3(e);return h.normalize(),t.mat[0]=a+h.x*h.x*(1-a),t.mat[1]=h.z*c+h.y*h.x*(1-a),t.mat[2]=-h.y*c+h.z*h.x*(1-a),t.mat[3]=0,t.mat[4]=-h.z*c+h.x*h.y*(1-a),t.mat[5]=a+h.y*h.y*(1-a),t.mat[6]=h.x*c+h.z*h.y*(1-a),t.mat[7]=0,t.mat[8]=h.y*c+h.x*h.z*(1-a),t.mat[9]=-h.x*c+h.y*h.z*(1-a),t.mat[10]=a+h.z*h.z*(1-a),t.mat[11]=0,t.mat[12]=0,t.mat[13]=0,t.mat[14]=0,t.mat[15]=1,t},cc.math.Matrix4.createByAxisAndAngle=function(t,e,r){r=r||new cc.math.Matrix4;var a=this.mat,c=Math.cos(e),h=Math.sin(e),u=new cc.math.Vec3(t);return u.normalize(),a[0]=c+u.x*u.x*(1-c),a[1]=u.z*h+u.y*u.x*(1-c),a[2]=-u.y*h+u.z*u.x*(1-c),a[3]=0,a[4]=-u.z*h+u.x*u.y*(1-c),a[5]=c+u.y*u.y*(1-c),a[6]=u.x*h+u.z*u.y*(1-c),a[7]=0,a[8]=u.y*h+u.x*u.z*(1-c),a[9]=-u.x*h+u.y*u.z*(1-c),a[10]=c+u.z*u.z*(1-c),a[11]=0,a[12]=a[13]=a[14]=0,a[15]=1,r},o.extractRotation=function(){var t=new cc.math.Matrix3,e=this.mat,r=t.mat;return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[4],r[4]=e[5],r[5]=e[6],r[6]=e[8],r[7]=e[9],r[8]=e[10],t},o.extractPlane=function(t){var e=new cc.math.Plane,r=this.mat;switch(t){case cc.math.Plane.RIGHT:e.a=r[3]-r[0],e.b=r[7]-r[4],e.c=r[11]-r[8],e.d=r[15]-r[12];break;case cc.math.Plane.LEFT:e.a=r[3]+r[0],e.b=r[7]+r[4],e.c=r[11]+r[8],e.d=r[15]+r[12];break;case cc.math.Plane.BOTTOM:e.a=r[3]+r[1],e.b=r[7]+r[5],e.c=r[11]+r[9],e.d=r[15]+r[13];break;case cc.math.Plane.TOP:e.a=r[3]-r[1],e.b=r[7]-r[5],e.c=r[11]-r[9],e.d=r[15]-r[13];break;case cc.math.Plane.FAR:e.a=r[3]-r[2],e.b=r[7]-r[6],e.c=r[11]-r[10],e.d=r[15]-r[14];break;case cc.math.Plane.NEAR:e.a=r[3]+r[2],e.b=r[7]+r[6],e.c=r[11]+r[10],e.d=r[15]+r[14];break;default:cc.logID(7904)}var a=Math.sqrt(e.a*e.a+e.b*e.b+e.c*e.c);return e.a/=a,e.b/=a,e.c/=a,e.d/=a,e},o.toAxisAndAngle=function(){var t=this.extractRotation();return cc.math.Quaternion.rotationMatrix(t).toAxisAndAngle()}},{}],207:[function(T,N,z){cc.math.Plane=function(s,n,t,e){s&&n===void 0?(this.a=s.a,this.b=s.b,this.c=s.c,this.d=s.d):(this.a=s||0,this.b=n||0,this.c=t||0,this.d=e||0)};var o=cc.math.Plane.prototype;cc.math.Plane.LEFT=0,cc.math.Plane.RIGHT=1,cc.math.Plane.BOTTOM=2,cc.math.Plane.TOP=3,cc.math.Plane.NEAR=4,cc.math.Plane.FAR=5,cc.math.Plane.POINT_INFRONT_OF_PLANE=0,cc.math.Plane.POINT_BEHIND_PLANE=1,cc.math.Plane.POINT_ON_PLANE=2,o.dot=function(s){return this.a*s.x+this.b*s.y+this.c*s.z+this.d*s.w},o.dotCoord=function(s){return this.a*s.x+this.b*s.y+this.c*s.z+this.d},o.dotNormal=function(s){return this.a*s.x+this.b*s.y+this.c*s.z},cc.math.Plane.fromPointNormal=function(s,n){return new cc.math.Plane(n.x,n.y,n.z,-n.dot(s))},cc.math.Plane.fromPoints=function(s,n,t){var e=new cc.math.Vec3(n),r=new cc.math.Vec3(t),a=new cc.math.Plane;return e.subtract(s),r.subtract(s),e.cross(r),e.normalize(),a.a=e.x,a.b=e.y,a.c=e.z,a.d=e.scale(-1).dot(s),a},o.normalize=function(){var s=new cc.math.Vec3(this.a,this.b,this.c),n=1/s.length();return s.normalize(),this.a=s.x,this.b=s.y,this.c=s.z,this.d=this.d*n,this},o.classifyPoint=function(s){var n=this.a*s.x+this.b*s.y+this.c*s.z+this.d;return n>.001?cc.math.Plane.POINT_INFRONT_OF_PLANE:n<-.001?cc.math.Plane.POINT_BEHIND_PLANE:cc.math.Plane.POINT_ON_PLANE}},{}],208:[function(T,N,z){cc.math.Quaternion=function(s,n,t,e){s&&n===void 0?(this.x=s.x,this.y=s.y,this.z=s.z,this.w=s.w):(this.x=s||0,this.y=n||0,this.z=t||0,this.w=e||0)};var o=cc.math.Quaternion.prototype;o.conjugate=function(s){return this.x=-s.x,this.y=-s.y,this.z=-s.z,this.w=s.w,this},o.dot=function(s){return this.w*s.w+this.x*s.x+this.y*s.y+this.z*s.z},o.exponential=function(){return this},o.identity=function(){return this.x=0,this.y=0,this.z=0,this.w=1,this},o.inverse=function(){var s=this.length();return Math.abs(s)>cc.math.EPSILON?(this.x=0,this.y=0,this.z=0,this.w=0,this):(this.conjugate(this).scale(1/s),this)},o.isIdentity=function(){return this.x===0&&this.y===0&&this.z===0&&this.w===1},o.length=function(){return Math.sqrt(this.lengthSq())},o.lengthSq=function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},o.multiply=function(s){var n=this.x,t=this.y,e=this.z,r=this.w;return this.w=r*s.w-n*s.x-t*s.y-e*s.z,this.x=r*s.x+n*s.w+t*s.z-e*s.y,this.y=r*s.y+t*s.w+e*s.x-n*s.z,this.z=r*s.z+e*s.w+n*s.y-t*s.x,this},o.normalize=function(){var s=this.length();if(Math.abs(s)<=cc.math.EPSILON)throw new Error("current quaternion is an invalid value");return this.scale(1/s),this},o.rotationAxis=function(s,n){var t=.5*n,e=Math.sin(t);return this.w=Math.cos(t),this.x=s.x*e,this.y=s.y*e,this.z=s.z*e,this},cc.math.Quaternion.rotationMatrix=function(s){if(!s)return null;var n,t,e,r,a=[],c=s.mat,h=0;a[0]=c[0],a[1]=c[3],a[2]=c[6],a[4]=c[1],a[5]=c[4],a[6]=c[7],a[8]=c[2],a[9]=c[5],a[10]=c[8],a[15]=1;var u=a[0],d=u[0]+u[5]+u[10]+1;return d>cc.math.EPSILON?(h=2*Math.sqrt(d),n=(u[9]-u[6])/h,t=(u[2]-u[8])/h,e=(u[4]-u[1])/h,r=.25*h):u[0]>u[5]&&u[0]>u[10]?(n=.25*(h=2*Math.sqrt(1+u[0]-u[5]-u[10])),t=(u[4]+u[1])/h,e=(u[2]+u[8])/h,r=(u[9]-u[6])/h):u[5]>u[10]?(h=2*Math.sqrt(1+u[5]-u[0]-u[10]),n=(u[4]+u[1])/h,t=.25*h,e=(u[9]+u[6])/h,r=(u[2]-u[8])/h):(h=2*Math.sqrt(1+u[10]-u[0]-u[5]),n=(u[2]+u[8])/h,t=(u[9]+u[6])/h,e=.25*h,r=(u[4]-u[1])/h),new cc.math.Quaternion(n,t,e,r)},cc.math.Quaternion.rotationYawPitchRoll=function(s,n,t){var e,r,a,c,h,u,d,f,m,v,_;e=cc.degreesToRadians(n)/2,r=cc.degreesToRadians(s)/2,a=cc.degreesToRadians(t)/2,c=Math.cos(e),h=Math.cos(r),u=Math.cos(a),d=Math.sin(e),v=h*u,_=(f=Math.sin(r))*(m=Math.sin(a));var p=new cc.math.Quaternion;return p.w=c*v+d*_,p.x=d*v-c*_,p.y=c*f*u+d*h*m,p.z=c*h*m-d*f*u,p.normalize(),p},o.slerp=function(s,n){if(this.x===s.x&&this.y===s.y&&this.z===s.z&&this.w===s.w)return this;var t=this.dot(s),e=Math.acos(t),r=Math.sqrt(1-cc.math.square(t)),a=Math.sin(n*e)/r,c=Math.sin((1-n)*e)/r,h=new cc.math.Quaternion(s);return this.scale(c),h.scale(a),this.add(h),this},o.toAxisAndAngle=function(){var s,n,t,e=new cc.math.Vec3;return s=Math.acos(this.w),(n=Math.sqrt(cc.math.square(this.x)+cc.math.square(this.y)+cc.math.square(this.z)))>-cc.math.EPSILON&&n<cc.math.EPSILON||n<2*Math.PI+cc.math.EPSILON&&n>2*Math.PI-cc.math.EPSILON?(t=0,e.x=0,e.y=0,e.z=1):(t=2*s,e.x=this.x/n,e.y=this.y/n,e.z=this.z/n,e.normalize()),{axis:e,angle:t}},o.scale=function(s){return this.x*=s,this.y*=s,this.z*=s,this.w*=s,this},o.assignFrom=function(s){return this.x=s.x,this.y=s.y,this.z=s.z,this.w=s.w,this},o.add=function(s){return this.x+=s.x,this.y+=s.y,this.z+=s.z,this.w+=s.w,this},cc.math.Quaternion.rotationBetweenVec3=function(s,n,t){var e=new cc.math.Vec3(s),r=new cc.math.Vec3(n);e.normalize(),r.normalize();var a=e.dot(r),c=new cc.math.Quaternion;if(a>=1)return c.identity(),c;if(a<1e-6-1)if(Math.abs(t.lengthSq())<cc.math.EPSILON)c.rotationAxis(t,Math.PI);else{var h=new cc.math.Vec3(1,0,0);h.cross(s),Math.abs(h.lengthSq())<cc.math.EPSILON&&(h.fill(0,1,0),h.cross(s)),h.normalize(),c.rotationAxis(h,Math.PI)}else{var u=Math.sqrt(2*(1+a)),d=1/u;e.cross(r),c.x=e.x*d,c.y=e.y*d,c.z=e.z*d,c.w=.5*u,c.normalize()}return c},o.multiplyVec3=function(s){var n=this.x,t=this.y,e=this.z,r=new cc.math.Vec3(s),a=new cc.math.Vec3(n,t,e),c=new cc.math.Vec3(n,t,e);return a.cross(s),c.cross(a),a.scale(2*q.w),c.scale(2),r.add(a),r.add(c),r}},{}],209:[function(T,N,z){function o(s,n,t){var e=new cc.math.Vec2(n);e.subtract(s),t.x=-e.y,t.y=e.x,t.normalize()}cc.math.Ray2=function(s,n){this.start=s||new cc.math.Vec2,this.dir=n||new cc.math.Vec2},cc.math.Ray2.prototype.fill=function(s,n,t,e){this.start.x=s,this.start.y=n,this.dir.x=t,this.dir.y=e},cc.math.Ray2.prototype.intersectLineSegment=function(s,n,t){var e,r,a,c=this.start.x,h=this.start.y,u=this.start.x+this.dir.x,d=this.start.y+this.dir.y,f=s.x,m=s.y,v=n.x,_=n.y,p=(_-m)*(u-c)-(v-f)*(d-h);return!(p>-cc.math.EPSILON&&p<cc.math.EPSILON)&&(e=((v-f)*(h-m)-(_-m)*(c-f))/p,r=c+e*(u-c),a=h+e*(d-h),!(r<Math.min(s.x,n.x)-cc.math.EPSILON||r>Math.max(s.x,n.x)+cc.math.EPSILON||a<Math.min(s.y,n.y)-cc.math.EPSILON||a>Math.max(s.y,n.y)+cc.math.EPSILON)&&!(r<Math.min(c,u)-cc.math.EPSILON||r>Math.max(c,u)+cc.math.EPSILON||a<Math.min(h,d)-cc.math.EPSILON||a>Math.max(h,d)+cc.math.EPSILON)&&(t.x=r,t.y=a,!0))},cc.math.Ray2.prototype.intersectTriangle=function(s,n,t,e,r){var a,c=new cc.math.Vec2,h=new cc.math.Vec2,u=new cc.math.Vec2,d=1e4,f=!1;return this.intersectLineSegment(s,n,c)&&(f=!0,(a=c.subtract(this.start).length())<d&&(h.x=c.x,h.y=c.y,d=a,o(s,n,u))),this.intersectLineSegment(n,t,c)&&(f=!0,(a=c.subtract(this.start).length())<d&&(h.x=c.x,h.y=c.y,d=a,o(n,t,u))),this.intersectLineSegment(t,s,c)&&(f=!0,(a=c.subtract(this.start).length())<d&&(h.x=c.x,h.y=c.y,d=a,o(t,s,u))),f&&(e.x=h.x,e.y=h.y,r&&(r.x=u.x,r.y=u.y)),f}},{}],210:[function(T,N,z){cc.math=cc.math||{},cc.math.EPSILON=1/64,cc.math.square=function(o){return o*o},cc.math.almostEqual=function(o,s){return o+cc.math.EPSILON>s&&o-cc.math.EPSILON<s}},{}],211:[function(T,N,z){cc.math.Vec2=function(s,n){n===void 0?(this.x=s.x,this.y=s.y):(this.x=s||0,this.y=n||0)};var o=cc.math.Vec2.prototype;o.fill=function(s,n){this.x=s,this.y=n},o.length=function(){return Math.sqrt(cc.math.square(this.x)+cc.math.square(this.y))},o.lengthSq=function(){return cc.math.square(this.x)+cc.math.square(this.y)},o.normalize=function(){var s=1/this.length();return this.x*=s,this.y*=s,this},cc.math.Vec2.add=function(s,n,t){return s.x=n.x+t.x,s.y=n.y+t.y,s},o.add=function(s){return this.x+=s.x,this.y+=s.y,this},o.dot=function(s){return this.x*s.x+this.y*s.y},cc.math.Vec2.subtract=function(s,n,t){return s.x=n.x-t.x,s.y=n.y-t.y,s},o.subtract=function(s){return this.x-=s.x,this.y-=s.y,this},o.transform=function(s){var n=this.x,t=this.y;return this.x=n*s.mat[0]+t*s.mat[3]+s.mat[6],this.y=n*s.mat[1]+t*s.mat[4]+s.mat[7],this},cc.math.Vec2.scale=function(s,n,t){return s.x=n.x*t,s.y=n.y*t,s},o.scale=function(s){return this.x*=s,this.y*=s,this},o.equals=function(s){return this.x<s.x+cc.math.EPSILON&&this.x>s.x-cc.math.EPSILON&&this.y<s.y+cc.math.EPSILON&&this.y>s.y-cc.math.EPSILON}},{}],212:[function(T,N,z){cc.math.Vec3=cc.math.Vec3=function(s,n,t){s&&n===void 0?(this.x=s.x,this.y=s.y,this.z=s.z):(this.x=s||0,this.y=n||0,this.z=t||0)},cc.math.vec3=function(s,n,t){return new cc.math.Vec3(s,n,t)};var o=cc.math.Vec3.prototype;o.fill=function(s,n,t){return s&&n===void 0?(this.x=s.x,this.y=s.y,this.z=s.z):(this.x=s,this.y=n,this.z=t),this},o.length=function(){return Math.sqrt(cc.math.square(this.x)+cc.math.square(this.y)+cc.math.square(this.z))},o.lengthSq=function(){return cc.math.square(this.x)+cc.math.square(this.y)+cc.math.square(this.z)},o.normalize=function(){var s=1/this.length();return this.x*=s,this.y*=s,this.z*=s,this},o.cross=function(s){var n=this.x,t=this.y,e=this.z;return this.x=t*s.z-e*s.y,this.y=e*s.x-n*s.z,this.z=n*s.y-t*s.x,this},o.dot=function(s){return this.x*s.x+this.y*s.y+this.z*s.z},o.add=function(s){return this.x+=s.x,this.y+=s.y,this.z+=s.z,this},o.subtract=function(s){return this.x-=s.x,this.y-=s.y,this.z-=s.z,this},o.transform=function(s){var n=this.x,t=this.y,e=this.z,r=s.mat;return this.x=n*r[0]+t*r[4]+e*r[8]+r[12],this.y=n*r[1]+t*r[5]+e*r[9]+r[13],this.z=n*r[2]+t*r[6]+e*r[10]+r[14],this},o.transformNormal=function(s){var n=this.x,t=this.y,e=this.z,r=s.mat;return this.x=n*r[0]+t*r[4]+e*r[8],this.y=n*r[1]+t*r[5]+e*r[9],this.z=n*r[2]+t*r[6]+e*r[10],this},o.transformCoord=function(s){var n=new cc.math.Vec4(this.x,this.y,this.z,1);return n.transform(s),this.x=n.x/n.w,this.y=n.y/n.w,this.z=n.z/n.w,this},o.scale=function(s){return this.x*=s,this.y*=s,this.z*=s,this},o.equals=function(s){var n=cc.math.EPSILON;return this.x<s.x+n&&this.x>s.x-n&&this.y<s.y+n&&this.y>s.y-n&&this.z<s.z+n&&this.z>s.z-n},o.inverseTransform=function(s){var n=s.mat,t=new cc.math.Vec3(this.x-n[12],this.y-n[13],this.z-n[14]);return this.x=t.x*n[0]+t.y*n[1]+t.z*n[2],this.y=t.x*n[4]+t.y*n[5]+t.z*n[6],this.z=t.x*n[8]+t.y*n[9]+t.z*n[10],this},o.inverseTransformNormal=function(s){var n=this.x,t=this.y,e=this.z,r=s.mat;return this.x=n*r[0]+t*r[1]+e*r[2],this.y=n*r[4]+t*r[5]+e*r[6],this.z=n*r[8]+t*r[9]+e*r[10],this},o.assignFrom=function(s){return s?(this.x=s.x,this.y=s.y,this.z=s.z,this):this},cc.math.Vec3.zero=function(s){return s.x=s.y=s.z=0,s},o.toTypeArray=function(){var s=new Float32Array(3);return s[0]=this.x,s[1]=this.y,s[2]=this.z,s}},{}],213:[function(T,N,z){cc.math.Vec4=function(s,n,t,e){s&&n===void 0?(this.x=s.x,this.y=s.y,this.z=s.z,this.w=s.w):(this.x=s||0,this.y=n||0,this.z=t||0,this.w=e||0)};var o=cc.math.Vec4.prototype;o.fill=function(s,n,t,e){s&&n===void 0?(this.x=s.x,this.y=s.y,this.z=s.z,this.w=s.w):(this.x=s,this.y=n,this.z=t,this.w=e)},o.add=function(s){return s?(this.x+=s.x,this.y+=s.y,this.z+=s.z,this.w+=s.w,this):this},o.dot=function(s){return this.x*s.x+this.y*s.y+this.z*s.z+this.w*s.w},o.length=function(){return Math.sqrt(cc.math.square(this.x)+cc.math.square(this.y)+cc.math.square(this.z)+cc.math.square(this.w))},o.lengthSq=function(){return cc.math.square(this.x)+cc.math.square(this.y)+cc.math.square(this.z)+cc.math.square(this.w)},o.lerp=function(s,n){return this},o.normalize=function(){var s=1/this.length();return this.x*=s,this.y*=s,this.z*=s,this.w*=s,this},o.scale=function(s){return this.normalize(),this.x*=s,this.y*=s,this.z*=s,this.w*=s,this},o.subtract=function(s){this.x-=s.x,this.y-=s.y,this.z-=s.z,this.w-=s.w},o.transform=function(s){var n=this.x,t=this.y,e=this.z,r=this.w,a=s.mat;return this.x=n*a[0]+t*a[4]+e*a[8]+r*a[12],this.y=n*a[1]+t*a[5]+e*a[9]+r*a[13],this.z=n*a[2]+t*a[6]+e*a[10]+r*a[14],this.w=n*a[3]+t*a[7]+e*a[11]+r*a[15],this},cc.math.Vec4.transformArray=function(s,n){for(var t=[],e=0;e<s.length;e++){var r=new cc.math.Vec4(s[e]);r.transform(n),t.push(r)}return t},o.equals=function(s){var n=cc.math.EPSILON;return this.x<s.x+n&&this.x>s.x-n&&this.y<s.y+n&&this.y>s.y-n&&this.z<s.z+n&&this.z>s.z-n&&this.w<s.w+n&&this.w>s.w-n},o.assignFrom=function(s){return this.x=s.x,this.y=s.y,this.z=s.z,this.w=s.w,this},o.toTypeArray=function(){var s=new Float32Array(4);return s[0]=this.x,s[1]=this.y,s[2]=this.z,s[3]=this.w,s}},{}],214:[function(T,N,z){var o=T("../compression/zlib.min"),s=cc._Class.extend({ctor:function(n){var t,e,r,a,c,h,u,d,f,m,v,_,p;for(this.data=n,this.pos=8,this.palette=[],this.imgData=[],this.transparency={},this.animation=null,this.text={},c=null;;){switch(t=this.readUInt32(),d=function(){var g,y;for(y=[],g=0;g<4;++g)y.push(String.fromCharCode(this.data[this.pos++]));return y}.call(this).join("")){case"IHDR":this.width=this.readUInt32(),this.height=this.readUInt32(),this.bits=this.data[this.pos++],this.colorType=this.data[this.pos++],this.compressionMethod=this.data[this.pos++],this.filterMethod=this.data[this.pos++],this.interlaceMethod=this.data[this.pos++];break;case"acTL":this.animation={numFrames:this.readUInt32(),numPlays:this.readUInt32()||1/0,frames:[]};break;case"PLTE":this.palette=this.read(t);break;case"fcTL":c&&this.animation.frames.push(c),this.pos+=4,c={width:this.readUInt32(),height:this.readUInt32(),xOffset:this.readUInt32(),yOffset:this.readUInt32()},a=this.readUInt16(),r=this.readUInt16()||100,c.delay=1e3*a/r,c.disposeOp=this.data[this.pos++],c.blendOp=this.data[this.pos++],c.data=[];break;case"IDAT":case"fdAT":for(d==="fdAT"&&(this.pos+=4,t-=4),n=(c!=null?c.data:void 0)||this.imgData,v=0;0<=t?v<t:v>t;0<=t?++v:--v)n.push(this.data[this.pos++]);break;case"tRNS":switch(this.transparency={},this.colorType){case 3:if(this.transparency.indexed=this.read(t),(f=255-this.transparency.indexed.length)>0)for(_=0;0<=f?_<f:_>f;0<=f?++_:--_)this.transparency.indexed.push(255);break;case 0:this.transparency.grayscale=this.read(t)[0];break;case 2:this.transparency.rgb=this.read(t)}break;case"tEXt":h=(m=this.read(t)).indexOf(0),u=String.fromCharCode.apply(String,m.slice(0,h)),this.text[u]=String.fromCharCode.apply(String,m.slice(h+1));break;case"IEND":return c&&this.animation.frames.push(c),this.colors=function(){switch(this.colorType){case 0:case 3:case 4:return 1;case 2:case 6:return 3}}.call(this),this.hasAlphaChannel=(p=this.colorType)===4||p===6,e=this.colors+(this.hasAlphaChannel?1:0),this.pixelBitlength=this.bits*e,this.colorSpace=function(){switch(this.colors){case 1:return"DeviceGray";case 3:return"DeviceRGB"}}.call(this),void(Uint8Array!=Array&&(this.imgData=new Uint8Array(this.imgData)));default:this.pos+=t}if(this.pos+=4,this.pos>this.data.length)throw new Error("Incomplete or corrupt PNG file")}},read:function(n){var t,e;for(e=[],t=0;0<=n?t<n:t>n;0<=n?++t:--t)e.push(this.data[this.pos++]);return e},readUInt32:function(){var n,t,e,r;return n=this.data[this.pos++]<<24,t=this.data[this.pos++]<<16,e=this.data[this.pos++]<<8,r=this.data[this.pos++],n|t|e|r},readUInt16:function(){var n,t;return n=this.data[this.pos++]<<8,t=this.data[this.pos++],n|t},decodePixels:function(n){var t,e,r,a,c,h,u,d,f,m,v,_,p,g,y,C,S,I,b,A,E,R,O;if(n==null&&(n=this.imgData),n.length===0)return new Uint8Array(0);for(n=new o.Inflate(n,{index:0,verify:!1}).decompress(),C=(_=this.pixelBitlength/8)*this.width,p=new Uint8Array(C*this.height),h=n.length,y=0,g=0,e=0;g<h;){switch(n[g++]){case 0:for(a=b=0;b<C;a=b+=1)p[e++]=n[g++];break;case 1:for(a=A=0;A<C;a=A+=1)t=n[g++],c=a<_?0:p[e-_],p[e++]=(t+c)%256;break;case 2:for(a=E=0;E<C;a=E+=1)t=n[g++],r=(a-a%_)/_,S=y&&p[(y-1)*C+r*_+a%_],p[e++]=(S+t)%256;break;case 3:for(a=R=0;R<C;a=R+=1)t=n[g++],r=(a-a%_)/_,c=a<_?0:p[e-_],S=y&&p[(y-1)*C+r*_+a%_],p[e++]=(t+Math.floor((c+S)/2))%256;break;case 4:for(a=O=0;O<C;a=O+=1)t=n[g++],r=(a-a%_)/_,c=a<_?0:p[e-_],y===0?S=I=0:(S=p[(y-1)*C+r*_+a%_],I=r&&p[(y-1)*C+(r-1)*_+a%_]),u=c+S-I,d=Math.abs(u-c),m=Math.abs(u-S),v=Math.abs(u-I),f=d<=m&&d<=v?c:m<=v?S:I,p[e++]=(t+f)%256;break;default:throw new Error("Invalid filter algorithm: "+n[g-1])}y++}return p},copyToImageData:function(n,t){var e,r,a,c,h,u,d,f,m,v,_;if(r=this.colors,m=null,e=this.hasAlphaChannel,this.palette.length&&(m=(_=this._decodedPalette)!=null?_:this._decodedPalette=this.decodePalette(),r=4,e=!0),a=n.data||n,f=a.length,h=m||t,c=u=0,r===1)for(;c<f;)d=m?4*t[c/4]:u,v=h[d++],a[c++]=v,a[c++]=v,a[c++]=v,a[c++]=e?h[d++]:255,u=d;else for(;c<f;)d=m?4*t[c/4]:u,a[c++]=h[d++],a[c++]=h[d++],a[c++]=h[d++],a[c++]=e?h[d++]:255,u=d},decodePalette:function(){var n,t,e,r,a,c,h,u,d;for(e=this.palette,c=this.transparency.indexed||[],a=new Uint8Array((c.length||0)+e.length),r=0,n=0,t=h=0,u=e.length;h<u;t=h+=3)a[r++]=e[t],a[r++]=e[t+1],a[r++]=e[t+2],a[r++]=(d=c[n++])!=null?d:255;return a},render:function(n){var t,e;return n.width=this.width,n.height=this.height,t=n.getContext("2d"),e=t.createImageData(this.width,this.height),this.copyToImageData(e,this.decodePixels()),t.putImageData(e,0,0)}});N.exports=s},{"../compression/zlib.min":31}],215:[function(T,N,z){var o=cc.Class({name:"cc.ParticleAsset",extends:cc.RawAsset});cc.ParticleAsset=N.exports=o},{}],216:[function(T,N,z){T("./CCParticleAsset"),T("./CCSGParticleSystem"),T("./CCSGParticleSystemCanvasRenderCmd"),T("./CCSGParticleSystemWebGLRenderCmd");var o=cc.BlendFunc.BlendFactor,s=cc.Enum({GRAVITY:0,RADIUS:1}),n=cc.Enum({FREE:0,RELATIVE:1,GROUPED:2}),t={preview:{default:!0,editorOnly:!0,notify:!1,animatable:!1,tooltip:!1},_custom:!1,custom:{get:function(){return this._custom},set:function(a){this._custom!==a&&(this._custom=a,a?this._applyCustoms():this._applyFile())},animatable:!1,tooltip:!1},_file:{default:"",url:cc.ParticleAsset},file:{get:function(){return this._file},set:function(a,c){this._file!==a&&(this._file=a,a?this._applyFile():this.custom=!0)},animatable:!1,url:cc.ParticleAsset,tooltip:!1},_texture:{default:"",url:cc.Texture2D},texture:{get:function(){return this._texture},set:function(a){this._texture=a,this._sgNode.texture=a?cc.textureCache.addImage(a):null,!a&&this._file&&this._applyFile()},url:cc.Texture2D,tooltip:!1},particleCount:{get:function(){return this._sgNode.particleCount},set:function(a){this._sgNode.particleCount=a},visible:!1,tooltip:!1},_srcBlendFactor:o.SRC_ALPHA,srcBlendFactor:{get:function(){return this._srcBlendFactor},set:function(a){this._srcBlendFactor=a,this._blendFunc.src=a,this._sgNode.setBlendFunc(this._blendFunc)},animatable:!1,type:o,tooltip:!1},_dstBlendFactor:o.ONE_MINUS_SRC_ALPHA,dstBlendFactor:{get:function(){return this._dstBlendFactor},set:function(a){this._dstBlendFactor=a,this._blendFunc.dst=a,this._sgNode.setBlendFunc(this._blendFunc)},animatable:!1,type:o,tooltip:!1},playOnLoad:!0,_autoRemoveOnFinish:!1,autoRemoveOnFinish:{get:function(){return this._autoRemoveOnFinish},set:function(a){this._autoRemoveOnFinish!==a&&(this._autoRemoveOnFinish=a,this._applyAutoRemove())},animatable:!1,tooltip:!1},active:{get:function(){return!!this._sgNode&&this._sgNode.isActive()},visible:!1}},e=function(){for(var a={totalParticles:150,duration:-1,emissionRate:10,life:1,lifeVar:0,startColor:cc.Color.WHITE,startColorVar:cc.Color.BLACK,endColor:cc.color(255,255,255,0),endColorVar:cc.color(0,0,0,0),angle:90,angleVar:20,startSize:50,startSizeVar:0,endSize:0,endSizeVar:0,startSpin:0,startSpinVar:0,endSpin:0,endSpinVar:0,sourcePos:cc.p(0,0),posVar:cc.p(0,0),positionType:n.FREE,emitterMode:s.GRAVITY,gravity:cc.p(0,0),speed:180,speedVar:50,tangentialAccel:80,tangentialAccelVar:0,radialAccel:0,radialAccelVar:0,rotationIsDir:!1,startRadius:0,startRadiusVar:0,endRadius:0,endRadiusVar:0,rotatePerS:0,rotatePerSVar:0},c=Object.keys(a),h=0;h<c.length;++h){var u=c[h];(function(d,f){var m="_"+d;t[m]=f;var v=f.constructor,_=t[d]={};cc.isChildClassOf(v,cc.ValueType)?(_.get=function(){return new v(this[m])},_.type=v):_.get=function(){return this[m]},cc.isChildClassOf(v,cc.ValueType)?_.set=function(p){this[m]=new v(p),this._sgNode[d]=p}:_.set=function(p){this[m]=p,this._sgNode[d]=p}})(u,a[u])}return c}();t.positionType.type=n,t.emitterMode.type=s;var r=cc.Class({name:"cc.ParticleSystem",extends:cc._RendererUnderSG,editor:!1,ctor:function(){this._previewTimer=null,this._focused=!1,this._willStart=!1,this._blendFunc=new cc.BlendFunc(0,0),this._originOnExit=null},properties:t,statics:{DURATION_INFINITY:-1,START_SIZE_EQUAL_TO_END_SIZE:-1,START_RADIUS_EQUAL_TO_END_RADIUS:-1,EmitterMode:s,PositionType:n},__preload:function(){this._super(),this.playOnLoad&&this.resetSystem(),this._applyAutoRemove()},onDestroy:function(){this._autoRemoveOnFinish&&(this.autoRemoveOnFinish=!1),this._super()},onFocusInEditor:!1,onLostFocusInEditor:!1,_createSgNode:function(){return new _ccsg.ParticleSystem},_initSgNode:function(){var a=this._sgNode;this._file?this._custom?this._texture?this._applyCustoms():this._applyFile():this._applyFile():this._custom&&this._applyCustoms(),a.stopSystem()},addParticle:function(){return this._sgNode.addParticle()},stopSystem:function(){this._sgNode.stopSystem()},resetSystem:function(){this._sgNode.resetSystem()},isFull:function(){return this.particleCount>=this._totalParticles},setDisplayFrame:function(a){if(a){var c=a.getTexture();c&&(this._texture=c.url),this._sgNode.setDisplayFrame(a)}},setTextureWithRect:function(a,c){a instanceof cc.Texture2D&&(this._texture=a.url),this._sgNode.setTextureWithRect(a,c)},_applyFile:function(){var a=this._file;if(a){var c=this;cc.loader.load(a,function(h,u){if(h||!u)throw h||new Error("Unkown error");if(c.isValid){var d=c._sgNode;d.particleCount=0;var f=d.isActive();d.initWithFile(a),u.textureUuid&&cc.AssetLibrary.queryAssetInfo(u.textureUuid,function(m,v,_){m?cc.error(m):c.texture=v}),u.emissionRate&&(c.emissionRate=u.emissionRate),d.setPosition(0,0),f||d.stopSystem(),c._applyAutoRemove(),c._custom&&c._applyCustoms()}})}},_applyCustoms:function(){for(var a=this._sgNode,c=a.isActive(),h=0;h<e.length;h++){var u=e[h];a[u]=this["_"+u]}this._blendFunc.src=this._srcBlendFactor,this._blendFunc.dst=this._dstBlendFactor,a.setBlendFunc(this._blendFunc),this._texture&&(a.texture=cc.textureCache.addImage(this._texture)),c||a.stopSystem(),this._applyAutoRemove()},_applyAutoRemove:function(){var a=this._sgNode,c=this._autoRemoveOnFinish;if(a.autoRemoveOnFinish=c,c){if(this._originOnExit)return;this._originOnExit=a.onExit;var h=this;a.onExit=function(){h._originOnExit.call(this),h.node.destroy()}}else this._originOnExit&&(a.onExit=this._originOnExit,this._originOnExit=null)}});cc.ParticleSystem=N.exports=r},{"./CCParticleAsset":215,"./CCSGParticleSystem":217,"./CCSGParticleSystemCanvasRenderCmd":218,"./CCSGParticleSystemWebGLRenderCmd":219}],217:[function(T,N,z){var o=T("./CCPNGReader"),s=T("./CCTIFFReader");T("../compression/ZipUtils"),cc.Particle=function(t,e,r,a,c,h,u,d,f,m,v){this.pos=t||cc.v2(0,0),this.startPos=e||cc.v2(0,0),this.color=r||cc.color(0,0,0,255),this.deltaColor=a||{r:0,g:0,b:0,a:255},this.size=c||0,this.deltaSize=h||0,this.rotation=u||0,this.deltaRotation=d||0,this.timeToLive=f||0,this.modeA=m||new cc.Particle.ModeA,this.modeB=v||new cc.Particle.ModeB,this.isChangeColor=!1,this.drawPos=cc.p(0,0)},cc.Particle.ModeA=function(t,e,r){this.dir=t||cc.p(0,0),this.radialAccel=e||0,this.tangentialAccel=r||0},cc.Particle.ModeB=function(t,e,r,a){this.angle=t||0,this.degreesPerSecond=e||0,this.radius=r||0,this.deltaRadius=a||0},cc.Particle.TemporaryPoints=[cc.p(),cc.p(),cc.p(),cc.p()],_ccsg.ParticleSystem=_ccsg.Node.extend({_className:"ParticleSystem",_plistFile:"",_elapsed:0,_dontTint:!1,modeA:null,modeB:null,_pointZeroForParticle:cc.p(0,0),_particles:null,_emitCounter:0,_particleIdx:0,_allocatedParticles:0,_isActive:!1,particleCount:0,duration:0,_sourcePosition:null,_posVar:null,life:0,lifeVar:0,angle:0,angleVar:0,startSize:0,startSizeVar:0,endSize:0,endSizeVar:0,_startColor:null,_startColorVar:null,_endColor:null,_endColorVar:null,startSpin:0,startSpinVar:0,endSpin:0,endSpinVar:0,emissionRate:0,_totalParticles:0,_texture:null,_blendFunc:null,_opacityModifyRGB:!1,positionType:null,autoRemoveOnFinish:!1,emitterMode:0,_textureLoaded:null,ctor:function(t){if(_ccsg.Node.prototype.ctor.call(this),this.emitterMode=_ccsg.ParticleSystem.Mode.GRAVITY,this.modeA=new _ccsg.ParticleSystem.ModeA,this.modeB=new _ccsg.ParticleSystem.ModeB,this._blendFunc={src:cc.macro.BLEND_SRC,dst:cc.macro.BLEND_DST},this._particles=[],this._sourcePosition=cc.p(0,0),this._posVar=cc.p(0,0),this._startColor=cc.color(255,255,255,255),this._startColorVar=cc.color(255,255,255,255),this._endColor=cc.color(255,255,255,255),this._endColorVar=cc.color(255,255,255,255),this._plistFile="",this._elapsed=0,this._dontTint=!1,this._pointZeroForParticle=cc.p(0,0),this._emitCounter=0,this._particleIdx=0,this._allocatedParticles=0,this._isActive=!1,this.particleCount=0,this.duration=0,this.life=0,this.lifeVar=0,this.angle=0,this.angleVar=0,this.startSize=0,this.startSizeVar=0,this.endSize=0,this.endSizeVar=0,this.startSpin=0,this.startSpinVar=0,this.endSpin=0,this.endSpinVar=0,this.emissionRate=0,this._totalParticles=0,this._texture=null,this._opacityModifyRGB=!1,this.positionType=_ccsg.ParticleSystem.Type.FREE,this.autoRemoveOnFinish=!1,this._textureLoaded=!0,!t||cc.js.isNumber(t)){var e=t||100;this.initWithTotalParticles(e)}else typeof t=="string"?this.initWithFile(t):typeof t=="object"&&this.initWithDictionary(t,"")},_createRenderCmd:function(){return cc._renderType===cc.game.RENDER_TYPE_CANVAS?new _ccsg.ParticleSystem.CanvasRenderCmd(this):new _ccsg.ParticleSystem.WebGLRenderCmd(this)},onEnter:function(){this.scheduleUpdateWithPriority(1),_ccsg.Node.prototype.onEnter.call(this)},ignoreColor:function(t){this._dontTint=t},initTexCoordsWithRect:function(t){this._renderCmd.initTexCoordsWithRect(t)},isActive:function(){return this._isActive},getParticleCount:function(){return this.particleCount},setParticleCount:function(t){this.particleCount=t},getDuration:function(){return this.duration},setDuration:function(t){this.duration=t},getSourcePosition:function(){return{x:this._sourcePosition.x,y:this._sourcePosition.y}},setSourcePosition:function(t){this._sourcePosition.x=t.x,this._sourcePosition.y=t.y},getPosVar:function(){return{x:this._posVar.x,y:this._posVar.y}},setPosVar:function(t){this._posVar.x=t.x,this._posVar.y=t.y},getLife:function(){return this.life},setLife:function(t){this.life=t},getLifeVar:function(){return this.lifeVar},setLifeVar:function(t){this.lifeVar=t},getAngle:function(){return this.angle},setAngle:function(t){this.angle=t},getAngleVar:function(){return this.angleVar},setAngleVar:function(t){this.angleVar=t},getGravity:function(){var t=this.modeA.gravity;return cc.p(t.x,t.y)},setGravity:function(t){this.modeA.gravity=t},getSpeed:function(){return this.modeA.speed},setSpeed:function(t){this.modeA.speed=t},getSpeedVar:function(){return this.modeA.speedVar},setSpeedVar:function(t){this.modeA.speedVar=t},getTangentialAccel:function(){return this.modeA.tangentialAccel},setTangentialAccel:function(t){this.modeA.tangentialAccel=t},getTangentialAccelVar:function(){return this.modeA.tangentialAccelVar},setTangentialAccelVar:function(t){this.modeA.tangentialAccelVar=t},getRadialAccel:function(){return this.modeA.radialAccel},setRadialAccel:function(t){this.modeA.radialAccel=t},getRadialAccelVar:function(){return this.modeA.radialAccelVar},setRadialAccelVar:function(t){this.modeA.radialAccelVar=t},getRotationIsDir:function(){return this.modeA.rotationIsDir},setRotationIsDir:function(t){this.modeA.rotationIsDir=t},getStartRadius:function(){return this.modeB.startRadius},setStartRadius:function(t){this.modeB.startRadius=t},getStartRadiusVar:function(){return this.modeB.startRadiusVar},setStartRadiusVar:function(t){this.modeB.startRadiusVar=t},getEndRadius:function(){return this.modeB.endRadius},setEndRadius:function(t){this.modeB.endRadius=t},getEndRadiusVar:function(){return this.modeB.endRadiusVar},setEndRadiusVar:function(t){this.modeB.endRadiusVar=t},getRotatePerSecond:function(){return this.modeB.rotatePerSecond},setRotatePerSecond:function(t){this.modeB.rotatePerSecond=t},getRotatePerSecondVar:function(){return this.modeB.rotatePerSecondVar},setRotatePerSecondVar:function(t){this.modeB.rotatePerSecondVar=t},getStartSize:function(){return this.startSize},setStartSize:function(t){this.startSize=t},getStartSizeVar:function(){return this.startSizeVar},setStartSizeVar:function(t){this.startSizeVar=t},getEndSize:function(){return this.endSize},setEndSize:function(t){this.endSize=t},getEndSizeVar:function(){return this.endSizeVar},setEndSizeVar:function(t){this.endSizeVar=t},getStartColor:function(){return cc.color(this._startColor.r,this._startColor.g,this._startColor.b,this._startColor.a)},setStartColor:function(t){this._startColor.fromColor(t)},getStartColorVar:function(){return cc.color(this._startColorVar.r,this._startColorVar.g,this._startColorVar.b,this._startColorVar.a)},setStartColorVar:function(t){this._startColorVar.fromColor(t)},getEndColor:function(){return cc.color(this._endColor.r,this._endColor.g,this._endColor.b,this._endColor.a)},setEndColor:function(t){this._endColor.fromColor(t)},getEndColorVar:function(){return cc.color(this._endColorVar.r,this._endColorVar.g,this._endColorVar.b,this._endColorVar.a)},setEndColorVar:function(t){this._endColorVar.fromColor(t)},getStartSpin:function(){return this.startSpin},setStartSpin:function(t){this.startSpin=t},getStartSpinVar:function(){return this.startSpinVar},setStartSpinVar:function(t){this.startSpinVar=t},getEndSpin:function(){return this.endSpin},setEndSpin:function(t){this.endSpin=t},getEndSpinVar:function(){return this.endSpinVar},setEndSpinVar:function(t){this.endSpinVar=t},getEmissionRate:function(){return this.emissionRate},setEmissionRate:function(t){this.emissionRate=t},getTotalParticles:function(){return this._totalParticles},setTotalParticles:function(t){this._renderCmd.setTotalParticles(t)},getTexture:function(){return this._texture},setTexture:function(t){t&&(t.loaded?this.setTextureWithRect(t,cc.rect(0,0,t.width,t.height)):(this._textureLoaded=!1,t.once("load",function(e){this._textureLoaded=!0,this.setTextureWithRect(t,cc.rect(0,0,t.width,t.height))},this)))},getBlendFunc:function(){return this._blendFunc},setBlendFunc:function(t,e){e===void 0?this._blendFunc!==t&&(this._blendFunc=t,this._updateBlendFunc()):this._blendFunc.src===t&&this._blendFunc.dst===e||(this._blendFunc={src:t,dst:e},this._updateBlendFunc())},isOpacityModifyRGB:function(){return this._opacityModifyRGB},setOpacityModifyRGB:function(t){this._opacityModifyRGB=t},isBlendAdditive:function(){return this._blendFunc.src===cc.macro.SRC_ALPHA&&this._blendFunc.dst===cc.macro.ONE||this._blendFunc.src===cc.macro.ONE&&this._blendFunc.dst===cc.macro.ONE},setBlendAdditive:function(t){var e=this._blendFunc;t?(e.src=cc.macro.SRC_ALPHA,e.dst=cc.macro.ONE):this._renderCmd._setBlendAdditive()},getPositionType:function(){return this.positionType},setPositionType:function(t){this.positionType=t},isAutoRemoveOnFinish:function(){return this.autoRemoveOnFinish},setAutoRemoveOnFinish:function(t){this.autoRemoveOnFinish=t},getEmitterMode:function(){return this.emitterMode},setEmitterMode:function(t){this.emitterMode=t},init:function(){return this.initWithTotalParticles(150)},initWithFile:function(t){this._plistFile=t;var e=cc.loader.getRes(t);return e?this.initWithDictionary(e,""):(cc.logID(6008),!1)},getBoundingBoxToWorld:function(){return cc.rect(0,0,cc._canvas.width,cc._canvas.height)},initWithDictionary:function(t,e){var r=!1,a=null,c=this._valueForKey,h=parseInt(c("maxParticles",t));if(this.initWithTotalParticles(h)){this.angle=parseFloat(c("angle",t)),this.angleVar=parseFloat(c("angleVariance",t)),this.duration=parseFloat(c("duration",t)),this._blendFunc.src=parseInt(c("blendFuncSource",t)),this._blendFunc.dst=parseInt(c("blendFuncDestination",t));var u=this._startColor;u.r=255*parseFloat(c("startColorRed",t)),u.g=255*parseFloat(c("startColorGreen",t)),u.b=255*parseFloat(c("startColorBlue",t)),u.a=255*parseFloat(c("startColorAlpha",t));var d=this._startColorVar;d.r=255*parseFloat(c("startColorVarianceRed",t)),d.g=255*parseFloat(c("startColorVarianceGreen",t)),d.b=255*parseFloat(c("startColorVarianceBlue",t)),d.a=255*parseFloat(c("startColorVarianceAlpha",t));var f=this._endColor;f.r=255*parseFloat(c("finishColorRed",t)),f.g=255*parseFloat(c("finishColorGreen",t)),f.b=255*parseFloat(c("finishColorBlue",t)),f.a=255*parseFloat(c("finishColorAlpha",t));var m=this._endColorVar;if(m.r=255*parseFloat(c("finishColorVarianceRed",t)),m.g=255*parseFloat(c("finishColorVarianceGreen",t)),m.b=255*parseFloat(c("finishColorVarianceBlue",t)),m.a=255*parseFloat(c("finishColorVarianceAlpha",t)),this.startSize=parseFloat(c("startParticleSize",t)),this.startSizeVar=parseFloat(c("startParticleSizeVariance",t)),this.endSize=parseFloat(c("finishParticleSize",t)),this.endSizeVar=parseFloat(c("finishParticleSizeVariance",t)),this.setPosition(parseFloat(c("sourcePositionx",t)),parseFloat(c("sourcePositiony",t))),this._posVar.x=parseFloat(c("sourcePositionVariancex",t)),this._posVar.y=parseFloat(c("sourcePositionVariancey",t)),this.startSpin=parseFloat(c("rotationStart",t)),this.startSpinVar=parseFloat(c("rotationStartVariance",t)),this.endSpin=parseFloat(c("rotationEnd",t)),this.endSpinVar=parseFloat(c("rotationEndVariance",t)),this.emitterMode=parseInt(c("emitterType",t)),this.emitterMode===_ccsg.ParticleSystem.Mode.GRAVITY){var v=this.modeA;v.gravity.x=parseFloat(c("gravityx",t)),v.gravity.y=parseFloat(c("gravityy",t)),v.speed=parseFloat(c("speed",t)),v.speedVar=parseFloat(c("speedVariance",t));var _=c("radialAcceleration",t);v.radialAccel=_?parseFloat(_):0,_=c("radialAccelVariance",t),v.radialAccelVar=_?parseFloat(_):0,_=c("tangentialAcceleration",t),v.tangentialAccel=_?parseFloat(_):0,_=c("tangentialAccelVariance",t),v.tangentialAccelVar=_?parseFloat(_):0;var p=c("rotationIsDir",t);p!==null?(p=p.toString().toLowerCase(),v.rotationIsDir=p==="true"||p==="1"):v.rotationIsDir=!1}else{if(this.emitterMode!==_ccsg.ParticleSystem.Mode.RADIUS)return cc.logID(6009),!1;var g=this.modeB;g.startRadius=parseFloat(c("maxRadius",t)),g.startRadiusVar=parseFloat(c("maxRadiusVariance",t)),g.endRadius=parseFloat(c("minRadius",t)),g.endRadiusVar=0,g.rotatePerSecond=parseFloat(c("rotatePerSecond",t)),g.rotatePerSecondVar=parseFloat(c("rotatePerSecondVariance",t))}this.life=parseFloat(c("particleLifespan",t)),this.lifeVar=parseFloat(c("particleLifespanVariance",t)),this.emissionRate=this._totalParticles/this.life,this._opacityModifyRGB=!1;var y=c("textureFileName",t),C=cc.path.changeBasename(this._plistFile,y),S=cc.textureCache.getTextureForKey(C);if(S)this.setTexture(S);else{var I=c("textureImageData",t);if(I&&I.length!==0){if(!(a=cc.Codec.unzipBase64AsArray(I,1)))return cc.logID(6010),!1;var b=cc.getImageFormatByData(a);if(b!==cc.ImageFormat.TIFF&&b!==cc.ImageFormat.PNG)return cc.logID(6011),!1;var A=document.createElement("canvas");b===cc.ImageFormat.PNG?new o(a).render(A):s.parseTIFF(a,A),cc.textureCache.cacheImage(C,A);var E=cc.textureCache.getTextureForKey(C);E||cc.logID(6012),this.setTexture(E)}else{if(!(S=cc.textureCache.addImage(C)))return!1;this.setTexture(S)}}r=!0}return r},initWithTotalParticles:function(t){this._totalParticles=t;var e=this._particles;if(!e)return cc.logID(6013),!1;e.length=t;for(var r=0;r<t;r++)e[r]=new cc.Particle;return this._allocatedParticles=t,this._isActive=!0,this._blendFunc.src=cc.macro.BLEND_SRC,this._blendFunc.dst=cc.macro.BLEND_DST,this.positionType=_ccsg.ParticleSystem.Type.FREE,this.emitterMode=_ccsg.ParticleSystem.Mode.GRAVITY,this.autoRemoveOnFinish=!1,this._renderCmd._initWithTotalParticles(t),!0},addParticle:function(){if(this.isFull())return!1;var t=this._renderCmd.addParticle();return this.initParticle(t),++this.particleCount,!0},initParticle:function(t){var e=cc.randomMinus1To1;t.timeToLive=this.life+this.lifeVar*e(),t.timeToLive=Math.max(0,t.timeToLive),t.pos.x=this._sourcePosition.x+this._posVar.x*e(),t.pos.y=this._sourcePosition.y+this._posVar.y*e();var r,a,c=this._startColor,h=this._startColorVar,u=this._endColor,d=this._endColorVar;r={r:cc.clampf(c.r+h.r*e(),0,255),g:cc.clampf(c.g+h.g*e(),0,255),b:cc.clampf(c.b+h.b*e(),0,255),a:cc.clampf(c.a+h.a*e(),0,255)},a={r:cc.clampf(u.r+d.r*e(),0,255),g:cc.clampf(u.g+d.g*e(),0,255),b:cc.clampf(u.b+d.b*e(),0,255),a:cc.clampf(u.a+d.a*e(),0,255)},t.color=r;var f=t.deltaColor,m=t.timeToLive;f.r=(a.r-r.r)/m,f.g=(a.g-r.g)/m,f.b=(a.b-r.b)/m,f.a=(a.a-r.a)/m;var v=this.startSize+this.startSizeVar*e();if(v=Math.max(0,v),t.size=v,this.endSize===_ccsg.ParticleSystem.START_SIZE_EQUAL_TO_END_SIZE)t.deltaSize=0;else{var _=this.endSize+this.endSizeVar*e();_=Math.max(0,_),t.deltaSize=(_-v)/m}var p=this.startSpin+this.startSpinVar*e(),g=this.endSpin+this.endSpinVar*e();t.rotation=p,t.deltaRotation=(g-p)/m,this.positionType===_ccsg.ParticleSystem.Type.FREE?t.startPos=this.convertToWorldSpace(this._pointZeroForParticle):this.positionType===_ccsg.ParticleSystem.Type.RELATIVE&&(t.startPos.x=this._position.x,t.startPos.y=this._position.y);var y=cc.degreesToRadians(this.angle+this.angleVar*e());if(this.emitterMode===_ccsg.ParticleSystem.Mode.GRAVITY){var C=this.modeA,S=t.modeA,I=C.speed+C.speedVar*e();S.dir.x=Math.cos(y),S.dir.y=Math.sin(y),cc.pMultIn(S.dir,I),S.radialAccel=C.radialAccel+C.radialAccelVar*e(),S.tangentialAccel=C.tangentialAccel+C.tangentialAccelVar*e(),C.rotationIsDir&&(t.rotation=-cc.radiansToDegrees(cc.pToAngle(S.dir)))}else{var b=this.modeB,A=t.modeB,E=b.startRadius+b.startRadiusVar*e(),R=b.endRadius+b.endRadiusVar*e();A.radius=E,A.deltaRadius=b.endRadius===_ccsg.ParticleSystem.START_RADIUS_EQUAL_TO_END_RADIUS?0:(R-E)/m,A.angle=y,A.degreesPerSecond=cc.degreesToRadians(b.rotatePerSecond+b.rotatePerSecondVar*e())}},stopSystem:function(){this._isActive=!1,this._elapsed=this.duration,this._emitCounter=0},resetSystem:function(){this._isActive=!0,this._elapsed=0;var t=this._particles;for(this._particleIdx=0;this._particleIdx<this.particleCount;++this._particleIdx)t[this._particleIdx].timeToLive=0},isFull:function(){return this.particleCount>=this._totalParticles},updateQuadWithParticle:function(t,e){this._renderCmd.updateQuadWithParticle(t,e)},postStep:function(){this._renderCmd.postStep()},update:function(t){if(this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.contentDirty),this._isActive&&this.emissionRate){var e=1/this.emissionRate;for(this.particleCount<this._totalParticles&&(this._emitCounter+=t);this.particleCount<this._totalParticles&&this._emitCounter>e;)this.addParticle(),this._emitCounter-=e;this._elapsed+=t,this.duration!==-1&&this.duration<this._elapsed&&this.stopSystem()}this._particleIdx=0;var r=this.getWorldToNodeTransform(),a=cc.Particle.TemporaryPoints[0];if(this.positionType===_ccsg.ParticleSystem.Type.FREE?cc.pIn(a,this.convertToWorldSpace(this._pointZeroForParticle)):this.positionType===_ccsg.ParticleSystem.Type.RELATIVE&&(a.x=this._position.x,a.y=this._position.y),this._visible){for(var c=cc.Particle.TemporaryPoints[1],h=cc.Particle.TemporaryPoints[2],u=cc.Particle.TemporaryPoints[3],d=this._particles;this._particleIdx<this.particleCount;){cc.pZeroIn(c),cc.pZeroIn(h),cc.pZeroIn(u);var f=d[this._particleIdx];if(f.timeToLive-=t,f.timeToLive>0){if(this.emitterMode===_ccsg.ParticleSystem.Mode.GRAVITY){var m=u,v=c,_=h;f.pos.x||f.pos.y?(cc.pIn(v,f.pos),cc.pNormalizeIn(v)):cc.pZeroIn(v),cc.pIn(_,v),cc.pMultIn(v,f.modeA.radialAccel);var p=_.x;_.x=-_.y,_.y=p,cc.pMultIn(_,f.modeA.tangentialAccel),cc.pIn(m,v),cc.pAddIn(m,_),cc.pAddIn(m,this.modeA.gravity),cc.pMultIn(m,t),cc.pAddIn(f.modeA.dir,m),cc.pIn(m,f.modeA.dir),cc.pMultIn(m,t),cc.pAddIn(f.pos,m)}else{var g=f.modeB;g.angle+=g.degreesPerSecond*t,g.radius+=g.deltaRadius*t,f.pos.x=-Math.cos(g.angle)*g.radius,f.pos.y=-Math.sin(g.angle)*g.radius}this._renderCmd._updateDeltaColor(f,t),f.size+=f.deltaSize*t,f.size=Math.max(0,f.size),f.rotation+=f.deltaRotation*t;var y=c;if(this.positionType===_ccsg.ParticleSystem.Type.FREE||this.positionType===_ccsg.ParticleSystem.Type.RELATIVE){var C=h,S=u;cc._pointApplyAffineTransformIn(a,r,C),cc._pointApplyAffineTransformIn(f.startPos,r,S),cc.pSubIn(C,S),cc.pIn(y,f.pos),cc.pSubIn(y,C)}else cc.pIn(y,f.pos);this._renderCmd.updateParticlePosition(f,y),++this._particleIdx}else{if(this._particleIdx!==this.particleCount-1){var I=d[this._particleIdx];d[this._particleIdx]=d[this.particleCount-1],d[this.particleCount-1]=I}if(--this.particleCount,this.particleCount===0&&this.autoRemoveOnFinish)return this.unscheduleUpdate(),this._parent.removeChild(this,!0),void(this._renderCmd.updateLocalBB&&this._renderCmd.updateLocalBB())}}this._renderCmd.updateLocalBB&&this._renderCmd.updateLocalBB()}this.postStep()},updateWithNoTime:function(){this.update(0)},_valueForKey:function(t,e){if(e){var r=e[t];return r!=null?r:""}return""},_updateBlendFunc:function(){var t=this._texture;if(t&&t instanceof cc.Texture2D){this._opacityModifyRGB=!1;var e=this._blendFunc;e.src===cc.macro.BLEND_SRC&&e.dst===cc.macro.BLEND_DST&&(t.hasPremultipliedAlpha()?this._opacityModifyRGB=!0:(e.src=cc.macro.SRC_ALPHA,e.dst=cc.macro.ONE_MINUS_SRC_ALPHA))}},clone:function(){var t=new _ccsg.ParticleSystem;if(t.initWithTotalParticles(this.getTotalParticles())){t.setAngle(this.getAngle()),t.setAngleVar(this.getAngleVar()),t.setDuration(this.getDuration());var e=this.getBlendFunc();if(t.setBlendFunc(e.src,e.dst),t.setStartColor(this.getStartColor()),t.setStartColorVar(this.getStartColorVar()),t.setEndColor(this.getEndColor()),t.setEndColorVar(this.getEndColorVar()),t.setStartSize(this.getStartSize()),t.setStartSizeVar(this.getStartSizeVar()),t.setEndSize(this.getEndSize()),t.setEndSizeVar(this.getEndSizeVar()),t.setPosition(cc.p(this.x,this.y)),t.setPosVar(cc.p(this.getPosVar().x,this.getPosVar().y)),t.setPositionType(this.getPositionType()),t.setStartSpin(this.getStartSpin()||0),t.setStartSpinVar(this.getStartSpinVar()||0),t.setEndSpin(this.getEndSpin()||0),t.setEndSpinVar(this.getEndSpinVar()||0),t.setEmitterMode(this.getEmitterMode()),this.getEmitterMode()===_ccsg.ParticleSystem.Mode.GRAVITY){var r=this.getGravity();t.setGravity(cc.p(r.x,r.y)),t.setSpeed(this.getSpeed()),t.setSpeedVar(this.getSpeedVar()),t.setRadialAccel(this.getRadialAccel()),t.setRadialAccelVar(this.getRadialAccelVar()),t.setTangentialAccel(this.getTangentialAccel()),t.setTangentialAccelVar(this.getTangentialAccelVar())}else this.getEmitterMode()===_ccsg.ParticleSystem.Mode.RADIUS&&(t.setStartRadius(this.getStartRadius()),t.setStartRadiusVar(this.getStartRadiusVar()),t.setEndRadius(this.getEndRadius()),t.setEndRadiusVar(this.getEndRadiusVar()),t.setRotatePerSecond(this.getRotatePerSecond()),t.setRotatePerSecondVar(this.getRotatePerSecondVar()));t.setLife(this.getLife()),t.setLifeVar(this.getLifeVar()),t.setEmissionRate(this.getEmissionRate()),t.setOpacityModifyRGB(this.isOpacityModifyRGB());var a=this.getTexture();if(a){var c=a.getContentSize();t.setTextureWithRect(a,cc.rect(0,0,c.width,c.height))}}return t},setDisplayFrame:function(t){if(t){var e=t.getOffset();e.x===0&&e.y===0||cc.logID(6015);var r=t.getTexture();this._texture!==r&&this.setTexture(r)}},setTextureWithRect:function(t,e){this._texture!==t&&(this._texture=t,this._updateBlendFunc()),this.initTexCoordsWithRect(e)},listenBackToForeground:function(t){}});var n=_ccsg.ParticleSystem.prototype;n.opacityModifyRGB,cc.defineGetterSetter(n,"opacityModifyRGB",n.isOpacityModifyRGB,n.setOpacityModifyRGB),n.active,cc.defineGetterSetter(n,"active",n.isActive),n.sourcePos,cc.defineGetterSetter(n,"sourcePos",n.getSourcePosition,n.setSourcePosition),n.posVar,cc.defineGetterSetter(n,"posVar",n.getPosVar,n.setPosVar),n.gravity,cc.defineGetterSetter(n,"gravity",n.getGravity,n.setGravity),n.speed,cc.defineGetterSetter(n,"speed",n.getSpeed,n.setSpeed),n.speedVar,cc.defineGetterSetter(n,"speedVar",n.getSpeedVar,n.setSpeedVar),n.tangentialAccel,cc.defineGetterSetter(n,"tangentialAccel",n.getTangentialAccel,n.setTangentialAccel),n.tangentialAccelVar,cc.defineGetterSetter(n,"tangentialAccelVar",n.getTangentialAccelVar,n.setTangentialAccelVar),n.radialAccel,cc.defineGetterSetter(n,"radialAccel",n.getRadialAccel,n.setRadialAccel),n.radialAccelVar,cc.defineGetterSetter(n,"radialAccelVar",n.getRadialAccelVar,n.setRadialAccelVar),n.rotationIsDir,cc.defineGetterSetter(n,"rotationIsDir",n.getRotationIsDir,n.setRotationIsDir),n.startRadius,cc.defineGetterSetter(n,"startRadius",n.getStartRadius,n.setStartRadius),n.startRadiusVar,cc.defineGetterSetter(n,"startRadiusVar",n.getStartRadiusVar,n.setStartRadiusVar),n.endRadius,cc.defineGetterSetter(n,"endRadius",n.getEndRadius,n.setEndRadius),n.endRadiusVar,cc.defineGetterSetter(n,"endRadiusVar",n.getEndRadiusVar,n.setEndRadiusVar),n.rotatePerS,cc.defineGetterSetter(n,"rotatePerS",n.getRotatePerSecond,n.setRotatePerSecond),n.rotatePerSVar,cc.defineGetterSetter(n,"rotatePerSVar",n.getRotatePerSecondVar,n.setRotatePerSecondVar),n.startColor,cc.defineGetterSetter(n,"startColor",n.getStartColor,n.setStartColor),n.startColorVar,cc.defineGetterSetter(n,"startColorVar",n.getStartColorVar,n.setStartColorVar),n.endColor,cc.defineGetterSetter(n,"endColor",n.getEndColor,n.setEndColor),n.endColorVar,cc.defineGetterSetter(n,"endColorVar",n.getEndColorVar,n.setEndColorVar),n.totalParticles,cc.defineGetterSetter(n,"totalParticles",n.getTotalParticles,n.setTotalParticles),n.texture,cc.defineGetterSetter(n,"texture",n.getTexture,n.setTexture),_ccsg.ParticleSystem.ModeA=function(t,e,r,a,c,h,u,d){this.gravity=t||cc.p(0,0),this.speed=e||0,this.speedVar=r||0,this.tangentialAccel=a||0,this.tangentialAccelVar=c||0,this.radialAccel=h||0,this.radialAccelVar=u||0,this.rotationIsDir=d||!1},_ccsg.ParticleSystem.ModeB=function(t,e,r,a,c,h){this.startRadius=t||0,this.startRadiusVar=e||0,this.endRadius=r||0,this.endRadiusVar=a||0,this.rotatePerSecond=c||0,this.rotatePerSecondVar=h||0},_ccsg.ParticleSystem.DURATION_INFINITY=-1,_ccsg.ParticleSystem.START_SIZE_EQUAL_TO_END_SIZE=-1,_ccsg.ParticleSystem.START_RADIUS_EQUAL_TO_END_RADIUS=-1,_ccsg.ParticleSystem.Mode=cc.Enum({GRAVITY:0,RADIUS:1}),_ccsg.ParticleSystem.Type=cc.Enum({FREE:0,RELATIVE:1,GROUPED:2})},{"../compression/ZipUtils":28,"./CCPNGReader":214,"./CCTIFFReader":220}],218:[function(T,N,z){_ccsg.ParticleSystem.CanvasRenderCmd=function(t){this._rootCtor(t),this._needDraw=!0,this._pointRect=cc.rect(0,0,0,0),this._localRegion=new cc.Region,this._tintCache=null};var o=_ccsg.ParticleSystem.CanvasRenderCmd.prototype=Object.create(_ccsg.Node.CanvasRenderCmd.prototype);o.constructor=_ccsg.ParticleSystem.CanvasRenderCmd,o.updateQuadWithParticle=function(t,e){},o.updateParticlePosition=function(t,e){cc.pIn(t.drawPos,e)};var s=new cc.Region,n=new cc.Rect;o.updateLocalBB=function(){var t=this._localRegion,e=this._node._particles;t.setEmpty();for(var r=e.length-1;r>=0;--r){var a=e[r],c=a.drawPos,h=1.415*a.size;s.setTo(c.x-h,c.y-h,c.x+h,c.y+h),t.union(s)}n.x=t._minX,n.y=t._minY,n.width=t._maxX-t._minX,n.height=t._maxY-t._minY},o.getLocalBB=function(){return n},o.updateStatus=function(){this.originUpdateStatus(),this._updateCurrentRegions(),this._regionFlag=_ccsg.Node.CanvasRenderCmd.RegionStatus.DirtyDouble,this._dirtyFlag&=~_ccsg.Node._dirtyFlags.contentDirty},o.rendering=function(t,e,r){var a=t||cc._renderContext,c=a.getContext(),h=this._node,u=this._pointRect;a.setTransform(this._worldTransform,e,r),a.save();var d,f,m=this._node.particleCount,v=this._node._particles;if(h._texture){if(!h._texture.loaded)return void a.restore();var _=h._texture.getHtmlElementObj();if(!_.width||!_.height)return void a.restore();var p=_;for(d=0;d<m;d++){0|.5*(f=v[d]).size,c.save(),c.translate(0|f.drawPos.x,-(0|f.drawPos.y));var g=4*Math.floor(f.size/4),y=u.width,C=u.height;c.scale(Math.max(1/y*g,1e-6),Math.max(1/C*g,1e-6)),f.rotation&&c.rotate(cc.degreesToRadians(f.rotation)),c.drawImage(p,-(0|y/2),-(0|C/2)),c.restore()}cc.g_NumberOfDraws++}a.restore()},o._changeTextureColor=function(t,e,r){this._tintCache||(this._tintCache=document.createElement("canvas"));var a=this._tintCache,c=t.getContentSize();return a.width=c.width,a.height=c.height,t._generateColorTexture(e.r,e.g,e.b,r,a)},o.initTexCoordsWithRect=function(t){this._pointRect=t},o.setTotalParticles=function(t){this._node._totalParticles=t<200?t:200},o.addParticle=function(){var t,e=this._node,r=e._particles;return e.particleCount<r.length?t=r[e.particleCount]:(t=new cc.Particle,r.push(t)),t},o._setupVBO=function(){},o._allocMemory=function(){return!0},o.postStep=function(){},o._setBlendAdditive=function(){var t=this._node._blendFunc;t.src=cc.macro.BLEND_SRC,t.dst=cc.macro.BLEND_DST},o._initWithTotalParticles=function(t){},o._updateDeltaColor=function(t,e){this._node._dontTint||(t.color.r+=t.deltaColor.r*e,t.color.g+=t.deltaColor.g*e,t.color.b+=t.deltaColor.b*e,t.color.a+=t.deltaColor.a*e,t.isChangeColor=!0)}},{}],219:[function(T,N,z){_ccsg.ParticleSystem.WebGLRenderCmd=function(s){this._rootCtor(s),this._needDraw=!0,this._matrix=new cc.math.Matrix4,this._matrix.identity(),this._buffersVBO=[0,0],this._quads=[],this._indices=[],this._quadsArrayBuffer=null};var o=_ccsg.ParticleSystem.WebGLRenderCmd.prototype=Object.create(_ccsg.Node.WebGLRenderCmd.prototype);o.constructor=_ccsg.ParticleSystem.WebGLRenderCmd,o.initIndices=function(s){for(var n=this._indices,t=0,e=s;t<e;++t){var r=6*t,a=4*t;n[r+0]=a+0,n[r+1]=a+1,n[r+2]=a+2,n[r+5]=a+1,n[r+4]=a+2,n[r+3]=a+3}},o.isDifferentTexture=function(s,n){return s===n},o.updateParticlePosition=function(s,n){this.updateQuadWithParticle(s,n)},o.updateQuadWithParticle=function(s,n){var t=null,e=this._node;t=this._quads[e._particleIdx];var r,a,c,h;e._opacityModifyRGB?(r=0|s.color.r*s.color.a/255,a=0|s.color.g*s.color.a/255,c=0|s.color.b*s.color.a/255):(r=0|s.color.r,a=0|s.color.g,c=0|s.color.b),h=0|s.color.a;var u=t.bl.colors,d=t.br.colors,f=t.tl.colors,m=t.tr.colors;u.r=d.r=f.r=m.r=r,u.g=d.g=f.g=m.g=a,u.b=d.b=f.b=m.b=c,u.a=d.a=f.a=m.a=h;var v=s.size/2;if(s.rotation){var _=-v,p=-v,g=v,y=v,C=n.x,S=n.y,I=-cc.degreesToRadians(s.rotation),b=Math.cos(I),A=Math.sin(I),E=_*b-p*A+C,R=_*A+p*b+S,O=g*b-p*A+C,P=g*A+p*b+S,x=g*b-y*A+C,w=g*A+y*b+S,L=_*b-y*A+C,D=_*A+y*b+S;t.bl.vertices.x=E,t.bl.vertices.y=R,t.br.vertices.x=O,t.br.vertices.y=P,t.tl.vertices.x=L,t.tl.vertices.y=D,t.tr.vertices.x=x,t.tr.vertices.y=w}else t.bl.vertices.x=n.x-v,t.bl.vertices.y=n.y-v,t.br.vertices.x=n.x+v,t.br.vertices.y=n.y-v,t.tl.vertices.x=n.x-v,t.tl.vertices.y=n.y+v,t.tr.vertices.x=n.x+v,t.tr.vertices.y=n.y+v},o.rendering=function(s){var n=this._node;if(n._texture){var t=s||cc._renderContext,e=this._worldTransform,r=this._matrix.mat;r[0]=e.a,r[4]=e.c,r[12]=e.tx,r[1]=e.b,r[5]=e.d,r[13]=e.ty,this._shaderProgram.use(),this._shaderProgram._setUniformForMVPMatrixWithMat4(this._matrix),cc.gl.bindTexture2DN(0,n._texture),cc.gl.blendFuncForParticle(n._blendFunc.src,n._blendFunc.dst),t.enableVertexAttribArray(cc.macro.VERTEX_ATTRIB_POSITION),t.enableVertexAttribArray(cc.macro.VERTEX_ATTRIB_COLOR),t.enableVertexAttribArray(cc.macro.VERTEX_ATTRIB_TEX_COORDS),t.bindBuffer(t.ARRAY_BUFFER,this._buffersVBO[0]),t.vertexAttribPointer(cc.macro.VERTEX_ATTRIB_POSITION,3,t.FLOAT,!1,24,0),t.vertexAttribPointer(cc.macro.VERTEX_ATTRIB_COLOR,4,t.UNSIGNED_BYTE,!0,24,12),t.vertexAttribPointer(cc.macro.VERTEX_ATTRIB_TEX_COORDS,2,t.FLOAT,!1,24,16),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this._buffersVBO[1]),t.drawElements(t.TRIANGLES,6*n._particleIdx,t.UNSIGNED_SHORT,0)}},o.initTexCoordsWithRect=function(s){var n=this._node,t=n.texture,e=s.width,r=s.height;t&&(e=t.getPixelWidth(),r=t.getPixelHeight());var a,c,h,u;cc.macro.FIX_ARTIFACTS_BY_STRECHING_TEXEL?(a=(2*s.x+1)/(2*e),c=(2*s.y+1)/(2*r),h=a+(2*s.width-2)/(2*e),u=c+(2*s.height-2)/(2*r)):(a=s.x/e,c=s.y/r,h=a+s.width/e,u=c+s.height/r);var d=u;u=c,c=d;for(var f=this._quads,m=n._totalParticles,v=0;v<m;v++){f[v]||(f[v]=cc.V3F_C4B_T2F_QuadZero());var _=f[v];_.bl.texCoords.u=a,_.bl.texCoords.v=c,_.br.texCoords.u=h,_.br.texCoords.v=c,_.tl.texCoords.u=a,_.tl.texCoords.v=u,_.tr.texCoords.u=h,_.tr.texCoords.v=u}},o.setTotalParticles=function(s){var n=this._node;if(s>n._allocatedParticles){var t=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT;this._indices=new Uint16Array(6*s);var e=new ArrayBuffer(s*t),r=n._particles;r.length=0;var a=this._quads;a.length=0;for(var c=0;c<s;c++)r[c]=new cc.Particle,a[c]=new cc.V3F_C4B_T2F_Quad(null,null,null,null,e,c*t);n._allocatedParticles=s,n._totalParticles=s,this._quadsArrayBuffer=e,this.initIndices(s),this._setupVBO(),n._texture&&this.initTexCoordsWithRect(cc.rect(0,0,n._texture.width,n._texture.height))}else n._totalParticles=s;n.resetSystem()},o.addParticle=function(){var s=this._node;return s._particles[s.particleCount]},o._setupVBO=function(){var s=cc._renderContext;this._buffersVBO[0]=s.createBuffer(),s.bindBuffer(s.ARRAY_BUFFER,this._buffersVBO[0]),s.bufferData(s.ARRAY_BUFFER,this._quadsArrayBuffer,s.DYNAMIC_DRAW),this._buffersVBO[1]=s.createBuffer(),s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,this._buffersVBO[1]),s.bufferData(s.ELEMENT_ARRAY_BUFFER,this._indices,s.STATIC_DRAW)},o._allocMemory=function(){var s=this._node,n=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,t=s._totalParticles,e=this._quads;e.length=0,this._indices=new Uint16Array(6*t);for(var r=new ArrayBuffer(n*t),a=0;a<t;a++)e[a]=new cc.V3F_C4B_T2F_Quad(null,null,null,null,r,a*n);return e&&this._indices?(this._quadsArrayBuffer=r,!0):(cc.logID(6013),!1)},o.postStep=function(){var s=cc._renderContext;s.bindBuffer(s.ARRAY_BUFFER,this._buffersVBO[0]),s.bufferSubData(s.ARRAY_BUFFER,0,this._quadsArrayBuffer)},o._setBlendAdditive=function(){var s=this._node._blendFunc;this._texture&&!this._texture.hasPremultipliedAlpha()?(s.src=cc.macro.SRC_ALPHA,s.dst=cc.macro.ONE_MINUS_SRC_ALPHA):(s.src=cc.macro.BLEND_SRC,s.dst=cc.macro.BLEND_DST)},o._initWithTotalParticles=function(s){if(!this._allocMemory())return!1;this.initIndices(s),this._setupVBO(),this._shaderProgram=cc.shaderCache.programForKey(cc.macro.SHADER_POSITION_TEXTURECOLOR)},o._updateDeltaColor=function(s,n){s.color.r+=s.deltaColor.r*n,s.color.g+=s.deltaColor.g*n,s.color.b+=s.deltaColor.b*n,s.color.a+=s.deltaColor.a*n,s.isChangeColor=!0}},{}],220:[function(T,N,z){var o={_littleEndian:!1,_tiffData:null,_fileDirectories:[],getUint8:function(s){return this._tiffData[s]},getUint16:function(s){return this._littleEndian?this._tiffData[s+1]<<8|this._tiffData[s]:this._tiffData[s]<<8|this._tiffData[s+1]},getUint32:function(s){var n=this._tiffData;return this._littleEndian?n[s+3]<<24|n[s+2]<<16|n[s+1]<<8|n[s]:n[s]<<24|n[s+1]<<16|n[s+2]<<8|n[s+3]},checkLittleEndian:function(){var s=this.getUint16(0);if(s===18761)this.littleEndian=!0;else{if(s!==19789)throw console.log(s),TypeError("Invalid byte order value.");this.littleEndian=!1}return this.littleEndian},hasTowel:function(){if(this.getUint16(2)!==42)throw RangeError("You forgot your towel!");return!0},getFieldTypeName:function(s){var n=this.fieldTypeNames;return s in n?n[s]:null},getFieldTagName:function(s){var n=this.fieldTagNames;return s in n?n[s]:(console.log("Unknown Field Tag:",s),"Tag"+s)},getFieldTypeLength:function(s){return["BYTE","ASCII","SBYTE","UNDEFINED"].indexOf(s)!==-1?1:["SHORT","SSHORT"].indexOf(s)!==-1?2:["LONG","SLONG","FLOAT"].indexOf(s)!==-1?4:["RATIONAL","SRATIONAL","DOUBLE"].indexOf(s)!==-1?8:null},getFieldValues:function(s,n,t,e){var r=[],a=this.getFieldTypeLength(n);if(a*t<=4)this.littleEndian===!1?r.push(e>>>8*(4-a)):r.push(e);else for(var c=0;c<t;c++){var h=a*c;a>=8?["RATIONAL","SRATIONAL"].indexOf(n)!==-1?(r.push(this.getUint32(e+h)),r.push(this.getUint32(e+h+4))):cc.logID(8e3):r.push(this.getBytes(a,e+h))}return n==="ASCII"&&r.forEach(function(u,d,f){f[d]=String.fromCharCode(u)}),r},getBytes:function(s,n){if(s<=0)cc.logID(8001);else{if(s<=1)return this.getUint8(n);if(s<=2)return this.getUint16(n);if(s<=3)return this.getUint32(n)>>>8;if(s<=4)return this.getUint32(n);cc.logID(8002)}},getBits:function(s,n,t){t=t||0;var e,r,a=n+Math.floor(t/8),c=t+s,h=32-s;return c<=0?console.log("No bits requested"):c<=8?(e=24+t,r=this.getUint8(a)):c<=16?(e=16+t,r=this.getUint16(a)):c<=32?(e=t,r=this.getUint32(a)):console.log("Too many bits requested"),{bits:r<<e>>>h,byteOffset:a+Math.floor(c/8),bitOffset:c%8}},parseFileDirectory:function(s){for(var n=this.getUint16(s),t=[],e=s+2,r=0;r<n;e+=12,r++){var a=this.getUint16(e),c=this.getUint16(e+2),h=this.getUint32(e+4),u=this.getUint32(e+8),d=this.getFieldTagName(a),f=this.getFieldTypeName(c),m=this.getFieldValues(d,f,h,u);t[d]={type:f,values:m}}this._fileDirectories.push(t);var v=this.getUint32(e);v!==0&&this.parseFileDirectory(v)},clampColorSample:function(s,n){var t=Math.pow(2,8-n);return Math.floor(s*t+(t-1))},parseTIFF:function(s,n){if(n=n||document.createElement("canvas"),this._tiffData=s,this.canvas=n,this.checkLittleEndian(),this.hasTowel()){var t=this.getUint32(4);this._fileDirectories.length=0,this.parseFileDirectory(t);var e=this._fileDirectories[0],r=e.ImageWidth.values[0],a=e.ImageLength.values[0];this.canvas.width=r,this.canvas.height=a;var c=[],h=e.Compression?e.Compression.values[0]:1,u=e.SamplesPerPixel.values[0],d=[],f=0,m=!1;if(e.BitsPerSample.values.forEach(function(Qt,Jt,he){d[Jt]={bitsPerSample:Qt,hasBytesPerSample:!1,bytesPerSample:void 0},Qt%8==0&&(d[Jt].hasBytesPerSample=!0,d[Jt].bytesPerSample=Qt/8),f+=Qt},this),f%8==0){m=!0;var v=f/8}var _=e.StripOffsets.values,p=_.length;if(e.StripByteCounts)var g=e.StripByteCounts.values;else{if(cc.logID(8003),p!==1)throw new Error("Cannot recover from missing StripByteCounts");g=[Math.ceil(r*a*f/8)]}for(var y=0;y<p;y++){var C=_[y];c[y]=[];for(var S=g[y],I=0,b=0,A=1,E=!0,R=[],O=0,P=0,x=0;I<S;I+=A)switch(h){case 1:var w=0;for(R=[];w<u;w++){if(!d[w].hasBytesPerSample){var L=this.getBits(d[w].bitsPerSample,C+I,b);throw R.push(L.bits),I=L.byteOffset-C,b=L.bitOffset,RangeError("Cannot handle sub-byte bits per sample")}var D=d[w].bytesPerSample*w;R.push(this.getBytes(d[w].bytesPerSample,C+I+D))}if(c[y].push(R),!m)throw A=0,RangeError("Cannot handle sub-byte bits per pixel");A=v;break;case 2:case 3:case 4:case 5:case 6:case 7:break;case 32773:if(E){E=!1;var F=1,M=1,B=this.getInt8(C+I);B>=0&&B<=127?F=B+1:B>=-127&&B<=-1?M=1-B:E=!0}else{var W=this.getUint8(C+I);for(w=0;w<M;w++){if(!d[P].hasBytesPerSample)throw RangeError("Cannot handle sub-byte bits per sample");x=x<<8*O|W,++O===d[P].bytesPerSample&&(R.push(x),x=O=0,P++),P===u&&(c[y].push(R),R=[],P=0)}--F===0&&(E=!0)}A=1}}if(n.getContext){var V=this.canvas.getContext("2d");V.fillStyle="rgba(255, 255, 255, 0)";var U=e.RowsPerStrip?e.RowsPerStrip.values[0]:a,k=c.length,X=a%U,Y=X===0?U:X,Z=U,et=0,$=e.PhotometricInterpretation.values[0],nt=[],at=0;if(e.ExtraSamples&&(at=(nt=e.ExtraSamples.values).length),e.ColorMap)var rt=e.ColorMap.values,it=Math.pow(2,d[0].bitsPerSample);for(y=0;y<k;y++){y+1===k&&(Z=Y);for(var ot=c[y].length,_t=et*y,ut=0,vt=0;vt<ot;ut++)for(var Tt=0;Tt<r;Tt++,vt++){var Rt=c[y][vt],zt=0,qt=0,Zt=0,Kt=1;if(at>0){for(var re=0;re<at;re++)if(nt[re]===1||nt[re]===2){Kt=Rt[3+re]/256;break}}switch($){case 0:if(d[0].hasBytesPerSample)var te=Math.pow(16,2*d[0].bytesPerSample);Rt.forEach(function(Qt,Jt,he){he[Jt]=te-Qt});case 1:zt=qt=Zt=this.clampColorSample(Rt[0],d[0].bitsPerSample);break;case 2:zt=this.clampColorSample(Rt[0],d[0].bitsPerSample),qt=this.clampColorSample(Rt[1],d[1].bitsPerSample),Zt=this.clampColorSample(Rt[2],d[2].bitsPerSample);break;case 3:if(rt===void 0)throw new Error("Palette image missing color map");var oe=Rt[0];zt=this.clampColorSample(rt[oe],16),qt=this.clampColorSample(rt[it+oe],16),Zt=this.clampColorSample(rt[2*it+oe],16);break;default:throw RangeError("Unknown Photometric Interpretation:",$)}V.fillStyle="rgba("+zt+", "+qt+", "+Zt+", "+Kt+")",V.fillRect(Tt,_t+ut,1,1)}et=Z}}return this.canvas}},fieldTagNames:{315:"Artist",258:"BitsPerSample",265:"CellLength",264:"CellWidth",320:"ColorMap",259:"Compression",33432:"Copyright",306:"DateTime",338:"ExtraSamples",266:"FillOrder",289:"FreeByteCounts",288:"FreeOffsets",291:"GrayResponseCurve",290:"GrayResponseUnit",316:"HostComputer",270:"ImageDescription",257:"ImageLength",256:"ImageWidth",271:"Make",281:"MaxSampleValue",280:"MinSampleValue",272:"Model",254:"NewSubfileType",274:"Orientation",262:"PhotometricInterpretation",284:"PlanarConfiguration",296:"ResolutionUnit",278:"RowsPerStrip",277:"SamplesPerPixel",305:"Software",279:"StripByteCounts",273:"StripOffsets",255:"SubfileType",263:"Threshholding",282:"XResolution",283:"YResolution",326:"BadFaxLines",327:"CleanFaxData",343:"ClipPath",328:"ConsecutiveBadFaxLines",433:"Decode",434:"DefaultImageColor",269:"DocumentName",336:"DotRange",321:"HalftoneHints",346:"Indexed",347:"JPEGTables",285:"PageName",297:"PageNumber",317:"Predictor",319:"PrimaryChromaticities",532:"ReferenceBlackWhite",339:"SampleFormat",559:"StripRowCounts",330:"SubIFDs",292:"T4Options",293:"T6Options",325:"TileByteCounts",323:"TileLength",324:"TileOffsets",322:"TileWidth",301:"TransferFunction",318:"WhitePoint",344:"XClipPathUnits",286:"XPosition",529:"YCbCrCoefficients",531:"YCbCrPositioning",530:"YCbCrSubSampling",345:"YClipPathUnits",287:"YPosition",37378:"ApertureValue",40961:"ColorSpace",36868:"DateTimeDigitized",36867:"DateTimeOriginal",34665:"Exif IFD",36864:"ExifVersion",33434:"ExposureTime",41728:"FileSource",37385:"Flash",40960:"FlashpixVersion",33437:"FNumber",42016:"ImageUniqueID",37384:"LightSource",37500:"MakerNote",37377:"ShutterSpeedValue",37510:"UserComment",33723:"IPTC",34675:"ICC Profile",700:"XMP",42112:"GDAL_METADATA",42113:"GDAL_NODATA",34377:"Photoshop"},fieldTypeNames:{1:"BYTE",2:"ASCII",3:"SHORT",4:"LONG",5:"RATIONAL",6:"SBYTE",7:"UNDEFINED",8:"SSHORT",9:"SLONG",10:"SRATIONAL",11:"FLOAT",12:"DOUBLE"}};N.exports=o},{}],221:[function(T,N,z){cc.RenderTexture=_ccsg.Node.extend({sprite:null,clearFlags:0,clearDepthVal:0,autoDraw:!1,_texture:null,_pixelFormat:0,clearStencilVal:0,_clearColor:null,_className:"RenderTexture",ctor:function(s,n,t,e){_ccsg.Node.prototype.ctor.call(this),this._cascadeColorEnabled=!0,this._cascadeOpacityEnabled=!0,this._pixelFormat=cc.Texture2D.PixelFormat.RGBA8888,this._clearColor=new cc.Color(0,0,0,255),s!==void 0&&n!==void 0&&(t=t||cc.Texture2D.PixelFormat.RGBA8888,e=e||0,this.initWithWidthAndHeight(s,n,t,e)),this.setAnchorPoint(0,0)},_createRenderCmd:function(){return cc._renderType===cc.game.RENDER_TYPE_CANVAS?new cc.RenderTexture.CanvasRenderCmd(this):new cc.RenderTexture.WebGLRenderCmd(this)},visit:function(s){var n=this._renderCmd,t=s?s._renderCmd:null;if(this._visible){var e=cc.renderer;n.visit(t),e.pushRenderCommand(n),this.sprite.visit(this),n._dirtyFlag=0}else n._propagateFlagsDown(t)},cleanup:function(){_ccsg.Node.prototype.onExit.call(this),this._renderCmd.cleanup()},getSprite:function(){return this.sprite},setSprite:function(s){this.sprite=s},setVirtualViewport:function(s,n,t){this._renderCmd.setVirtualViewport(s,n,t)},initWithWidthAndHeight:function(s,n,t,e){return this._renderCmd.initWithWidthAndHeight(s,n,t,e)},begin:function(){cc.renderer._turnToCacheMode(this.__instanceId),this._renderCmd.begin()},beginWithClear:function(s,n,t,e,r,a){var c=cc._renderContext;r=r||c.COLOR_BUFFER_BIT,a=a||c.COLOR_BUFFER_BIT|c.DEPTH_BUFFER_BIT,this._beginWithClear(s,n,t,e,r,a,c.COLOR_BUFFER_BIT|c.DEPTH_BUFFER_BIT|c.STENCIL_BUFFER_BIT)},_beginWithClear:function(s,n,t,e,r,a,c){this.begin(),this._renderCmd._beginWithClear(s,n,t,e,r,a,c)},end:function(){this._renderCmd.end()},clear:function(s,n,t,e){this.beginWithClear(s,n,t,e),this.end()},clearRect:function(s,n,t,e){this._renderCmd.clearRect(s,n,t,e)},clearDepth:function(s){this._renderCmd.clearDepth(s)},clearStencil:function(s){this._renderCmd.clearStencil(s)},getClearFlags:function(){return this.clearFlags},setClearFlags:function(s){this.clearFlags=s},getClearColor:function(){return this._clearColor},setClearColor:function(s){var n=this._clearColor;n.r=s.r,n.g=s.g,n.b=s.b,n.a=s.a,this._renderCmd.updateClearColor(s)},getClearDepth:function(){return this.clearDepthVal},setClearDepth:function(s){this.clearDepthVal=s},getClearStencil:function(){return this.clearStencilVal},setClearStencil:function(s){this.clearStencilVal=s},isAutoDraw:function(){return this.autoDraw},setAutoDraw:function(s){this.autoDraw=s},saveToFile:function(s,n){cc.log("saveToFile isn't supported on Cocos2d-Html5")},newCCImage:function(s){return cc.log("saveToFile isn't supported on cocos2d-html5"),null},listenToBackground:function(s){},listenToForeground:function(s){}});var o=cc.RenderTexture.prototype;o.clearColorVal,cc.defineGetterSetter(o,"clearColorVal",o.getClearColor,o.setClearColor),cc.RenderTexture.create=function(s,n,t,e){return new cc.RenderTexture(s,n,t,e)}},{}],222:[function(T,N,z){cc.RenderTexture.CanvasRenderCmd=function(s){this._rootCtor(s),this._needDraw=!1,this._clearColorStr="rgba(255,255,255,1)",this._cacheCanvas=document.createElement("canvas"),this._cacheContext=new cc.CanvasContextWrapper(this._cacheCanvas.getContext("2d"))};var o=cc.RenderTexture.CanvasRenderCmd.prototype=Object.create(_ccsg.Node.CanvasRenderCmd.prototype);o.constructor=cc.RenderTexture.CanvasRenderCmd,o.cleanup=function(){this._cacheContext=null,this._cacheCanvas=null},o.clearStencil=function(s){},o.setVirtualViewport=function(s,n,t){},o.updateClearColor=function(s){this._clearColorStr="rgba("+(0|s.r)+","+(0|s.g)+","+(0|s.b)+","+s.a/255+")"},o.initWithWidthAndHeight=function(s,n,t,e){var r=this._node,a=this._cacheCanvas;a.width=0|s,a.height=0|n;var c=new cc.Texture2D;c.initWithElement(a),c.handleLoadedTexture();var h=r.sprite=new _ccsg.Sprite(c);return h.setBlendFunc(cc.macro.ONE,cc.macro.ONE_MINUS_SRC_ALPHA),r.autoDraw=!1,r.addChild(h),!0},o.begin=function(){},o._beginWithClear=function(s,n,t,e,r,a,c){s=s||0,n=n||0,t=t||0,e=Number.isNaN(e)?255:e;var h=this._cacheContext.getContext(),u=this._cacheCanvas;h.setTransform(1,0,0,1,0,0),this._cacheContext.setFillStyle("rgba("+(0|s)+","+(0|n)+","+(0|t)+","+e/255+")"),h.clearRect(0,0,u.width,u.height),h.fillRect(0,0,u.width,u.height)},o.end=function(){var s=this._node;cc.renderer._renderingToCacheCanvas(this._cacheContext,s.__instanceId);var n=s.sprite._renderCmd;n._notifyRegionStatus&&n._notifyRegionStatus(_ccsg.Node.CanvasRenderCmd.RegionStatus.Dirty)},o.clearRect=function(s,n,t,e){this._cacheContext.clearRect(s,n,t,-e)},o.clearDepth=function(s){cc.log("clearDepth isn't supported on Cocos2d-Html5")}},{}],223:[function(T,N,z){var o=T("../core/utils/misc");cc.RenderTexture.WebGLRenderCmd=function(n){this._rootCtor(n),this._needDraw=!0,this._fBO=null,this._oldFBO=null,this._textureCopy=null,this._depthRenderBuffer=null,this._rtTextureRect=new cc.Rect,this._fullRect=new cc.Rect,this._fullViewport=new cc.Rect};var s=cc.RenderTexture.WebGLRenderCmd.prototype=Object.create(_ccsg.Node.WebGLRenderCmd.prototype);s.constructor=cc.RenderTexture.WebGLRenderCmd,s.setVirtualViewport=function(n,t,e){this._rtTextureRect.x=n.x,this._rtTextureRect.y=n.y,this._fullRect=t,this._fullViewport=e},s.needDraw=function(){return this._needDraw&&this._node.autoDraw},s.rendering=function(n){var t=n||cc._renderContext,e=this._node;if(e.autoDraw){e.begin();var r=e.clearFlags;if(r){var a=[0,0,0,0],c=0,h=0;r&t.COLOR_BUFFER_BIT&&(a=t.getParameter(t.COLOR_CLEAR_VALUE),t.clearColor(e._clearColor.r/255,e._clearColor.g/255,e._clearColor.b/255,e._clearColor.a/255)),r&t.DEPTH_BUFFER_BIT&&(c=t.getParameter(t.DEPTH_CLEAR_VALUE),t.clearDepth(e.clearDepthVal)),r&t.STENCIL_BUFFER_BIT&&(h=t.getParameter(t.STENCIL_CLEAR_VALUE),t.clearStencil(e.clearStencilVal)),t.clear(r),r&t.COLOR_BUFFER_BIT&&t.clearColor(a[0],a[1],a[2],a[3]),r&t.DEPTH_BUFFER_BIT&&t.clearDepth(c),r&t.STENCIL_BUFFER_BIT&&t.clearStencil(h)}e.sortAllChildren();for(var u=e._children,d=0;d<u.length;d++){var f=u[d];f!==e.sprite&&f.visit(e.sprite)}e.end()}},s.clearStencil=function(n){var t=cc._renderContext,e=t.getParameter(t.STENCIL_CLEAR_VALUE);t.clearStencil(n),t.clear(t.STENCIL_BUFFER_BIT),t.clearStencil(e)},s.cleanup=function(){this._node,this._textureCopy=null;var n=cc._renderContext;n.deleteFramebuffer(this._fBO),this._depthRenderBuffer&&n.deleteRenderbuffer(this._depthRenderBuffer)},s.updateClearColor=function(n){},s.initWithWidthAndHeight=function(n,t,e,r){var a=this._node;e===cc.Texture2D.PixelFormat.A8&&cc.log("cc.RenderTexture._initWithWidthAndHeightForWebGL() : only RGB and RGBA formats are valid for a render texture;");var c=cc._renderContext;this._fullRect=new cc.Rect(0,0,n,t),n|=0,t|=0,this._oldFBO=c.getParameter(c.FRAMEBUFFER_BINDING);var h,u;cc.configuration.supportsNPOT()?(h=n,u=t):(h=o.NextPOT(n),u=o.NextPOT(t)),this._fullViewport=new cc.Rect(0,0,h,u);for(var d=h*u*4,f=new Uint8Array(d),m=0;m<h*u*4;m++)f[m]=0;this._pixelFormat=e;var v=a._texture=new cc.Texture2D;if(!a._texture)return!1;v.initWithData(f,a._pixelFormat,h,u);var _=c.getParameter(c.RENDERBUFFER_BINDING);if(cc.configuration.checkForGLExtension("GL_QCOM")){if(this._textureCopy=new cc.Texture2D,!this._textureCopy)return!1;this._textureCopy.initWithData(f,a._pixelFormat,h,u)}this._fBO=c.createFramebuffer(),c.bindFramebuffer(c.FRAMEBUFFER,this._fBO),c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,v._glID,0),r!==0&&(this._depthRenderBuffer=c.createRenderbuffer(),c.bindRenderbuffer(c.RENDERBUFFER,this._depthRenderBuffer),c.renderbufferStorage(c.RENDERBUFFER,r,h,u),r===c.DEPTH_STENCIL?c.framebufferRenderbuffer(c.FRAMEBUFFER,c.DEPTH_STENCIL_ATTACHMENT,c.RENDERBUFFER,this._depthRenderBuffer):r===c.STENCIL_INDEX||r===c.STENCIL_INDEX8?c.framebufferRenderbuffer(c.FRAMEBUFFER,c.STENCIL_ATTACHMENT,c.RENDERBUFFER,this._depthRenderBuffer):r===c.DEPTH_COMPONENT16&&c.framebufferRenderbuffer(c.FRAMEBUFFER,c.DEPTH_ATTACHMENT,c.RENDERBUFFER,this._depthRenderBuffer)),c.checkFramebufferStatus(c.FRAMEBUFFER)!==c.FRAMEBUFFER_COMPLETE&&cc.log("Could not attach texture to the framebuffer"),v.setAliasTexParameters();var p=a.sprite=new _ccsg.Sprite(v);return p.scaleY=-1,p.setBlendFunc(c.ONE,c.ONE_MINUS_SRC_ALPHA),c.bindRenderbuffer(c.RENDERBUFFER,_),c.bindFramebuffer(c.FRAMEBUFFER,this._oldFBO),a.autoDraw=!1,a.addChild(p),!0},s.begin=function(){var n=this._node;cc.math.glMatrixMode(cc.math.KM_GL_PROJECTION),cc.math.glPushMatrix(),cc.math.glMatrixMode(cc.math.KM_GL_MODELVIEW),cc.math.glPushMatrix();var t=cc._renderContext,e=cc.director;e.setProjection(e.getProjection());var r=cc.director.getWinSizeInPixels(),a=r.width/n._texture.width,c=r.height/n._texture.height,h=cc.math.Matrix4.createOrthographicProjection(-1/a,1/a,-1/c,1/c,-1,1);cc.math.glMatrixMode(cc.math.KM_GL_PROJECTION),cc.math.glMultMatrix(h);var u=new cc.Rect(0,0,0,0);u.width=this._fullViewport.width,u.height=this._fullViewport.height;var d=u.width/this._fullRect.width,f=u.height/this._fullRect.height;u.x=(this._fullRect.x-this._rtTextureRect.x)*d,u.y=(this._fullRect.y-this._rtTextureRect.y)*f,t.viewport(u.x,u.y,u.width,u.height),this._oldFBO=t.getParameter(t.FRAMEBUFFER_BINDING),t.bindFramebuffer(t.FRAMEBUFFER,this._fBO),cc.configuration.checkForGLExtension("GL_QCOM")&&(t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this._textureCopy._glID,0),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,n._texture._glID,0))},s._beginWithClear=function(n,t,e,r,a,c,h){n/=255,t/=255,e/=255,r/=255;var u=cc._renderContext,d=[0,0,0,0],f=0,m=0;h&u.COLOR_BUFFER_BIT&&(d=u.getParameter(u.COLOR_CLEAR_VALUE),u.clearColor(n,t,e,r)),h&u.DEPTH_BUFFER_BIT&&(f=u.getParameter(u.DEPTH_CLEAR_VALUE),u.clearDepth(a)),h&u.STENCIL_BUFFER_BIT&&(m=u.getParameter(u.STENCIL_CLEAR_VALUE),u.clearStencil(c)),u.clear(h),h&u.COLOR_BUFFER_BIT&&u.clearColor(d[0],d[1],d[2],d[3]),h&u.DEPTH_BUFFER_BIT&&u.clearDepth(f),h&u.STENCIL_BUFFER_BIT&&u.clearStencil(m)},s.end=function(){var n=this._node;cc.renderer._renderingToBuffer(n.__instanceId);var t=cc._renderContext,e=cc.director;t.bindFramebuffer(t.FRAMEBUFFER,this._oldFBO),e.setViewport(),cc.math.glMatrixMode(cc.math.KM_GL_PROJECTION),cc.math.glPopMatrix(),cc.math.glMatrixMode(cc.math.KM_GL_MODELVIEW),cc.math.glPopMatrix()},s.clearRect=function(n,t,e,r){},s.clearDepth=function(n){var t=this._node;t.begin();var e=cc._renderContext,r=e.getParameter(e.DEPTH_CLEAR_VALUE);e.clearDepth(n),e.clear(e.DEPTH_BUFFER_BIT),e.clearDepth(r),t.end()}},{"../core/utils/misc":185}],224:[function(T,N,z){var o=cc.macro,s=cc.math;cc.GLProgram=cc._Class.extend({_updateUniformLocation:function(n){if(!n)return!1;var t,e=this._hashForUniforms[n];if(e){t=!1;for(var r=arguments.length-1,a=0;a<r;++a)arguments[a+1]!==e[a]&&(e[a]=arguments[a+1],t=!0)}else e=[arguments[1],arguments[2],arguments[3],arguments[4]],this._hashForUniforms[n]=e,t=!0;return t},_description:function(){return"<CCGLProgram = "+this.toString()+" | Program = "+this._programObj.toString()+", VertexShader = "+this._vertShader.toString()+", FragmentShader = "+this._fragShader.toString()+">"},_compileShader:function(n,t,e){if(!e||!n)return!1;e=(cc.GLProgram._isHighpSupported()?`precision highp float;
`:`precision mediump float;
`)+`uniform mat4 CC_PMatrix;
uniform mat4 CC_MVMatrix;
uniform mat4 CC_MVPMatrix;
uniform vec4 CC_Time;
uniform vec4 CC_SinTime;
uniform vec4 CC_CosTime;
uniform vec4 CC_Random01;
uniform sampler2D CC_Texture0;
//CC INCLUDES END
`+e,this._glContext.shaderSource(n,e),this._glContext.compileShader(n);var r=this._glContext.getShaderParameter(n,this._glContext.COMPILE_STATUS);return r||(cc.logID(8100,this._glContext.getShaderSource(n)),t===this._glContext.VERTEX_SHADER?cc.log(`cocos2d: 
`+this.vertexShaderLog()):cc.log(`cocos2d: 
`+this.fragmentShaderLog())),!!r},ctor:function(n,t,e){this._uniforms={},this._hashForUniforms={},this._glContext=e||cc._renderContext,this._programObj=null,this._vertShader=null,this._fragShader=null,this._usesTime=!1,this._projectionUpdated=-1,n&&t&&this.init(n,t)},destroyProgram:function(){this._vertShader=null,this._fragShader=null,this._uniforms=null,this._hashForUniforms=null,this._glContext.deleteProgram(this._programObj)},initWithVertexShaderByteArray:function(n,t){var e=this._glContext;this._programObj=e.createProgram(),this._projectionUpdated=-1,this._vertShader=null,this._fragShader=null,n&&(this._vertShader=e.createShader(e.VERTEX_SHADER),this._compileShader(this._vertShader,e.VERTEX_SHADER,n)||cc.logID(8101)),t&&(this._fragShader=e.createShader(e.FRAGMENT_SHADER),this._compileShader(this._fragShader,e.FRAGMENT_SHADER,t)||cc.logID(8102)),this._vertShader&&e.attachShader(this._programObj,this._vertShader),this._fragShader&&e.attachShader(this._programObj,this._fragShader);for(var r in this._hashForUniforms)delete this._hashForUniforms[r];return!0},initWithString:function(n,t){return this.initWithVertexShaderByteArray(n,t)},initWithVertexShaderFilename:function(n,t){var e=cc.loader.getRes(n);if(!e)throw new Error("Please load the resource firset : "+n);var r=cc.loader.getRes(t);if(!r)throw new Error("Please load the resource firset : "+t);return this.initWithVertexShaderByteArray(e,r)},init:function(n,t){return this.initWithVertexShaderFilename(n,t)},addAttribute:function(n,t){this._glContext.bindAttribLocation(this._programObj,t,n)},link:function(){return this._programObj?(this._glContext.linkProgram(this._programObj),this._vertShader&&this._glContext.deleteShader(this._vertShader),this._fragShader&&this._glContext.deleteShader(this._fragShader),this._vertShader=null,this._fragShader=null,cc.game.config[cc.game.CONFIG_KEY.debugMode]&&!this._glContext.getProgramParameter(this._programObj,this._glContext.LINK_STATUS)?(cc.logID(8104,this._glContext.getProgramInfoLog(this._programObj)),cc.gl.deleteProgram(this._programObj),this._programObj=null,!1):!0):(cc.logID(8103),!1)},use:function(){cc.gl.useProgram(this._programObj)},updateUniforms:function(){this._uniforms[o.UNIFORM_PMATRIX]=this._glContext.getUniformLocation(this._programObj,o.UNIFORM_PMATRIX_S),this._uniforms[o.UNIFORM_MVMATRIX]=this._glContext.getUniformLocation(this._programObj,o.UNIFORM_MVMATRIX_S),this._uniforms[o.UNIFORM_MVPMATRIX]=this._glContext.getUniformLocation(this._programObj,o.UNIFORM_MVPMATRIX_S),this._uniforms[o.UNIFORM_TIME]=this._glContext.getUniformLocation(this._programObj,o.UNIFORM_TIME_S),this._uniforms[o.UNIFORM_SINTIME]=this._glContext.getUniformLocation(this._programObj,o.UNIFORM_SINTIME_S),this._uniforms[o.UNIFORM_COSTIME]=this._glContext.getUniformLocation(this._programObj,o.UNIFORM_COSTIME_S),this._usesTime=this._uniforms[o.UNIFORM_TIME]!=null||this._uniforms[o.UNIFORM_SINTIME]!=null||this._uniforms[o.UNIFORM_COSTIME]!=null,this._uniforms[o.UNIFORM_RANDOM01]=this._glContext.getUniformLocation(this._programObj,o.UNIFORM_RANDOM01_S),this._uniforms[o.UNIFORM_SAMPLER]=this._glContext.getUniformLocation(this._programObj,o.UNIFORM_SAMPLER_S),this.use(),this.setUniformLocationWith1i(this._uniforms[o.UNIFORM_SAMPLER],0)},_addUniformLocation:function(n){var t=this._glContext.getUniformLocation(this._programObj,n);this._uniforms[n]=t},getUniformLocationForName:function(n){if(!n)throw new Error("cc.GLProgram.getUniformLocationForName(): uniform name should be non-null");if(!this._programObj)throw new Error("cc.GLProgram.getUniformLocationForName(): Invalid operation. Cannot get uniform location when program is not initialized");return this._uniforms[n]||this._glContext.getUniformLocation(this._programObj,n)},getUniformMVPMatrix:function(){return this._uniforms[o.UNIFORM_MVPMATRIX]},getUniformSampler:function(){return this._uniforms[o.UNIFORM_SAMPLER]},setUniformLocationWith1i:function(n,t){var e=this._glContext;if(typeof n=="string"){if(this._updateUniformLocation(n,t)){var r=this.getUniformLocationForName(n);e.uniform1i(r,t)}}else e.uniform1i(n,t)},setUniformLocationWith2i:function(n,t,e){var r=this._glContext;if(typeof n=="string"){if(this._updateUniformLocation(n,t,e)){var a=this.getUniformLocationForName(n);r.uniform2i(a,t,e)}}else r.uniform2i(n,t,e)},setUniformLocationWith3i:function(n,t,e,r){var a=this._glContext;if(typeof n=="string"){if(this._updateUniformLocation(n,t,e,r)){var c=this.getUniformLocationForName(n);a.uniform3i(c,t,e,r)}}else a.uniform3i(n,t,e,r)},setUniformLocationWith4i:function(n,t,e,r,a){var c=this._glContext;if(typeof n=="string"){if(this._updateUniformLocation(n,t,e,r,a)){var h=this.getUniformLocationForName(n);c.uniform4i(h,t,e,r,a)}}else c.uniform4i(n,t,e,r,a)},setUniformLocationWith2iv:function(n,t){var e=typeof n=="string"?this.getUniformLocationForName(n):n;this._glContext.uniform2iv(e,t)},setUniformLocationWith3iv:function(n,t){var e=typeof n=="string"?this.getUniformLocationForName(n):n;this._glContext.uniform3iv(e,t)},setUniformLocationWith4iv:function(n,t){var e=typeof n=="string"?this.getUniformLocationForName(n):n;this._glContext.uniform4iv(e,t)},setUniformLocationI32:function(n,t){this.setUniformLocationWith1i(n,t)},setUniformLocationWith1f:function(n,t){var e=this._glContext;if(typeof n=="string"){if(this._updateUniformLocation(n,t)){var r=this.getUniformLocationForName(n);e.uniform1f(r,t)}}else e.uniform1f(n,t)},setUniformLocationWith2f:function(n,t,e){var r=this._glContext;if(typeof n=="string"){if(this._updateUniformLocation(n,t,e)){var a=this.getUniformLocationForName(n);r.uniform2f(a,t,e)}}else r.uniform2f(n,t,e)},setUniformLocationWith3f:function(n,t,e,r){var a=this._glContext;if(typeof n=="string"){if(this._updateUniformLocation(n,t,e,r)){var c=this.getUniformLocationForName(n);a.uniform3f(c,t,e,r)}}else a.uniform3f(n,t,e,r)},setUniformLocationWith4f:function(n,t,e,r,a){var c=this._glContext;if(typeof n=="string"){if(this._updateUniformLocation(n,t,e,r,a)){var h=this.getUniformLocationForName(n);c.uniform4f(h,t,e,r,a)}}else c.uniform4f(n,t,e,r,a)},setUniformLocationWith2fv:function(n,t){var e=typeof n=="string"?this.getUniformLocationForName(n):n;this._glContext.uniform2fv(e,t)},setUniformLocationWith3fv:function(n,t){var e=typeof n=="string"?this.getUniformLocationForName(n):n;this._glContext.uniform3fv(e,t)},setUniformLocationWith4fv:function(n,t){var e=typeof n=="string"?this.getUniformLocationForName(n):n;this._glContext.uniform4fv(e,t)},setUniformLocationWithMatrix3fv:function(n,t){var e=typeof n=="string"?this.getUniformLocationForName(n):n;this._glContext.uniformMatrix3fv(e,!1,t)},setUniformLocationWithMatrix4fv:function(n,t){var e=typeof n=="string"?this.getUniformLocationForName(n):n;this._glContext.uniformMatrix4fv(e,!1,t)},setUniformLocationF32:function(n,t,e,r,a){"use strict";switch(arguments.length){case 0:case 1:return;case 2:this.setUniformLocationWith1f(n,t);break;case 3:this.setUniformLocationWith2f(n,t,e);break;case 4:this.setUniformLocationWith3f(n,t,e,r);break;case 5:this.setUniformLocationWith4f(n,t,e,r,a)}},setUniformsForBuiltins:function(){var n=new s.Matrix4,t=new s.Matrix4,e=new s.Matrix4;if(s.glGetMatrix(s.KM_GL_PROJECTION,n),s.glGetMatrix(s.KM_GL_MODELVIEW,t),s.mat4Multiply(e,n,t),this.setUniformLocationWithMatrix4fv(this._uniforms[o.UNIFORM_PMATRIX],n.mat,1),this.setUniformLocationWithMatrix4fv(this._uniforms[o.UNIFORM_MVMATRIX],t.mat,1),this.setUniformLocationWithMatrix4fv(this._uniforms[o.UNIFORM_MVPMATRIX],e.mat,1),this._usesTime){var r=cc.director,a=r.getTotalFrames()*r.getAnimationInterval();this.setUniformLocationWith4f(this._uniforms[o.UNIFORM_TIME],a/10,a,2*a,4*a),this.setUniformLocationWith4f(this._uniforms[o.UNIFORM_SINTIME],a/8,a/4,a/2,Math.sin(a)),this.setUniformLocationWith4f(this._uniforms[o.UNIFORM_COSTIME],a/8,a/4,a/2,Math.cos(a))}this._uniforms[o.UNIFORM_RANDOM01]!==-1&&this.setUniformLocationWith4f(this._uniforms[o.UNIFORM_RANDOM01],Math.random(),Math.random(),Math.random(),Math.random())},_setUniformsForBuiltinsForRenderer:function(n){if(n&&n._renderCmd){var t=new s.Matrix4,e=new s.Matrix4;if(s.glGetMatrix(s.KM_GL_PROJECTION,t),s.mat4Multiply(e,t,n._renderCmd._stackMatrix),this.setUniformLocationWithMatrix4fv(this._uniforms[o.UNIFORM_PMATRIX],t.mat,1),this.setUniformLocationWithMatrix4fv(this._uniforms[o.UNIFORM_MVMATRIX],n._renderCmd._stackMatrix.mat,1),this.setUniformLocationWithMatrix4fv(this._uniforms[o.UNIFORM_MVPMATRIX],e.mat,1),this._usesTime){var r=cc.director,a=r.getTotalFrames()*r.getAnimationInterval();this.setUniformLocationWith4f(this._uniforms[o.UNIFORM_TIME],a/10,a,2*a,4*a),this.setUniformLocationWith4f(this._uniforms[o.UNIFORM_SINTIME],a/8,a/4,a/2,Math.sin(a)),this.setUniformLocationWith4f(this._uniforms[o.UNIFORM_COSTIME],a/8,a/4,a/2,Math.cos(a))}this._uniforms[o.UNIFORM_RANDOM01]!==-1&&this.setUniformLocationWith4f(this._uniforms[o.UNIFORM_RANDOM01],Math.random(),Math.random(),Math.random(),Math.random())}},setUniformForModelViewProjectionMatrix:function(){this._glContext.uniformMatrix4fv(this._uniforms[o.UNIFORM_MVPMATRIX],!1,s.getMat4MultiplyValue(s.projection_matrix_stack.top,s.modelview_matrix_stack.top))},setUniformForModelViewProjectionMatrixWithMat4:function(n){s.mat4Multiply(n,s.projection_matrix_stack.top,s.modelview_matrix_stack.top),this._glContext.uniformMatrix4fv(this._uniforms[o.UNIFORM_MVPMATRIX],!1,n.mat)},setUniformForModelViewAndProjectionMatrixWithMat4:function(){this._glContext.uniformMatrix4fv(this._uniforms[o.UNIFORM_MVMATRIX],!1,s.modelview_matrix_stack.top.mat),this._glContext.uniformMatrix4fv(this._uniforms[o.UNIFORM_PMATRIX],!1,s.projection_matrix_stack.top.mat)},_setUniformForMVPMatrixWithMat4:function(n){if(!n)throw new Error("modelView matrix is undefined.");this._glContext.uniformMatrix4fv(this._uniforms[o.UNIFORM_MVMATRIX],!1,n.mat),this._glContext.uniformMatrix4fv(this._uniforms[o.UNIFORM_PMATRIX],!1,s.projection_matrix_stack.top.mat)},_updateProjectionUniform:function(){var n=s.projection_matrix_stack;n.lastUpdated!==this._projectionUpdated&&(this._glContext.uniformMatrix4fv(this._uniforms[o.UNIFORM_PMATRIX],!1,n.top.mat),this._projectionUpdated=n.lastUpdated)},vertexShaderLog:function(){return this._glContext.getShaderInfoLog(this._vertShader)},getVertexShaderLog:function(){return this._glContext.getShaderInfoLog(this._vertShader)},getFragmentShaderLog:function(){return this._glContext.getShaderInfoLog(this._vertShader)},fragmentShaderLog:function(){return this._glContext.getShaderInfoLog(this._fragShader)},programLog:function(){return this._glContext.getProgramInfoLog(this._programObj)},getProgramLog:function(){return this._glContext.getProgramInfoLog(this._programObj)},reset:function(){this._vertShader=null,this._fragShader=null,this._uniforms.length=0,this._glContext.deleteProgram(this._programObj),this._programObj=null;for(var n in this._hashForUniforms)this._hashForUniforms[n].length=0,delete this._hashForUniforms[n]},getProgram:function(){return this._programObj},retain:function(){},release:function(){}}),cc.GLProgram._highpSupported=null,cc.GLProgram._isHighpSupported=function(){var n=cc._renderContext;if(n.getShaderPrecisionFormat&&cc.GLProgram._highpSupported==null){var t=n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.HIGH_FLOAT);cc.GLProgram._highpSupported=t.precision!==0}return cc.GLProgram._highpSupported}},{}],225:[function(T,N,z){var o=cc.macro.ENABLE_GL_STATE_CACHE,s=0,n=0,t=null,e=0,r=0;o&&(s=16,n=-1,t=new Array(s),e=-1,r=-1),cc.gl={},cc.gl.invalidateStateCache=function(){if(cc.math.glFreeAll(),o){n=-1;for(var a=0;a<s;a++)t[a]=null;e=-1,r=-1}},cc.gl.useProgram=o?function(a){a!==n&&(n=a,cc._renderContext.useProgram(a))}:function(a){cc._renderContext.useProgram(a)},cc.gl.deleteProgram=function(a){o&&a===n&&(n=-1),gl.deleteProgram(a)},cc.gl.setBlending=function(a,c){var h=cc._renderContext;a===h.ONE&&c===h.ZERO?h.disable(h.BLEND):(h.enable(h.BLEND),h.blendFunc(a,c))},cc.gl.blendFunc=o?function(a,c){a===e&&c===r||(e=a,r=c,cc.gl.setBlending(a,c))}:cc.gl.setBlending,cc.gl.blendFuncForParticle=function(a,c){if(a!==e||c!==r){e=a,r=c;var h=cc._renderContext;a===h.ONE&&c===h.ZERO?h.disable(h.BLEND):(h.enable(h.BLEND),h.blendFuncSeparate(h.SRC_ALPHA,c,a,c))}},cc.gl.blendResetToCache=function(){var a=cc._renderContext;a.blendEquation(a.FUNC_ADD),o?cc.gl.setBlending(e,r):cc.gl.setBlending(a.BLEND_SRC,a.BLEND_DST)},cc.gl.setProjectionMatrixDirty=function(){},cc.gl.bindTexture2D=function(a){cc.gl.bindTexture2DN(0,a)},cc.gl.bindTexture2DN=o?function(a,c){if(t[a]!==c){t[a]=c;var h=cc._renderContext;h.activeTexture(h.TEXTURE0+a),c?h.bindTexture(h.TEXTURE_2D,c._glID):h.bindTexture(h.TEXTURE_2D,null)}}:function(a,c){var h=cc._renderContext;h.activeTexture(h.TEXTURE0+a),c?h.bindTexture(h.TEXTURE_2D,c._glID):h.bindTexture(h.TEXTURE_2D,null)},cc.gl.deleteTexture2D=function(a){cc.gl.deleteTexture2DN(0,a)},cc.gl.deleteTexture2DN=function(a,c){o&&c===t[a]&&(t[a]=null),cc._renderContext.deleteTexture(c._glID)},cc.gl.enable=function(a){}},{}],226:[function(T,N,z){var o=cc.PresetShaders,s=cc.macro;cc.shaderCache={TYPE_POSITION_TEXTURECOLOR:0,TYPE_POSITION_TEXTURECOLOR_ALPHATEST:1,TYPE_POSITION_COLOR:2,TYPE_POSITION_TEXTURE:3,TYPE_POSITION_TEXTURE_UCOLOR:4,TYPE_POSITION_TEXTURE_A8COLOR:5,TYPE_POSITION_UCOLOR:6,TYPE_POSITION_LENGTH_TEXTURECOLOR:7,TYPE_SPRITE_POSITION_TEXTURECOLOR:8,TYPE_SPRITE_POSITION_TEXTURECOLOR_ALPHATEST:9,TYPE_SPRITE_POSITION_COLOR:10,TYPE_MAX:10,_programs:{},_init:function(){return this.loadDefaultShaders(),!0},_loadDefaultShader:function(n,t){switch(t){case s.SHADER_POSITION_TEXTURECOLOR:n.initWithVertexShaderByteArray(o.POSITION_TEXTURE_COLOR_VERT,o.POSITION_TEXTURE_COLOR_FRAG),n.addAttribute(s.ATTRIBUTE_NAME_POSITION,s.VERTEX_ATTRIB_POSITION),n.addAttribute(s.ATTRIBUTE_NAME_COLOR,s.VERTEX_ATTRIB_COLOR),n.addAttribute(s.ATTRIBUTE_NAME_TEX_COORD,s.VERTEX_ATTRIB_TEX_COORDS);break;case s.SHADER_SPRITE_POSITION_TEXTURECOLOR:n.initWithVertexShaderByteArray(o.SPRITE_POSITION_TEXTURE_COLOR_VERT,o.POSITION_TEXTURE_COLOR_FRAG),n.addAttribute(s.ATTRIBUTE_NAME_POSITION,s.VERTEX_ATTRIB_POSITION),n.addAttribute(s.ATTRIBUTE_NAME_COLOR,s.VERTEX_ATTRIB_COLOR),n.addAttribute(s.ATTRIBUTE_NAME_TEX_COORD,s.VERTEX_ATTRIB_TEX_COORDS);break;case s.SHADER_POSITION_TEXTURECOLORALPHATEST:n.initWithVertexShaderByteArray(o.POSITION_TEXTURE_COLOR_VERT,o.POSITION_TEXTURE_COLOR_ALPHATEST_FRAG),n.addAttribute(s.ATTRIBUTE_NAME_POSITION,s.VERTEX_ATTRIB_POSITION),n.addAttribute(s.ATTRIBUTE_NAME_COLOR,s.VERTEX_ATTRIB_COLOR),n.addAttribute(s.ATTRIBUTE_NAME_TEX_COORD,s.VERTEX_ATTRIB_TEX_COORDS);break;case s.SHADER_SPRITE_POSITION_TEXTURECOLORALPHATEST:n.initWithVertexShaderByteArray(o.SPRITE_POSITION_TEXTURE_COLOR_VERT,o.POSITION_TEXTURE_COLOR_ALPHATEST_FRAG),n.addAttribute(s.ATTRIBUTE_NAME_POSITION,s.VERTEX_ATTRIB_POSITION),n.addAttribute(s.ATTRIBUTE_NAME_COLOR,s.VERTEX_ATTRIB_COLOR),n.addAttribute(s.ATTRIBUTE_NAME_TEX_COORD,s.VERTEX_ATTRIB_TEX_COORDS);break;case s.SHADER_POSITION_COLOR:n.initWithVertexShaderByteArray(o.POSITION_COLOR_VERT,o.POSITION_COLOR_FRAG),n.addAttribute(s.ATTRIBUTE_NAME_POSITION,s.VERTEX_ATTRIB_POSITION),n.addAttribute(s.ATTRIBUTE_NAME_COLOR,s.VERTEX_ATTRIB_COLOR);break;case s.SHADER_SPRITE_POSITION_COLOR:n.initWithVertexShaderByteArray(o.SPRITE_POSITION_COLOR_VERT,o.POSITION_COLOR_FRAG),n.addAttribute(s.ATTRIBUTE_NAME_POSITION,s.VERTEX_ATTRIB_POSITION),n.addAttribute(s.ATTRIBUTE_NAME_COLOR,s.VERTEX_ATTRIB_COLOR);break;case s.SHADER_POSITION_TEXTURE:n.initWithVertexShaderByteArray(o.POSITION_TEXTURE_VERT,o.POSITION_TEXTURE_FRAG),n.addAttribute(s.ATTRIBUTE_NAME_POSITION,s.VERTEX_ATTRIB_POSITION),n.addAttribute(s.ATTRIBUTE_NAME_TEX_COORD,s.VERTEX_ATTRIB_TEX_COORDS);break;case s.SHADER_POSITION_TEXTURE_UCOLOR:n.initWithVertexShaderByteArray(o.POSITION_TEXTURE_UCOLOR_VERT,o.POSITION_TEXTURE_UCOLOR_FRAG),n.addAttribute(s.ATTRIBUTE_NAME_POSITION,s.VERTEX_ATTRIB_POSITION),n.addAttribute(s.ATTRIBUTE_NAME_TEX_COORD,s.VERTEX_ATTRIB_TEX_COORDS);break;case s.SHADER_POSITION_TEXTUREA8COLOR:n.initWithVertexShaderByteArray(o.POSITION_TEXTURE_A8COLOR_VERT,o.POSITION_TEXTURE_A8COLOR_FRAG),n.addAttribute(s.ATTRIBUTE_NAME_POSITION,s.VERTEX_ATTRIB_POSITION),n.addAttribute(s.ATTRIBUTE_NAME_COLOR,s.VERTEX_ATTRIB_COLOR),n.addAttribute(s.ATTRIBUTE_NAME_TEX_COORD,s.VERTEX_ATTRIB_TEX_COORDS);break;case s.SHADER_POSITION_UCOLOR:n.initWithVertexShaderByteArray(o.POSITION_UCOLOR_VERT,o.POSITION_UCOLOR_FRAG),n.addAttribute("aVertex",s.VERTEX_ATTRIB_POSITION);break;case s.SHADER_POSITION_LENGTHTEXTURECOLOR:n.initWithVertexShaderByteArray(o.POSITION_COLOR_LENGTH_TEXTURE_VERT,o.POSITION_COLOR_LENGTH_TEXTURE_FRAG),n.addAttribute(s.ATTRIBUTE_NAME_POSITION,s.VERTEX_ATTRIB_POSITION),n.addAttribute(s.ATTRIBUTE_NAME_TEX_COORD,s.VERTEX_ATTRIB_TEX_COORDS),n.addAttribute(s.ATTRIBUTE_NAME_COLOR,s.VERTEX_ATTRIB_COLOR);break;default:return void cc.logID(8105)}n.link(),n.updateUniforms()},_reloadShader:function(n){var t=this.programForKey(n);t.reset(),this._loadDefaultShader(t,n)},loadDefaultShaders:function(){},reloadDefaultShaders:function(){this._reloadShader(s.SHADER_POSITION_TEXTURECOLOR),this._reloadShader(s.SHADER_SPRITE_POSITION_TEXTURECOLOR),this._reloadShader(s.SHADER_POSITION_TEXTURECOLORALPHATEST),this._reloadShader(s.SHADER_SPRITE_POSITION_TEXTURECOLORALPHATEST),this._reloadShader(s.SHADER_POSITION_COLOR),this._reloadShader(s.SHADER_POSITION_TEXTURE),this._reloadShader(s.SHADER_POSITION_TEXTURE_UCOLOR),this._reloadShader(s.SHADER_POSITION_TEXTUREA8COLOR),this._reloadShader(s.SHADER_POSITION_UCOLOR)},programForKey:function(n){if(!this._programs[n]){var t=new cc.GLProgram;this._loadDefaultShader(t,n),this._programs[n]=t}return this._programs[n]},getProgram:function(n){return this.programForKey(n)},addProgram:function(n,t){this._programs[t]=n}}},{}],227:[function(T,N,z){cc.PresetShaders={POSITION_UCOLOR_FRAG:`precision lowp float;
varying vec4 v_fragmentColor;
void main()
{
gl_FragColor = v_fragmentColor;
}`,POSITION_UCOLOR_VERT:`attribute vec4 a_position;
uniform vec4 u_color;
uniform float u_pointSize;
varying lowp vec4 v_fragmentColor;
void main(void)
{
gl_Position = (CC_PMatrix * CC_MVMatrix) * a_position;
gl_PointSize = u_pointSize;
v_fragmentColor = u_color;
}`,POSITION_COLOR_FRAG:`precision lowp float;
varying vec4 v_fragmentColor;
void main()
{
gl_FragColor = v_fragmentColor;
}`,POSITION_COLOR_VERT:`attribute vec4 a_position;
attribute vec4 a_color;
varying lowp vec4 v_fragmentColor;
void main()
{
gl_Position = (CC_PMatrix * CC_MVMatrix) * a_position;
v_fragmentColor = a_color;
}`,SPRITE_POSITION_COLOR_VERT:`attribute vec4 a_position;
attribute vec4 a_color;
varying lowp vec4 v_fragmentColor;
void main()
{
gl_Position = CC_PMatrix * a_position;
v_fragmentColor = a_color;
}`,POSITION_COLOR_LENGTH_TEXTURE_FRAG:`//#extension GL_OES_standard_derivatives : enable
varying mediump vec4 v_color;
varying mediump vec2 v_texcoord;
void main()
{
//#if defined GL_OES_standard_derivatives
//gl_FragColor=v_color*smoothstep(0.0, length(fwidth(v_texcoord)), 1.0-length(v_texcoord));
//#else
gl_FragColor = v_color * step(0.0, 1.0 - length(v_texcoord));
//#endif
}`,POSITION_COLOR_LENGTH_TEXTURE_VERT:`attribute mediump vec4 a_position;
attribute mediump vec2 a_texcoord;
attribute mediump vec4 a_color;
varying mediump vec4 v_color;
varying mediump vec2 v_texcoord;
void main()
{
v_color = a_color;
v_texcoord = a_texcoord;
gl_Position = (CC_PMatrix * CC_MVMatrix) * a_position;
}`,POSITION_TEXTURE_FRAG:`precision lowp float;
varying vec2 v_texCoord;
void main()
{
gl_FragColor = texture2D(CC_Texture0, v_texCoord);
}`,POSITION_TEXTURE_VERT:`attribute vec4 a_position;
attribute vec2 a_texCoord;
varying mediump vec2 v_texCoord;
void main()
{
gl_Position = (CC_PMatrix * CC_MVMatrix) * a_position;
v_texCoord = a_texCoord;
}`,POSITION_TEXTURE_UCOLOR_FRAG:`precision lowp float;
uniform vec4 u_color;
varying vec2 v_texCoord;
void main()
{
gl_FragColor=texture2D(CC_Texture0, v_texCoord) * u_color;
}`,POSITION_TEXTURE_UCOLOR_VERT:`attribute vec4 a_position;
attribute vec2 a_texCoord;
varying mediump vec2 v_texCoord;
void main()
{
gl_Position = (CC_PMatrix * CC_MVMatrix) * a_position;
v_texCoord = a_texCoord;
}`,POSITION_TEXTURE_A8COLOR_FRAG:`precision lowp float;
varying vec4 v_fragmentColor;
varying vec2 v_texCoord;
void main()
{
gl_FragColor = vec4(v_fragmentColor.rgb,
v_fragmentColor.a * texture2D(CC_Texture0, v_texCoord).a);
}`,POSITION_TEXTURE_A8COLOR_VERT:`attribute vec4 a_position;
attribute vec2 a_texCoord;
attribute vec4 a_color;
varying lowp vec4 v_fragmentColor;
varying mediump vec2 v_texCoord;
void main()
{
gl_Position = (CC_PMatrix * CC_MVMatrix) * a_position;
v_fragmentColor = a_color;
v_texCoord = a_texCoord;
}`,POSITION_TEXTURE_COLOR_FRAG:`precision lowp float;
varying vec4 v_fragmentColor;
varying vec2 v_texCoord;
void main()
{
gl_FragColor = v_fragmentColor * texture2D(CC_Texture0, v_texCoord);
}`,POSITION_TEXTURE_COLOR_VERT:`attribute vec4 a_position;
attribute vec2 a_texCoord;
attribute vec4 a_color;
varying lowp vec4 v_fragmentColor;
varying mediump vec2 v_texCoord;
void main()
{
gl_Position = (CC_PMatrix * CC_MVMatrix) * a_position;
v_fragmentColor = a_color;
v_texCoord = a_texCoord;
}`,SPRITE_POSITION_TEXTURE_COLOR_VERT:`attribute vec4 a_position;
attribute vec2 a_texCoord;
attribute vec4 a_color;
varying lowp vec4 v_fragmentColor;
varying mediump vec2 v_texCoord;
void main()
{
gl_Position = CC_PMatrix * a_position;
v_fragmentColor = a_color;
v_texCoord = a_texCoord;
}`,POSITION_TEXTURE_COLOR_ALPHATEST_FRAG:`precision lowp float;
varying vec4 v_fragmentColor;
varying vec2 v_texCoord;
uniform float CC_alpha_value;
void main()
{
vec4 texColor=texture2D(CC_Texture0, v_texCoord);
if(texColor.a <= CC_alpha_value)
 discard; 
gl_FragColor=texColor*v_fragmentColor;
}`,EX_SWITCHMASK_FRAG:`precision lowp float;
varying vec4 v_fragmentColor;
varying vec2 v_texCoord;
uniform sampler2D u_texture;
uniform sampler2D u_mask;
void main()
{
vec4 texColorc=texture2D(u_texture, v_texCoord);
vec4 maskColor=texture2D(u_mask, v_texCoord);
vec4 finalColor=vec4(texColor.r, texColor.g, texColor.b, maskColor.a*texColor.a);
gl_FragColor=v_fragmentColor*finalColor;
}`}},{}],228:[function(T,N,z){T("./CCShaders"),T("./CCShaderCache"),T("./CCGLProgram"),T("./CCGLStateCache")},{"./CCGLProgram":224,"./CCGLStateCache":225,"./CCShaderCache":226,"./CCShaders":227}],229:[function(T,N,z){var o=function(s){return{u:s.x,v:s.y}};cc.DrawNode=_ccsg.Node.extend({_buffer:null,_blendFunc:null,_lineWidth:1,_drawColor:null,getBlendFunc:function(){return this._blendFunc},setBlendFunc:function(s,n){n===void 0?(this._blendFunc.src=s.src,this._blendFunc.dst=s.dst):(this._blendFunc.src=s,this._blendFunc.dst=n)},setLineWidth:function(s){this._lineWidth=s},getLineWidth:function(){return this._lineWidth},setDrawColor:function(s){var n=this._drawColor;n.r=s.r,n.g=s.g,n.b=s.b,n.a=s.a==null?255:s.a},getDrawColor:function(){return cc.color(this._drawColor.r,this._drawColor.g,this._drawColor.b,this._drawColor.a)}}),cc.DrawNode.TYPE_DOT=0,cc.DrawNode.TYPE_SEGMENT=1,cc.DrawNode.TYPE_POLY=2,cc.game.once(cc.game.EVENT_RENDERER_INITED,function(){var s=cc.DrawNode.prototype;cc._renderType===cc.game.RENDER_TYPE_CANVAS?(cc._DrawNodeElement=function(n,t,e,r,a,c,h,u,d){this.type=n,this.verts=t||null,this.fillColor=e||null,this.lineWidth=r||0,this.lineColor=a||null,this.lineCap=c||"butt",this.isClosePolygon=h||!1,this.isFill=u||!1,this.isStroke=d||!1},s._className="DrawNodeCanvas",s.ctor=function(){_ccsg.Node.prototype.ctor.call(this);var n=this._renderCmd;n._buffer=this._buffer=[],n._drawColor=this._drawColor=cc.color(255,255,255,255),n._blendFunc=this._blendFunc=new cc.BlendFunc(cc.macro.SRC_ALPHA,cc.macro.ONE_MINUS_SRC_ALPHA),this.init()},s.drawRect=function(n,t,e,r,a){r=r==null?this._lineWidth:r,(a=a||this.getDrawColor()).a==null&&(a.a=255);var c=[n,cc.p(t.x,n.y),t,cc.p(n.x,t.y)],h=new cc._DrawNodeElement(cc.DrawNode.TYPE_POLY);h.verts=c,h.lineWidth=r,h.lineColor=a,h.isClosePolygon=!0,h.isStroke=!0,h.lineCap="butt",h.fillColor=e,e&&(e.a==null&&(e.a=255),h.isFill=!0),this._buffer.push(h)},s.drawCircle=function(n,t,e,r,a,c,h){c=c||this._lineWidth,(h=h||this.getDrawColor()).a==null&&(h.a=255);for(var u=2*Math.PI/r,d=[],f=0;f<=r;f++){var m=f*u,v=t*Math.cos(m+e)+n.x,_=t*Math.sin(m+e)+n.y;d.push(cc.p(v,_))}a&&d.push(cc.p(n.x,n.y));var p=new cc._DrawNodeElement(cc.DrawNode.TYPE_POLY);p.verts=d,p.lineWidth=c,p.lineColor=h,p.isClosePolygon=!0,p.isStroke=!0,this._buffer.push(p)},s.drawQuadBezier=function(n,t,e,r,a,c){a=a||this._lineWidth,(c=c||this.getDrawColor()).a==null&&(c.a=255);for(var h=[],u=0,d=0;d<r;d++){var f=Math.pow(1-u,2)*n.x+2*(1-u)*u*t.x+u*u*e.x,m=Math.pow(1-u,2)*n.y+2*(1-u)*u*t.y+u*u*e.y;h.push(cc.p(f,m)),u+=1/r}h.push(cc.p(e.x,e.y));var v=new cc._DrawNodeElement(cc.DrawNode.TYPE_POLY);v.verts=h,v.lineWidth=a,v.lineColor=c,v.isStroke=!0,v.lineCap="round",this._buffer.push(v)},s.drawCubicBezier=function(n,t,e,r,a,c,h){c=c||this._lineWidth,(h=h||this.getDrawColor()).a==null&&(h.a=255);for(var u=[],d=0,f=0;f<a;f++){var m=Math.pow(1-d,3)*n.x+3*Math.pow(1-d,2)*d*t.x+3*(1-d)*d*d*e.x+d*d*d*r.x,v=Math.pow(1-d,3)*n.y+3*Math.pow(1-d,2)*d*t.y+3*(1-d)*d*d*e.y+d*d*d*r.y;u.push(cc.p(m,v)),d+=1/a}u.push(cc.p(r.x,r.y));var _=new cc._DrawNodeElement(cc.DrawNode.TYPE_POLY);_.verts=u,_.lineWidth=c,_.lineColor=h,_.isStroke=!0,_.lineCap="round",this._buffer.push(_)},s.drawCatmullRom=function(n,t,e,r){this.drawCardinalSpline(n,.5,t,e,r)},s.drawCardinalSpline=function(n,t,e,r,a){r=r||this._lineWidth,(a=a||this.getDrawColor()).a==null&&(a.a=255);for(var c,h,u=[],d=1/n.length,f=0;f<e+1;f++){var m=f/e;m===1?(c=n.length-1,h=1):h=(m-d*(c=0|m/d))/d;var v=cc.cardinalSplineAt(cc.getControlPointAt(n,c-1),cc.getControlPointAt(n,c-0),cc.getControlPointAt(n,c+1),cc.getControlPointAt(n,c+2),t,h);u.push(v)}var _=new cc._DrawNodeElement(cc.DrawNode.TYPE_POLY);_.verts=u,_.lineWidth=r,_.lineColor=a,_.isStroke=!0,_.lineCap="round",this._buffer.push(_)},s.drawDot=function(n,t,e){(e=e||this.getDrawColor()).a==null&&(e.a=255);var r=new cc._DrawNodeElement(cc.DrawNode.TYPE_DOT);r.verts=[n],r.lineWidth=t,r.fillColor=e,this._buffer.push(r)},s.drawDots=function(n,t,e){if(n&&n.length!=0){(e=e||this.getDrawColor()).a==null&&(e.a=255);for(var r=0,a=n.length;r<a;r++)this.drawDot(n[r],t,e)}},s.drawSegment=function(n,t,e,r){e=e||this._lineWidth,(r=r||this.getDrawColor()).a==null&&(r.a=255);var a=new cc._DrawNodeElement(cc.DrawNode.TYPE_POLY);a.verts=[n,t],a.lineWidth=2*e,a.lineColor=r,a.isStroke=!0,a.lineCap="round",this._buffer.push(a)},s.drawPoly_=function(n,t,e,r,a){e=e==null?this._lineWidth:e,(r=r||this.getDrawColor()).a==null&&(r.a=255);var c=new cc._DrawNodeElement(cc.DrawNode.TYPE_POLY);c.verts=n,c.fillColor=t,c.lineWidth=e,c.lineColor=r,c.isClosePolygon=!a,c.isStroke=!0,c.lineCap="round",t&&(c.isFill=!0),this._buffer.push(c)},s.drawPoly=function(n,t,e,r,a){for(var c=[],h=0;h<n.length;h++)c.push(cc.p(n[h].x,n[h].y));return this.drawPoly_(c,t,e,r,a)},s.clear=function(){this._buffer.length=0},T("./CCDrawNodeCanvasRenderCmd"),s._createRenderCmd=function(){return new cc.DrawNode.CanvasRenderCmd(this)}):cc._renderType===cc.game.RENDER_TYPE_WEBGL&&(s._bufferCapacity=0,s._trianglesArrayBuffer=null,s._trianglesWebBuffer=null,s._trianglesReader=null,s._dirty=!1,s._className="DrawNodeWebGL",s.ctor=function(){_ccsg.Node.prototype.ctor.call(this),this._buffer=[],this._blendFunc=new cc.BlendFunc(cc.macro.SRC_ALPHA,cc.macro.ONE_MINUS_SRC_ALPHA),this._drawColor=cc.color(255,255,255,255),this.init()},s.init=function(){return!!_ccsg.Node.prototype.init.call(this)&&(this.shaderProgram=cc.shaderCache.programForKey(cc.macro.SHADER_POSITION_LENGTHTEXTURECOLOR),this._ensureCapacity(64),this._trianglesWebBuffer=cc._renderContext.createBuffer(),this._dirty=!0,!0)},s.drawRect=function(n,t,e,r,a){r=r==null?this._lineWidth:r,(a=a||this.getDrawColor()).a==null&&(a.a=255);var c=[n,cc.p(t.x,n.y),t,cc.p(n.x,t.y)];e==null?this._drawSegments(c,r,a,!0):this.drawPoly(c,e,r,a)},s.drawCircle=function(n,t,e,r,a,c,h){c=c||this._lineWidth,(h=h||this.getDrawColor()).a==null&&(h.a=255);var u,d,f=2*Math.PI/r,m=[];for(u=0;u<=r;u++){var v=u*f,_=t*Math.cos(v+e)+n.x,p=t*Math.sin(v+e)+n.y;m.push(cc.p(_,p))}for(a&&m.push(cc.p(n.x,n.y)),c*=.5,u=0,d=m.length;u<d-1;u++)this.drawSegment(m[u],m[u+1],c,h)},s.drawQuadBezier=function(n,t,e,r,a,c){a=a||this._lineWidth,(c=c||this.getDrawColor()).a==null&&(c.a=255);for(var h=[],u=0,d=0;d<r;d++){var f=Math.pow(1-u,2)*n.x+2*(1-u)*u*t.x+u*u*e.x,m=Math.pow(1-u,2)*n.y+2*(1-u)*u*t.y+u*u*e.y;h.push(cc.p(f,m)),u+=1/r}h.push(cc.p(e.x,e.y)),this._drawSegments(h,a,c,!1)},s.drawCubicBezier=function(n,t,e,r,a,c,h){c=c||this._lineWidth,(h=h||this.getDrawColor()).a==null&&(h.a=255);for(var u=[],d=0,f=0;f<a;f++){var m=Math.pow(1-d,3)*n.x+3*Math.pow(1-d,2)*d*t.x+3*(1-d)*d*d*e.x+d*d*d*r.x,v=Math.pow(1-d,3)*n.y+3*Math.pow(1-d,2)*d*t.y+3*(1-d)*d*d*e.y+d*d*d*r.y;u.push(cc.p(m,v)),d+=1/a}u.push(cc.p(r.x,r.y)),this._drawSegments(u,c,h,!1)},s.drawCatmullRom=function(n,t,e,r){this.drawCardinalSpline(n,.5,t,e,r)},s.drawCardinalSpline=function(n,t,e,r,a){r=r||this._lineWidth,(a=a||this.getDrawColor()).a==null&&(a.a=255);for(var c,h,u=[],d=1/n.length,f=0;f<e+1;f++){var m=f/e;m===1?(c=n.length-1,h=1):h=(m-d*(c=0|m/d))/d;var v=cc.cardinalSplineAt(cc.getControlPointAt(n,c-1),cc.getControlPointAt(n,c-0),cc.getControlPointAt(n,c+1),cc.getControlPointAt(n,c+2),t,h);u.push(v)}r*=.5;for(var _=0,p=u.length;_<p-1;_++)this.drawSegment(u[_],u[_+1],r,a)},s._render=function(){var n=cc._renderContext;n.bindBuffer(n.ARRAY_BUFFER,this._trianglesWebBuffer),this._dirty&&(n.bufferData(n.ARRAY_BUFFER,this._trianglesArrayBuffer,n.STREAM_DRAW),this._dirty=!1);var t=cc.V2F_C4B_T2F.BYTES_PER_ELEMENT;n.enableVertexAttribArray(cc.macro.VERTEX_ATTRIB_POSITION),n.enableVertexAttribArray(cc.macro.VERTEX_ATTRIB_COLOR),n.enableVertexAttribArray(cc.macro.VERTEX_ATTRIB_TEX_COORDS),n.vertexAttribPointer(cc.macro.VERTEX_ATTRIB_POSITION,2,n.FLOAT,!1,t,0),n.vertexAttribPointer(cc.macro.VERTEX_ATTRIB_COLOR,4,n.UNSIGNED_BYTE,!0,t,8),n.vertexAttribPointer(cc.macro.VERTEX_ATTRIB_TEX_COORDS,2,n.FLOAT,!1,t,12),n.drawArrays(n.TRIANGLES,0,3*this._buffer.length),cc.incrementGLDraws(1)},s._ensureCapacity=function(n){var t=this._buffer;if(t.length+n>this._bufferCapacity){var e=cc.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT;if(this._bufferCapacity+=Math.max(this._bufferCapacity,n),t==null||t.length===0)this._buffer=[],this._trianglesArrayBuffer=new ArrayBuffer(e*this._bufferCapacity),this._trianglesReader=new Uint8Array(this._trianglesArrayBuffer);else{for(var r=[],a=new ArrayBuffer(e*this._bufferCapacity),c=0;c<t.length;c++)r[c]=new cc.V2F_C4B_T2F_Triangle(t[c].a,t[c].b,t[c].c,a,c*e);this._trianglesReader=new Uint8Array(a),this._trianglesArrayBuffer=a,this._buffer=r}}},s.drawDot=function(n,t,e){(e=e||this.getDrawColor()).a==null&&(e.a=255);var r={r:0|e.r,g:0|e.g,b:0|e.b,a:0|e.a},a={vertices:{x:n.x-t,y:n.y-t},colors:r,texCoords:{u:-1,v:-1}},c={vertices:{x:n.x-t,y:n.y+t},colors:r,texCoords:{u:-1,v:1}},h={vertices:{x:n.x+t,y:n.y+t},colors:r,texCoords:{u:1,v:1}},u={vertices:{x:n.x+t,y:n.y-t},colors:r,texCoords:{u:1,v:-1}};this._ensureCapacity(6),this._buffer.push(new cc.V2F_C4B_T2F_Triangle(a,c,h,this._trianglesArrayBuffer,this._buffer.length*cc.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT)),this._buffer.push(new cc.V2F_C4B_T2F_Triangle(a,h,u,this._trianglesArrayBuffer,this._buffer.length*cc.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT)),this._dirty=!0},s.drawDots=function(n,t,e){if(n&&n.length!==0){(e=e||this.getDrawColor()).a==null&&(e.a=255);for(var r=0,a=n.length;r<a;r++)this.drawDot(n[r],t,e)}},s.drawSegment=function(n,t,e,r){(r=r||this.getDrawColor()).a==null&&(r.a=255),e=e||.5*this._lineWidth,this._ensureCapacity(18);var a={r:0|r.r,g:0|r.g,b:0|r.b,a:0|r.a},c=cc.v2(n),h=cc.v2(t),u=cc.pNormalize(cc.pPerp(cc.pSub(h,c))),d=cc.pPerp(u),f=cc.pMult(u,e),m=cc.pMult(d,e),v=cc.pSub(h,cc.pAdd(f,m)),_=cc.pAdd(h,cc.pSub(f,m)),p=cc.pSub(h,f),g=cc.pAdd(h,f),y=cc.pSub(c,f),C=cc.pAdd(c,f),S=cc.pSub(c,cc.pSub(f,m)),I=cc.pAdd(c,cc.pAdd(f,m)),b=cc.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT,A=this._trianglesArrayBuffer,E=this._buffer;E.push(new cc.V2F_C4B_T2F_Triangle({vertices:v,colors:a,texCoords:o(cc.pNeg(cc.pAdd(u,d)))},{vertices:_,colors:a,texCoords:o(cc.pSub(u,d))},{vertices:p,colors:a,texCoords:o(cc.pNeg(u))},A,E.length*b)),E.push(new cc.V2F_C4B_T2F_Triangle({vertices:g,colors:a,texCoords:o(u)},{vertices:_,colors:a,texCoords:o(cc.pSub(u,d))},{vertices:p,colors:a,texCoords:o(cc.pNeg(u))},A,E.length*b)),E.push(new cc.V2F_C4B_T2F_Triangle({vertices:g,colors:a,texCoords:o(u)},{vertices:y,colors:a,texCoords:o(cc.pNeg(u))},{vertices:p,colors:a,texCoords:o(cc.pNeg(u))},A,E.length*b)),E.push(new cc.V2F_C4B_T2F_Triangle({vertices:g,colors:a,texCoords:o(u)},{vertices:y,colors:a,texCoords:o(cc.pNeg(u))},{vertices:C,colors:a,texCoords:o(u)},A,E.length*b)),E.push(new cc.V2F_C4B_T2F_Triangle({vertices:S,colors:a,texCoords:o(cc.pSub(d,u))},{vertices:y,colors:a,texCoords:o(cc.pNeg(u))},{vertices:C,colors:a,texCoords:o(u)},A,E.length*b)),E.push(new cc.V2F_C4B_T2F_Triangle({vertices:S,colors:a,texCoords:o(cc.pSub(d,u))},{vertices:I,colors:a,texCoords:o(cc.pAdd(u,d))},{vertices:C,colors:a,texCoords:o(u)},A,E.length*b)),this._dirty=!0},s.drawPoly=function(n,t,e,r,a){if(t!=null){t.a==null&&(t.a=255),r.a==null&&(r.a=255),e=e==null?this._lineWidth:e,e*=.5;var c,h,u,d,f={r:0|t.r,g:0|t.g,b:0|t.b,a:0|t.a},m={r:0|r.r,g:0|r.g,b:0|r.b,a:0|r.a},v=[],_=n.length;for(c=0;c<_;c++){h=cc.v2(n[(c-1+_)%_]),u=cc.v2(n[c]),d=cc.v2(n[(c+1)%_]);var p=cc.pNormalize(cc.pPerp(cc.pSub(u,h))),g=cc.pNormalize(cc.pPerp(cc.pSub(d,u))),y=cc.pMult(cc.pAdd(p,g),1/(cc.pDot(p,g)+1));v[c]={offset:y,n:g}}var C=e>0,S=3*(3*_-2);this._ensureCapacity(S);var I,b,A,E=cc.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT,R=this._trianglesArrayBuffer,O=this._buffer;for(c=0;c<_-2;c++)I={vertices:n[0],colors:f,texCoords:o(cc.v2())},b={vertices:n[c+1],colors:f,texCoords:o(cc.v2())},A={vertices:n[c+2],colors:f,texCoords:o(cc.v2())},O.push(new cc.V2F_C4B_T2F_Triangle(I,b,A,R,O.length*E));if(C)for(c=0;c<_;c++){var P=(c+1)%_;h=cc.v2(n[c]),u=cc.v2(n[P]);var x=v[c].n,w=v[c].offset,L=v[P].offset,D=cc.pSub(h,cc.pMult(w,e)),F=cc.pSub(u,cc.pMult(L,e)),M=cc.pAdd(h,cc.pMult(w,e)),B=cc.pAdd(u,cc.pMult(L,e));I={vertices:D,colors:m,texCoords:o(cc.pNeg(x))},b={vertices:F,colors:m,texCoords:o(cc.pNeg(x))},A={vertices:B,colors:m,texCoords:o(x)},O.push(new cc.V2F_C4B_T2F_Triangle(I,b,A,R,O.length*E)),I={vertices:D,colors:m,texCoords:o(cc.pNeg(x))},b={vertices:M,colors:m,texCoords:o(x)},A={vertices:B,colors:m,texCoords:o(x)},O.push(new cc.V2F_C4B_T2F_Triangle(I,b,A,R,O.length*E))}v=null,this._dirty=!0}else this._drawSegments(n,e,r,!a)},s._drawSegments=function(n,t,e,r){if(t=t==null?this._lineWidth:t,(e=e||this._drawColor).a==null&&(e.a=255),!((t*=.5)<=0)){var a,c,h,u,d={r:0|e.r,g:0|e.g,b:0|e.b,a:0|e.a},f=[],m=n.length;for(a=0;a<m;a++){c=cc.v2(n[(a-1+m)%m]),h=cc.v2(n[a]),u=cc.v2(n[(a+1)%m]);var v=cc.pNormalize(cc.pPerp(cc.pSub(h,c))),_=cc.pNormalize(cc.pPerp(cc.pSub(u,h))),p=cc.pMult(cc.pAdd(v,_),1/(cc.pDot(v,_)+1));f[a]={offset:p,n:_}}var g=3*(3*m-2);this._ensureCapacity(g);var y=cc.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT,C=this._trianglesArrayBuffer,S=this._buffer,I=r?m:m-1;for(a=0;a<I;a++){var b=(a+1)%m;c=cc.v2(n[a]),h=cc.v2(n[b]);var A=f[a].n,E=f[a].offset,R=f[b].offset,O=cc.pSub(c,cc.pMult(E,t)),P=cc.pSub(h,cc.pMult(R,t)),x=cc.pAdd(c,cc.pMult(E,t)),w=cc.pAdd(h,cc.pMult(R,t));S.push(new cc.V2F_C4B_T2F_Triangle({vertices:O,colors:d,texCoords:o(cc.pNeg(A))},{vertices:P,colors:d,texCoords:o(cc.pNeg(A))},{vertices:w,colors:d,texCoords:o(A)},C,S.length*y)),S.push(new cc.V2F_C4B_T2F_Triangle({vertices:O,colors:d,texCoords:o(cc.pNeg(A))},{vertices:x,colors:d,texCoords:o(A)},{vertices:w,colors:d,texCoords:o(A)},C,S.length*y))}f=null,this._dirty=!0}},s.clear=function(){this._buffer.length=0,this._dirty=!0},T("./CCDrawNodeWebGLRenderCmd"),s._createRenderCmd=function(){return new cc.DrawNode.WebGLRenderCmd(this)})})},{"./CCDrawNodeCanvasRenderCmd":230,"./CCDrawNodeWebGLRenderCmd":231}],230:[function(T,N,z){cc.DrawNode.CanvasRenderCmd=function(s){this._rootCtor(s),this._needDraw=!0,this._buffer=null,this._drawColor=null,this._blendFunc=null};var o=cc.DrawNode.CanvasRenderCmd.prototype=Object.create(_ccsg.Node.CanvasRenderCmd.prototype);o.constructor=cc.DrawNode.CanvasRenderCmd,o.rendering=function(s,n,t){var e=s||cc._renderContext,r=(e.getContext(),this._node._displayedOpacity/255);if(r!==0){e.setTransform(this._worldTransform,n,t),e.setGlobalAlpha(r),this._blendFunc&&this._blendFunc.src===cc.macro.SRC_ALPHA&&this._blendFunc.dst===cc.macro.ONE&&e.setCompositeOperation("lighter");for(var a=this._buffer,c=0,h=a.length;c<h;c++){var u=a[c];switch(u.type){case cc.DrawNode.TYPE_DOT:this._drawDot(e,u,n,t);break;case cc.DrawNode.TYPE_SEGMENT:this._drawSegment(e,u,n,t);break;case cc.DrawNode.TYPE_POLY:this._drawPoly(e,u,n,t)}}}},o._drawDot=function(s,n,t,e){var r=n.fillColor,a=n.verts[0],c=n.lineWidth,h=s.getContext();s.setFillStyle("rgba("+(0|r.r)+","+(0|r.g)+","+(0|r.b)+","+r.a/255+")"),h.beginPath(),h.arc(a.x,-a.y,c,0,2*Math.PI,!1),h.closePath(),h.fill()},o._drawSegment=function(s,n,t,e){var r=n.lineColor,a=n.verts[0],c=n.verts[1],h=n.lineWidth,u=n.lineCap,d=s.getContext();s.setStrokeStyle("rgba("+(0|r.r)+","+(0|r.g)+","+(0|r.b)+","+r.a/255+")"),d.lineWidth=h*t,d.beginPath(),d.lineCap=u,d.moveTo(a.x,-a.y),d.lineTo(c.x,-c.y),d.stroke()},o._drawPoly=function(s,n,t,e){var r=n.verts,a=n.lineCap;if(r!=null){var c=n.fillColor,h=n.lineWidth,u=n.lineColor,d=n.isClosePolygon,f=n.isFill,m=n.isStroke,v=s.getContext(),_=r[0];v.lineCap=a,c&&s.setFillStyle("rgba("+(0|c.r)+","+(0|c.g)+","+(0|c.b)+","+c.a/255+")"),h&&(v.lineWidth=h*t),u&&s.setStrokeStyle("rgba("+(0|u.r)+","+(0|u.g)+","+(0|u.b)+","+u.a/255+")"),v.beginPath(),v.moveTo(_.x,-_.y);for(var p=1,g=r.length;p<g;p++)v.lineTo(r[p].x,-r[p].y);d&&v.closePath(),f&&v.fill(),m&&v.stroke()}}},{}],231:[function(T,N,z){cc.DrawNode.WebGLRenderCmd=function(o){this._rootCtor(o),this._needDraw=!0,this._matrix=new cc.math.Matrix4,this._matrix.identity()},cc.DrawNode.WebGLRenderCmd.prototype=Object.create(_ccsg.Node.WebGLRenderCmd.prototype),cc.DrawNode.WebGLRenderCmd.prototype.constructor=cc.DrawNode.WebGLRenderCmd,cc.DrawNode.WebGLRenderCmd.prototype.rendering=function(o){var s=this._node;if(s._buffer.length>0){var n=this._worldTransform,t=this._matrix.mat;t[0]=n.a,t[4]=n.c,t[12]=n.tx,t[1]=n.b,t[5]=n.d,t[13]=n.ty,cc.gl.blendFunc(s._blendFunc.src,s._blendFunc.dst),this._shaderProgram.use(),this._shaderProgram._setUniformForMVPMatrixWithMat4(this._matrix),s._render()}}},{}],232:[function(T,N,z){T("./cocos2d/core"),T("./cocos2d/animation"),T("./cocos2d/particle/CCParticleSystem"),T("./cocos2d/tilemap/CCTiledMap"),T("./cocos2d/motion-streak/CCMotionStreak"),T("./cocos2d/core/components/CCStudioComponent"),T("./extensions/ccpool/CCNodePool"),T("./extensions/ccpool/CCPool"),T("./cocos2d/actions"),T("./external/chipmunk/chipmunk"),T("./extensions/spine"),T("./extensions/dragonbones"),T("./cocos2d/deprecated")},{"./cocos2d/actions":10,"./cocos2d/animation":18,"./cocos2d/core":109,"./cocos2d/core/components/CCStudioComponent":237,"./cocos2d/deprecated":199,"./cocos2d/motion-streak/CCMotionStreak":237,"./cocos2d/particle/CCParticleAsset":215,"./cocos2d/particle/CCParticleSystem":216,"./cocos2d/tilemap/CCTiledMap":237,"./cocos2d/tilemap/CCTiledMapAsset":237,"./extensions/ccpool/CCNodePool":233,"./extensions/ccpool/CCPool":234,"./extensions/dragonbones":237,"./extensions/spine":237,"./external/chipmunk/chipmunk":237}],233:[function(T,N,z){cc.NodePool=function(o){this.poolHandlerComp=o,this._pool=[]},cc.NodePool.prototype={constructor:cc.NodePool,size:function(){return this._pool.length},clear:function(){for(var o=this._pool.length,s=0;s<o;++s)this._pool[s].destroy();this._pool.length=0},put:function(o){if(o&&this._pool.indexOf(o)===-1){o.removeFromParent(!1);var s=this.poolHandlerComp?o.getComponent(this.poolHandlerComp):null;s&&s.unuse&&s.unuse(),this._pool.push(o)}},get:function(){var o=this._pool.length-1;if(o<0)return null;var s=this._pool[o];this._pool.length=o;var n=this.poolHandlerComp?s.getComponent(this.poolHandlerComp):null;return n&&n.reuse&&n.reuse.apply(n,arguments),s}},N.exports=cc.NodePool},{}],234:[function(T,N,z){var o=[];cc.pool={_pool:{},_releaseCB:function(){this.release()},_autoRelease:function(s){var n=s._running!==void 0&&!s._running;cc.director.getScheduler().schedule(this._releaseCB,s,0,0,0,n)},putInPool:function(s){var n=cc.js._getClassId(s.constructor);n&&(this._pool[n]||(this._pool[n]=[]),s.unuse&&s.unuse(),this._pool[n].push(s))},hasObject:function(s){var n=cc.js._getClassId(s),t=this._pool[n];return!(!t||t.length===0)},removeObject:function(s){var n=cc.js._getClassId(s.constructor);if(n){var t=this._pool[n];if(t)for(var e=0;e<t.length;e++)s===t[e]&&t.splice(e,1)}},getFromPool:function(s){if(this.hasObject(s)){var n=cc.js._getClassId(s),t=this._pool[n];o.length=arguments.length-1;for(var e=0;e<o.length;e++)o[e]=arguments[e+1];var r=t.pop();return r.reuse&&r.reuse.apply(r,o),o.length=0,r}},drainAllPools:function(){this._pool={}}}},{}],235:[function(T,N,z){N.exports=function(){"use strict";var o=Math.round(window.devicePixelRatio||1),s=function(b,A){this._color=A||"#666",this._canvas=document.createElement("canvas"),this._ctx=this._canvas.getContext("2d"),this._canvas.className="pstats-canvas",b.appendChild(this._canvas)};s.prototype.init=function(b,A){var E=b*o,R=A*o;this._canvas.width=E,this._canvas.height=R,this._canvas.style.width=b+"px",this._canvas.style.height=A+"px",this._ctx.globalAlpha=1,this._ctx.fillStyle="#444",this._ctx.fillRect(0,0,E,R)};var n=Math.round(window.devicePixelRatio||1),t=function(b){function A(E,R){b.call(this,E,R),this._current=0,this._max=0}return b&&(A.__proto__=b),A.prototype=Object.create(b&&b.prototype),A.prototype.constructor=A,A.prototype.draw=function(E,R){var O=this._canvas.width,P=this._canvas.height;this._current+=.1*(E-this._current),this._max*=.99,this._current>this._max&&(this._max=this._current);var x=Math.round((1-this._current/this._max)*P);this._ctx.globalAlpha=1,this._ctx.drawImage(this._canvas,n,0,O-n,P,0,0,O-n,P),R?(this._ctx.fillStyle="#444",this._ctx.fillRect(O-n,0,n,P),this._ctx.fillStyle="#b70000",this._ctx.fillRect(O-n,x,n,P-x),this._ctx.globalAlpha=.5,this._ctx.fillStyle="#fff",this._ctx.fillRect(O-n,x,n,n)):(this._ctx.fillStyle="#444",this._ctx.fillRect(O-n,0,n,P),this._ctx.fillStyle=this._color,this._ctx.fillRect(O-n,x,n,P-x),this._ctx.globalAlpha=.5,this._ctx.fillStyle="#fff",this._ctx.fillRect(O-n,x,n,n))},A}(s),e=Math.round(window.devicePixelRatio||1),r=function(b){function A(E,R){b.call(this,E,R),this._threshold=0,this._canvas2=document.createElement("canvas"),this._ctx2=this._canvas2.getContext("2d")}return b&&(A.__proto__=b),A.prototype=Object.create(b&&b.prototype),A.prototype.constructor=A,A.prototype.init=function(E,R){b.prototype.init.call(this,E,R);var O=E*e,P=R*e;this._canvas2.width=O,this._canvas2.height=P,this._canvas2.style.width=E+"px",this._canvas2.style.height=R+"px",this._ctx2.globalAlpha=1,this._ctx2.fillStyle="#444",this._ctx2.fillRect(0,0,O,P)},A.prototype.draw=function(E,R){var O=this._canvas.width,P=this._canvas.height;if(this._ctx.globalAlpha=1,this._ctx2.globalAlpha=1,E>this._threshold){var x=P*((E-E%P)/P+1),w=this._threshold;this._threshold=x;var L=w/x;this._ctx2.drawImage(this._canvas,0,0),this._ctx.fillStyle="#444",this._ctx.fillRect(0,0,O,P),this._ctx.drawImage(this._canvas2,e,0,O-e,P,0,Math.round((1-L)*P),O-e,P)}else this._ctx.drawImage(this._canvas,e,0,O-e,P,0,0,O-e,P);var D=Math.round(P*(1-E/this._threshold));R?(this._ctx.fillStyle="#444",this._ctx.fillRect(O-e,0,e,P),this._ctx.fillStyle="#b70000",this._ctx.fillRect(O-e,D,e,P-D),this._ctx.globalAlpha=.5,this._ctx.fillStyle="#fff",this._ctx.fillRect(O-e,D,e,e)):(this._ctx.fillStyle="#444",this._ctx.fillRect(O-e,0,e,P),this._ctx.fillStyle=this._color,this._ctx.fillRect(O-e,D,e,P-D),this._ctx.globalAlpha=.5,this._ctx.fillStyle="#fff",this._ctx.fillRect(O-e,D,e,e))},A}(s),a=Math.round(window.devicePixelRatio||1),c=function(b){function A(E,R,O,P){b.call(this,E,R),this._min=O,this._max=P}return b&&(A.__proto__=b),A.prototype=Object.create(b&&b.prototype),A.prototype.constructor=A,A.prototype.draw=function(E,R){var O=this._canvas.width,P=this._canvas.height,x=(E-this._min)/(this._max-this._min),w=Math.round((1-x)*P);this._ctx.globalAlpha=1,this._ctx.drawImage(this._canvas,a,0,O-a,P,0,0,O-a,P),R?(this._ctx.fillStyle="#444",this._ctx.fillRect(O-a,0,a,P),this._ctx.fillStyle="#b70000",this._ctx.fillRect(O-a,w,a,P-w),this._ctx.globalAlpha=.5,this._ctx.fillStyle="#fff",this._ctx.fillRect(O-a,w,a,a)):(this._ctx.fillStyle="#444",this._ctx.fillRect(O-a,0,a,P),this._ctx.fillStyle=this._color,this._ctx.fillRect(O-a,w,a,P-w),this._ctx.globalAlpha=.5,this._ctx.fillStyle="#fff",this._ctx.fillRect(O-a,w,a,a))},A}(s),h=Math.round(window.devicePixelRatio||1),u=function(b,A){this._colors=A,this._canvas=document.createElement("canvas"),this._ctx=this._canvas.getContext("2d"),this._canvas.className="pstats-canvas",b.appendChild(this._canvas)};u.prototype.init=function(b,A,E){var R=b*h,O=A*h;this._canvas.width=R,this._canvas.height=O*E,this._canvas.style.width=b+"px",this._canvas.style.height=A*E+"px",this._ctx.globalAlpha=1,this._ctx.fillStyle="#444",this._ctx.fillRect(0,0,R,O*E)},u.prototype.draw=function(b){var A=this._canvas.width,E=this._canvas.height;this._ctx.globalAlpha=1,this._ctx.drawImage(this._canvas,h,0,A-h,E,0,0,A-h,E);for(var R=0,O=0;O<b.length;++O){var P=b[O]*E;this._ctx.fillStyle=this._colors[O],this._ctx.fillRect(A-h,R,h,P),R+=P}};var d=function(b,A){this._id=b,this._opts=A||{},this._value=0,this._total=0,this._averageValue=0,this._accumValue=0,this._accumSamples=0,this._accumStart=window.performance.now()},f={value:{}};d.prototype._average=function(b){if(this._opts.average){this._accumValue+=b,++this._accumSamples;var A=performance.now();A-this._accumStart>=this._opts.average&&(this._averageValue=this._accumValue/this._accumSamples,this._accumValue=0,this._accumStart=A,this._accumSamples=0)}},f.value.get=function(){return this._value},f.value.set=function(b){this._value=b},d.prototype.sample=function(){this._average(this._value)},d.prototype.human=function(){var b=this._opts.average?this._averageValue:this._value;return Math.round(100*b)/100},d.prototype.alarm=function(){return this._opts.below&&this._value<this._opts.below||this._opts.over&&this._value>this._opts.over},Object.defineProperties(d.prototype,f);var m=function(b){function A(E,R){b.call(this,E,R),this._time=window.performance.now()}return b&&(A.__proto__=b),A.prototype=Object.create(b&&b.prototype),A.prototype.constructor=A,A.prototype.start=function(){this._time=window.performance.now()},A.prototype.end=function(){this._value=window.performance.now()-this._time,this._average(this._value)},A.prototype.tick=function(){this.end(),this.start()},A.prototype.frame=function(){var E=window.performance.now(),R=E-this._time;this._total++,R>(this._opts.average||1e3)&&(this._value=1e3*this._total/R,this._total=0,this._time=E,this._average(this._value))},A}(d),v=Math.log(1024),_=["Bytes","KB","MB","GB","TB"],p=function(b){function A(E,R,O){b.call(this,R,O),this._stats=E,this._start=0,O.extension.indexOf("memory.")===0&&(this._field=O.extension.substring(7))}return b&&(A.__proto__=b),A.prototype=Object.create(b&&b.prototype),A.prototype.constructor=A,A.prototype.snapshot=function(){this._value=this._stats[this._field]},A.prototype.start=function(){this._start=this._stats[this._field]},A.prototype.end=function(){this._value=this._stats[this._field]-this._start},A.prototype.human=function(){return function(E){var R=Math.floor(Math.log(E)/v);return E===0?"n/a":Math.round(100*E/Math.pow(1024,R))/100+" "+_[R]}(b.prototype.human.call(this))},A}(d),g=function(){window.performance.memory.totalJSHeapSize===0&&console.warn("totalJSHeapSize === 0, performance.memory is only available in Chrome."),this._used=0,this._total=0,this._lastUsed=0},y={alarm:{},used:{},total:{}};g.prototype.tick=function(){this._lastUsed=this._used,this._used=window.performance.memory.usedJSHeapSize,this._total=window.performance.memory.totalJSHeapSize},y.alarm.get=function(){return this._used-this._lastUsed<0},y.used.get=function(){return window.performance.memory.usedJSHeapSize},y.total.get=function(){return this._total},g.prototype.counter=function(b,A){return new p(this,b,A)},Object.defineProperties(g.prototype,y);var C={memory:g},S=document.createElement("style");S.type="text/css",S.textContent=`
  .pstats {
    position: fixed;
    z-index: 9999;

    padding: 5px;
    width: 250px;
    right: 5px;
    bottom: 5px;

    font-size: 10px;
    font-family: 'Roboto Condensed', tahoma, sans-serif;
    overflow: hidden;
    user-select: none;
    cursor: default;

    background: #222;
    border-radius: 3px;
  }

  .pstats-container {
    display: block;
    position: relative;
    color: #888;
    white-space: nowrap;
  }

  .pstats-item {
    position: absolute;
    width: 250px;
    height: 12px;
    left: 0px;
  }

  .pstats-label {
    position: absolute;
    width: 150px;
    height: 12px;
    text-align: left;
    transition: background 0.3s;
  }

  .pstats-label.alarm {
    color: #ccc;
    background: #800;

    transition: background 0s;
  }

  .pstats-counter-id {
    position: absolute;
    width: 90px;
    left: 0px;
  }

  .pstats-counter-value {
    position: absolute;
    width: 60px;
    left: 90px;
    text-align: right;
  }

  .pstats-canvas {
    display: block;
    position: absolute;
    right: 0px;
    top: 1px;
  }

  .pstats-fraction {
    position: absolute;
    width: 250px;
    left: 0px;
  }

  .pstats-legend {
    position: absolute;
    width: 150px;

    text-align: right;
  }

  .pstats-legend > span {
    position: absolute;
    right: 0px;
  }
`,document.head.appendChild(S);var I=function(b,A){if(A=A||{},this._showGraph=A.showGraph===void 0||A._showGraph,this._values=A.values||{},this._fractions=A.fractions||[],this._id2counter={},this._id2item={},this._name2extStats={},A.css){var E=document.createElement("style");E.type="text/css",E.textContent=A.css,document.head.appendChild(E)}if(A.extensions)for(var R=0;R<A.extensions.length;++R){var O=A.extensions[R],P=C[O];P?this._name2extStats[O]=new P:console.warn("Can not find extensions "+O+", please register your extension via pstats.register().")}this._root=document.createElement("div"),this._root.className="pstats";var x=document.createElement("div");x.className="pstats-container",this._root.appendChild(x);var w=0;for(var L in this._values){var D=this._values[L],F=document.createElement("div");F.className="pstats-item";var M=document.createElement("div");M.className="pstats-label";var B=document.createElement("span");B.className="pstats-counter-id",B.textContent=D.desc||L;var W=document.createElement("div");W.className="pstats-counter-value";var V=document.createTextNode("");V.nodeValue="0",M.appendChild(B),M.appendChild(W),W.appendChild(V),F.appendChild(M);var U=void 0;this._showGraph&&(U=D.min!==void 0||D.max!==void 0?new c(F,D.color,D.min||0,D.max||9999):D.threshold?new r(F,D.color):new t(F,D.color)).init(95,10),this._id2item[L]={label:M,valueText:V,graph:U},F.style.top=w+"px",x.appendChild(F),w+=12}if(this._showGraph&&A.fractions)for(var k=0;k<A.fractions.length;++k){var X=A.fractions[k],Y=X.steps,Z=10*Y.length+2;X.colors=X.colors||["#850700","#c74900","#fcb300","#284280","#4c7c0c"];var et=document.createElement("div");et.className="pstats-fraction";var $=document.createElement("div");$.className="pstats-legend",$.style.height=Z+"px";for(var nt=0;nt<Y.length;++nt){var at=document.createElement("span");at.textContent=Y[nt],at.style.color=X.colors[nt],at.style.top=10*nt+"px",$.appendChild(at)}et.appendChild($),et.style.height=Z+"px",et.style.top=w+"px";var rt=new u(et,X.colors);rt.init(95,10,Y.length),X.graph=rt,X.values=new Array(Y.length),x.appendChild(et),w+=10*Y.length+2}x.style.height=w+"px",this._root.style.height=w+"px",this._showGraph||(this._root.style.width="150px"),b.appendChild(this._root)};return I.prototype.item=function(b){if(!b)return null;var A=this._id2counter[b];if(A)return A;var E=this._values[b];if(!E)return null;if(E.extension){var R=E.extension.indexOf("."),O=E.extension.substring(0,R),P=this._name2extStats[O];if(!P)return console.error("extension "+O+" not found, make sure you have register and enable it."),null;A=P.counter(b,E)}else A=new m(b,E);return this._id2counter[b]=A,A},I.prototype.tick=function(){for(var b in this._name2extStats)this._name2extStats[b].tick();for(var A in this._values){var E=this._id2counter[A];if(E){E.sample();var R=E.alarm(),O=E.human(),P=this._id2item[A];P.label.classList.toggle("alarm",R>0),P.valueText.nodeValue=O,this._showGraph&&P.graph.draw(E.value,R)}}if(this._showGraph)for(var x=0;x<this._fractions.length;++x){var w=this._fractions[x],L=this._id2counter[w.base];if(L){for(var D=w.steps,F=0;F<D.length;++F){var M=D[F],B=this._id2counter[M];B&&(w.values[F]=B.value/L.value)}w.graph.draw(w.values)}}},function(){if(window.performance===void 0&&(window.performance={}),!window.performance.now){var b=Date.now();performance.timing&&performance.timing.navigationStart&&(b=performance.timing.navigationStart),window.performance.now=function(){return Date.now()-b}}window.performance.mark||(window.performance.mark=function(){}),window.performance.measure||(window.performance.measure=function(){}),window.performance.memory||(window.performance.memory={usedJSHeapSize:0,totalJSHeapSize:0})}(),{new:function(b,A){var E=new I(b,A);return function(R){return R?E.item(R):E}},register:function(b,A){C[b]=A}}}()},{}],236:[function(T,N,z){function o(t,e){n[t]===void 0&&(n[t]=e)}function s(t){return typeof n[t]=="object"}var n=typeof window=="undefined"?global:window;o("CC_TEST",s("tap")||s("QUnit")),o("CC_EDITOR",s("Editor")&&s("process")&&"electron"in process.versions),o("CC_PREVIEW",!0),o("CC_DEV",!0),o("CC_DEBUG",!0),o("CC_JSB",s("jsb")),o("CC_BUILD",!1),o("CC_WECHATGAME",!1),o("CC_QQPLAY",!1),o("CC_SUPPORT_JIT",!0),cc={},_ccsg={},_cc={},T("./CCDebugger"),cc._initDebugSetting(cc.DebugMode.INFO),T("./polyfill/string"),T("./polyfill/misc"),T("./polyfill/array"),T("./polyfill/typescript"),T("./cocos2d/kazmath"),T("./cocos2d/core/predefine"),ccs={},cp={},T("./cocos2d/shaders"),T("./CCBoot"),T("./cocos2d"),T("./extends"),N.exports=cc},{"./CCBoot":1,"./CCDebugger":2,"./DebugInfos":3,"./cocos2d":200,"./cocos2d/core/predefine":161,"./cocos2d/kazmath":204,"./cocos2d/shaders":228,"./extends":232,"./package.json":void 0,"./polyfill/array":238,"./polyfill/misc":239,"./polyfill/string":240,"./polyfill/typescript":241}],237:[function(T,N,z){},{}],238:[function(T,N,z){Array.isArray||(Array.isArray=function(o){return Object.prototype.toString.call(o)==="[object Array]"})},{}],239:[function(T,N,z){if(Math.sign||(Math.sign=function(n){return(n=+n)==0||Number.isNaN(n)?n:n>0?1:-1}),Number.isInteger||(Number.isInteger=function(n){return typeof n=="number"&&isFinite(n)&&Math.floor(n)===n}),!console.time){var o=window.performance||Date,s=Object.create(null);console.time=function(n){s[n]=o.now()},console.timeEnd=function(n){var t=s[n],e=o.now()-t;console.log(n+": "+e+"ms")}}},{}],240:[function(T,N,z){String.prototype.startsWith||(String.prototype.startsWith=function(o,s){return s=s||0,this.lastIndexOf(o,s)===s}),String.prototype.endsWith||(String.prototype.endsWith=function(o,s){(s===void 0||s>this.length)&&(s=this.length),s-=o.length;var n=this.indexOf(o,s);return n!==-1&&n===s})},{}],241:[function(T,N,z){var o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,n){s.__proto__=n}||function(s,n){for(var t in n)n.hasOwnProperty(t)&&(s[t]=n[t])};window.__extends=function(s,n){function t(){this.constructor=s}o(s,n),s.prototype=n===null?Object.create(n):(t.prototype=n.prototype,new t)},window.__assign=Object.assign||function(s){for(var n,t=1,e=arguments.length;t<e;t++){n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(s[r]=n[r])}return s},window.__rest=function(s,n){var t={};for(var e in s)Object.prototype.hasOwnProperty.call(s,e)&&n.indexOf(e)<0&&(t[e]=s[e]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function"){var r=0;for(e=Object.getOwnPropertySymbols(s);r<e.length;r++)n.indexOf(e[r])<0&&(t[e[r]]=s[e[r]])}return t},window.__decorate=function(s,n,t,e){var r,a=arguments.length,c=a<3?n:e===null?e=Object.getOwnPropertyDescriptor(n,t):e;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(s,n,t,e);else for(var h=s.length-1;h>=0;h--)(r=s[h])&&(c=(a<3?r(c):a>3?r(n,t,c):r(n,t))||c);return a>3&&c&&Object.defineProperty(n,t,c),c},window.__param=function(s,n){return function(t,e){n(t,e,s)}},window.__metadata=function(s,n){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(s,n)},window.__awaiter=function(s,n,t,e){return new(t||(t=Promise))(function(r,a){function c(d){try{u(e.next(d))}catch(f){a(f)}}function h(d){try{u(e.throw(d))}catch(f){a(f)}}function u(d){d.done?r(d.value):new t(function(f){f(d.value)}).then(c,h)}u((e=e.apply(s,n||[])).next())})},window.__generator=function(s,n){function t(u){return function(d){return function(f){if(e)throw new TypeError("Generator is already executing.");for(;h;)try{if(e=1,r&&(a=r[2&f[0]?"return":f[0]?"throw":"next"])&&!(a=a.call(r,f[1])).done)return a;switch(r=0,a&&(f=[0,a.value]),f[0]){case 0:case 1:a=f;break;case 4:return h.label++,{value:f[1],done:!1};case 5:h.label++,r=f[1],f=[0];continue;case 7:f=h.ops.pop(),h.trys.pop();continue;default:if(a=h.trys,!(a=a.length>0&&a[a.length-1])&&(f[0]===6||f[0]===2)){h=0;continue}if(f[0]===3&&(!a||f[1]>a[0]&&f[1]<a[3])){h.label=f[1];break}if(f[0]===6&&h.label<a[1]){h.label=a[1],a=f;break}if(a&&h.label<a[2]){h.label=a[2],h.ops.push(f);break}a[2]&&h.ops.pop(),h.trys.pop();continue}f=n.call(s,h)}catch(m){f=[6,m],r=0}finally{e=a=0}if(5&f[0])throw f[1];return{value:f[0]?f[1]:void 0,done:!0}}([u,d])}}var e,r,a,c,h={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return c={next:t(0),throw:t(1),return:t(2)},typeof Symbol=="function"&&(c[Symbol.iterator]=function(){return this}),c},window.__exportStar=function(s,n){for(var t in s)n.hasOwnProperty(t)||(n[t]=s[t])},window.__values=function(s){var n=typeof Symbol=="function"&&s[Symbol.iterator],t=0;return n?n.call(s):{next:function(){return s&&t>=s.length&&(s=void 0),{value:s&&s[t++],done:!s}}}},window.__read=function(s,n){var t=typeof Symbol=="function"&&s[Symbol.iterator];if(!t)return s;var e,r,a=t.call(s),c=[];try{for(;(n===void 0||n-- >0)&&!(e=a.next()).done;)c.push(e.value)}catch(h){r={error:h}}finally{try{e&&!e.done&&(t=a.return)&&t.call(a)}finally{if(r)throw r.error}}return c},window.__spread=function(){for(var s=[],n=0;n<arguments.length;n++)s=s.concat(__read(arguments[n]));return s},window.__await=function(s){return this instanceof __await?(this.v=s,this):new __await(s)},window.__asyncGenerator=function(s,n,t){function e(m){d[m]&&(u[m]=function(v){return new Promise(function(_,p){f.push([m,v,_,p])>1||r(m,v)})})}function r(m,v){try{(function(_){_.value instanceof __await?Promise.resolve(_.value.v).then(a,c):h(f[0][2],_)})(d[m](v))}catch(_){h(f[0][3],_)}}function a(m){r("next",m)}function c(m){r("throw",m)}function h(m,v){m(v),f.shift(),f.length&&r(f[0][0],f[0][1])}if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var u,d=t.apply(s,n||[]),f=[];return u={},e("next"),e("throw"),e("return"),u[Symbol.asyncIterator]=function(){return this},u},window.__asyncDelegator=function(s){function n(r,a){s[r]&&(t[r]=function(c){return(e=!e)?{value:__await(s[r](c)),done:r==="return"}:a?a(c):c})}var t,e;return t={},n("next"),n("throw",function(r){throw r}),n("return"),t[Symbol.iterator]=function(){return this},t},window.__asyncValues=function(s){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=s[Symbol.asyncIterator];return n?n.call(s):typeof __values=="function"?__values(s):s[Symbol.iterator]()}},{}]},{},[236])})()})()})()})();})();
